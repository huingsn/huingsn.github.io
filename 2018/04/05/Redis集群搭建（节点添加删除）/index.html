<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="集群,Redis," />










<meta name="description" content="一、Redis Cluster（Redis集群）简介1、redis是一个开源的key value存储系统，受到了广大互联网公司的青睐。redis3.0版本之前只支持单例模式，在3.0版本及以后才支持集群，我这里用的是redis3.0.0版本； 2、所有的redis节点彼此互联(PING-PONG机制),内部使用二进制协议优化传输速度和带宽。redis集群采用P2P模式，是完全去中心化的，不存在中心">
<meta property="og:type" content="article">
<meta property="og:title" content="Redis集群搭建（节点添加删除）">
<meta property="og:url" content="https://huyunshun.com/2018/04/05/Redis%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA%EF%BC%88%E8%8A%82%E7%82%B9%E6%B7%BB%E5%8A%A0%E5%88%A0%E9%99%A4%EF%BC%89/index.html">
<meta property="og:site_name" content="简">
<meta property="og:description" content="一、Redis Cluster（Redis集群）简介1、redis是一个开源的key value存储系统，受到了广大互联网公司的青睐。redis3.0版本之前只支持单例模式，在3.0版本及以后才支持集群，我这里用的是redis3.0.0版本； 2、所有的redis节点彼此互联(PING-PONG机制),内部使用二进制协议优化传输速度和带宽。redis集群采用P2P模式，是完全去中心化的，不存在中心">
<meta property="article:published_time" content="2018-04-04T16:00:00.000Z">
<meta property="article:modified_time" content="2020-05-20T10:04:24.701Z">
<meta property="article:author" content="初晨">
<meta property="article:tag" content="集群">
<meta property="article:tag" content="Redis">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://huyunshun.com/2018/04/05/Redis集群搭建（节点添加删除）/"/>





  <title>Redis集群搭建（节点添加删除） | 简</title>
  








  <script type="text/javascript" src="/js/src/love.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome/css/font-awesome.min.css">

  <!-- 看板娘 -->
    
        <script async src="/live2d-widget/autoload.js"></script>
    
 <!-- 飘动的彩带） -->
  <script src="/js/src/piao.js" type="text/javascript"></script>
<meta name="generator" content="Hexo 4.2.1"></head>
<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">简</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">人生短暂，学海无边，而大道至简。</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://huyunshun.com/2018/04/05/Redis%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA%EF%BC%88%E8%8A%82%E7%82%B9%E6%B7%BB%E5%8A%A0%E5%88%A0%E9%99%A4%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="初晨">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://img.huyunshun.com/img/20200522182348.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="简">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Redis集群搭建（节点添加删除）</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-04-05T00:00:00+08:00">
                2018-04-05
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Redis/" itemprop="url" rel="index">
                    <span itemprop="name">Redis</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="一、Redis-Cluster（Redis集群）简介"><a href="#一、Redis-Cluster（Redis集群）简介" class="headerlink" title="一、Redis Cluster（Redis集群）简介"></a>一、Redis Cluster（Redis集群）简介</h2><pre><code>1、redis是一个开源的key value存储系统，受到了广大互联网公司的青睐。redis3.0版本之前只支持单例模式，在3.0版本及以后才支持集群，我这里用的是redis3.0.0版本；
2、所有的redis节点彼此互联(PING-PONG机制),内部使用二进制协议优化传输速度和带宽。redis集群采用P2P模式，是完全去中心化的，不存在中心节点或者代理节点；
3、redis集群是没有统一的入口的，客户端（client）连接集群的时候连接集群中的任意节点（node）即可，集群内部的节点是相互通信的（PING-PONG机制），每个节点都是一个redis实例；
4、为了实现集群的高可用，即判断节点是否健康（能否正常使用），redis-cluster有这么一个投票容错机制：如果集群中超过半数的节点投票认为某个节点挂了，那么这个节点就挂了（fail）。这是判断节点是否挂了的方法；
5、那么如何判断集群是否挂了呢? -&gt; 如果集群中任意一个节点挂了，而且该节点没有从节点（备份节点），那么这个集群就挂了。这是判断集群是否挂了的方法；</code></pre><p>那么为什么任意一个节点挂了（没有从节点）这个集群就挂了呢？ -&gt; 因为集群内置了16384个slot（哈希槽），并且把所有的物理节点映射到了这16384[0-16383]个slot上，或者说把这些slot均等的分配给了各个节点。当需要在Redis集群存放一个数据（key-value）时，redis会先对这个key进行crc16算法，然后得到一个结果。再把这个结果对16384进行求余，这个余数会对应[0-16383]其中一个槽，进而决定key-value存储到哪个节点中。所以一旦某个节点挂了，该节点对应的slot就无法使用，那么就会导致集群无法正常工作。</p>
<p>如果集群超过半数以上master挂掉，无论是否有slave，集群进入fail状态.</p>
<p>综上所述，每个Redis集群理论上最多可以有16384个节点。</p>
<p>关于redis的集群化方案 目前有三种：</p>
<pre><code>（1）Twitter开发的twemproxy
    简介：twemproxy架构简单就是用proxy对后端redis server进行代理 但是由于代理层的消耗性能很低 而且通常涉及多个key的操作都是不支持的 而且本身不支持动态扩容和透明的数据迁移 而且也失去维护 Twitter内部已经不使用了
（2）豌豆荚开发的codis
        codis使用的也是proxy思路，但是做的比较好，是这两种之间的一个中间级，而且支持redis命令是最多的，有图形化GUI管理和监控工具。
（3）redis官方的redis-cluster
        redis-cluster是三个里性能最强大的。因为他使用去中心化的思想，使用hash slot方式，将16348个hash slot 覆盖到所有节点上，对于存储的每个key值 使用CRC16(KEY)&amp;16348=slot 得到他对应的hash slot 并在访问key时就去找他的hash slot在哪一个节点上 然后由当前访问节点从实际被分配了这个hash slot的节点去取数据 节点之间使用轻量协议通信，减少带宽占用，性能很高，自动实现负载均衡与高可用，自动实现failover。并且支持动态扩展，官方已经玩到可以1000个节点 实现的复杂度低，是全新的思路。
        但是它也有一些不足。例如官方没有提供图形化管理工具，运维体验差，全手工数据迁移 ，且自己对自己本身的redis命令支持也不完全等</code></pre><h2 id="二、集群搭建需要的环境"><a href="#二、集群搭建需要的环境" class="headerlink" title="二、集群搭建需要的环境"></a>二、集群搭建需要的环境</h2><p>Redis集群至少需要3个节点，因为投票容错机制要求超过半数节点认为某个节点挂了该节点才是挂了，所以2个节点无法构成集群。<br>要保证集群的高可用，需要每个节点都有从节点，也就是备份节点，所以Redis集群至少需要6台服务器。</p>
<h3 id="1、安装ruby"><a href="#1、安装ruby" class="headerlink" title="1、安装ruby"></a>1、安装ruby</h3><p>创建集群集群脚本是ruby写的</p>
<pre><code>yum -y install ruby
yum -y install rubygems
gem install redis  #安装Redis和ruby的接口

[root@localhost redis]# gem install redis
ERROR:  Error installing redis:
    redis requires Ruby version &gt;= 2.2.2.</code></pre><p>yum库中ruby的版本支持到 2.0.0,可gem 安装redis需要最低是2.2.2。解决办法是采用rvm来更新ruby<br>    安装yum install curl</p>
<p>按照rvm.io提示执行gpg2 –recv-keys 409B6B1796C275462A1703113804BB82D39DC0E3 7D2BAF1CF37B13E2069D6956105BD0E739499BDB<br>curl: (35) SSL connectgpg2 –recv-keys 409B6B1796C275462A1703113804BB82D39DC0E3 7D2BAF1CF37B13E2069D6956105BD0E739499BDB<br>gpg: requesting key D39DC0E3 from hkp server keys.gnupg.net<br>gpg: requesting key 39499BDB from hkp server keys.gnupg.net<br>gpg: key D39DC0E3: “Michal Papis (RVM signing) <a href="mailto:&#109;&#112;&#x61;&#x70;&#x69;&#115;&#x40;&#x67;&#x6d;&#x61;&#105;&#108;&#x2e;&#99;&#x6f;&#x6d;">&#109;&#112;&#x61;&#x70;&#x69;&#115;&#x40;&#x67;&#x6d;&#x61;&#105;&#108;&#x2e;&#99;&#x6f;&#x6d;</a>“ not changed<br>gpg: key D39DC0E3: “Totally Legit Signing Key <a href="mailto:&#109;&#x61;&#108;&#108;&#111;&#114;&#x79;&#x40;&#x65;&#x78;&#97;&#x6d;&#112;&#108;&#x65;&#46;&#111;&#114;&#x67;">&#109;&#x61;&#108;&#108;&#111;&#114;&#x79;&#x40;&#x65;&#x78;&#97;&#x6d;&#112;&#108;&#x65;&#46;&#111;&#114;&#x67;</a>“ not changed<br>gpg: key 39499BDB: “Piotr Kuczynski <a href="mailto:&#x70;&#x69;&#111;&#116;&#x72;&#46;&#107;&#x75;&#x63;&#122;&#x79;&#110;&#x73;&#x6b;&#x69;&#x40;&#x67;&#x6d;&#x61;&#x69;&#x6c;&#46;&#99;&#x6f;&#109;">&#x70;&#x69;&#111;&#116;&#x72;&#46;&#107;&#x75;&#x63;&#122;&#x79;&#110;&#x73;&#x6b;&#x69;&#x40;&#x67;&#x6d;&#x61;&#x69;&#x6c;&#46;&#99;&#x6f;&#109;</a>“ not changed<br>gpg: Total number processed: 3<br>gpg:              unchanged: 3</p>
<p>不通过，下一步的\curl -sSL <a href="https://get.rvm.io" target="_blank" rel="noopener">https://get.rvm.io</a> | bash -s stable<br>或curl -L get.rvm.io | bash -s stable</p>
<p>也就不行。</p>
<p>寻找了很多招办法都不行，只能通过手动下载ruby高版本手动安装，或者通过另外一个工具rbenv安装</p>
<p><strong>手动下载高版本rub安装</strong></p>
<p>解压</p>
<pre><code>[root@localhost tmp]# tar -zxvf ruby-2.6.1.tar.gz -C ../ruby-2.6
[root@localhost tmp]# ./configure --prefix=/usr/local/ruby -prefix是将ruby安装到指定目录，也可以自定义
[root@localhost tmp]# make &amp;&amp; make install</code></pre><p>安装完成</p>
<pre><code>[root@localhost ruby]# bin/ruby -v
ruby 2.6.1p33 (2019-01-30 revision 66950) [x86_64-linux]</code></pre><p>把ruby加入环境变量</p>
<pre><code>[root@localhost ruby]# vim /etc/profile
[root@localhost ruby]# source /etc/profile
[root@localhost ruby]# echo $PATH
/usr/local/ruby/bin:/usr/local/jdk8/bin:/usr/local/jdk8/bin:/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin:/root/bin</code></pre><p>其中设置PATH路径，把安装的ruby放在系统PATH前面，避免调用操作系统自带的ruby</p>
<p>这回执行gem install redis  #安装Redis和ruby的接口<br>成功</p>
<h3 id="2、配置集群"><a href="#2、配置集群" class="headerlink" title="2、配置集群"></a>2、配置集群</h3><p>由于没有这么多Linux，就在同一台上模拟配置6个Redis实例作为六个节点。</p>
<p>在/usr/local/下新建redis_cluster文件，里边新建六个目录node6001~node6006当做六个节点</p>
<p>拷贝创建集群的脚本文件redis-trib.rb到redis_cluster</p>
<p>在分别拷贝配置文件Redis.conf到这些目录下，并且依次修改为自己对应的节点信息。</p>
<p>依次修改信息如下：</p>
<pre><code>port  6001    
bind 192.168.18.140                           #默认ip为127.0.0.1 需要改为其他节点机器可访问的ip 否则创建集群时无法访问对应的端口，无法创建集群
daemonize    yes                               #redis后台运行
pidfile /var/run/redis_6001.pid          #PID
cluster-enabled  yes                        #开启集群  把注释#去掉
cluster-config-file nodes-6001.conf   #集群的配置  配置文件首次启动自动生成6001/6002...
cluster-node-timeout  15000               #请求超时  默认15秒，可自行设置
appendonly  yes                           #aof日志开启  有需要就开启，它会每次写操作都记录一条日志
dir /usr/local/redis-cluster/node6001/    #默认是./，分别修改为当前节点下</code></pre><p>启动并检查六个节点是否启动</p>
<p>编写脚本\start-all.sh</p>
<pre><code>#start 6 redis
/usr/local/redis/bin/redis-server /usr/local/redis-cluster/node6001/redis.conf
/usr/local/redis/bin/redis-server /usr/local/redis-cluster/node6002/redis.conf
/usr/local/redis/bin/redis-server /usr/local/redis-cluster/node6003/redis.conf
/usr/local/redis/bin/redis-server /usr/local/redis-cluster/node6004/redis.conf
/usr/local/redis/bin/redis-server /usr/local/redis-cluster/node6005/redis.conf
/usr/local/redis/bin/redis-server /usr/local/redis-cluster/node6006/redis.conf

stop-all.sh
#stop 6 redis
/usr/local/redis/bin/redis-cli -h 192.168.18.140 -p 6001 shutdown
/usr/local/redis/bin/redis-cli -h 192.168.18.140 -p 6002 shutdown
/usr/local/redis/bin/redis-cli -h 192.168.18.140 -p 6003 shutdown
/usr/local/redis/bin/redis-cli -h 192.168.18.140 -p 6004 shutdown
/usr/local/redis/bin/redis-cli -h 192.168.18.140 -p 6005 shutdown
/usr/local/redis/bin/redis-cli -h 192.168.18.140 -p 6006 shutdown</code></pre><p>赋权：chmod 777 start-all.sh stop-all.sh</p>
<p>执行启动脚本，并检查：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">[root@localhost redis-cluster]# .&#x2F;start-all.sh</span><br><span class="line">[root@localhost redis-cluster]# netstat -tnlp | grep redis</span><br><span class="line">tcp        0      0 192.168.18.140:6001         0.0.0.0:*                   LISTEN      34204&#x2F;redis-server  </span><br><span class="line">tcp        0      0 192.168.18.140:6002         0.0.0.0:*                   LISTEN      34206&#x2F;redis-server  </span><br><span class="line">tcp        0      0 192.168.18.140:6003         0.0.0.0:*                   LISTEN      34208&#x2F;redis-server  </span><br><span class="line">tcp        0      0 192.168.18.140:6004         0.0.0.0:*                   LISTEN      34213&#x2F;redis-server  </span><br><span class="line">tcp        0      0 192.168.18.140:6005         0.0.0.0:*                   LISTEN      34218&#x2F;redis-server  </span><br><span class="line">tcp        0      0 192.168.18.140:6006         0.0.0.0:*                   LISTEN      34223&#x2F;redis-server  </span><br><span class="line">tcp        0      0 192.168.18.140:16001        0.0.0.0:*                   LISTEN      34204&#x2F;redis-server  </span><br><span class="line">tcp        0      0 192.168.18.140:16002        0.0.0.0:*                   LISTEN      34206&#x2F;redis-server  </span><br><span class="line">tcp        0      0 192.168.18.140:16003        0.0.0.0:*                   LISTEN      34208&#x2F;redis-server  </span><br><span class="line">tcp        0      0 192.168.18.140:16004        0.0.0.0:*                   LISTEN      34213&#x2F;redis-server  </span><br><span class="line">tcp        0      0 192.168.18.140:16005        0.0.0.0:*                   LISTEN      34218&#x2F;redis-server  </span><br><span class="line">tcp        0      0 192.168.18.140:16006        0.0.0.0:*                   LISTEN      34223&#x2F;redis-server  </span><br><span class="line"></span><br><span class="line">[root@localhost redis-cluster]# ps -el | grep redis</span><br><span class="line">5 S     0  34204      1  0  80   0 - 36491 ep_pol ?        00:00:00 redis-server</span><br><span class="line">5 S     0  34206      1  0  80   0 - 36491 ep_pol ?        00:00:00 redis-server</span><br><span class="line">5 S     0  34208      1  0  80   0 - 35979 ep_pol ?        00:00:00 redis-server</span><br><span class="line">5 S     0  34213      1  0  80   0 - 35979 ep_pol ?        00:00:00 redis-server</span><br><span class="line">5 S     0  34218      1  0  80   0 - 36491 ep_pol ?        00:00:00 redis-server</span><br><span class="line">5 S     0  34223      1  0  80   0 - 36491 ep_pol ?        00:00:00 redis-server</span><br><span class="line"></span><br><span class="line">执行关闭脚本并检查</span><br><span class="line">[root@localhost redis-cluster]# .&#x2F;stop-all.sh</span><br><span class="line">[root@localhost redis-cluster]# netstat -tnlp | grep redis</span><br><span class="line">[root@localhost redis-cluster]# ps -el | grep redis</span><br></pre></td></tr></table></figure>
<p>一切没问题。</p>
<p>查看集群包括各个节点文件得到如下，文件结构没有问题：</p>
<pre><code>../redis-cluster/
├── node6001
│  ├── appendonly.aof
│  ├── dump.rdb
│  ├── nodes-6001.conf
│  └── redis.conf
├── node6002
│  ├── appendonly.aof
│  ├── dump.rdb
│  ├── nodes-6002.conf
│  └── redis.conf
├── node6003
│  ├── appendonly.aof
│  ├── dump.rdb
│  ├── nodes-6003.conf
│  └── redis.conf
├── node6004
│  ├── appendonly.aof
│  ├── dump.rdb
│  ├── nodes-6004.conf
│  └── redis.conf
├── node6005
│  ├── appendonly.aof
│  ├── dump.rdb
│  ├── nodes-6005.conf
│  └── redis.conf
├── node6006
│  ├── appendonly.aof
│  ├── dump.rdb
│  ├── nodes-6006.conf
│  └── redis.conf
├── redis-trib.rb
├── start-all.sh
└── stop-all.sh</code></pre><p>检查都没有问题，继续下一步。<br>nodes-*.conf这个文件代表集群文件</p>
<h3 id="3、创建集群"><a href="#3、创建集群" class="headerlink" title="3、创建集群"></a>3、创建集群</h3><p>执行创建脚本</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost redis-cluster]<span class="comment"># ./redis-trib.rb create --replicas 1 192.168.18.140:6001 192.168.18.140:6002 192.168.18.140:6003 192.168.18.140:6004 192.168.18.140:6005 192.168.18.140:6006</span></span><br><span class="line">&gt;&gt;&gt; Creating cluster</span><br><span class="line">&gt;&gt;&gt; Performing <span class="built_in">hash</span> slots allocation on 6 nodes...</span><br><span class="line">Using 3 masters:</span><br><span class="line">192.168.18.140:6001</span><br><span class="line">192.168.18.140:6002</span><br><span class="line">192.168.18.140:6003</span><br><span class="line">Adding replica 192.168.18.140:6005 to 192.168.18.140:6001</span><br><span class="line">Adding replica 192.168.18.140:6006 to 192.168.18.140:6002</span><br><span class="line">Adding replica 192.168.18.140:6004 to 192.168.18.140:6003</span><br><span class="line">&gt;&gt;&gt; Trying to optimize slaves allocation <span class="keyword">for</span> anti-affinity</span><br><span class="line">[WARNING] Some slaves are <span class="keyword">in</span> the same host as their master</span><br><span class="line">M: 9a21d2551ce8531661be5ee5f57eea2c61f03dba 192.168.18.140:6001</span><br><span class="line">  slots:0-5460 (5461 slots) master</span><br><span class="line">M: 050dc8a4a6c58ebe7deda200463a035d19637ced 192.168.18.140:6002</span><br><span class="line">  slots:5461-10922 (5462 slots) master</span><br><span class="line">M: 1642f2248dd4e98bdd81971613f0c2afb1531127 192.168.18.140:6003</span><br><span class="line">  slots:10923-16383 (5461 slots) master</span><br><span class="line">S: 5b5bf9e6f0f4c84abbaa93a61a9b3d9168411a09 192.168.18.140:6004</span><br><span class="line">  replicates 050dc8a4a6c58ebe7deda200463a035d19637ced</span><br><span class="line">S: ff5f6edf1fe07f953796ecd19dda50d3a934ca3f 192.168.18.140:6005</span><br><span class="line">  replicates 1642f2248dd4e98bdd81971613f0c2afb1531127</span><br><span class="line">S: b71c3f2524dd94c801cf84a9c90577991e98d34f 192.168.18.140:6006</span><br><span class="line">  replicates 9a21d2551ce8531661be5ee5f57eea2c61f03dba</span><br><span class="line">Can I <span class="built_in">set</span> the above configuration? (<span class="built_in">type</span> <span class="string">'yes'</span> to accept):</span><br></pre></td></tr></table></figure>
<p>以上信息说明了集群配置OK，master和salve都分配好，是否确认创建集群。yes</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">Can I set the above configuration? (type &#39;yes&#39; to accept): yes</span><br><span class="line">&gt;&gt;&gt; Nodes configuration updated</span><br><span class="line">&gt;&gt;&gt; Assign a different config epoch to each node</span><br><span class="line">&gt;&gt;&gt; Sending CLUSTER MEET messages to join the cluster</span><br><span class="line">Waiting for the cluster to join..</span><br><span class="line">&gt;&gt;&gt; Performing Cluster Check (using node 192.168.18.140:6001)</span><br><span class="line">M: 9a21d2551ce8531661be5ee5f57eea2c61f03dba 192.168.18.140:6001</span><br><span class="line">  slots:0-5460 (5461 slots) master</span><br><span class="line">  1 additional replica(s)</span><br><span class="line">M: 050dc8a4a6c58ebe7deda200463a035d19637ced 192.168.18.140:6002</span><br><span class="line">  slots:5461-10922 (5462 slots) master</span><br><span class="line">  1 additional replica(s)</span><br><span class="line">S: 5b5bf9e6f0f4c84abbaa93a61a9b3d9168411a09 192.168.18.140:6004</span><br><span class="line">  slots: (0 slots) slave</span><br><span class="line">  replicates 050dc8a4a6c58ebe7deda200463a035d19637ced</span><br><span class="line">M: 1642f2248dd4e98bdd81971613f0c2afb1531127 192.168.18.140:6003</span><br><span class="line">  slots:10923-16383 (5461 slots) master</span><br><span class="line">  1 additional replica(s)</span><br><span class="line">S: ff5f6edf1fe07f953796ecd19dda50d3a934ca3f 192.168.18.140:6005</span><br><span class="line">  slots: (0 slots) slave</span><br><span class="line">  replicates 1642f2248dd4e98bdd81971613f0c2afb1531127</span><br><span class="line">S: b71c3f2524dd94c801cf84a9c90577991e98d34f 192.168.18.140:6006</span><br><span class="line">  slots: (0 slots) slave</span><br><span class="line">  replicates 9a21d2551ce8531661be5ee5f57eea2c61f03dba</span><br><span class="line">[OK] All nodes agree about slots configuration.</span><br><span class="line">&gt;&gt;&gt; Check for open slots...</span><br><span class="line">&gt;&gt;&gt; Check slots coverage...</span><br><span class="line">[OK] All 16384 slots covered.</span><br></pre></td></tr></table></figure>
<p>集群创建成功！</p>
<p>验证、登录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -c -h 192.168.37.131 -p 7001 ，其中-c表示以集群方式连接redis，-h指定ip地址，-p指定端口号</span><br><span class="line">[root@localhost redis-cluster]# ..&#x2F;redis&#x2F;bin&#x2F;redis-cli -c -h 192.168.18.140 -p 6001</span><br><span class="line"></span><br><span class="line">查看集群节点</span><br><span class="line"></span><br><span class="line">192.168.18.140:6001&gt; cluster nodes</span><br><span class="line">050dc8a4a6c58ebe7deda200463a035d19637ced 192.168.18.140:6002@16002 master - 0 1550668881045 2 connected 5461-10922</span><br><span class="line">5b5bf9e6f0f4c84abbaa93a61a9b3d9168411a09 192.168.18.140:6004@16004 slave 050dc8a4a6c58ebe7deda200463a035d19637ced 0 1550668879000 4 connected</span><br><span class="line">9a21d2551ce8531661be5ee5f57eea2c61f03dba 192.168.18.140:6001@16001 myself,master - 0 1550668878000 1 connected 0-5460</span><br><span class="line">1642f2248dd4e98bdd81971613f0c2afb1531127 192.168.18.140:6003@16003 master - 0 1550668879026 3 connected 10923-16383</span><br><span class="line">ff5f6edf1fe07f953796ecd19dda50d3a934ca3f 192.168.18.140:6005@16005 slave 1642f2248dd4e98bdd81971613f0c2afb1531127 0 1550668879000 5 connected</span><br><span class="line">b71c3f2524dd94c801cf84a9c90577991e98d34f 192.168.18.140:6006@16006 slave 9a21d2551ce8531661be5ee5f57eea2c61f03dba 0 1550668880036 6 connected</span><br><span class="line"></span><br><span class="line">查看集群信息</span><br><span class="line"></span><br><span class="line">192.168.18.140:6001&gt; cluster info</span><br><span class="line">cluster_state:ok</span><br><span class="line">cluster_slots_assigned:16384</span><br><span class="line">cluster_slots_ok:16384</span><br><span class="line">cluster_slots_pfail:0</span><br><span class="line">cluster_slots_fail:0</span><br><span class="line">cluster_known_nodes:6</span><br><span class="line">cluster_size:3</span><br><span class="line">cluster_current_epoch:6</span><br><span class="line">cluster_my_epoch:1</span><br><span class="line">cluster_stats_messages_ping_sent:829</span><br><span class="line">cluster_stats_messages_pong_sent:843</span><br><span class="line">cluster_stats_messages_sent:1672</span><br><span class="line">cluster_stats_messages_ping_received:838</span><br><span class="line">cluster_stats_messages_pong_received:829</span><br><span class="line">cluster_stats_messages_meet_received:5</span><br><span class="line">cluster_stats_messages_received:1672</span><br><span class="line">192.168.18.140:6001&gt;</span><br></pre></td></tr></table></figure>


<h3 id="4、新添加主节点"><a href="#4、新添加主节点" class="headerlink" title="4、新添加主节点"></a>4、新添加主节点</h3><p>准备好Redis节点192.168.18.140:6007并启动起来，执行添加节点命令如下：<br>    ./redis-trib.rb add-node 192.168.18.140:6007 192.168.18.140:6001</p>
<p>添加后的节点设置主节点或从节点</p>
<p>hash槽重新分配</p>
<p>添加完主节点需要对主节点进行hash槽分配这样该主节才可以存数据，就成为主节点。</p>
<p>redis集群有16384个槽，集群中的每个master结点分配一些槽，通过查看集群结点可以看到槽占用情况。<br>./redis-trib.rb reshard 192.168.18.140:6001</p>
<p>提示移动多少槽，输入值1000。</p>
<p>之后提示移动到那个节点，输入节点ID</p>
<p>之后提示我们指定转移哪几个几点的哈希槽，输入all 表示从所有的主节点中随机转移，凑够1000个哈希槽</p>
<p>然后再输入yes，redis集群就开始分配哈希槽了。</p>
<p>分配完成后这个节点也就成为主节点。</p>
<p>如果是把这个节点变成从节点，比如让新节点成为6001的从节点：</p>
<pre><code>redis-cli -c -p 6007 cluster replicate 0b00721a509444db793d28448d8</code></pre><p>命令后面的ID就是6001的ID</p>
<p>使用下面命令来确认一下6007是否已经成为6001的从节点</p>
<p>redis-cli -p 6001 cluster nodes | grep slave | grep 6001ID</p>
<h3 id="5、删除节点"><a href="#5、删除节点" class="headerlink" title="5、删除节点"></a>5、删除节点</h3><p>如果删除主节点：该节点有100个哈希槽，首先把节点的哈希槽转移到其他主节点，命令：<br>./redis-trib.rb reshard 192.168.18.140:6001</p>
<pre><code>系统会提示我们要移动多少哈希槽，这里移动1000个，因为新节点有1000个哈希槽
然后系统提示我们输入要接收这些哈希槽的节点的ID
然后要我们选择从那些节点中转出哈希槽，这里一定要输入6007这个节点的ID，最后输入 done  表示输入完毕
最后使用命令删除节点
./redis-trib.rb del-node 192.168.18.140:6001  需要删除的节点ID</code></pre><p>如果节点是从节点，直接使用删除命令即可。</p>
<p>redis-trib.rb具有以下功能：</p>
<pre><code>create：创建集群 --replicas可以指定从节点个数
check：检查集群
info：查看集群信息
fix：修复集群
reshard：在线迁移slot
rebalance：平衡集群节点slot数量
add-node：将新节点加入集群
del-node：从集群中删除节点
set-timeout：设置集群节点间心跳连接的超时时间
call：在集群全部节点上执行命令
import：将外部redis数据导入集群</code></pre><p>以集群方式登录任意节点，即可以使用这些命令</p>
<h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testRedis</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">           <span class="comment">// 创建并填充节点信息</span></span><br><span class="line">Set&lt;HostAndPort&gt; nodes = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line">nodes.add(<span class="keyword">new</span> HostAndPort(<span class="string">"192.168.18.140"</span>, <span class="number">6001</span>));</span><br><span class="line">nodes.add(<span class="keyword">new</span> HostAndPort(<span class="string">"192.168.18.140"</span>, <span class="number">6002</span>));</span><br><span class="line">nodes.add(<span class="keyword">new</span> HostAndPort(<span class="string">"192.168.18.140"</span>, <span class="number">6003</span>));</span><br><span class="line">nodes.add(<span class="keyword">new</span> HostAndPort(<span class="string">"192.168.18.140"</span>, <span class="number">6004</span>));</span><br><span class="line">nodes.add(<span class="keyword">new</span> HostAndPort(<span class="string">"192.168.18.140"</span>, <span class="number">6005</span>));</span><br><span class="line">nodes.add(<span class="keyword">new</span> HostAndPort(<span class="string">"192.168.18.140"</span>, <span class="number">6006</span>));</span><br><span class="line"><span class="comment">// 创建集群对象</span></span><br><span class="line">JedisCluster jedisCluster = <span class="keyword">new</span> JedisCluster(nodes);</span><br><span class="line"><span class="comment">// 使用jedisCluster操作redis</span></span><br><span class="line">String key = <span class="string">"cluster"</span>;</span><br><span class="line">String setResult = jedisCluster.set(key, <span class="string">"hello redis cluster "</span>);</span><br><span class="line">System.out.println(setResult);</span><br><span class="line">String getResult = jedisCluster.get(key);</span><br><span class="line">System.out.println(getResult);</span><br><span class="line"><span class="comment">//关闭连接</span></span><br><span class="line">jedisCluster.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
     <!-- 相关文章推荐 -->
    
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/%E9%9B%86%E7%BE%A4/" rel="tag"># 集群</a>
          
            <a href="/tags/Redis/" rel="tag"># Redis</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/04/05/%E7%BC%93%E5%AD%98Redis%20%E5%9C%A8%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93%E6%95%B4%E7%90%86/" rel="next" title="缓存Redis 在项目总结整理">
                <i class="fa fa-chevron-left"></i> 缓存Redis 在项目总结整理
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/04/05/%E7%BC%93%E5%AD%98%E5%92%8Cmapper/" rel="prev" title="Mybatis缓存和mapper配置">
                Mybatis缓存和mapper配置 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
        <!-- JiaThis Button BEGIN -->
<div class="jiathis_style">
<span class="jiathis_txt">分享到：</span>
<a class="jiathis_button_fav">收藏夹</a>
<a class="jiathis_button_copy">复制网址</a>
<a class="jiathis_button_email">邮件</a>
<a class="jiathis_button_weixin">微信</a>
<a class="jiathis_button_qzone">QQ空间</a>
<a class="jiathis_button_tqq">腾讯微博</a>
<a class="jiathis_button_douban">豆瓣</a>
<a class="jiathis_button_share">一键分享</a>

<a href="http://www.jiathis.com/share?uid=2140465" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank">更多</a>
<a class="jiathis_counter_style"></a>
</div>
<script type="text/javascript" >
var jiathis_config={
  data_track_clickback:true,
  summary:"",
  shortUrl:false,
  hideMore:false
}
</script>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=" charset="utf-8"></script>
<!-- JiaThis Button END -->
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="https://img.huyunshun.com/img/20200522182348.png"
                alt="初晨" />
            
              <p class="site-author-name" itemprop="name">初晨</p>
              <p class="site-description motion-element" itemprop="description">永远不要说你知道本质，更别说真相了。</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/%7C%7C%20archive">
              
                  <span class="site-state-item-count">249</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">46</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">109</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          
<!--近期文章版块-->
            
                <div class="links-of-blogroll motion-element links-of-blogroll-block">
                  <div class="links-of-blogroll-title">
                    <!-- modify icon to fire by szw -->
                    <i class="fa fa-history fa-" aria-hidden="true"></i>
                    近期文章
                  </div>
                  <ul class="links-of-blogroll-list">
                    
                    
                      <li>
                        <a href="/2020/05/22/WebSocket%E3%80%81Socket%E3%80%81TCP%E3%80%81HTTP%E5%8C%BA%E5%88%AB/" title="WebSocket、Socket、TCP、HTTP区别" target="_blank">WebSocket、Socket、TCP、HTTP区别</a>
                      </li>
                    
                      <li>
                        <a href="/2020/05/19/Springboot%E9%A1%B9%E7%9B%AE%E7%9A%84%E6%8E%A5%E5%8F%A3%E9%98%B2%E5%88%B7/" title="Springboot项目的接口防刷" target="_blank">Springboot项目的接口防刷</a>
                      </li>
                    
                      <li>
                        <a href="/2020/05/03/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3Volatile%E5%85%B3%E9%94%AE%E5%AD%97%E5%8F%8A%E5%85%B6%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86/" title="深入理解Volatile关键字及其实现原理" target="_blank">深入理解Volatile关键字及其实现原理</a>
                      </li>
                    
                      <li>
                        <a href="/2020/04/20/%E4%BD%BF%E7%94%A8vscode%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E7%AC%94%E8%AE%B0%E7%8E%AF%E5%A2%83/" title="使用vscode搭建个人笔记环境" target="_blank">使用vscode搭建个人笔记环境</a>
                      </li>
                    
                      <li>
                        <a href="/2020/01/20/HBase%E4%BB%8B%E7%BB%8D%E5%AE%89%E8%A3%85%E4%B8%8E%E6%93%8D%E4%BD%9C/" title="HBase介绍安装与操作" target="_blank">HBase介绍安装与操作</a>
                      </li>
                    
                  </ul>
                </div>
            
          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#一、Redis-Cluster（Redis集群）简介"><span class="nav-number">1.</span> <span class="nav-text">一、Redis Cluster（Redis集群）简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#二、集群搭建需要的环境"><span class="nav-number">2.</span> <span class="nav-text">二、集群搭建需要的环境</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1、安装ruby"><span class="nav-number">2.1.</span> <span class="nav-text">1、安装ruby</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2、配置集群"><span class="nav-number">2.2.</span> <span class="nav-text">2、配置集群</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3、创建集群"><span class="nav-number">2.3.</span> <span class="nav-text">3、创建集群</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4、新添加主节点"><span class="nav-number">2.4.</span> <span class="nav-text">4、新添加主节点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5、删除节点"><span class="nav-number">2.5.</span> <span class="nav-text">5、删除节点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#测试"><span class="nav-number">2.6.</span> <span class="nav-text">测试</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2018 &mdash; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Copyright</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  


</body>
</html>
