<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Elasticsearch," />










<meta name="description" content="搜索API搜索API 端点地址12345678910111213141516GET &#x2F;bank&#x2F;accounts&#x2F;_search?q&#x3D;account_number:222#从索引bank里面搜索字段firstname为Rachelle的记录GET &#x2F;bank&#x2F;_search?q&#x3D;firstname:Rachelle#从索引ban">
<meta property="og:type" content="article">
<meta property="og:title" content="Elasticsearch搜索（API和DSL）">
<meta property="og:url" content="https://huyunshun.com/2019/03/14/Elasticsearch%E6%90%9C%E7%B4%A2%EF%BC%88API%E5%92%8CDSL%EF%BC%89/index.html">
<meta property="og:site_name" content="简">
<meta property="og:description" content="搜索API搜索API 端点地址12345678910111213141516GET &#x2F;bank&#x2F;accounts&#x2F;_search?q&#x3D;account_number:222#从索引bank里面搜索字段firstname为Rachelle的记录GET &#x2F;bank&#x2F;_search?q&#x3D;firstname:Rachelle#从索引ban">
<meta property="og:image" content="https://img.huyunshun.com/img1/Elasticsearch/sdafasdgsdg524535478imgclip.png">
<meta property="og:image" content="https://img.huyunshun.com/img1/Elasticsearch/sdafasdgsdg524535478imgclip_1.png">
<meta property="article:published_time" content="2019-03-13T16:00:00.000Z">
<meta property="article:modified_time" content="2020-05-20T10:04:24.703Z">
<meta property="article:author" content="初晨">
<meta property="article:tag" content="Elasticsearch">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://img.huyunshun.com/img1/Elasticsearch/sdafasdgsdg524535478imgclip.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://huyunshun.com/2019/03/14/Elasticsearch搜索（API和DSL）/"/>





  <title>Elasticsearch搜索（API和DSL） | 简</title>
  








  <script type="text/javascript" src="/js/src/love.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome/css/font-awesome.min.css">

  <!-- 看板娘 -->
    
        <script async src="/live2d-widget/autoload.js"></script>
    
 <!-- 飘动的彩带） -->
  <script src="/js/src/piao.js" type="text/javascript"></script>
<meta name="generator" content="Hexo 4.2.1"></head>
<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">简</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">人生短暂，学海无边，而大道至简。</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://huyunshun.com/2019/03/14/Elasticsearch%E6%90%9C%E7%B4%A2%EF%BC%88API%E5%92%8CDSL%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="初晨">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://img.huyunshun.com/img/20200522182348.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="简">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Elasticsearch搜索（API和DSL）</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-03-14T00:00:00+08:00">
                2019-03-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Elasticsearch/" itemprop="url" rel="index">
                    <span itemprop="name">Elasticsearch</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="搜索API"><a href="#搜索API" class="headerlink" title="搜索API"></a>搜索API</h1><h2 id="搜索API-端点地址"><a href="#搜索API-端点地址" class="headerlink" title="搜索API 端点地址"></a>搜索API 端点地址</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;bank&#x2F;accounts&#x2F;_search?q&#x3D;account_number:222</span><br><span class="line"></span><br><span class="line">#从索引bank里面搜索字段firstname为Rachelle的记录</span><br><span class="line"></span><br><span class="line">GET &#x2F;bank&#x2F;_search?q&#x3D;firstname:Rachelle</span><br><span class="line"></span><br><span class="line">#从索引bank、user里面搜索字段firstname为Rachelle的记录</span><br><span class="line"></span><br><span class="line">GET &#x2F;bank,user&#x2F;_search?q&#x3D;firstname:Rachelle</span><br><span class="line"></span><br><span class="line">#从所有索引里面搜索字段firstname为Rachelle的记录</span><br><span class="line">GET &#x2F;_all&#x2F;_search?q&#x3D;firstname:Rachelle</span><br><span class="line">GET &#x2F;_search?q&#x3D;firstname:Rachelle</span><br><span class="line"></span><br><span class="line">#说明：搜索的端点地址可以是多索引多mapping type的。</span><br><span class="line">#搜索的参数可作为URI请求参数给出，也可用 request body 给出</span><br></pre></td></tr></table></figure>

<h2 id="URI-Search"><a href="#URI-Search" class="headerlink" title="URI Search"></a>URI Search</h2><p>URI 搜索方式通过URI参数来指定查询相关参数。</p>
<p>GET /bank/_search?q=account_number:222</p>
<p>可用的参数请参考： <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/search-uri-request.html" target="_blank" rel="noopener">https://www.elastic.co/guide/en/elasticsearch/reference/current/search-uri-request.html</a></p>
<p>查询结果说明</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;took&quot;: 3,#耗时（ms）</span><br><span class="line">  &quot;timed_out&quot;: false,#是否超时</span><br><span class="line">  &quot;_shards&quot;: &#123;#查询了多少分片</span><br><span class="line">    &quot;total&quot;: 5,</span><br><span class="line">    &quot;successful&quot;: 5,</span><br><span class="line">    &quot;skipped&quot;: 0,</span><br><span class="line">    &quot;failed&quot;: 0</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;hits&quot;: &#123;#命中结果</span><br><span class="line">    &quot;total&quot;: 1, #命中总数</span><br><span class="line">    &quot;max_score&quot;: 1,#最高得分</span><br><span class="line">    &quot;hits&quot;: [#本页结果文档数组</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot;: &quot;bank&quot;,</span><br><span class="line">        &quot;_type&quot;: &quot;accounts&quot;, </span><br><span class="line">        &quot;_id&quot;: &quot;222&quot;,</span><br><span class="line">        &quot;_score&quot;: 1,</span><br><span class="line">        &quot;_source&quot;: &#123;</span><br><span class="line">          &quot;account_number&quot;: 222,</span><br><span class="line">          &quot;balance&quot;: 14764,</span><br><span class="line">          &quot;firstname&quot;: &quot;Rachelle&quot;,</span><br><span class="line">          &quot;lastname&quot;: &quot;Rice&quot;,</span><br><span class="line">          &quot;age&quot;: 36,</span><br><span class="line">          &quot;gender&quot;: &quot;M&quot;,</span><br><span class="line">          &quot;address&quot;: &quot;333 Narrows Avenue&quot;,</span><br><span class="line">          &quot;employer&quot;: &quot;Enaut&quot;,</span><br><span class="line">          &quot;email&quot;: &quot;rachellerice@enaut.com&quot;,</span><br><span class="line">          &quot;city&quot;: &quot;Wright&quot;,</span><br><span class="line">          &quot;state&quot;: &quot;AZ&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="特殊的查询参数用法"><a href="#特殊的查询参数用法" class="headerlink" title="特殊的查询参数用法"></a>特殊的查询参数用法</h3><p>有多少文档匹配某个查询：GET /bank/_search?q=city:b*&amp;size=0</p>
<p>有没有文档匹配某个查询：GET /bank/_search?q=city:b*&amp;size=0&amp;terminate_after=1 #”terminated_early”: true,</p>
<h2 id="Request-body-Search"><a href="#Request-body-Search" class="headerlink" title="Request body Search"></a>Request body Search</h2><p>Request body 搜索方式以JSON格式在请求体中定义查询 query。请求方式可以是 GET 、POST 。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;bank&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">    &quot;query&quot;:&#123;</span><br><span class="line">        &quot;term&quot;:&#123;&quot;firstname&quot;:&quot;Effie&quot;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可用的参数:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">timeout：请求超时时长，限定在指定时长内响应（即使没查完）；</span><br><span class="line">from： 分页的起始行，默认0；</span><br><span class="line">size：分页大小；</span><br><span class="line">request_cache：是否缓存请求结果，默认true。</span><br><span class="line">terminate_after：限定每个分片取几个文档。如果设置，则响应将有一个布尔型字段terminated_early来指示查询执行是否实际已经terminate_early。缺省为no terminate_after；</span><br><span class="line">search_type：查询的执行方式，可选值dfs_query_then_fetch or query_then_fetch ，默认： query_then_fetch ；</span><br><span class="line">batched_reduce_size：一次在协调节点上应该减少的分片结果的数量。如果请求中的潜在分片数量可能很大，则应将此值用作保护机制以减少每个搜索请求的内存开销。</span><br></pre></td></tr></table></figure>
<h3 id="query-元素定义查询"><a href="#query-元素定义查询" class="headerlink" title="query 元素定义查询"></a>query 元素定义查询</h3><p>query 元素用Query DSL 来定义查询。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">    &quot;query&quot; : &#123;</span><br><span class="line">        &quot;term&quot; : &#123;&quot;firstname&quot;:&quot;Effie&quot;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="指定返回哪些内容"><a href="#指定返回哪些内容" class="headerlink" title="指定返回哪些内容"></a>指定返回哪些内容</h3><h4 id="source-filter-对-source字段进行选择"><a href="#source-filter-对-source字段进行选择" class="headerlink" title="source filter  对_source字段进行选择"></a>source filter  对_source字段进行选择</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">    &quot;_source&quot;: false,</span><br><span class="line">    &quot;query&quot; : &#123;</span><br><span class="line">        &quot;term&quot; : &#123;&quot;firstname&quot;:&quot;Virginia&quot;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#通配符查询</span><br><span class="line"></span><br><span class="line">GET &#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">    &quot;_source&quot;: [ &quot;obj1.*&quot;, &quot;obj2.*&quot; ],</span><br><span class="line">    &quot;query&quot; : &#123;</span><br><span class="line">        &quot;term&quot; : &#123;&quot;firstname&quot;:&quot;Virginia&quot;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET &#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">    &quot;_source&quot;: &quot;obj.*&quot;,</span><br><span class="line">    &quot;query&quot; : &#123;</span><br><span class="line">        &quot;term&quot; : &#123;&quot;firstname&quot;:&quot;Virginia&quot;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#包含什么不包含什么</span><br><span class="line">GET &#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">    &quot;_source&quot;: &#123;</span><br><span class="line">        &quot;includes&quot;: [ &quot;obj1.*&quot;, &quot;obj2.*&quot; ],</span><br><span class="line">        &quot;excludes&quot;: [ &quot;*.description&quot; ]</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;query&quot; : &#123;</span><br><span class="line">        &quot;term&quot; : &#123;&quot;firstname&quot;:&quot;Virginia&quot;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="stored-fields-来指定返回哪些stored字段"><a href="#stored-fields-来指定返回哪些stored字段" class="headerlink" title="stored_fields 来指定返回哪些stored字段"></a>stored_fields 来指定返回哪些stored字段</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">    &quot;stored_fields&quot; : [&quot;account_number&quot;, &quot;age&quot;],</span><br><span class="line">    &quot;query&quot; : &#123;</span><br><span class="line">        &quot;term&quot; : &#123;&quot;firstname&quot;:&quot;Virginia&quot;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>说明：* 可用来指定返回所有存储字段</p>
<h4 id="docValue-Field-返回存储了docValue的字段值"><a href="#docValue-Field-返回存储了docValue的字段值" class="headerlink" title="docValue Field 返回存储了docValue的字段值"></a>docValue Field 返回存储了docValue的字段值</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">    &quot;query&quot; : &#123;</span><br><span class="line">        &quot;match_all&quot;: &#123;&#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;docvalue_fields&quot; : [&quot;account_number&quot;, &quot;age&quot;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="version-来指定返回文档的版本字段"><a href="#version-来指定返回文档的版本字段" class="headerlink" title="version 来指定返回文档的版本字段"></a>version 来指定返回文档的版本字段</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">    &quot;version&quot;: true,</span><br><span class="line">    &quot;query&quot; : &#123;</span><br><span class="line">        &quot;term&quot; : &#123;&quot;firstname&quot;:&quot;Virginia&quot;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="explain-返回文档的评分解释"><a href="#explain-返回文档的评分解释" class="headerlink" title="explain 返回文档的评分解释"></a>explain 返回文档的评分解释</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">    &quot;explain&quot;: true,</span><br><span class="line">    &quot;query&quot; : &#123;</span><br><span class="line">        &quot;term&quot; : &#123;&quot;firstname&quot;:&quot;Virginia&quot;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Script-Field-用脚本来对命中的每个文档的字段进行运算后返回"><a href="#Script-Field-用脚本来对命中的每个文档的字段进行运算后返回" class="headerlink" title="Script Field 用脚本来对命中的每个文档的字段进行运算后返回"></a>Script Field 用脚本来对命中的每个文档的字段进行运算后返回</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;bank&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match_all&quot;: &#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;script_fields&quot;: &#123;</span><br><span class="line">    &quot;test1&quot;: &#123;</span><br><span class="line">      &quot;script&quot;: &#123;</span><br><span class="line">        &quot;lang&quot;: &quot;painless&quot;,</span><br><span class="line">        &quot;source&quot;: &quot;doc[&#39;balance&#39;].value * 2&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;test2&quot;: &#123;</span><br><span class="line">      &quot;script&quot;: &#123;</span><br><span class="line">        &quot;lang&quot;: &quot;painless&quot;,</span><br><span class="line">        &quot;source&quot;: &quot;doc[&#39;age&#39;].value * params.factor&quot;,</span><br><span class="line">        &quot;params&quot;: &#123;</span><br><span class="line">          &quot;factor&quot;: 2</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; &#125;&#125;</span><br></pre></td></tr></table></figure>
<p>说明：params  _source 取 _source字段值，官方推荐使用doc，理由是用doc效率比取_source 高</p>
<h4 id="min-score-限制最低评分得分"><a href="#min-score-限制最低评分得分" class="headerlink" title="min_score  限制最低评分得分"></a>min_score  限制最低评分得分</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">    &quot;min_score&quot;: 0.5,</span><br><span class="line">    &quot;query&quot; : &#123;</span><br><span class="line">        &quot;term&quot; : &#123;&quot;firstname&quot;: &quot;Virginia&quot;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="post-filter-后置过滤：在查询命中文档、完成聚合后，再对命中的文档进行过滤。"><a href="#post-filter-后置过滤：在查询命中文档、完成聚合后，再对命中的文档进行过滤。" class="headerlink" title="post_filter  后置过滤：在查询命中文档、完成聚合后，再对命中的文档进行过滤。"></a>post_filter  后置过滤：在查询命中文档、完成聚合后，再对命中的文档进行过滤。</h4><p>如：要在一次查询中查询品牌为gucci且颜色为红色的shirts，同时还要得到gucci品牌各颜色的shirts的分面统计。</p>
<p>创建索引并指定mappping：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">PUT &#x2F;shirts</span><br><span class="line">&#123;</span><br><span class="line">    &quot;mappings&quot;: &#123;</span><br><span class="line">        &quot;_doc&quot;: &#123;</span><br><span class="line">            &quot;properties&quot;: &#123;</span><br><span class="line">                &quot;brand&quot;: &#123; &quot;type&quot;: &quot;keyword&quot;&#125;,</span><br><span class="line">                &quot;color&quot;: &#123; &quot;type&quot;: &quot;keyword&quot;&#125;,</span><br><span class="line">                &quot;model&quot;: &#123; &quot;type&quot;: &quot;keyword&quot;&#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>往索引里面放入文档即类似数据库里面的向表插入一行数据，并立即刷新</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">PUT &#x2F;shirts&#x2F;_doc&#x2F;1?refresh</span><br><span class="line">&#123;</span><br><span class="line">    &quot;brand&quot;: &quot;gucci&quot;,</span><br><span class="line">    &quot;color&quot;: &quot;red&quot;,</span><br><span class="line">    &quot;model&quot;: &quot;slim&quot;</span><br><span class="line">&#125;</span><br><span class="line">PUT &#x2F;shirts&#x2F;_doc&#x2F;2?refresh</span><br><span class="line">&#123;</span><br><span class="line">    &quot;brand&quot;: &quot;gucci&quot;,</span><br><span class="line">    &quot;color&quot;: &quot;green&quot;,</span><br><span class="line">    &quot;model&quot;: &quot;seec&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>执行查询：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;shirts&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;bool&quot;: &#123;</span><br><span class="line">      &quot;filter&quot;: &#123;</span><br><span class="line">        &quot;term&quot;: &#123; &quot;brand&quot;: &quot;gucci&quot; &#125; </span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;aggs&quot;: &#123;</span><br><span class="line">    &quot;colors&quot;: &#123;</span><br><span class="line">      &quot;terms&quot;: &#123; &quot;field&quot;: &quot;color&quot; &#125; </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;post_filter&quot;: &#123; </span><br><span class="line">    &quot;term&quot;: &#123; &quot;color&quot;: &quot;red&quot; &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="sort-排序"><a href="#sort-排序" class="headerlink" title="sort  排序"></a>sort  排序</h4><p>可以指定按一个或多个字段排序。也可通过_score指定按评分值排序，_doc按索引顺序排序。默认是按相关性评分从高到低排序。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;bank&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match_all&quot;: &#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;sort&quot;: [&#123;</span><br><span class="line">      &quot;age&quot;: &#123; &quot;order&quot;: &quot;desc&quot; &#125;    </span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;balance&quot;: &#123; &quot;order&quot;: &quot;asc&quot; &#125;  </span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;_score&quot;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>说明：order 值：asc、desc。如果不给定，默认是asc，_score默认是desc</p>
<p>结果中每个文档会有排序字段值给出</p>
<p>** 多值字段排序 **</p>
<p>对于值是数组或多值的字段，也可进行排序，通过mode参数指定按多值的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">PUT &#x2F;my_index&#x2F;_doc&#x2F;1?refresh</span><br><span class="line">&#123;</span><br><span class="line">   &quot;product&quot;: &quot;chocolate&quot;,</span><br><span class="line">   &quot;price&quot;: [20, 4]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">POST &#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">   &quot;query&quot; : &#123;</span><br><span class="line">      &quot;term&quot; : &#123; &quot;product&quot; : &quot;chocolate&quot; &#125;</span><br><span class="line">   &#125;,</span><br><span class="line">   &quot;sort&quot; : [</span><br><span class="line">      &#123;&quot;price&quot; : &#123;&quot;order&quot; : &quot;asc&quot;, &quot;mode&quot; : &quot;avg&quot;&#125;&#125;</span><br><span class="line">   ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>** Missing values  缺失该字段的文档 **</p>
<p>missing 的值可以是 _last, _first</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">    &quot;sort&quot; : [</span><br><span class="line">        &#123; &quot;price&quot; : &#123;&quot;missing&quot; : &quot;_last&quot;&#125; &#125;</span><br><span class="line">    ],</span><br><span class="line">    &quot;query&quot; : &#123;</span><br><span class="line">        &quot;term&quot; : &#123; &quot;product&quot; : &quot;chocolate&quot; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>** 地理空间距离排序 **</p>
<p>官方文档：<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/search-request-sort.html#geo-sorting" target="_blank" rel="noopener">https://www.elastic.co/guide/en/elasticsearch/reference/current/search-request-sort.html#geo-sorting</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">    &quot;sort&quot; : [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;_geo_distance&quot; : &#123;</span><br><span class="line">                &quot;pin.location&quot; : [-70, 40],</span><br><span class="line">                &quot;order&quot; : &quot;asc&quot;,</span><br><span class="line">                &quot;unit&quot; : &quot;km&quot;,</span><br><span class="line">                &quot;mode&quot; : &quot;min&quot;,</span><br><span class="line">                &quot;distance_type&quot; : &quot;arc&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    &quot;query&quot; : &#123;</span><br><span class="line">        &quot;term&quot; : &#123; &quot;user&quot; : &quot;kimchy&quot; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>参数说明：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">_geo_distance 距离排序关键字</span><br><span class="line">pin.location是 geo_point 类型的字段</span><br><span class="line">distance_type：距离计算方式 arc球面 、plane 平面。</span><br><span class="line">unit: 距离单位 km 、m 默认m</span><br></pre></td></tr></table></figure>
<p>** Script Based Sorting 基于脚本计算的排序 **</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">    &quot;query&quot; : &#123;</span><br><span class="line">        &quot;term&quot; : &#123; &quot;user&quot; : &quot;kimchy&quot; &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;sort&quot; : &#123;</span><br><span class="line">        &quot;_script&quot; : &#123;</span><br><span class="line">            &quot;type&quot; : &quot;number&quot;,</span><br><span class="line">            &quot;script&quot; : &#123;</span><br><span class="line">                &quot;lang&quot;: &quot;painless&quot;,</span><br><span class="line">                &quot;source&quot;: &quot;doc[&#39;field_name&#39;].value * params.factor&quot;,</span><br><span class="line">                &quot;params&quot; : &#123;</span><br><span class="line">                    &quot;factor&quot; : 1.1</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;order&quot; : &quot;asc&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="折叠"><a href="#折叠" class="headerlink" title="折叠"></a>折叠</h4><p>用 collapse指定根据某个字段对命中结果进行折叠</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;bank&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">    &quot;query&quot;: &#123;</span><br><span class="line">        &quot;match_all&quot;: &#123;&#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;collapse&quot; : &#123;</span><br><span class="line">        &quot;field&quot; : &quot;age&quot; </span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;sort&quot;: [&quot;balance&quot;] </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>** 高级折叠 **</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"># 指定inner_hits来解释折叠 </span><br><span class="line"># 自命名&quot;name&quot;: &quot;details&quot;,  </span><br><span class="line"># 指定每组取几个文档 &quot;size&quot;: 5, </span><br><span class="line"># 组内排序 &quot;sort&quot;: [&#123; &quot;balance&quot;: &quot;asc&quot; &#125;]  </span><br><span class="line"># 指定组查询的并发数  &quot;max_concurrent_group_searches&quot;: 4 </span><br><span class="line"></span><br><span class="line">GET &#x2F;bank&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">    &quot;query&quot;: &#123;</span><br><span class="line">        &quot;match_all&quot;: &#123;&#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;collapse&quot; : &#123;</span><br><span class="line">        &quot;field&quot; : &quot;age&quot; ,</span><br><span class="line">        </span><br><span class="line">        &quot;inner_hits&quot;: &#123;</span><br><span class="line">            &quot;name&quot;: &quot;details&quot;, </span><br><span class="line">            &quot;size&quot;: 5,   </span><br><span class="line">            &quot;sort&quot;: [&#123; &quot;balance&quot;: &quot;asc&quot; &#125;] </span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;max_concurrent_group_searches&quot;: 4  </span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;sort&quot;: [&quot;balance&quot;] </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="分页"><a href="#分页" class="headerlink" title="分页"></a>分页</h4><p>** from and size **</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;bank&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">    &quot;from&quot; : 0, &quot;size&quot; : 10,</span><br><span class="line">    &quot;query&quot; : &#123;</span><br><span class="line">        &quot;term&quot; : &#123; &quot;firstname&quot; : &quot;Virginia&quot; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注：搜索请求耗用的堆内存和时间与 from + size 大小成正比。分页越深耗用越大，为了不因分页导致OOM或严重影响性能，ES中规定from + size 不能大于索引setting参数 index.max_result_window 的值，默认值为 10,000。</p>
<p>** Search after  在指定文档后取文档， 可用于深度分页 **<br>首次查询第一页</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">GET bank&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">    &quot;size&quot;: 10,</span><br><span class="line">    &quot;query&quot;: &#123;</span><br><span class="line">        &quot;match&quot; : &#123;</span><br><span class="line">            &quot;age&quot; : &quot;37&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;sort&quot;: [</span><br><span class="line">        &#123;&quot;account_number&quot;: &quot;asc&quot;&#125;,</span><br><span class="line">        &#123;&quot;balance&quot;: &quot;desc&quot;&#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>后续页的查询</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">GET bank&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">    &quot;size&quot;: 10,</span><br><span class="line">    &quot;query&quot;: &#123;</span><br><span class="line">        &quot;match&quot; : &#123;</span><br><span class="line">            &quot;age&quot; : &quot;37&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;search_after&quot;: [44, 34487],</span><br><span class="line">    &quot;sort&quot;: [</span><br><span class="line">        &#123;&quot;account_number&quot;: &quot;asc&quot;&#125;,</span><br><span class="line">        &#123;&quot;balance&quot;: &quot;desc&quot;&#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用search_after，要求查询必须指定排序，并且这个排序组合值每个文档唯一（最好排序中包含_id字段）。 search_after的值用的就是这个排序值。 用search_after时 from 只能为0、-1。</p>
<h4 id="高亮"><a href="#高亮" class="headerlink" title="高亮"></a>高亮</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;bank&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match&quot;: &#123;</span><br><span class="line">      &quot;lastname&quot;: &quot;Justice&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;highlight&quot;: &#123;</span><br><span class="line">    &quot;fields&quot;: &#123;</span><br><span class="line">      &quot;firstname&quot;: &#123;&#125;,</span><br><span class="line">      &quot;lastname&quot;: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">结果：</span><br><span class="line">&#123;</span><br><span class="line">  &quot;took&quot;: 0,</span><br><span class="line">  &quot;timed_out&quot;: false,</span><br><span class="line">  &quot;_shards&quot;: &#123;</span><br><span class="line">    &quot;total&quot;: 5,</span><br><span class="line">    &quot;successful&quot;: 5,</span><br><span class="line">    &quot;skipped&quot;: 0,</span><br><span class="line">    &quot;failed&quot;: 0</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;hits&quot;: &#123;</span><br><span class="line">    &quot;total&quot;: 1,</span><br><span class="line">    &quot;max_score&quot;: 4.8520303,</span><br><span class="line">    &quot;hits&quot;: [</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot;: &quot;bank&quot;,</span><br><span class="line">        &quot;_type&quot;: &quot;accounts&quot;,</span><br><span class="line">        &quot;_id&quot;: &quot;59&quot;,</span><br><span class="line">        &quot;_score&quot;: 4.8520303,</span><br><span class="line">        &quot;_source&quot;: &#123;</span><br><span class="line">          &quot;account_number&quot;: 59,</span><br><span class="line">          &quot;balance&quot;: 37728,</span><br><span class="line">          &quot;firstname&quot;: &quot;Malone&quot;,</span><br><span class="line">          &quot;lastname&quot;: &quot;Justice&quot;,</span><br><span class="line">          &quot;age&quot;: 37,</span><br><span class="line">          &quot;gender&quot;: &quot;F&quot;,</span><br><span class="line">          &quot;address&quot;: &quot;721 Russell Street&quot;,</span><br><span class="line">          &quot;employer&quot;: &quot;Emoltra&quot;,</span><br><span class="line">          &quot;email&quot;: &quot;malonejustice@emoltra.com&quot;,</span><br><span class="line">          &quot;city&quot;: &quot;Trucksville&quot;,</span><br><span class="line">          &quot;state&quot;: &quot;HI&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;highlight&quot;: &#123;</span><br><span class="line">          &quot;lastname&quot;: [</span><br><span class="line">            &quot;&lt;em&gt;Justice&lt;&#x2F;em&gt;&quot;</span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>多字段高亮，在highlight中加入：”require_field_match”: false,即可。</p>
<p>指定高亮标签</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">  &quot;highlight&quot;: &#123;</span><br><span class="line">    &quot;require_field_match&quot;: false,</span><br><span class="line">    &quot;fields&quot;: &#123;</span><br><span class="line">      &quot;firstname&quot;: &#123;</span><br><span class="line">        &quot;pre_tags&quot;:[&quot;&lt;strong&gt;&quot;],</span><br><span class="line">        &quot;post_tags&quot;: [&quot;&lt;&#x2F;strong&gt;&quot;]</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;firstname&quot;: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Profile-为了调试、优化"><a href="#Profile-为了调试、优化" class="headerlink" title="Profile  为了调试、优化"></a>Profile  为了调试、优化</h4><p>查询上加入上 profile 来获得详细的执行步骤、耗时信息。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;bank&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;profile&quot;: true,</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match&quot;: &#123;</span><br><span class="line">      &quot;lastname&quot;: &quot;Justice&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="count-api-查询数量"><a href="#count-api-查询数量" class="headerlink" title="count api 查询数量"></a>count api 查询数量</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;bank&#x2F;accounts&#x2F;_count?q&#x3D;firstname:Malone</span><br><span class="line"># 或 </span><br><span class="line">GET &#x2F;bank&#x2F;accounts&#x2F;_count</span><br><span class="line">&#123;</span><br><span class="line">    &quot;query&quot; : &#123;</span><br><span class="line">        &quot;term&quot; : &#123; &quot;firstname&quot; : &quot;Malone&quot; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="validate-api"><a href="#validate-api" class="headerlink" title="validate api"></a>validate api</h2><p>用来检查我们的查询是否正确，以及查看底层生成查询。</p>
<p>GET /bank/_validate/query?q=firstname:Malone</p>
<h3 id="校验查询"><a href="#校验查询" class="headerlink" title="校验查询"></a>校验查询</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;bank&#x2F;accounts&#x2F;_validate&#x2F;query</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;query_string&quot;: &#123;</span><br><span class="line">      &quot;query&quot;: &quot;firstname:Malone&quot;,</span><br><span class="line">      &quot;lenient&quot;: false</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="获得查询解释"><a href="#获得查询解释" class="headerlink" title="获得查询解释"></a>获得查询解释</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;bank&#x2F;accounts&#x2F;_validate&#x2F;query?explain&#x3D;true</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;query_string&quot;: &#123;</span><br><span class="line">      &quot;query&quot;: &quot;firstname:Malone&quot;,</span><br><span class="line">      &quot;lenient&quot;: false</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>** 用rewrite获得比explain 更详细的解释 **</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;bank&#x2F;accounts&#x2F;_validate&#x2F;query?rewrite&#x3D;true</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;query_string&quot;: &#123;</span><br><span class="line">      &quot;query&quot;: &quot;firstname:Malone&quot;,</span><br><span class="line">      &quot;lenient&quot;: false</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;bank&#x2F;accounts&#x2F;_validate&#x2F;query?rewrite&#x3D;true</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;more_like_this&quot;: &#123;	</span><br><span class="line">      &quot;like&quot;: &#123;</span><br><span class="line">        &quot;_id&quot;: &quot;3&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;boost_terms&quot;: 1</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="获得所有分片上的查询解释"><a href="#获得所有分片上的查询解释" class="headerlink" title="获得所有分片上的查询解释"></a>获得所有分片上的查询解释</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;bank&#x2F;_doc&#x2F;_validate&#x2F;query?rewrite&#x3D;true&amp;all_shards&#x3D;true</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match&quot;: &#123;</span><br><span class="line">        &quot;firstname&quot;: &quot;Virginia&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Explain-api"><a href="#Explain-api" class="headerlink" title="Explain api"></a>Explain api</h2><p>获得某个查询的评分解释，及某个文档是否被这个查询命中。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;bank&#x2F;accounts&#x2F;0&#x2F;_explain</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot; : &#123;</span><br><span class="line">      &quot;match&quot; : &#123;&quot;firstname&quot;: &quot;Virginia&quot;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>官网链接：<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/search-explain.html" target="_blank" rel="noopener">https://www.elastic.co/guide/en/elasticsearch/reference/current/search-explain.html</a></p>
<h2 id="Search-Shards-API"><a href="#Search-Shards-API" class="headerlink" title="Search Shards API"></a>Search Shards API</h2><p>让我们可以获取查询的索引分片节点情况</p>
<p>GET /bank/_search_shards</p>
<p>指定routing值的查询将在哪些分片节点上执行</p>
<p>GET /bank/_search_shards?routing=25,56</p>
<p>这里使用默认的路由，就是文档ID</p>
<h2 id="Search-Template-查询模板"><a href="#Search-Template-查询模板" class="headerlink" title="Search Template 查询模板"></a>Search Template 查询模板</h2><p>注册一个模板</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">POST _scripts&#x2F;bank_accounts_tm1</span><br><span class="line">&#123;</span><br><span class="line">    &quot;script&quot;: &#123;</span><br><span class="line">        &quot;lang&quot;: &quot;mustache&quot;,</span><br><span class="line">        &quot;source&quot;: &#123;</span><br><span class="line">            &quot;query&quot;: &#123;</span><br><span class="line">                &quot;match&quot;: &#123;</span><br><span class="line">                    &quot;email&quot;: &quot;&#123;&#123;query_string&#125;&#125;&quot;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用模板进行查询</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">GET _search&#x2F;template</span><br><span class="line">&#123;</span><br><span class="line">    &quot;id&quot;: &quot;bank_accounts_tm1&quot;, </span><br><span class="line">    &quot;params&quot;: &#123;</span><br><span class="line">        &quot;query_string&quot;: &quot;virginiaayala@filodyne.com&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="Query-DSL"><a href="#Query-DSL" class="headerlink" title="Query DSL"></a>Query DSL</h1><p>Domain Specific Language：领域特定语言</p>
<p>Elasticsearch 提供了一个完整的 query DSL，并且是 JSON 形式的。它和 AST 比较类似，并且包含两种类型的语句：</p>
<ul>
<li><p>叶子查询语句（Leaf Query)，用于查询某个特定的字段，如 match , term 或 range 等</p>
</li>
<li><p>复合查询语句 (Compound query clauses) 用于合并其他的叶查询或复合查询语句，也就是说复合语句之间可以嵌套，用来表示一个复杂的单一查询</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">​ ** DSL ** （domain-specific language），领域特定语言指的是专注于某个应用程序领域的计算机语言，又译作领域专用语言。不同于普通的跨领域通用计算机语言(GPL)，领域特定语言只用在某些特定的领域。</span><br><span class="line">​ ** AST** （abstract syntax tree), 抽象语法树是源代码的抽象语法结构的树形表现形式。树上的每个节点都表示源代码中的一种结构。之所以说语法是“抽象”的，是因为这里的语法并不会表示出真实语法中出现的每个细节。比如，嵌套括号被隐含在树的结构中，并没有以节点的形式呈现；而类似于if-condition-then这样的条件跳转语句，可以使用带有两个分支的节点来表示。</span><br><span class="line">——百度百科</span><br></pre></td></tr></table></figure></li>
<li><ul>
<li>Query and filter context **<br>一个查询语句究竟具有什么样的行为和得到什么结果，主要取决于它到底是处于查询上下文(Query Context) 还是过滤上下文(Filter Context)。两者有很大区别，我们来看下：</li>
</ul>
</li>
<li><p>Query context 查询上下文：这种语句在执行时既要计算文档是否匹配，还要计算文档相对于其他文档的匹配度有多高，匹配度越高，<em>_score</em> 分数就越高</p>
</li>
<li><p>Filter context 过滤上下文：过滤上下文中的语句在执行时只关心文档是否和查询匹配，不会计算匹配度，也就是得分。</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123; </span><br><span class="line">    &quot;bool&quot;: &#123; </span><br><span class="line">      &quot;must&quot;: [</span><br><span class="line">        &#123; &quot;match&quot;: &#123; &quot;title&quot;:   &quot;Search&quot;        &#125;&#125;, </span><br><span class="line">        &#123; &quot;match&quot;: &#123; &quot;content&quot;: &quot;Elasticsearch&quot; &#125;&#125;  </span><br><span class="line">      ],</span><br><span class="line">      &quot;filter&quot;: [ </span><br><span class="line">        &#123; &quot;term&quot;:  &#123; &quot;status&quot;: &quot;published&quot; &#125;&#125;, </span><br><span class="line">        &#123; &quot;range&quot;: &#123; &quot;publish_date&quot;: &#123; &quot;gte&quot;: &quot;2015-01-01&quot; &#125;&#125;&#125; </span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">query 参数表示整个语句是处于 query context 中</span><br><span class="line">bool 和 match 语句被用在 query context 中，也就是说它们会计算每个文档的匹配度（_score)</span><br><span class="line">filter 参数则表示这个子查询处于 filter context 中</span><br><span class="line">filter 语句中的 term 和 range 语句用在 filter context 中，它们只起到过滤的作用，并不会计算文档的得分。</span><br></pre></td></tr></table></figure>

<h2 id="Match-all-query"><a href="#Match-all-query" class="headerlink" title="Match all query"></a>Match all query</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">    &quot;query&quot;: &#123;</span><br><span class="line">        &quot;match_all&quot;: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 什么都不查 </span><br><span class="line">GET &#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">    &quot;query&quot;: &#123;</span><br><span class="line">        &quot;match_none&quot;: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="全文查询-Full-text-queries"><a href="#全文查询-Full-text-queries" class="headerlink" title="全文查询 Full text queries"></a>全文查询 Full text queries</h2><p>全文查询，用于对分词的字段进行搜索。会用查询字段的分词器对查询的文本进行分词生成查询。可用于短语查询、模糊查询、前缀查询、临近查询等查询场景。</p>
<p>官网链接：<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/full-text-queries.html" target="_blank" rel="noopener">https://www.elastic.co/guide/en/elasticsearch/reference/current/full-text-queries.html</a></p>
<h3 id="match-query"><a href="#match-query" class="headerlink" title="match query"></a>match query</h3><p>全文查询的标准查询，它可以对一个字段进行模糊、短语查询。 match queries 接收 text/numerics/dates, 对它们进行分词分析, 再组织成一个boolean查询。可通过operator 指定bool组合操作（or、and 默认是 or ）， 以及minimum_should_match 指定至少需多少个should(or)字句需满足。还可用ananlyzer指定查询用的特殊分析器。包括模糊查询(fuzzy matching) 或者临近查询(proximity queries)。</p>
<p>新增文档：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">PUT &#x2F;ftq&#x2F;_doc&#x2F;1</span><br><span class="line">&#123;</span><br><span class="line">  &quot;title&quot;: &quot;lucene solr and elasticsearch&quot;,</span><br><span class="line">  &quot;content&quot;: &quot;lucene solr and elasticsearch for search&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">PUT &#x2F;ftq&#x2F;_doc&#x2F;2</span><br><span class="line">&#123;</span><br><span class="line">  &quot;title&quot;: &quot;java spring boot&quot;,</span><br><span class="line">  &quot;content&quot;: &quot;lucene is writerd by java&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p> 查询：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">GET ftq&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match&quot;: &#123;</span><br><span class="line">      &quot;title&quot;: &quot;lucene java&quot;  #分词后用or</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET ftq&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match&quot;: &#123;</span><br><span class="line">      &quot;title&quot;: &#123;</span><br><span class="line">        &quot;query&quot;: &quot;lucene java&quot;,</span><br><span class="line">        &quot;operator&quot;: &quot;and&quot;  #指定分词后用and</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>** 模糊查询，可以指定fuzziness最大编辑数 **</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">最大编辑数为2，说明query字符串中分词后，每个词允许编辑两次单个字符，可删除、新增、修改字符</span><br><span class="line">fuzziness 参数可以被设置为 AUTO，此时字符串只有 1 到 2 个字符时是 0；字符串有 3 、4 或者 5 个字符时是 1；字符串大于 5 个字符时是 2</span><br><span class="line">有时编辑距离 2 仍然是太多了，返回的结果似乎并不相关。 把最大 fuzziness 设置为 1 ，可以得到更好的结果和更好的性能</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET ftq&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match&quot;: &#123;</span><br><span class="line">      &quot;title&quot;: &#123;</span><br><span class="line">        &quot;query&quot;: &quot;ucen elatic&quot;,</span><br><span class="line">        &quot;fuzziness&quot;: 2</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>** 指定最少需满足两个词匹配 ** </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">GET ftq&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match&quot;: &#123;</span><br><span class="line">      &quot;content&quot;: &#123;</span><br><span class="line">        &quot;query&quot;: &quot;ucen elatic java&quot;,</span><br><span class="line">        &quot;fuzziness&quot;: 2,</span><br><span class="line">        &quot;minimum_should_match&quot;: 2</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>** max_expansions 指定模糊匹配的最大词项数，默认是50。**</p>
<p>比如：反向索引中有 100 个词项与 ucen 模糊匹配，只选用前50 个。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">GET ftq&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match&quot;: &#123;</span><br><span class="line">      &quot;content&quot;: &#123;</span><br><span class="line">        &quot;query&quot;: &quot;ucen elatic java&quot;,</span><br><span class="line">        &quot;fuzziness&quot;: 2,</span><br><span class="line">        &quot;minimum_should_match&quot;: 2,</span><br><span class="line">        &quot;max_expansions &quot;: 50</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="match-phrase-query"><a href="#match-phrase-query" class="headerlink" title="match_phrase query"></a>match_phrase query</h3><p>match_phrase 查询用来对一个字段进行短语查询，可以指定 analyzer、slop移动因子。和 match 查询比较类似，但是它会保留包含所有搜索词项，且位置与搜索词项相同的文档。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">#短语查询</span><br><span class="line">GET ftq&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match_phrase&quot;: &#123;</span><br><span class="line">      &quot;title&quot;: &quot;lucene solr&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#指定移动因子  </span><br><span class="line">GET ftq&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match_phrase&quot;: &#123;</span><br><span class="line">      &quot;title&quot;: &#123;</span><br><span class="line">        &quot;query&quot;: &quot;lucene elasticsearch&quot;,</span><br><span class="line">        &quot;slop&quot;: 2</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="match-phrase-prefix-query"><a href="#match-phrase-prefix-query" class="headerlink" title="match_phrase_prefix query"></a>match_phrase_prefix query</h3><p>是一种输入即搜索(search-as-you-type) 的查询，它和 match_phrase 比较类似，区别就是会将查询字符串的最后一个词作为前缀来使用。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">    &quot;query&quot;: &#123;</span><br><span class="line">        &quot;match_phrase_prefix&quot; : &#123;</span><br><span class="line">            &quot;message&quot; : &quot;quick brown f&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p> 指定前缀匹配选用的最大词项数量</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">    &quot;query&quot;: &#123;</span><br><span class="line">        &quot;match_phrase_prefix&quot; : &#123;</span><br><span class="line">            &quot;message&quot; : &#123;</span><br><span class="line">                &quot;query&quot; : &quot;quick brown f&quot;,</span><br><span class="line">                &quot;max_expansions&quot; : 10</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="multi-match-query"><a href="#multi-match-query" class="headerlink" title="multi_match query"></a>multi_match query</h3><p>需要在多个字段上进行文本搜索，可用multi_match 。 multi_match在 match的基础上支持对多个字段进行文本查询。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">GET ftq&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;multi_match&quot; : &#123;</span><br><span class="line">      &quot;query&quot;:    &quot;lucene java&quot;, </span><br><span class="line">      &quot;fields&quot;: [ &quot;title&quot;, &quot;content&quot; ] </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">还可以使用*匹配多个字段：</span><br><span class="line"></span><br><span class="line">GET ftq&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;multi_match&quot; : &#123;</span><br><span class="line">      &quot;query&quot;:    &quot;lucene java&quot;, </span><br><span class="line">      &quot;fields&quot;: [ &quot;title&quot;, &quot;cont*&quot; ] </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="query-string-query"><a href="#query-string-query" class="headerlink" title="query_string query"></a>query_string query</h3><p>支持复杂的 Lucene query String 语法，可以直接用lucene查询语法写一个查询串进行查询，ES中接到请求后，通过查询解析器解析查询串生成对应的查询。使用它要求掌握lucene的查询语法。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># 单字段</span><br><span class="line">GET &#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">    &quot;query&quot;: &#123;</span><br><span class="line">        &quot;query_string&quot; : &#123;</span><br><span class="line">            &quot;default_field&quot; : &quot;content&quot;,</span><br><span class="line">            &quot;query&quot; : &quot;this AND that OR thus&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"># 多字段通配符查询</span><br><span class="line">GET &#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">    &quot;query&quot;: &#123;</span><br><span class="line">        &quot;query_string&quot; : &#123;</span><br><span class="line">            &quot;fields&quot; : [&quot;content&quot;,  &quot;name.*^5&quot;],</span><br><span class="line">            &quot;query&quot; : &quot;this AND that OR thus&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="common-terms-query"><a href="#common-terms-query" class="headerlink" title="common terms query"></a>common terms query</h3><p>common 常用词查询</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">问1、什么是停用词？索引时做停用词处理的目的是什么？</span><br><span class="line">不再使用的词，做停用词处理的目的是提高索引的效率，去掉不需要的索引操作，即停用词不需要索引</span><br><span class="line"></span><br><span class="line">问2、如果在索引时应用停用词处理，下面的两个查询会查询什么词项？</span><br><span class="line">the brown fox—— brown fox</span><br><span class="line">not happy——happy</span><br><span class="line"></span><br><span class="line">问3、索引时应用停用词处理对搜索精度是否有影响？如果不做停用词处理又会有什么影响？如何协调这两个问题？如何保证搜索的精确度又兼顾搜索性能？</span><br><span class="line">索引时应用停用词处理对搜索精度有影响，不做停用词处理又会影响索引的效率，要协调这两个问题就必须要使用tf-idf 相关性计算模型</span><br></pre></td></tr></table></figure>
<p>** tf-idf 相关性计算模型 **<br>tf：term frequency   词频 ：指一个词在一篇文档中出现的频率。</p>
<p>如“世界杯”在文档A中出现3次，那么可以定义“世界杯”在文档A中的词频为3。请问在一篇3000字的文章中出现“世界杯”3次和一篇150字的文章中出现3词，哪篇文章更是与“世界杯”有关的。也就是说，简单用出现次数作为频率不够准确。那就用占比来表示：</p>
<p><img src="https://img.huyunshun.com/img1/Elasticsearch/sdafasdgsdg524535478imgclip.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">问：tf值越大是否就一定说明这个词更相关？</span><br><span class="line"> 不是，出现太多了说明不重要</span><br><span class="line"></span><br><span class="line"> 说明：tf的计算不一定非是这样的，可以定义不同的计算方式。</span><br><span class="line">	df：document frequency 词的文档频率 ：指包含某个词的文档数（有多少文档中包含这个词）。 df越大的词越常见，哪些词会是高频词？</span><br><span class="line"></span><br><span class="line">问：词的df值越大说明这个词在这个文档集中是越重要还是越不重要？</span><br><span class="line"> 越不重要</span><br><span class="line"></span><br><span class="line">问：词t的tf高，在文档集中的重要性也高，是否说明文档与该词越相关？举例：整个文档集中只有3篇文档中有“世界杯”，文档A中就出现了“世界杯”好几次。 </span><br><span class="line"> 不能说明文档与该词越相关</span><br><span class="line"></span><br><span class="line">问：如何用数值体现词t在文档集中的重要性？df可以吗？</span><br><span class="line"> 不可以</span><br></pre></td></tr></table></figure>
<p>idf：inverse document frequency   词的逆文档频率 ：用来表示词在文档集中的重要性。文档总数/ df ，df越小，词越重要，这个值会很大，那就对它取个自然对数，将值映射到一个较小的取值范围。</p>
<p><img src="https://img.huyunshun.com/img1/Elasticsearch/sdafasdgsdg524535478imgclip_1.png" alt=""> </p>
<p>说明： +1 是为了避免除0（即词t在文档集中未出现的情况）</p>
<p>tf-idf 相关性性计算模型：tf-idf t = tf t,d * idf t</p>
<p> 说明： tf-idf 相关性性计算模型的值为词频（ tf t,d）乘以词的逆文档频率（idf t）</p>
<p>** Common terms query **</p>
<p>common 区分常用（高频）词查询让我们可以通过cutoff_frequency来指定一个分界文档频率值，将搜索文本中的词分为高频词和低频词，低频词的重要性高于高频词，先对低频词进行搜索并计算所有匹配文档相关性得分；然后再搜索和高频词匹配的文档，这会搜到很多文档，但只对和低频词重叠的文档进行相关性得分计算（这可保证搜索精确度，同时大大提高搜索性能），和低频词累加作为文档得分。实际执行的搜索是 必须包含低频词 + 或包含高频词。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">思考：这样处理下，如果用户输入的都是高频词如 “to be or not to be”结果会是怎样的？你希望是怎样的？</span><br><span class="line">优化：如果都是高频词，那就对这些词进行and 查询。</span><br><span class="line">进一步优化：让用户可以自己定对高频词做and&#x2F;or 操作，自己定对低频词进行and&#x2F;or 操作；或指定最少得多少个同时匹配</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">    &quot;query&quot;: &#123;</span><br><span class="line">        &quot;common&quot;: &#123;</span><br><span class="line">            &quot;address&quot;: &#123;</span><br><span class="line">                &quot;query&quot;: &quot;171 Putnam Avenue&quot;,</span><br><span class="line">                &quot;cutoff_frequency&quot;: 0.001</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>说明：cutoff_frequency : 值大于1表示文档数，0-1.0表示占比。 此处界定 文档频率大于 0.1%的词为高频词。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">    &quot;query&quot;: &#123;</span><br><span class="line">        &quot;common&quot;: &#123;</span><br><span class="line">          &quot;address&quot;: &#123;</span><br><span class="line">                &quot;query&quot;: &quot;171 Putnam Avenue&quot;,</span><br><span class="line">                &quot;cutoff_frequency&quot;: 0.001,</span><br><span class="line">                &quot;low_freq_operator&quot;: &quot;and&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>说明：low_freq_operator指定对低频词做与操作。</p>
<p>可用参数：minimum_should_match (high_freq, low_freq), low_freq_operator (default “or”) and high_freq_operator (default “or”)、 boost and analyzer</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">    &quot;query&quot;: &#123;</span><br><span class="line">        &quot;common&quot;: &#123;</span><br><span class="line">            &quot;address&quot;: &#123;</span><br><span class="line">                &quot;query&quot;: &quot;171 Putnam Avenue&quot;,</span><br><span class="line">                &quot;cutoff_frequency&quot;: 0.001,</span><br><span class="line">                &quot;minimum_should_match&quot;: 2</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">    &quot;query&quot;: &#123;</span><br><span class="line">        &quot;common&quot;: &#123;</span><br><span class="line">            &quot;address&quot;: &#123;</span><br><span class="line">                &quot;query&quot;: &quot;171 Putnam Avenue&quot;,</span><br><span class="line">                &quot;cutoff_frequency&quot;: 0.001,</span><br><span class="line">                &quot;minimum_should_match&quot;: &#123;</span><br><span class="line">                    &quot;low_freq&quot; : 2,</span><br><span class="line">                    &quot;high_freq&quot; : 3</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="simple-query-string-query"><a href="#simple-query-string-query" class="headerlink" title="simple_query_string query"></a>simple_query_string query</h3><p>简化版的 query_string ，simple_query_string 查同 query_string 查询一样用lucene查询语法写查询串，较query_string不同的地方：更小的语法集；查询串有错误，它会忽略错误的部分，不抛出错误。更适合给用户使用。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;simple_query_string&quot; : &#123;</span><br><span class="line">        &quot;query&quot;: &quot;\&quot;fried eggs\&quot; +(eggplant | potato) -frittata&quot;,</span><br><span class="line">        &quot;fields&quot;: [&quot;title^5&quot;, &quot;body&quot;],</span><br><span class="line">        &quot;default_operator&quot;: &quot;and&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="词项查询"><a href="#词项查询" class="headerlink" title="词项查询"></a>词项查询</h2><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/term-level-queries.html" target="_blank" rel="noopener">https://www.elastic.co/guide/en/elasticsearch/reference/current/term-level-queries.html</a></p>
<h3 id="term-terms-query"><a href="#term-terms-query" class="headerlink" title="term/terms query"></a>term/terms query</h3><p>term 查询用于查询指定字段包含某个词项的文档。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">POST _search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;term&quot; : &#123; &quot;address&quot; : &quot;Putnam&quot; &#125; </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 权重boost </span><br><span class="line">POST _search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;term&quot;: &#123;</span><br><span class="line">            &quot;balance&quot;: &#123;&quot;value&quot;: 40540,&quot;boost&quot;: 2&#125;</span><br><span class="line">          &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#  terms 查询用于查询指定字段包含某些词项的文档。</span><br><span class="line">POST _search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;terms&quot; : &#123; &quot;address&quot; : [&quot;171&quot;,&quot;Putnam&quot;] &#125; </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Terms 还可以查询支持嵌套查询的方式来获得查询词项，相当于 in (select term from other)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;bank&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;terms&quot; : &#123;</span><br><span class="line">        &quot;firstname&quot; : &#123;</span><br><span class="line">          &quot;index&quot;: &quot;bank&quot;,</span><br><span class="line">          &quot;type&quot;: &quot;accounts&quot;,</span><br><span class="line">          &quot;id&quot;: &quot;25&quot;,</span><br><span class="line">          &quot;path&quot;: &quot;followers&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;  </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="range-query"><a href="#range-query" class="headerlink" title="range query"></a>range query</h3><p>范围查询</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">gte：大于等于</span><br><span class="line">gt：大于</span><br><span class="line">lte：小于等于</span><br><span class="line">lt：小于</span><br><span class="line">boost：查询权重</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">GET _search</span><br><span class="line">&#123;</span><br><span class="line">    &quot;query&quot;: &#123;</span><br><span class="line">        &quot;range&quot; : &#123;</span><br><span class="line">            &quot;age&quot; : &#123;</span><br><span class="line">                &quot;gte&quot; : 10,</span><br><span class="line">                &quot;lte&quot; : 20,</span><br><span class="line">                &quot;boost&quot; : 2.0</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET _search</span><br><span class="line">&#123;</span><br><span class="line">    &quot;query&quot;: &#123;</span><br><span class="line">        &quot;range&quot; : &#123;</span><br><span class="line">            &quot;date&quot; : &#123;</span><br><span class="line">                &quot;gte&quot; : &quot;now-1d&#x2F;d&quot;,  #当前时间减1天后转成天数</span><br><span class="line">                &quot;lt&quot; :  &quot;now&#x2F;d&quot;  #当前时间转成条数</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET _search</span><br><span class="line">&#123;</span><br><span class="line">    &quot;query&quot;: &#123;</span><br><span class="line">        &quot;range&quot; : &#123;</span><br><span class="line">            &quot;born&quot; : &#123;</span><br><span class="line">                &quot;gte&quot;: &quot;01&#x2F;01&#x2F;2012&quot;,</span><br><span class="line">                &quot;lte&quot;: &quot;2013&quot;,</span><br><span class="line">                &quot;format&quot;: &quot;dd&#x2F;MM&#x2F;yyyy||yyyy&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>时间舍入||说明：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">gt：大于的情况下，四舍五入，比如2014-11-18||&#x2F;M变成2014-11-30T23:59:59:999，不包含整个月</span><br><span class="line">gte：大于等于的情况下，向下取整，比如2014-11-18||&#x2F;M变成2014-11-01，包含整个月</span><br><span class="line">lt：小于的情况下，向下取整，比如2014-11-18||&#x2F;M变成2014-11-01，不包含整个月</span><br><span class="line">lte：小于等于的情况下，四舍五入，比如2014-11-18||&#x2F;M变成2014-11-30T23:59:59:999，包含整个月</span><br></pre></td></tr></table></figure>

<h3 id="exits-query"><a href="#exits-query" class="headerlink" title="exits query"></a>exits query</h3><p>查询指定字段值不为空的文档。相当 SQL 中的 column is not null</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">    &quot;query&quot;: &#123;</span><br><span class="line">        &quot;exists&quot; : &#123; &quot;field&quot; : &quot;balance&quot; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="prefix-query-词项前缀查询"><a href="#prefix-query-词项前缀查询" class="headerlink" title="prefix query 词项前缀查询"></a>prefix query 词项前缀查询</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;_search</span><br><span class="line">&#123; &quot;query&quot;: &#123;</span><br><span class="line">    &quot;prefix&quot; : &#123; &quot;address&quot; : &quot;171&quot; &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="wildcard-query-通配符查询"><a href="#wildcard-query-通配符查询" class="headerlink" title="wildcard query 通配符查询"></a>wildcard query 通配符查询</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">    &quot;query&quot;: &#123;</span><br><span class="line">        &quot;wildcard&quot; : &#123; &quot;lastname&quot; : &quot;A*a*&quot; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"># 加权 </span><br><span class="line">GET &#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;wildcard&quot;: &#123;</span><br><span class="line">      &quot;lastname&quot;: &#123;</span><br><span class="line">        &quot;value&quot;: &quot;ki*y&quot;,</span><br><span class="line">        &quot;boost&quot;: 2</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<h3 id="regexp-query-正则查询"><a href="#regexp-query-正则查询" class="headerlink" title="regexp query 正则查询"></a>regexp query 正则查询</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">    &quot;query&quot;: &#123;</span><br><span class="line">        &quot;regexp&quot;:&#123;</span><br><span class="line">            &quot;name.first&quot;: &quot;s.*y&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET &#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">    &quot;query&quot;: &#123;</span><br><span class="line">        &quot;regexp&quot;:&#123;</span><br><span class="line">            &quot;name.first&quot;:&#123;</span><br><span class="line">                &quot;value&quot;:&quot;s.*y&quot;,</span><br><span class="line">                &quot;boost&quot;:1.2</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>正则语法参考：<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-regexp-query.html#regexp-syntax" target="_blank" rel="noopener">https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-regexp-query.html#regexp-syntax</a></p>
<h3 id="fuzzy-query-模糊查询"><a href="#fuzzy-query-模糊查询" class="headerlink" title="fuzzy query 模糊查询"></a>fuzzy query 模糊查询</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">    &quot;query&quot;: &#123;</span><br><span class="line">       &quot;fuzzy&quot; : &#123; &quot;address&quot; : &quot;Avenue&quot; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET &#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">    &quot;query&quot;: &#123;</span><br><span class="line">        &quot;fuzzy&quot; : &#123;</span><br><span class="line">            &quot;address&quot; : &#123;</span><br><span class="line">                &quot;value&quot;: &quot;Avenue&quot;,</span><br><span class="line">                &quot;boost&quot;: 1.0,</span><br><span class="line">                &quot;fuzziness&quot;: 2,</span><br><span class="line">                &quot;prefix_length&quot;: 0,</span><br><span class="line">                &quot;max_expansions&quot;: 100</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="ids-根据文档id查询"><a href="#ids-根据文档id查询" class="headerlink" title="ids 根据文档id查询"></a>ids 根据文档id查询</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">    &quot;query&quot;: &#123;</span><br><span class="line">        &quot;ids&quot; : &#123;</span><br><span class="line">            &quot;type&quot; : &quot;_doc&quot;,</span><br><span class="line">            &quot;values&quot; : [&quot;1&quot;, &quot;4&quot;, &quot;100&quot;]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="复合查询"><a href="#复合查询" class="headerlink" title="复合查询"></a>复合查询</h2><h3 id="constant-score-query"><a href="#constant-score-query" class="headerlink" title="constant score query"></a>constant score query</h3><p>用来包装另一个查询，将查询匹配的文档的评分设为一个常值。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">    &quot;query&quot;: &#123;</span><br><span class="line">        &quot;constant_score&quot; : &#123;</span><br><span class="line">            &quot;filter&quot; : &#123;</span><br><span class="line">                &quot;term&quot; : &#123; &quot;age&quot; : &quot;39&quot;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;boost&quot; : 1.2</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="bool-query"><a href="#bool-query" class="headerlink" title="bool query"></a>bool query</h3><p>Bool 查询用bool操作来组合多个查询字句为一个查询。 可用的关键字：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">must：必须满足</span><br><span class="line">filter：必须满足，但执行的是filter上下文，不参与、不影响评分</span><br><span class="line">should：或</span><br><span class="line">must_not：必须不满足，在filter上下文中执行，不参与、不影响评分</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">POST _search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;bool&quot; : &#123;</span><br><span class="line">      &quot;must&quot; : &#123;</span><br><span class="line">        &quot;term&quot; : &#123; &quot;lastname&quot;: &quot;Ayala&quot;&#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;filter&quot;: &#123;</span><br><span class="line">        &quot;term&quot; : &#123; &quot;state&quot;: &quot;PA&quot; &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;must_not&quot; : &#123;</span><br><span class="line">        &quot;range&quot; : &#123;</span><br><span class="line">          &quot;age&quot; : &#123; &quot;gte&quot; : 10, &quot;lte&quot; : 20 &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;should&quot; : [</span><br><span class="line">        &#123; &quot;term&quot; : &#123; &quot;city&quot;: &quot;Nicholson&quot; &#125; &#125;,</span><br><span class="line">        &#123; &quot;term&quot; : &#123; &quot;city&quot;: &quot;Shaft&quot; &#125; &#125;</span><br><span class="line">      ],</span><br><span class="line">      &quot;minimum_should_match&quot; : 1,</span><br><span class="line">      &quot;boost&quot; : 1.0</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>
     <!-- 相关文章推荐 -->
    
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Elasticsearch/" rel="tag"># Elasticsearch</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/03/13/Elasticsearch%E8%B7%AF%E7%94%B1%E8%AF%A6%E8%A7%A3/" rel="next" title="Elasticsearch路由详解">
                <i class="fa fa-chevron-left"></i> Elasticsearch路由详解
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/03/15/Elasticsearch%E6%90%9C%E7%B4%A2%E8%AF%A6%E8%A7%A3/" rel="prev" title="Elasticsearch搜索详解">
                Elasticsearch搜索详解 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
        <!-- JiaThis Button BEGIN -->
<div class="jiathis_style">
<span class="jiathis_txt">分享到：</span>
<a class="jiathis_button_fav">收藏夹</a>
<a class="jiathis_button_copy">复制网址</a>
<a class="jiathis_button_email">邮件</a>
<a class="jiathis_button_weixin">微信</a>
<a class="jiathis_button_qzone">QQ空间</a>
<a class="jiathis_button_tqq">腾讯微博</a>
<a class="jiathis_button_douban">豆瓣</a>
<a class="jiathis_button_share">一键分享</a>

<a href="http://www.jiathis.com/share?uid=2140465" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank">更多</a>
<a class="jiathis_counter_style"></a>
</div>
<script type="text/javascript" >
var jiathis_config={
  data_track_clickback:true,
  summary:"",
  shortUrl:false,
  hideMore:false
}
</script>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=" charset="utf-8"></script>
<!-- JiaThis Button END -->
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="https://img.huyunshun.com/img/20200522182348.png"
                alt="初晨" />
            
              <p class="site-author-name" itemprop="name">初晨</p>
              <p class="site-description motion-element" itemprop="description">永远不要说你知道本质，更别说真相了。</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/%7C%7C%20archive">
              
                  <span class="site-state-item-count">249</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">46</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">109</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          
<!--近期文章版块-->
            
                <div class="links-of-blogroll motion-element links-of-blogroll-block">
                  <div class="links-of-blogroll-title">
                    <!-- modify icon to fire by szw -->
                    <i class="fa fa-history fa-" aria-hidden="true"></i>
                    近期文章
                  </div>
                  <ul class="links-of-blogroll-list">
                    
                    
                      <li>
                        <a href="/2020/05/22/WebSocket%E3%80%81Socket%E3%80%81TCP%E3%80%81HTTP%E5%8C%BA%E5%88%AB/" title="WebSocket、Socket、TCP、HTTP区别" target="_blank">WebSocket、Socket、TCP、HTTP区别</a>
                      </li>
                    
                      <li>
                        <a href="/2020/05/19/Springboot%E9%A1%B9%E7%9B%AE%E7%9A%84%E6%8E%A5%E5%8F%A3%E9%98%B2%E5%88%B7/" title="Springboot项目的接口防刷" target="_blank">Springboot项目的接口防刷</a>
                      </li>
                    
                      <li>
                        <a href="/2020/05/03/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3Volatile%E5%85%B3%E9%94%AE%E5%AD%97%E5%8F%8A%E5%85%B6%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86/" title="深入理解Volatile关键字及其实现原理" target="_blank">深入理解Volatile关键字及其实现原理</a>
                      </li>
                    
                      <li>
                        <a href="/2020/04/20/%E4%BD%BF%E7%94%A8vscode%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E7%AC%94%E8%AE%B0%E7%8E%AF%E5%A2%83/" title="使用vscode搭建个人笔记环境" target="_blank">使用vscode搭建个人笔记环境</a>
                      </li>
                    
                      <li>
                        <a href="/2020/01/20/HBase%E4%BB%8B%E7%BB%8D%E5%AE%89%E8%A3%85%E4%B8%8E%E6%93%8D%E4%BD%9C/" title="HBase介绍安装与操作" target="_blank">HBase介绍安装与操作</a>
                      </li>
                    
                  </ul>
                </div>
            
          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#搜索API"><span class="nav-number">1.</span> <span class="nav-text">搜索API</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#搜索API-端点地址"><span class="nav-number">1.1.</span> <span class="nav-text">搜索API 端点地址</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#URI-Search"><span class="nav-number">1.2.</span> <span class="nav-text">URI Search</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#特殊的查询参数用法"><span class="nav-number">1.2.1.</span> <span class="nav-text">特殊的查询参数用法</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Request-body-Search"><span class="nav-number">1.3.</span> <span class="nav-text">Request body Search</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#query-元素定义查询"><span class="nav-number">1.3.1.</span> <span class="nav-text">query 元素定义查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#指定返回哪些内容"><span class="nav-number">1.3.2.</span> <span class="nav-text">指定返回哪些内容</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#source-filter-对-source字段进行选择"><span class="nav-number">1.3.2.1.</span> <span class="nav-text">source filter  对_source字段进行选择</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#stored-fields-来指定返回哪些stored字段"><span class="nav-number">1.3.2.2.</span> <span class="nav-text">stored_fields 来指定返回哪些stored字段</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#docValue-Field-返回存储了docValue的字段值"><span class="nav-number">1.3.2.3.</span> <span class="nav-text">docValue Field 返回存储了docValue的字段值</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#version-来指定返回文档的版本字段"><span class="nav-number">1.3.2.4.</span> <span class="nav-text">version 来指定返回文档的版本字段</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#explain-返回文档的评分解释"><span class="nav-number">1.3.2.5.</span> <span class="nav-text">explain 返回文档的评分解释</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Script-Field-用脚本来对命中的每个文档的字段进行运算后返回"><span class="nav-number">1.3.2.6.</span> <span class="nav-text">Script Field 用脚本来对命中的每个文档的字段进行运算后返回</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#min-score-限制最低评分得分"><span class="nav-number">1.3.2.7.</span> <span class="nav-text">min_score  限制最低评分得分</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#post-filter-后置过滤：在查询命中文档、完成聚合后，再对命中的文档进行过滤。"><span class="nav-number">1.3.2.8.</span> <span class="nav-text">post_filter  后置过滤：在查询命中文档、完成聚合后，再对命中的文档进行过滤。</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#sort-排序"><span class="nav-number">1.3.2.9.</span> <span class="nav-text">sort  排序</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#折叠"><span class="nav-number">1.3.2.10.</span> <span class="nav-text">折叠</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#分页"><span class="nav-number">1.3.2.11.</span> <span class="nav-text">分页</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#高亮"><span class="nav-number">1.3.2.12.</span> <span class="nav-text">高亮</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Profile-为了调试、优化"><span class="nav-number">1.3.2.13.</span> <span class="nav-text">Profile  为了调试、优化</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#count-api-查询数量"><span class="nav-number">1.4.</span> <span class="nav-text">count api 查询数量</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#validate-api"><span class="nav-number">1.5.</span> <span class="nav-text">validate api</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#校验查询"><span class="nav-number">1.5.1.</span> <span class="nav-text">校验查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#获得查询解释"><span class="nav-number">1.5.2.</span> <span class="nav-text">获得查询解释</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#获得所有分片上的查询解释"><span class="nav-number">1.5.3.</span> <span class="nav-text">获得所有分片上的查询解释</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Explain-api"><span class="nav-number">1.6.</span> <span class="nav-text">Explain api</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Search-Shards-API"><span class="nav-number">1.7.</span> <span class="nav-text">Search Shards API</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Search-Template-查询模板"><span class="nav-number">1.8.</span> <span class="nav-text">Search Template 查询模板</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Query-DSL"><span class="nav-number">2.</span> <span class="nav-text">Query DSL</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Match-all-query"><span class="nav-number">2.1.</span> <span class="nav-text">Match all query</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#全文查询-Full-text-queries"><span class="nav-number">2.2.</span> <span class="nav-text">全文查询 Full text queries</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#match-query"><span class="nav-number">2.2.1.</span> <span class="nav-text">match query</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#match-phrase-query"><span class="nav-number">2.2.2.</span> <span class="nav-text">match_phrase query</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#match-phrase-prefix-query"><span class="nav-number">2.2.3.</span> <span class="nav-text">match_phrase_prefix query</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#multi-match-query"><span class="nav-number">2.2.4.</span> <span class="nav-text">multi_match query</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#query-string-query"><span class="nav-number">2.2.5.</span> <span class="nav-text">query_string query</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#common-terms-query"><span class="nav-number">2.2.6.</span> <span class="nav-text">common terms query</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#simple-query-string-query"><span class="nav-number">2.2.7.</span> <span class="nav-text">simple_query_string query</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#词项查询"><span class="nav-number">2.3.</span> <span class="nav-text">词项查询</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#term-terms-query"><span class="nav-number">2.3.1.</span> <span class="nav-text">term&#x2F;terms query</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#range-query"><span class="nav-number">2.3.2.</span> <span class="nav-text">range query</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#exits-query"><span class="nav-number">2.3.3.</span> <span class="nav-text">exits query</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#prefix-query-词项前缀查询"><span class="nav-number">2.3.4.</span> <span class="nav-text">prefix query 词项前缀查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#wildcard-query-通配符查询"><span class="nav-number">2.3.5.</span> <span class="nav-text">wildcard query 通配符查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#regexp-query-正则查询"><span class="nav-number">2.3.6.</span> <span class="nav-text">regexp query 正则查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#fuzzy-query-模糊查询"><span class="nav-number">2.3.7.</span> <span class="nav-text">fuzzy query 模糊查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ids-根据文档id查询"><span class="nav-number">2.3.8.</span> <span class="nav-text">ids 根据文档id查询</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#复合查询"><span class="nav-number">2.4.</span> <span class="nav-text">复合查询</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#constant-score-query"><span class="nav-number">2.4.1.</span> <span class="nav-text">constant score query</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#bool-query"><span class="nav-number">2.4.2.</span> <span class="nav-text">bool query</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2018 &mdash; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Copyright</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  


</body>
</html>
