<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="永远不要说你知道本质，更别说真相了。">
<meta property="og:type" content="website">
<meta property="og:title" content="简">
<meta property="og:url" content="https://huyunshun.com/page/6/index.html">
<meta property="og:site_name" content="简">
<meta property="og:description" content="永远不要说你知道本质，更别说真相了。">
<meta property="article:author" content="初晨">
<meta property="article:tag" content="编程">
<meta property="article:tag" content="开发">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://huyunshun.com/page/6/"/>





  <title>简</title>
  








  <script type="text/javascript" src="/js/src/love.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome/css/font-awesome.min.css">

  <!-- 看板娘 -->
    
        <script async src="/live2d-widget/autoload.js"></script>
    
 <!-- 飘动的彩带） -->
  <script src="/js/src/piao.js" type="text/javascript"></script>
<meta name="generator" content="Hexo 4.2.1"></head>
<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">简</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">人生短暂，学海无边，而大道至简。</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://huyunshun.com/2019/04/15/ECMAScript_6_Promise/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="初晨">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://img.huyunshun.com/img/20200522182348.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="简">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/04/15/ECMAScript_6_Promise/" itemprop="url">ECMAScript 6 Promise</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-04-15T00:00:00+08:00">
                2019-04-15
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Node/" itemprop="url" rel="index">
                    <span itemprop="name">Node</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Promise 是异步编程的一种解决方案，比传统的解决方案——回调函数和事件——更合理和更强大。</p>
<p>所谓Promise，简单说就是一个容器，里面保存着某个未来才会结束的事件（通常是一个异步操作）的结果。从语法上说，Promise 是一个对象，从它可以获取异步操作的消息。Promise 提供统一的 API，各种异步操作都可以用同样的方法进行处理。</p>
<p>Promise对象有以下两个特点。</p>
<p>（1）对象的状态不受外界影响。Promise对象代表一个异步操作，有三种状态：pending（进行中）、fulfilled（已成功）和rejected（已失败）。只有异步操作的结果，可以决定当前是哪一种状态，任何其他操作都无法改变这个状态。</p>
<p>（2）一旦状态改变，就不会再变，任何时候都可以得到这个结果。Promise对象的状态改变，只有两种可能：从pending变为fulfilled和从pending变为rejected。只要这两种情况发生，状态就凝固了，不会再变了，会一直保持这个结果，这时就称为 resolved（已定型）。如果改变已经发生了，你再对Promise对象添加回调函数，也会立即得到这个结果。这与事件（Event）完全不同，事件的特点是，如果你错过了它，再去监听，是得不到结果的。</p>
<p>有了Promise对象，就可以将异步操作以同步操作的流程表达出来，避免了层层嵌套的回调函数。此外，Promise对象提供统一的接口，使得控制异步操作更加容易。</p>
<p>Promise也有一些缺点。首先，无法取消Promise，一旦新建它就会立即执行，无法中途取消。其次，如果不设置回调函数，Promise内部抛出的错误，不会反应到外部。第三，当处于pending状态时，无法得知目前进展到哪一个阶段（刚刚开始还是即将完成）。</p>
<p>如果某些事件不断地反复发生，一般来说，使用 Stream 模式是比部署Promise更好的选择。</p>
<h5 id="一、用法"><a href="#一、用法" class="headerlink" title="一、用法"></a>一、用法</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ... some code</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="comment">/* 异步操作成功 */</span>)&#123;</span><br><span class="line">    resolve(value);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    reject(error);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>Promise构造函数接受一个函数作为参数，该函数的两个参数分别是resolve和reject。它们是两个函数，由 JavaScript 引擎提供，不用自己部署。</p>
<p>resolve函数的作用是，将Promise对象的状态从“未完成”变为“成功”（即从 pending 变为 resolved），在异步操作成功时调用，并将异步操作的结果，作为参数传递出去；reject函数的作用是，将Promise对象的状态从“未完成”变为“失败”（即从 pending 变为 rejected），在异步操作失败时调用，并将异步操作报出的错误，作为参数传递出去。</p>
<p>Promise实例生成以后，可以用then方法分别指定resolved状态和rejected状态的回调函数。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">promise.then(<span class="function"><span class="keyword">function</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// success</span></span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">error</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// failure</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>简单例子。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">timeout</span>(<span class="params">ms</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    setTimeout(resolve, ms, <span class="string">'done'</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">timeout(<span class="number">100</span>).then(<span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(value);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>上面代码中，timeout方法返回一个Promise实例，表示一段时间以后才会发生的结果。过了指定的时间（ms参数）以后，Promise实例的状态变为resolved，就会触发then方法绑定的回调函数。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Promise 新建后立即执行，所以首先输出的是Promise。</span></span><br><span class="line"><span class="comment">// 然后，then方法指定的回调函数，将在当前脚本所有同步任务执行完才会执行，所以resolved最后输出。</span></span><br><span class="line"><span class="keyword">let</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Promise'</span>);</span><br><span class="line">    resolve();</span><br><span class="line">    reject();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">promise.then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'resolved.'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'Hi!'</span>);</span><br></pre></td></tr></table></figure>
<p>用Promise对象实现的 Ajax 操作的例子。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> getJSON = <span class="function"><span class="keyword">function</span>(<span class="params">url</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> handler = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>.readyState !== <span class="number">4</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>.status === <span class="number">200</span>) &#123;</span><br><span class="line">        resolve(<span class="keyword">this</span>.response);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        reject(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="keyword">this</span>.statusText));</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">const</span> client = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">    client.open(<span class="string">"GET"</span>, url);</span><br><span class="line">    client.onreadystatechange = handler;</span><br><span class="line">    client.responseType = <span class="string">"json"</span>;</span><br><span class="line">    client.setRequestHeader(<span class="string">"Accept"</span>, <span class="string">"application/json"</span>);</span><br><span class="line">    client.send();</span><br><span class="line"></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> promise;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">getJSON(<span class="string">"/posts.json"</span>).then(<span class="function"><span class="keyword">function</span>(<span class="params">json</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Contents: '</span> + json);</span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">error</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.error(<span class="string">'出错了'</span>, error);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h5 id="Promise-prototype-then"><a href="#Promise-prototype-then" class="headerlink" title="Promise.prototype.then()"></a>Promise.prototype.then()</h5><p>Promise 实例具有then方法，也就是说，then方法是定义在原型对象Promise.prototype上的。它的作用是为 Promise 实例添加状态改变时的回调函数。前面说过，then方法的第一个参数是resolved状态的回调函数，第二个参数（可选）是rejected状态的回调函数。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">getJSON(<span class="string">"/post/1.json"</span>).then(</span><br><span class="line">  post =&gt; getJSON(post.commentURL)</span><br><span class="line">).then(</span><br><span class="line">  comments =&gt; <span class="built_in">console</span>.log(<span class="string">"resolved: "</span>, comments),</span><br><span class="line">  err =&gt; <span class="built_in">console</span>.log(<span class="string">"rejected: "</span>, err)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h5 id="Promise-prototype-catch"><a href="#Promise-prototype-catch" class="headerlink" title="Promise.prototype.catch()"></a>Promise.prototype.catch()</h5><p>Promise.prototype.catch方法是.then(null, rejection)或.then(undefined, rejection)的别名，用于指定发生错误时的回调函数。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">getJSON(<span class="string">'/posts.json'</span>).then(<span class="function"><span class="keyword">function</span>(<span class="params">posts</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;).catch(<span class="function"><span class="keyword">function</span>(<span class="params">error</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 处理 getJSON 和 前一个回调函数运行时发生的错误</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'发生错误！'</span>, error);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h5 id="Promise-prototype-finally"><a href="#Promise-prototype-finally" class="headerlink" title="Promise.prototype.finally()"></a>Promise.prototype.finally()</h5><p>finally方法用于指定不管 Promise 对象最后状态如何，都会执行的操作。该方法是 ES2018 引入标准的。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">promise</span><br><span class="line">.then(<span class="function"><span class="params">result</span> =&gt;</span> &#123;···&#125;)</span><br><span class="line">.catch(<span class="function"><span class="params">error</span> =&gt;</span> &#123;···&#125;)</span><br><span class="line">.finally(<span class="function"><span class="params">()</span> =&gt;</span> &#123;···&#125;);</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">promise</span><br><span class="line">.finally(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 语句</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 等同于</span></span><br><span class="line">promise</span><br><span class="line">.then(</span><br><span class="line">  result =&gt; &#123;</span><br><span class="line">    <span class="comment">// 语句</span></span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;,</span><br><span class="line">  error =&gt; &#123;</span><br><span class="line">    <span class="comment">// 语句</span></span><br><span class="line">    <span class="keyword">throw</span> error;</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h5 id="Promise-all"><a href="#Promise-all" class="headerlink" title="Promise.all()"></a>Promise.all()</h5><p>Promise.all()方法用于将多个 Promise 实例，包装成一个新的 Promise 实例。</p>
<p>const p = Promise.all([p1, p2, p3]);</p>
<p>Promise.all()方法接受一个数组作为参数，p1、p2、p3都是 Promise 实例，如果不是，就会先调用下面讲到的Promise.resolve方法，将参数转为 Promise 实例，再进一步处理。另外，Promise.all()方法的参数可以不是数组，但必须具有 Iterator 接口，且返回的每个成员都是 Promise 实例。</p>
<p>p的状态由p1、p2、p3决定，分成两种情况。</p>
<p>（1）只有p1、p2、p3的状态都变成fulfilled，p的状态才会变成fulfilled，此时p1、p2、p3的返回值组成一个数组，传递给p的回调函数。</p>
<p>（2）只要p1、p2、p3之中有一个被rejected，p的状态就变成rejected，此时第一个被reject的实例的返回值，会传递给p的回调函数。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> databasePromise = connectDatabase();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> booksPromise = databasePromise</span><br><span class="line">  .then(findAllBooks);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> userPromise = databasePromise</span><br><span class="line">  .then(getCurrentUser);</span><br><span class="line"></span><br><span class="line"><span class="built_in">Promise</span>.all([</span><br><span class="line">  booksPromise,</span><br><span class="line">  userPromise</span><br><span class="line">])</span><br><span class="line">.then(<span class="function">(<span class="params">[books, user]</span>) =&gt;</span> pickTopRecommendations(books, user));</span><br></pre></td></tr></table></figure>
<p>上面代码中，booksPromise和userPromise是两个异步操作，只有等到它们的结果都返回了，才会触发pickTopRecommendations这个回调函数。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> p1 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  resolve(<span class="string">'hello'</span>);</span><br><span class="line">&#125;)</span><br><span class="line">.then(<span class="function"><span class="params">result</span> =&gt;</span> result)</span><br><span class="line">.catch(<span class="function"><span class="params">e</span> =&gt;</span> e);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> p2 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'报错了'</span>);</span><br><span class="line">&#125;)</span><br><span class="line">.then(<span class="function"><span class="params">result</span> =&gt;</span> result)</span><br><span class="line">.catch(<span class="function"><span class="params">e</span> =&gt;</span> e);</span><br><span class="line"></span><br><span class="line"><span class="built_in">Promise</span>.all([p1, p2])</span><br><span class="line">.then(<span class="function"><span class="params">result</span> =&gt;</span> <span class="built_in">console</span>.log(result))</span><br><span class="line">.catch(<span class="function"><span class="params">e</span> =&gt;</span> <span class="built_in">console</span>.log(e));</span><br><span class="line"><span class="comment">// ["hello", Error: 报错了]</span></span><br></pre></td></tr></table></figure>
<p>上面代码中，p1会resolved，p2首先会rejected，但是p2有自己的catch方法，该方法返回的是一个新的 Promise 实例，p2指向的实际上是这个实例。该实例执行完catch方法后，也会变成resolved，导致Promise.all()方法参数里面的两个实例都会resolved，因此会调用then方法指定的回调函数，而不会调用catch方法指定的回调函数。</p>
<p>如果p2没有自己的catch方法，就会调用Promise.all()的catch方法。</p>
<p>待续。。。</p>

          
        
      
    </div>
     <!-- 相关文章推荐 -->
    
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://huyunshun.com/2019/04/14/ECMAScript_6_%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="初晨">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://img.huyunshun.com/img/20200522182348.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="简">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/04/14/ECMAScript_6_%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" itemprop="url">ECMAScript 6 基础知识</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-04-14T00:00:00+08:00">
                2019-04-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Node/" itemprop="url" rel="index">
                    <span itemprop="name">Node</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="一、let和const命令"><a href="#一、let和const命令" class="headerlink" title="一、let和const命令"></a>一、let和const命令</h1><h5 id="1-let命令"><a href="#1-let命令" class="headerlink" title="1. let命令"></a>1. let命令</h5><h6 id="基本用法"><a href="#基本用法" class="headerlink" title="基本用法"></a>基本用法</h6><p>ES6新增了let命令，用来声明变量。用法类似于var，但是也存在新特性：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">1）let所声明的变量，只在let命令所在的代码块有效。适用于for循环。</span><br><span class="line"></span><br><span class="line">   &#123;let a &#x3D; 10;var b &#x3D; 1;&#125;</span><br><span class="line">   &#x2F;&#x2F;a  a is not defined</span><br><span class="line">   &#x2F;&#x2F;b  1</span><br><span class="line"></span><br><span class="line">2）不存在变量提升。</span><br><span class="line">   console.log&#123;bar&#125;;</span><br><span class="line">   let bar &#x3D; 2;</span><br><span class="line">   &#x2F;&#x2F;报错ReferenceError:bar is not defined</span><br><span class="line"></span><br><span class="line">3）暂时性死区。</span><br><span class="line">   在代码块内，使用let命令变量之前，该变量都是不可用的。</span><br><span class="line">   var tmp &#x3D; 123;</span><br><span class="line">   if(true)&#123;</span><br><span class="line">        tmp &#x3D; &#39;abc&#39;; &#x2F;&#x2F;ReferenceError</span><br><span class="line">        let tmp;</span><br><span class="line">   &#125;     </span><br><span class="line"></span><br><span class="line">4）不允许重复声明。</span><br><span class="line">    function()&#123;let a &#x3D;10;let a &#x3D; 1;&#125; &#x2F;&#x2F;报错</span><br></pre></td></tr></table></figure>
<h6 id="块级作用域"><a href="#块级作用域" class="headerlink" title="块级作用域"></a>块级作用域</h6><p>let实际上为JavaScript新增了块级作用域。外层作用域无法读取内层作用域的变量，内层作用域可以定义外层作用域的同名变量。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">let foo &#x3D; 1;</span><br><span class="line">&#123;</span><br><span class="line">   let foo &#x3D; 2; &#x2F;&#x2F;定义同名变量</span><br><span class="line">   let bar &#x3D; &quot;one&quot;;</span><br><span class="line">&#125;      </span><br><span class="line">console.log&#123;foo&#125;; &#x2F;&#x2F;1</span><br><span class="line">console.log(bar); &#x2F;&#x2F;报错</span><br></pre></td></tr></table></figure>
<p> 块级作用域的出现，实际上使得广泛应用的立即执行函数表达式(IIFE)不再必要了。  </p>
<h5 id="2-const命令"><a href="#2-const命令" class="headerlink" title="2. const命令"></a>2. const命令</h5><h6 id="基本用法-1"><a href="#基本用法-1" class="headerlink" title="基本用法"></a>基本用法</h6><p>const声明一个只读的变量。一旦声明，常量的值就不能改变。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">1）const声明的变量不得改变值，这意味着，const一旦声明变量，就必须立即初始化，不能留到以后赋值。</span><br><span class="line">const foo; &#x2F;&#x2F;SyntaxErroe:Missing initializer in const declaration</span><br><span class="line">2）块级作用域</span><br><span class="line">只在声明所在的块级作用域内有效。</span><br><span class="line">3）暂时性死区</span><br><span class="line">  在代码块内，使用let命令声明变量之前，该变量是不可用。</span><br><span class="line"></span><br><span class="line">  if(true)&#123;</span><br><span class="line">     console.log(MAX); &#x2F;&#x2F;ReferenceError const MAX &#x3D; 5;</span><br><span class="line">  &#125;</span><br><span class="line">4）不允许重复声明</span><br><span class="line">   var message &#x3D; &#39;Hello!&#39;;</span><br><span class="line">   let age &#x3D; 25;</span><br><span class="line">   &#x2F;&#x2F;以下两行都会报错</span><br><span class="line">   const message &#x3D; &#39;Goodbye!&#39;;</span><br><span class="line">   const age &#x3D; 30;</span><br></pre></td></tr></table></figure>
<p>用途：为了防止意外修改变量，比如，引入库名，组件名等</p>
<p>let、const与var的区别：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a. let、const有块级作用域的概念，只要是定义的变量，就是一个块级作用域；var只有在函数中才有作用域；</span><br><span class="line">b. let、const不允许重复声明；</span><br><span class="line">c. let和var声明的变量，都可以再修改，而const定义的是常量，值是不可以修改的(对象除外，对象的属性可以修改)</span><br></pre></td></tr></table></figure>
<p>作用域的概念：ES5有两个作用域：全局和局部</p>
<p>ES6有了块作用域的概念：块作用域，通俗的理解，就是一个大括号，就是一个块作用域；</p>
<h5 id="ES6-声明变量的六种方法"><a href="#ES6-声明变量的六种方法" class="headerlink" title="ES6 声明变量的六种方法"></a>ES6 声明变量的六种方法</h5><p>ES5 只有两种声明变量的方法：var命令和function命令。ES6 除了添加let和const命令，后面章节还会提到，另外两种声明变量的方法：import命令和class命令。所以，ES6 一共有 6 种声明变量的方法。</p>
<h5 id="顶层对象的属性"><a href="#顶层对象的属性" class="headerlink" title="顶层对象的属性"></a>顶层对象的属性</h5><p>顶层对象，在浏览器环境指的是window对象，在 Node 指的是global对象。ES5 之中，顶层对象的属性与全局变量是等价的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">window.a &#x3D; 1;</span><br><span class="line">a &#x2F;&#x2F; 1</span><br><span class="line"></span><br><span class="line">a &#x3D; 2;</span><br><span class="line">window.a &#x2F;&#x2F; 2</span><br></pre></td></tr></table></figure>
<p>上面代码中，顶层对象的属性赋值与全局变量的赋值，是同一件事。</p>
<p>顶层对象的属性与全局变量挂钩，是JavaScript 语言最大的设计败笔之一。ES6 为了改变这一点，一方面规定，为了保持兼容性，var命令和function命令声明的全局变量，依旧是顶层对象的属性；另一方面规定，let命令、const命令、class命令声明的全局变量，不属于顶层对象的属性。也就是说，从 ES6 开始，全局变量将逐步与顶层对象的属性脱钩。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">var a &#x3D; 1;</span><br><span class="line">&#x2F;&#x2F; 如果在 Node 的 REPL 环境，可以写成 global.a</span><br><span class="line">&#x2F;&#x2F; 或者采用通用方法，写成 this.a</span><br><span class="line">window.a &#x2F;&#x2F; 1</span><br><span class="line"></span><br><span class="line">let b &#x3D; 1;</span><br><span class="line">window.b &#x2F;&#x2F; undefined</span><br></pre></td></tr></table></figure>
<p>上面代码中，全局变量a由var命令声明，所以它是顶层对象的属性；全局变量b由let命令声明，所以它不是顶层对象的属性，返回undefined。</p>
<h5 id="globalThis-对象"><a href="#globalThis-对象" class="headerlink" title="globalThis 对象"></a>globalThis 对象</h5><p>JavaScript 语言存在一个顶层对象，它提供全局环境（即全局作用域），所有代码都是在这个环境中运行。但是，顶层对象在各种实现里面是不统一的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">浏览器里面，顶层对象是window，但 Node 和 Web Worker 没有window。</span><br><span class="line">浏览器和 Web Worker 里面，self也指向顶层对象，但是 Node 没有self。</span><br><span class="line">Node 里面，顶层对象是global，但其他环境都不支持。</span><br></pre></td></tr></table></figure>
<p>同一段代码为了能够在各种环境，都能取到顶层对象，现在一般是使用this变量，但是有局限性。</p>
<ul>
<li>全局环境中，this会返回顶层对象。但是，Node 模块和 ES6 模块中，this返回的是当前模块。</li>
<li>函数里面的this，如果函数不是作为对象的方法运行，而是单纯作为函数运行，this会指向顶层对象。但是，严格模式下，这时this会返回undefined。</li>
<li>不管是严格模式，还是普通模式，new Function(‘return this’)()，总是会返回全局对象。但是，如果浏览器用了 CSP（Content Security Policy，内容安全策略），那么eval、new Function这些方法都可能无法使用。</li>
</ul>
<p>综上所述，很难找到一种方法，可以在所有情况下，都取到顶层对象。下面是两种勉强可以使用的方法。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 方法一</span><br><span class="line">(typeof window !&#x3D;&#x3D; &#39;undefined&#39;</span><br><span class="line">   ? window</span><br><span class="line">   : (typeof process &#x3D;&#x3D;&#x3D; &#39;object&#39; &amp;&amp;</span><br><span class="line">      typeof require &#x3D;&#x3D;&#x3D; &#39;function&#39; &amp;&amp;</span><br><span class="line">      typeof global &#x3D;&#x3D;&#x3D; &#39;object&#39;)</span><br><span class="line">     ? global</span><br><span class="line">     : this);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 方法二</span><br><span class="line">var getGlobal &#x3D; function () &#123;</span><br><span class="line">  if (typeof self !&#x3D;&#x3D; &#39;undefined&#39;) &#123; return self; &#125;</span><br><span class="line">  if (typeof window !&#x3D;&#x3D; &#39;undefined&#39;) &#123; return window; &#125;</span><br><span class="line">  if (typeof global !&#x3D;&#x3D; &#39;undefined&#39;) &#123; return global; &#125;</span><br><span class="line">  throw new Error(&#39;unable to locate global object&#39;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>现在有一个提案，在语言标准的层面，引入globalThis作为顶层对象。也就是说，任何环境下，globalThis都是存在的，都可以从它拿到顶层对象，指向全局环境下的this。</p>
<h1 id="二、解构赋值"><a href="#二、解构赋值" class="headerlink" title="二、解构赋值"></a>二、解构赋值</h1><p>ES6允许按照一定模式，从数组和对象中提取值，对变量进行赋值，这被称为解构（Destructing）。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">以前，为变量赋值，只能直接指定值。</span><br><span class="line"></span><br><span class="line">let a &#x3D; 1;</span><br><span class="line">let b &#x3D; 2;</span><br><span class="line">let c &#x3D; 3;</span><br><span class="line">ES6 允许写成下面这样。</span><br><span class="line"></span><br><span class="line">let [a, b, c] &#x3D; [1, 2, 3];</span><br></pre></td></tr></table></figure>

<p>本质上，这种写法属于“模式匹配”，只要等号两边的模式相同，左边的变量就会被赋予对应的值。如果结构不成功，变量的值就等于undefined。另一种情况是不完全解构，即等号左边的模式只匹配一部分的等号右边的数组。这种情况下，解构依然可以成功。</p>
<h5 id="数组的解构赋值"><a href="#数组的解构赋值" class="headerlink" title="数组的解构赋值"></a>数组的解构赋值</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">let [a,b,c] &#x3D; [1,2,3];</span><br><span class="line"></span><br><span class="line">1）不完全解构：</span><br><span class="line"></span><br><span class="line">  let [a,[b],d] &#x3D; [1,[2,3],4]; &#x2F;&#x2F;a&#x3D;1;b&#x3D;2;d&#x3D;4</span><br><span class="line"></span><br><span class="line">2）集合解构：</span><br><span class="line"></span><br><span class="line">  let[head,...tail] &#x3D; [1,2,3,4]; &#x2F;&#x2F;head&#x3D;1;tail&#x3D;[2,3,4]</span><br><span class="line"></span><br><span class="line">3）默认值（当匹配值严格等于undefined时，默认值生效）：</span><br><span class="line"></span><br><span class="line">  let [x,y&#x3D;&#39;b&#39;] &#x3D; [&#39;a&#39;]; &#x2F;&#x2F;x &#x3D; &#39;a&#39;,y &#x3D; &#39;b&#39;</span><br><span class="line"></span><br><span class="line">4）默认值也可以为函数：</span><br><span class="line"></span><br><span class="line">  function f()&#123; console.log(&#39;aaa&#39;); &#125;</span><br><span class="line">  let [x&#x3D;f()] &#x3D; [1];</span><br></pre></td></tr></table></figure>
<h5 id="对象的解构赋值"><a href="#对象的解构赋值" class="headerlink" title="对象的解构赋值"></a>对象的解构赋值</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">1）对象的属性没有次序，变量必须与属性同名，才能取到正确的值</span><br><span class="line"></span><br><span class="line">   let &#123;foo,bar&#125; &#x3D; &#123;foo:&#39;aaa&#39;,bar:&#39;bbb&#39;&#125;; &#x2F;&#x2F;foo&#x3D;&#39;aaa&#39;;bar&#x3D;&#39;bbb&#39;</span><br><span class="line"></span><br><span class="line">2）如果变量名与属性名不一致，必须写成下面这样。</span><br><span class="line"></span><br><span class="line">    var &#123;foo:baz&#125; &#x3D; &#123;foo:&#39;aaa&#39;,bar:&#39;bbb&#39;&#125;; &#x2F;&#x2F; baz&#x3D;&#39;aaa&#39;    </span><br><span class="line"></span><br><span class="line">3）这实际上说明，对象的解构赋值是下面形式的简写。</span><br><span class="line"></span><br><span class="line">    let &#123;foo:foo,bar:bar&#125; &#x3D; &#123;foo:&#39;aaa&#39;,bar:&#39;bbb&#39;&#125;;</span><br><span class="line"></span><br><span class="line">4）嵌套结构</span><br><span class="line"></span><br><span class="line">    let obj &#x3D; &#123;p:[&#39;Hello&#39;,&#123;y:&#39;World&#39;&#125;]&#125;;</span><br><span class="line">    let &#123;p:[x,&#123;y&#125;]&#125; &#x3D; obj;  &#x2F;&#x2F; x&#x3D;&#39;Hello&#39;;y&#x3D;&#39;World&#39;  </span><br><span class="line"></span><br><span class="line">5）默认值（默认值生效的条件是，对象的属性值严格等于undefined）</span><br><span class="line">    var &#123;x:y&#x3D;3&#125; &#x3D; &#123;&#125;; &#x2F;&#x2F; y&#x3D;3</span><br></pre></td></tr></table></figure>
<p>对象的解构也可以指定默认值。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">var &#123;x &#x3D; 3&#125; &#x3D; &#123;&#125;;</span><br><span class="line">x &#x2F;&#x2F; 3</span><br><span class="line"></span><br><span class="line">var &#123;x, y &#x3D; 5&#125; &#x3D; &#123;x: 1&#125;;</span><br><span class="line">x &#x2F;&#x2F; 1</span><br><span class="line">y &#x2F;&#x2F; 5</span><br><span class="line"></span><br><span class="line">var &#123;x: y &#x3D; 3&#125; &#x3D; &#123;&#125;;</span><br><span class="line">y &#x2F;&#x2F; 3</span><br><span class="line"></span><br><span class="line">var &#123;x: y &#x3D; 3&#125; &#x3D; &#123;x: 5&#125;;</span><br><span class="line">y &#x2F;&#x2F; 5</span><br><span class="line"></span><br><span class="line">var &#123; message: msg &#x3D; &#39;Something went wrong&#39; &#125; &#x3D; &#123;&#125;;</span><br><span class="line">msg &#x2F;&#x2F; &quot;Something went wrong&quot;</span><br></pre></td></tr></table></figure>
<h5 id="字符串的解构赋值"><a href="#字符串的解构赋值" class="headerlink" title="字符串的解构赋值"></a>字符串的解构赋值</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1）解构时，字符串被转换成了一个类似数组的对象。</span><br><span class="line"></span><br><span class="line">  const [a,b,c,d,e] &#x3D; &#39;hello&#39;; &#x2F;&#x2F;a&#x3D;h;b&#x3D;e;c&#x3D;l;d&#x3D;l;e&#x3D;o</span><br><span class="line"></span><br><span class="line">2）也可以对数组的属性解构</span><br><span class="line"></span><br><span class="line">  let &#123;length:len&#125; &#x3D; &#39;hello&#39;; &#x2F;&#x2F; len&#x3D;5</span><br></pre></td></tr></table></figure>
<h5 id="数值和布尔值的解构赋值"><a href="#数值和布尔值的解构赋值" class="headerlink" title="数值和布尔值的解构赋值"></a>数值和布尔值的解构赋值</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">解构时，如果等号右边是数值和布尔值，则会先转为对象。</span><br><span class="line"></span><br><span class="line">let &#123;toString:s&#125; &#x3D; 123; &#x2F;&#x2F; s&#x3D;&#x3D;&#x3D;Number.prototype.toString true</span><br><span class="line">let &#123;toString:s&#125; &#x3D; true; &#x2F;&#x2F; s&#x3D;&#x3D;&#x3D;Boolean.prototype.toString true</span><br></pre></td></tr></table></figure>
<h5 id="函数参数的解构赋值"><a href="#函数参数的解构赋值" class="headerlink" title="函数参数的解构赋值"></a>函数参数的解构赋值</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">1）基本语法</span><br><span class="line"></span><br><span class="line">  function add([x,y])&#123;return x+y;&#125;</span><br><span class="line">  add([1,2]);</span><br><span class="line"></span><br><span class="line">2）默认值</span><br><span class="line"></span><br><span class="line">  function move(&#123;x&#x3D;0,y&#x3D;0&#125;)&#123;</span><br><span class="line">      return [x,y];</span><br><span class="line">  &#125;  </span><br><span class="line">  move(&#123;x:3,y:8&#125;); &#x2F;&#x2F;[3,8]</span><br><span class="line">  move(&#123;x:3&#125;); &#x2F;&#x2F;[3,0]</span><br><span class="line">  move(&#123;&#125;); &#x2F;&#x2F;[0,0]</span><br><span class="line">  move(); &#x2F;&#x2F;[0,0]</span><br></pre></td></tr></table></figure>
<h5 id="常见用途"><a href="#常见用途" class="headerlink" title="常见用途"></a>常见用途</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">1）交换变量的值</span><br><span class="line"></span><br><span class="line">   let x &#x3D; 1; </span><br><span class="line">   let y &#x3D; 2; </span><br><span class="line">   [x,y] &#x3D; [y,x];</span><br><span class="line"></span><br><span class="line">2）从函数返回多个值</span><br><span class="line"></span><br><span class="line">   function example()&#123;</span><br><span class="line">      return [1,2,3];</span><br><span class="line">   &#125;</span><br><span class="line">   let [a,b,c] &#x3D; example();   </span><br><span class="line"></span><br><span class="line">3）函数参数的定义</span><br><span class="line">   </span><br><span class="line">   function f([x,y,z])&#123;...&#125;</span><br><span class="line">   f([1,2,3]);</span><br><span class="line"></span><br><span class="line">4）提取JSON数据</span><br><span class="line"></span><br><span class="line">   let jsonData &#x3D; &#123;id:42,status:&#39;OK&#39;,data:[867,5309]&#125;;</span><br><span class="line">   let &#123;id,status,data:number&#125; &#x3D; jsonData;   </span><br><span class="line"></span><br><span class="line">5）输入模块的指定方法</span><br><span class="line"></span><br><span class="line">   const &#123;SourceMapConsumer,SourceNode&#125; &#x3D; require(&quot;source-map&quot;);</span><br><span class="line"></span><br><span class="line">6）函数参数的默认值         </span><br><span class="line"></span><br><span class="line">   jQuery.ajax &#x3D; function(url,&#123;</span><br><span class="line">     async &#x3D; true,cache &#x3D; true,global &#x3D; true,</span><br><span class="line">     beforeSend &#x3D; function()&#123;&#125;,</span><br><span class="line">     complete &#x3D; function()&#123;&#125;,</span><br><span class="line">     &#x2F;&#x2F;...more config</span><br><span class="line">   &#125;)&#123;&#x2F;&#x2F;...do stuff&#125;;</span><br><span class="line"></span><br><span class="line">   指定参数的默认值，就避免了在函数体内部再写var foo &#x3D; config.foo||&#39;default foo&#39;;这样的语句。</span><br><span class="line"></span><br><span class="line">7）遍历map结构</span><br><span class="line"></span><br><span class="line">   var map &#x3D; new Map();</span><br><span class="line">   map.set(&#39;first&#39;,&#39;hello&#39;);</span><br><span class="line">   map.set(&#39;second&#39;,&#39;world&#39;);</span><br><span class="line">   for(let [key,value] of map)&#123;</span><br><span class="line">      console.log(key + &quot;is&quot; + value);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<h1 id="三、字符串、正则、对象、函数、数组等扩展"><a href="#三、字符串、正则、对象、函数、数组等扩展" class="headerlink" title="三、字符串、正则、对象、函数、数组等扩展"></a>三、字符串、正则、对象、函数、数组等扩展</h1><h2 id="字符串的扩展"><a href="#字符串的扩展" class="headerlink" title="字符串的扩展"></a>字符串的扩展</h2><h3 id="字符串的遍历器接口"><a href="#字符串的遍历器接口" class="headerlink" title="字符串的遍历器接口"></a>字符串的遍历器接口</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">for (let codePoint of &#39;foo&#39;) &#123;</span><br><span class="line">  console.log(codePoint)</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;&#x2F; &quot;f&quot;</span><br><span class="line">&#x2F;&#x2F; &quot;o&quot;</span><br><span class="line">&#x2F;&#x2F; &quot;o&quot;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
     <!-- 相关文章推荐 -->
    
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://huyunshun.com/2019/04/13/jenkins%E4%BB%8B%E7%BB%8D%E5%92%8C%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="初晨">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://img.huyunshun.com/img/20200522182348.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="简">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/04/13/jenkins%E4%BB%8B%E7%BB%8D%E5%92%8C%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8/" itemprop="url">Jenkins介绍和安装使用</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-04-13T00:00:00+08:00">
                2019-04-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Jenkins/" itemprop="url" rel="index">
                    <span itemprop="name">Jenkins</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="一、什么是持续集成？"><a href="#一、什么是持续集成？" class="headerlink" title="一、什么是持续集成？"></a>一、什么是持续集成？</h2><h3 id="（1）Continuous-integration（CI）"><a href="#（1）Continuous-integration（CI）" class="headerlink" title="（1）Continuous integration（CI）"></a>（1）Continuous integration（CI）</h3><p>持续集成是一种软件开发实践，即团队开发成员经常集成他们的工作，通常每个成员至少集成一次，也就意味着每天可能会发生多次集成。每次集成都通过自动化的构建（包括编译，发布，自动化测试）来验证，从而尽快地发现集成错误。许多团队发现这个过程可以大大减少集成的问题，让团队能够更快的开发内聚的软件。</p>
<h3 id="（2）没有持续集成"><a href="#（2）没有持续集成" class="headerlink" title="（2）没有持续集成"></a>（2）没有持续集成</h3><pre><code>项目做模块集成的时候，发现很多借口都不通==&gt;浪费大量时间
需要手动去编译打包最新的代码==&gt;构建过程不透明
发布代码，上线，基本靠手工==&gt;脚本乱飞</code></pre><h3 id="（3）持续集成最佳实践："><a href="#（3）持续集成最佳实践：" class="headerlink" title="（3）持续集成最佳实践："></a>（3）持续集成最佳实践：</h3><pre><code>维护一个单一的代码库
使构建自动化
执行测试是构建的一部分
集成日志及历史记录
使用统一的依赖包管理库
每天至少集成一次</code></pre><h3 id="（4）jenkins介绍"><a href="#（4）jenkins介绍" class="headerlink" title="（4）jenkins介绍"></a>（4）jenkins介绍</h3><pre><code>Jenkins只是一个平台，真正运作的都是插件。这就是jenkins流行的原因，因为jenkins什么插件都有
Hudson是Jenkins的前身，是基于Java开发的一种持续集成工具，用于监控程序重复的工作，Hudson后来被收购，成为商业版。后来创始人又写了一个jenkins，jenkins在功能上远远超过hudson
Jenkins官网：https://jenkins.io/
Jenkins下载：http://updates.jenkins-ci.org/
jenkins的全部镜像：http://mirrors.jenkins-ci.org/status.html</code></pre><h3 id="（5）部署代码上线流程："><a href="#（5）部署代码上线流程：" class="headerlink" title="（5）部署代码上线流程："></a>（5）部署代码上线流程：</h3><pre><code>1.代码获取（直接了拉取）
2.编译      （可选）
3.配置文件放进去
4.打包
5.scp到目标服务器
6.将目标服务器移除集群
7.解压并放置到Webroot
8.Scp 差异文件
9.重启      （可选）
10.测试
11.加入集群</code></pre><h2 id="二、安装使用"><a href="#二、安装使用" class="headerlink" title="二、安装使用"></a>二、安装使用</h2><p>yum的repo中默认没有Jenkins，需要先将Jenkins存储库添加到yum repos，执行下面的命令：<br>wget -O /etc/yum.repos.d/jenkins.repo <a href="https://pkg.jenkins.io/redhat-stable/jenkins.repo" target="_blank" rel="noopener">https://pkg.jenkins.io/redhat-stable/jenkins.repo</a></p>
<p>然后执行下面的命令：</p>
<p>rpm –import <a href="https://pkg.jenkins.io/redhat-stable/jenkins.io.key" target="_blank" rel="noopener">https://pkg.jenkins.io/redhat-stable/jenkins.io.key</a></p>
<p>然后 安装Jenkins</p>
<p>yum install -y jenkins 默认安装最新的</p>
<p>或者<br>直接下载到本地：wget <a href="https://pkg.jenkins.io/redhat/jenkins-2.160-1.1.noarch.rpm" target="_blank" rel="noopener">https://pkg.jenkins.io/redhat/jenkins-2.160-1.1.noarch.rpm</a><br>然后通过命令安装成功：rpm -ih jenkins-2.160-1.1.noarch.rpm</p>
<p>jenkins安装成功后，默认的用户是jenkins，端口是8080，为了防止冲突，并且给用户赋权限，我们修改用户名和端口。</p>
<p>输入命令，进入jenkins配置文件： vi /etc/sysconfig/jenkins</p>
<p>修改用户名root，端口，然后保存，退出</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">安装jenkins有两种方式，tomcat方式部署和java部署启动。</span><br><span class="line"></span><br><span class="line">tomcat方式部署：</span><br><span class="line">       1、首先安装tomcat和JAVA；</span><br><span class="line">       2、官网下载下来的jenkins.war文件放入tomcat下的webapps目录下，进入tomcat的&#x2F;bin目录下，启动tomcat即启动jenkins。</span><br><span class="line">       3、启动jenkins时，会自动在webapps目录下建立jenkins目录，访问地址为：http:&#x2F;&#x2F;localhost:8080&#x2F;jenkins</span><br><span class="line">       4、如果启动时报错：Caused by:java.awt.AWTError: Can&#39;t connect to X11 window server using &#39;:0&#39; as the value of the DISPLAY varible...</span><br><span class="line">               解决：[jenkins@osb30 bin]$ vim apache-tomcat-8.0.30&#x2F;bin&#x2F;catalina.sh，修改为：JAVA_OPTS&#x3D;&quot;-Xms1024m -Xmx1024m -Djava.awt.headless&#x3D;true&quot;</span><br><span class="line"></span><br><span class="line">java部署启动jenkins：</span><br><span class="line">       1、切换到jenkins.war存放的目录，输入如下命令：java -jar jenkins.war，可以修改启动端口java -jar jenkins.war --httpPort&#x3D;8000</span><br><span class="line">       2、然后在浏览器http:&#x2F;&#x2F;localhost:8080即可访问</span><br></pre></td></tr></table></figure>

<h3 id="启动jenkins"><a href="#启动jenkins" class="headerlink" title="启动jenkins"></a>启动jenkins</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">service jenkins start</span><br><span class="line">启动报Starting Jenkins bash: &#x2F;usr&#x2F;bin&#x2F;java: No such file or directory</span><br><span class="line">修改Jenkins启动配置文件，指定java安装路径。</span><br><span class="line">vim &#x2F;etc&#x2F;init.d&#x2F;jenkins</span><br><span class="line">在candidates中第一行添加java路径，如下：</span><br><span class="line">candidates&#x3D;&quot;</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;jdk8&#x2F;bin&#x2F;java</span><br><span class="line">启动成功，浏览器访问http:&#x2F;&#x2F;192.168.1.110:8088</span><br><span class="line"></span><br><span class="line">初始密码在：&#x2F;var&#x2F;lib&#x2F;jenkins&#x2F;secrets&#x2F;initialAdminPassword</span><br></pre></td></tr></table></figure>
<p>登录成功后显示</p>
<p><img src="https://img.huyunshun.com/img/20200413162014.png" alt="20200413162014"></p>
<p>选择”Install suggested plugins”安装默认的插件，下面Jenkins就会自己去下载相关的插件进行安装。安装完成后配置账号，配置好账号之后hu/123456，进入Jenkins。</p>
<p>接下来在jenkins中配置jdk、svn、maven、git，并且构建web项目和spring boot项目。</p>
<h2 id="三、安装Maven"><a href="#三、安装Maven" class="headerlink" title="三、安装Maven"></a>三、安装Maven</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">官网下载安装包apache-maven-3.6.0-bin.tar.gz到Linux上</span><br><span class="line">解压[root@localhost local]# tar -zxvf apache-maven-3.6.0-bin.tar.gz</span><br><span class="line">&#x2F;&#x2F; 配置环境变量到&#x2F;etc&#x2F;profile</span><br><span class="line">export PATH&#x3D;$PATH:cbin</span><br><span class="line">&#x2F;&#x2F;查看版本</span><br><span class="line">[root@localhost local]# mvn --version</span><br><span class="line">Apache Maven 3.6.0 (97c98ec64a1fdfee7767ce5ffb20918da4f719f3; 2018-10-25T02:41:47+08:00)</span><br><span class="line">Maven home: &#x2F;usr&#x2F;local&#x2F;apache-maven-3.6.0</span><br><span class="line">Java version: 1.8.0_191, vendor: Oracle Corporation, runtime: &#x2F;usr&#x2F;local&#x2F;jdk8&#x2F;jre</span><br><span class="line">Default locale: en_US, platform encoding: UTF-8</span><br><span class="line">OS name: &quot;linux&quot;, version: &quot;2.6.32-431.el6.x86_64&quot;, arch: &quot;amd64&quot;, family: &quot;unix&quot;</span><br><span class="line">修改一下源：</span><br></pre></td></tr></table></figure>
<h2 id="四、安装git"><a href="#四、安装git" class="headerlink" title="四、安装git"></a>四、安装git</h2><p>安装过程 略</p>
<p>有的插件安装失败，通过换源来解决或者手动下载：jenkins-&gt;系统管理-&gt;管理插件-&gt;高级，如<br> <a href="https://mirrors.tuna.tsinghua.edu.cn/jenkins/updates/update-center.jsonss" target="_blank" rel="noopener">https://mirrors.tuna.tsinghua.edu.cn/jenkins/updates/update-center.jsonss</a></p>
<h2 id="五、使用Jenkins"><a href="#五、使用Jenkins" class="headerlink" title="五、使用Jenkins"></a>五、使用Jenkins</h2><h3 id="使用构建"><a href="#使用构建" class="headerlink" title="使用构建"></a>使用构建</h3><p>配置DK、MAVEN、Git为实际对应的安装目录</p>
<p><img src="https://img.huyunshun.com/img/20200413161952.png" alt="20200413161952"></p>
<p>安装以下插件：</p>
<pre><code>1、 Maven Integration plugin
2、 Subversion Plugin
3、 Checkstyle Plugin
4、 Findbugs Plugin
5、 PMD Plugin
6、 Warnings Plugin
7、 Maven Info Plugin
8、 Maven Repository Scheduled Cleanup Plugin
9、 Unleash Maven Plugin
10、 Maven Invoker plugin

Subversion Plug-in ## 版本管理 SVN 的插件
Git plugin ## 版本管理 GIT 的插件
Maven Integration plugin ## 项目构建 Maven 的插件
Gradle Plugin ## 项目构建 Gradle 的插件</code></pre><p>无需重启 Jenkins 插件即生效。如遇失败可重试或离线安装。</p>
<p>一般情况下，常使用到如下这些插件：</p>
<pre><code>FindBugs Plug-in： 是一个静态分析工具，它检查类或者 JAR 文件，将字节码与一组缺陷模式进行对        比以发现可能的问题。
Checkstyle Plug-in：是一个静态分析工具，检查Java程序代码。
Deploy to container Plugin：用于构建项目后，自动发布war包重新部署的插件
SSH Plugin：这个插件使用 SSH 协议执行远程 shell 命令。
Multijob Plugin：这个插件是一个将多个项目连接在一起的插件。</code></pre><h3 id="1、构建Maven项目"><a href="#1、构建Maven项目" class="headerlink" title="1、构建Maven项目"></a>1、构建Maven项目</h3><p> <img src="https://img.huyunshun.com/img/20200413162214.png" alt="20200413162214"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">由用户 hu 启动</span><br><span class="line">Running as SYSTEM</span><br><span class="line">构建中 在工作空间 &#x2F;var&#x2F;lib&#x2F;jenkins&#x2F;workspace&#x2F;maven-jenkins-test 中</span><br><span class="line">using credential dd5c879e-a6f2-4902-95fc-81219b15096f</span><br><span class="line">Cloning the remote Git repository</span><br><span class="line">Cloning repository https:&#x2F;&#x2F;github.com&#x2F;huingsn&#x2F;demo</span><br><span class="line">&gt; git init &#x2F;var&#x2F;lib&#x2F;jenkins&#x2F;workspace&#x2F;maven-jenkins-test # timeout&#x3D;10</span><br><span class="line">Fetching upstream changes from https:&#x2F;&#x2F;github.com&#x2F;huingsn&#x2F;demo</span><br><span class="line">&gt; git --version # timeout&#x3D;10</span><br><span class="line">using GIT_ASKPASS to set credentials</span><br><span class="line">&gt; git fetch --tags --progress https:&#x2F;&#x2F;github.com&#x2F;huingsn&#x2F;demo +refs&#x2F;heads&#x2F;*:refs&#x2F;remotes&#x2F;origin&#x2F;*</span><br><span class="line">&gt; git config remote.origin.url https:&#x2F;&#x2F;github.com&#x2F;huingsn&#x2F;demo # timeout&#x3D;10</span><br><span class="line">&gt; git config --add remote.origin.fetch +refs&#x2F;heads&#x2F;*:refs&#x2F;remotes&#x2F;origin&#x2F;* # timeout&#x3D;10</span><br><span class="line">&gt; git config remote.origin.url https:&#x2F;&#x2F;github.com&#x2F;huingsn&#x2F;demo # timeout&#x3D;10</span><br><span class="line">Fetching upstream changes from https:&#x2F;&#x2F;github.com&#x2F;huingsn&#x2F;demo</span><br><span class="line">using GIT_ASKPASS to set credentials</span><br><span class="line">&gt; git fetch --tags --progress https:&#x2F;&#x2F;github.com&#x2F;huingsn&#x2F;demo +refs&#x2F;heads&#x2F;*:refs&#x2F;remotes&#x2F;origin&#x2F;*</span><br><span class="line">&gt; git rev-parse refs&#x2F;remotes&#x2F;origin&#x2F;master^&#123;commit&#125; # timeout&#x3D;10</span><br><span class="line">&gt; git rev-parse refs&#x2F;remotes&#x2F;origin&#x2F;origin&#x2F;master^&#123;commit&#125; # timeout&#x3D;10</span><br><span class="line">&gt; git rev-parse origin&#x2F;master^&#123;commit&#125; # timeout&#x3D;10</span><br><span class="line">ERROR: Couldn&#39;t find any revision to build. Verify the repository and branch configuration for this job.</span><br><span class="line">Finished: FAILURE</span><br></pre></td></tr></table></figure>
<p>原因分析：jenkins无法准确识别revision</p>
<p>操作方法：</p>
<p><img src="https://img.huyunshun.com/img/20200413162306.png" alt="20200413162306"></p>
<p>再次构建，成功！</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">由用户 hu 启动</span><br><span class="line">Running as SYSTEM</span><br><span class="line">构建中 在工作空间 &#x2F;var&#x2F;lib&#x2F;jenkins&#x2F;workspace&#x2F;dsafsdfdsafas 中</span><br><span class="line">using credential dd5c879e-a6f2-4902-95fc-81219b15096f</span><br><span class="line">Cloning the remote Git repository</span><br><span class="line">Cloning repository https:&#x2F;&#x2F;github.com&#x2F;huingsn&#x2F;demo</span><br><span class="line">&gt; git init &#x2F;var&#x2F;lib&#x2F;jenkins&#x2F;workspace&#x2F;dsafsdfdsafas # timeout&#x3D;10</span><br><span class="line">Fetching upstream changes from https:&#x2F;&#x2F;github.com&#x2F;huingsn&#x2F;demo</span><br><span class="line">&gt; git --version # timeout&#x3D;10</span><br><span class="line">using GIT_ASKPASS to set credentials</span><br><span class="line">&gt; git fetch --tags --progress https:&#x2F;&#x2F;github.com&#x2F;huingsn&#x2F;demo +refs&#x2F;heads&#x2F;*:refs&#x2F;remotes&#x2F;origin&#x2F;*</span><br><span class="line">&gt; git config remote.origin.url https:&#x2F;&#x2F;github.com&#x2F;huingsn&#x2F;demo # timeout&#x3D;10</span><br><span class="line">&gt; git config --add remote.origin.fetch +refs&#x2F;heads&#x2F;*:refs&#x2F;remotes&#x2F;origin&#x2F;* # timeout&#x3D;10</span><br><span class="line">&gt; git config remote.origin.url https:&#x2F;&#x2F;github.com&#x2F;huingsn&#x2F;demo # timeout&#x3D;10</span><br><span class="line">Fetching upstream changes from https:&#x2F;&#x2F;github.com&#x2F;huingsn&#x2F;demo</span><br><span class="line">using GIT_ASKPASS to set credentials</span><br><span class="line">&gt; git fetch --tags --progress https:&#x2F;&#x2F;github.com&#x2F;huingsn&#x2F;demo +refs&#x2F;heads&#x2F;*:refs&#x2F;remotes&#x2F;origin&#x2F;*</span><br><span class="line">Seen branch in repository origin&#x2F;github.com&#x2F;huingsn&#x2F;demo</span><br><span class="line">Seen 1 remote branch</span><br><span class="line">&gt; git show-ref --tags -d # timeout&#x3D;10</span><br><span class="line">Checking out Revision c8688fb590873bd7b77f3537d11640a5139c0da4 (origin&#x2F;github.com&#x2F;huingsn&#x2F;demo)</span><br><span class="line">&gt; git config core.sparsecheckout # timeout&#x3D;10</span><br><span class="line">&gt; git checkout -f c8688fb590873bd7b77f3537d11640a5139c0da4</span><br><span class="line">Commit message: &quot;dfsdfsdfs&quot;</span><br><span class="line">First time build. Skipping changelog.</span><br><span class="line">Parsing POMs</span><br><span class="line">Discovered a new module com.hu:maven-jenkins-test maven-jenkins-test Maven Webapp</span><br><span class="line">Modules changed, recalculating dependency graph</span><br><span class="line">Established TCP socket on 37646</span><br><span class="line">[dsafsdfdsafas] $ &#x2F;usr&#x2F;lib&#x2F;jvm&#x2F;java-1.8.0-openjdk-1.8.0.201.b09-2.el7_6.x86_64&#x2F;bin&#x2F;java -cp &#x2F;var&#x2F;lib&#x2F;jenkins&#x2F;plugins&#x2F;maven-plugin&#x2F;WEB-INF&#x2F;lib&#x2F;maven3-agent-1.12.jar:&#x2F;usr&#x2F;share&#x2F;maven&#x2F;boot&#x2F;plexus-classworlds.jar org.jvnet.hudson.maven3.agent.Maven3Main &#x2F;usr&#x2F;share&#x2F;maven &#x2F;var&#x2F;cache&#x2F;jenkins&#x2F;war&#x2F;WEB-INF&#x2F;lib&#x2F;remoting-3.29.jar &#x2F;var&#x2F;lib&#x2F;jenkins&#x2F;plugins&#x2F;maven-plugin&#x2F;WEB-INF&#x2F;lib&#x2F;maven3-interceptor-1.12.jar &#x2F;var&#x2F;lib&#x2F;jenkins&#x2F;plugins&#x2F;maven-plugin&#x2F;WEB-INF&#x2F;lib&#x2F;maven3-interceptor-commons-1.12.jar 37646</span><br><span class="line">&lt;&#x3D;&#x3D;&#x3D;[JENKINS REMOTING CAPACITY]&#x3D;&#x3D;&#x3D;&gt;channel started</span><br><span class="line">Executing Maven:  -B -f &#x2F;var&#x2F;lib&#x2F;jenkins&#x2F;workspace&#x2F;dsafsdfdsafas&#x2F;pom.xml install</span><br><span class="line">[INFO] Scanning for projects...</span><br><span class="line">[INFO]                                                                        </span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br><span class="line">[INFO] Building maven-jenkins-test Maven Webapp 1.0-SNAPSHOT</span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br><span class="line">Downloading: https:&#x2F;&#x2F;repo.maven.apache.org&#x2F;maven2&#x2F;org&#x2F;apache&#x2F;maven&#x2F;plugins&#x2F;maven-resources-plugin&#x2F;3.0.2&#x2F;maven-resources-plugin-3.0.2.pom</span><br><span class="line">&#x2F;&#x2F;省略下载包过程</span><br><span class="line">Downloaded: https:&#x2F;&#x2F;repo.maven.apache.org&#x2F;maven2&#x2F;org&#x2F;codehaus&#x2F;plexus&#x2F;plexus-utils&#x2F;3.0.15&#x2F;plexus-utils-3.0.15.jar (234 KB at 17.8 KB&#x2F;sec)</span><br><span class="line">[INFO] Installing &#x2F;var&#x2F;lib&#x2F;jenkins&#x2F;workspace&#x2F;dsafsdfdsafas&#x2F;target&#x2F;maven-jenkins-test.war to &#x2F;root&#x2F;.m2&#x2F;repository&#x2F;com&#x2F;hu&#x2F;maven-jenkins-test&#x2F;1.0-SNAPSHOT&#x2F;maven-jenkins-test-1.0-SNAPSHOT.war</span><br><span class="line">[INFO] Installing &#x2F;var&#x2F;lib&#x2F;jenkins&#x2F;workspace&#x2F;dsafsdfdsafas&#x2F;pom.xml to &#x2F;root&#x2F;.m2&#x2F;repository&#x2F;com&#x2F;hu&#x2F;maven-jenkins-test&#x2F;1.0-SNAPSHOT&#x2F;maven-jenkins-test-1.0-SNAPSHOT.pom</span><br><span class="line"></span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br><span class="line">[INFO] BUILD SUCCESS</span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br><span class="line">[INFO] Total time: 6:17.736s</span><br><span class="line">[INFO] Finished at: Sat Apr 06 21:22:19 CST 2019</span><br><span class="line">[INFO] Final Memory: 14M&#x2F;79M</span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br><span class="line">Waiting for Jenkins to finish collecting data</span><br><span class="line">[JENKINS] Archiving &#x2F;var&#x2F;lib&#x2F;jenkins&#x2F;workspace&#x2F;dsafsdfdsafas&#x2F;pom.xml to com.hu&#x2F;maven-jenkins-test&#x2F;1.0-SNAPSHOT&#x2F;maven-jenkins-test-1.0-SNAPSHOT.pom</span><br><span class="line">[JENKINS] Archiving &#x2F;var&#x2F;lib&#x2F;jenkins&#x2F;workspace&#x2F;dsafsdfdsafas&#x2F;target&#x2F;maven-jenkins-test.war to com.hu&#x2F;maven-jenkins-test&#x2F;1.0-SNAPSHOT&#x2F;maven-jenkins-test-1.0-SNAPSHOT.war</span><br><span class="line">channel stopped</span><br><span class="line"></span><br><span class="line">Finished: SUCCESS</span><br></pre></td></tr></table></figure>
<h3 id="构建触发器"><a href="#构建触发器" class="headerlink" title="构建触发器"></a>构建触发器</h3><p>指定的项目完成构建后，触发此项目的构建。</p>
<p>Poll SCM</p>
<p>1.首先格式为：* * * * *（五个星）；</p>
<p>2.第一个*表示分钟，取值0~59</p>
<pre><code>第二个*表示小时，取值0~23
第三个*表示一个月的第几天，取值1~31
第四个*表示第几月，取值1~12
第五个*表示一周中的第几天，取值0~7，其中0和7代表的都是周日</code></pre><p>3.使用举例：</p>
<pre><code>每隔10分钟构建一次：H/5 * * * *
每隔1小时构建一次： H/1* *
每月30号构建一次：   H 30 * *
Build periodically：此选项仅仅通知Jenkins按指定的频率对项目进行构建，而不管SCM是否有变化。如果想在这个Job中运行一些测试用例的话，它就很有帮助。</code></pre><p><img src="https://img.huyunshun.com/img/20200413162444.png" alt="20200413162444"></p>
<h3 id="构建"><a href="#构建" class="headerlink" title="构建"></a>构建</h3><p>　    这部分主要是配置构建的相关内容，用于定时触发构建或者手动执行构建的时候，对代码检验、编译时进行的操作。构建概念到处可查到，形象来说，构建就是要把代码从某个地方拷贝过来，编译，再拷贝到某个地方去等等操作，当然不仅与此，但是主要用来干这个。</p>
<p>因为我的项目是用ant脚本实现的编译和打包，所以我选择的是Invoke Ant，Ant Version选择我Ant配置的那个名字（这里可以参见3.4.2），注意不要选择default喔，那个选择了没有用。</p>
<h3 id="构建后操作"><a href="#构建后操作" class="headerlink" title="构建后操作"></a>构建后操作</h3><p>　　用于定义当前项目构建完之后的一些操作，比如构建完之后将checkstyle结果输出到指定日志文件，重新发布项目，去执行其他项目构建等。</p>
<p><img src="https://img.huyunshun.com/img/20200413162513.png" alt="20200413162513"></p>
<h3 id="构建后发布项目"><a href="#构建后发布项目" class="headerlink" title="构建后发布项目"></a>构建后发布项目</h3><p>注意，首先必须安装好Deploy Plugin插件，然后在tomcat的conf目录配置tomcat-users.xml文件，如我这里配置的是manager, 在<tomcat-users>节点里添加如下内容:</p>
<p> <img src="https://img.huyunshun.com/img/20200413162537.png" alt="20200413162537"></p>
<pre><code>WAR/EAR files：是war包的相对路径(相对于工作区路径,即在工作区中war包的相对路径.)如我的maven执行完成之后会在工作区的target目录下生成项目.war,所以这里我的路径就写target\项目.war.
Context path：访问时需要输入的内容http://192.168.1.112:8000/maven-jenkins-test，如果为空，默认是war包的名字。
Container：选择你的web容器，如tomca 7.x
Manager user name：填入tomcat-users.xml配置的username内容
Manager password：填入tomcat-users.xml配置的password内容</code></pre><p>Tomcat URL：<a href="http://192.168.1.112:8000" target="_blank" rel="noopener">http://192.168.1.112:8000</a></p>
<p>Deploy on failure：构建失败依然部署，一般不选择</p>
<p>　　注意：虽然这种部署方法可能会导致tomcat加载时出现卡死的现象。但是也是最简单的部署方式。如果卡死了重启下就好了，将tomcat的java内存参数调高可以解决这个问题。</p>
<p>上面写入错入，Tomcat端口是8080，开始部署：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line">Running as SYSTEM</span><br><span class="line">[EnvInject] - Loading node environment variables.</span><br><span class="line">构建中 在工作空间 &#x2F;var&#x2F;lib&#x2F;jenkins&#x2F;workspace&#x2F;first 中</span><br><span class="line">using credential dd5c879e-a6f2-4902-95fc-81219b15096f</span><br><span class="line">&gt; git rev-parse --is-inside-work-tree # timeout&#x3D;10</span><br><span class="line">Fetching changes from the remote Git repository</span><br><span class="line">&gt; git config remote.origin.url https:&#x2F;&#x2F;github.com&#x2F;huingsn&#x2F;demo # timeout&#x3D;10</span><br><span class="line">Fetching upstream changes from https:&#x2F;&#x2F;github.com&#x2F;huingsn&#x2F;demo</span><br><span class="line">&gt; git --version # timeout&#x3D;10</span><br><span class="line">using GIT_ASKPASS to set credentials</span><br><span class="line">&gt; git fetch --tags --progress https:&#x2F;&#x2F;github.com&#x2F;huingsn&#x2F;demo +refs&#x2F;heads&#x2F;*:refs&#x2F;remotes&#x2F;origin&#x2F;*</span><br><span class="line">Seen branch in repository origin&#x2F;github.com&#x2F;huingsn&#x2F;demo</span><br><span class="line">Seen 1 remote branch</span><br><span class="line">&gt; git show-ref --tags -d # timeout&#x3D;10</span><br><span class="line">Checking out Revision c8688fb590873bd7b77f3537d11640a5139c0da4 (origin&#x2F;github.com&#x2F;huingsn&#x2F;demo)</span><br><span class="line">&gt; git config core.sparsecheckout # timeout&#x3D;10</span><br><span class="line">&gt; git checkout -f c8688fb590873bd7b77f3537d11640a5139c0da4</span><br><span class="line">Commit message: &quot;dfsdfsdfs&quot;</span><br><span class="line">&gt; git rev-list --no-walk c8688fb590873bd7b77f3537d11640a5139c0da4 # timeout&#x3D;10</span><br><span class="line">Parsing POMs</span><br><span class="line">Established TCP socket on 36677</span><br><span class="line">[first] $ &#x2F;usr&#x2F;lib&#x2F;jvm&#x2F;java-1.8.0-openjdk-1.8.0.201.b09-2.el7_6.x86_64&#x2F;bin&#x2F;java -cp &#x2F;var&#x2F;lib&#x2F;jenkins&#x2F;plugins&#x2F;maven-plugin&#x2F;WEB-INF&#x2F;lib&#x2F;maven3-agent-1.12.jar:&#x2F;usr&#x2F;share&#x2F;maven&#x2F;boot&#x2F;plexus-classworlds.jar org.jvnet.hudson.maven3.agent.Maven3Main &#x2F;usr&#x2F;share&#x2F;maven &#x2F;var&#x2F;cache&#x2F;jenkins&#x2F;war&#x2F;WEB-INF&#x2F;lib&#x2F;remoting-3.29.jar &#x2F;var&#x2F;lib&#x2F;jenkins&#x2F;plugins&#x2F;maven-plugin&#x2F;WEB-INF&#x2F;lib&#x2F;maven3-interceptor-1.12.jar &#x2F;var&#x2F;lib&#x2F;jenkins&#x2F;plugins&#x2F;maven-plugin&#x2F;WEB-INF&#x2F;lib&#x2F;maven3-interceptor-commons-1.12.jar 36677</span><br><span class="line">&lt;&#x3D;&#x3D;&#x3D;[JENKINS REMOTING CAPACITY]&#x3D;&#x3D;&#x3D;&gt;channel started</span><br><span class="line"></span><br><span class="line">Executing Maven:  -B -f &#x2F;var&#x2F;lib&#x2F;jenkins&#x2F;workspace&#x2F;first&#x2F;pom.xml install</span><br><span class="line"></span><br><span class="line">[INFO] Scanning for projects...</span><br><span class="line"></span><br><span class="line">[INFO]                                                                        </span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br><span class="line">[INFO] Building maven-jenkins-test Maven Webapp 1.0-SNAPSHOT</span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br><span class="line">[INFO]</span><br><span class="line">[INFO] --- maven-resources-plugin:3.0.2:resources (default-resources) @ maven-jenkins-test ---</span><br><span class="line"></span><br><span class="line">[INFO] Using &#39;UTF-8&#39; encoding to copy filtered resources.</span><br><span class="line">[INFO] skip non existing resourceDirectory &#x2F;var&#x2F;lib&#x2F;jenkins&#x2F;workspace&#x2F;first&#x2F;src&#x2F;main&#x2F;resources</span><br><span class="line"></span><br><span class="line">[INFO]</span><br><span class="line">[INFO] --- maven-compiler-plugin:3.8.0:compile (default-compile) @ maven-jenkins-test ---</span><br><span class="line"></span><br><span class="line">[INFO] No sources to compile</span><br><span class="line">[INFO]</span><br><span class="line">[INFO] --- maven-resources-plugin:3.0.2:testResources (default-testResources) @ maven-jenkins-test ---</span><br><span class="line">[INFO] Using &#39;UTF-8&#39; encoding to copy filtered resources.</span><br><span class="line">[INFO] skip non existing resourceDirectory &#x2F;var&#x2F;lib&#x2F;jenkins&#x2F;workspace&#x2F;first&#x2F;src&#x2F;test&#x2F;resources</span><br><span class="line">[INFO]</span><br><span class="line">[INFO] --- maven-compiler-plugin:3.8.0:testCompile (default-testCompile) @ maven-jenkins-test ---</span><br><span class="line">[INFO] No sources to compile</span><br><span class="line">[INFO]</span><br><span class="line">[INFO] --- maven-surefire-plugin:2.22.1:test (default-test) @ maven-jenkins-test ---</span><br><span class="line"></span><br><span class="line">[INFO] No tests to run.</span><br><span class="line">[JENKINS] Recording test results</span><br><span class="line">[WARNING] Attempt to (de-)serialize anonymous class hudson.maven.reporters.BuildInfoRecorder$1; see: https:&#x2F;&#x2F;jenkins.io&#x2F;redirect&#x2F;serialization-of-anonymous-classes&#x2F;</span><br><span class="line">[INFO]</span><br><span class="line">[INFO] --- maven-war-plugin:3.2.2:war (default-war) @ maven-jenkins-test ---</span><br><span class="line"></span><br><span class="line">[INFO] Packaging webapp</span><br><span class="line">[INFO] Assembling webapp [maven-jenkins-test] in [&#x2F;var&#x2F;lib&#x2F;jenkins&#x2F;workspace&#x2F;first&#x2F;target&#x2F;maven-jenkins-test]</span><br><span class="line">[INFO] Processing war project</span><br><span class="line">[INFO] Copying webapp resources [&#x2F;var&#x2F;lib&#x2F;jenkins&#x2F;workspace&#x2F;first&#x2F;src&#x2F;main&#x2F;webapp]</span><br><span class="line">[INFO] Webapp assembled in [75 msecs]</span><br><span class="line">[INFO] Building war: &#x2F;var&#x2F;lib&#x2F;jenkins&#x2F;workspace&#x2F;first&#x2F;target&#x2F;maven-jenkins-test.war</span><br><span class="line"></span><br><span class="line">[INFO]</span><br><span class="line">[INFO] --- maven-install-plugin:2.5.2:install (default-install) @ maven-jenkins-test ---</span><br><span class="line"></span><br><span class="line">[INFO] Installing &#x2F;var&#x2F;lib&#x2F;jenkins&#x2F;workspace&#x2F;first&#x2F;target&#x2F;maven-jenkins-test.war to &#x2F;root&#x2F;.m2&#x2F;repository&#x2F;com&#x2F;hu&#x2F;maven-jenkins-test&#x2F;1.0-SNAPSHOT&#x2F;maven-jenkins-test-1.0-SNAPSHOT.war</span><br><span class="line">[INFO] Installing &#x2F;var&#x2F;lib&#x2F;jenkins&#x2F;workspace&#x2F;first&#x2F;pom.xml to &#x2F;root&#x2F;.m2&#x2F;repository&#x2F;com&#x2F;hu&#x2F;maven-jenkins-test&#x2F;1.0-SNAPSHOT&#x2F;maven-jenkins-test-1.0-SNAPSHOT.pom</span><br><span class="line"></span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br><span class="line">[INFO] BUILD SUCCESS</span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br><span class="line">[INFO] Total time: 9.804s</span><br><span class="line">[INFO] Finished at: Sat Apr 06 23:06:26 CST 2019</span><br><span class="line">[INFO] Final Memory: 13M&#x2F;98M</span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br><span class="line">Waiting for Jenkins to finish collecting data</span><br><span class="line">[JENKINS] Archiving &#x2F;var&#x2F;lib&#x2F;jenkins&#x2F;workspace&#x2F;first&#x2F;pom.xml to com.hu&#x2F;maven-jenkins-test&#x2F;1.0-SNAPSHOT&#x2F;maven-jenkins-test-1.0-SNAPSHOT.pom</span><br><span class="line">[JENKINS] Archiving &#x2F;var&#x2F;lib&#x2F;jenkins&#x2F;workspace&#x2F;first&#x2F;target&#x2F;maven-jenkins-test.war to com.hu&#x2F;maven-jenkins-test&#x2F;1.0-SNAPSHOT&#x2F;maven-jenkins-test-1.0-SNAPSHOT.war</span><br><span class="line">channel stopped</span><br><span class="line"></span><br><span class="line">Deploying &#x2F;var&#x2F;lib&#x2F;jenkins&#x2F;workspace&#x2F;first&#x2F;target&#x2F;maven-jenkins-test.war to container Tomcat 7.x Remote with context</span><br><span class="line"> [&#x2F;var&#x2F;lib&#x2F;jenkins&#x2F;workspace&#x2F;first&#x2F;target&#x2F;maven-jenkins-test.war] is not deployed. Doing a fresh deployment.</span><br><span class="line"> Deploying [&#x2F;var&#x2F;lib&#x2F;jenkins&#x2F;workspace&#x2F;first&#x2F;target&#x2F;maven-jenkins-test.war]</span><br><span class="line"></span><br><span class="line">Finished: SUCCESS</span><br></pre></td></tr></table></figure>
<p>成功部署到Tomcat，<a href="http://192.168.1.112:8080/maven-jenkins-test/成功访问。" target="_blank" rel="noopener">http://192.168.1.112:8080/maven-jenkins-test/成功访问。</a></p>
<p>好了！到此一个项目的获取源码，打包，远程部署</p>

          
        
      
    </div>
     <!-- 相关文章推荐 -->
    
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://huyunshun.com/2019/04/13/github+jenkins+maven+docker%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%84%E5%BB%BA%E9%83%A8%E7%BD%B2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="初晨">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://img.huyunshun.com/img/20200522182348.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="简">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/04/13/github+jenkins+maven+docker%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%84%E5%BB%BA%E9%83%A8%E7%BD%B2/" itemprop="url">github+jenkins+maven+docker自动化构建部署</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-04-13T00:00:00+08:00">
                2019-04-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Jenkins/" itemprop="url" rel="index">
                    <span itemprop="name">Jenkins</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在linux系统中，搭建jenkins服务，定时（或githook）的方式从github上拉取maven工程，构建war包。使用docker构建image，推送到docker registry上。</p>

          
        
      
    </div>
     <!-- 相关文章推荐 -->
    
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://huyunshun.com/2019/04/13/ECMAScript_6_%E7%AE%80%E4%BB%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="初晨">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://img.huyunshun.com/img/20200522182348.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="简">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/04/13/ECMAScript_6_%E7%AE%80%E4%BB%8B/" itemprop="url">ECMAScript 6 简介</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-04-13T00:00:00+08:00">
                2019-04-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Node/" itemprop="url" rel="index">
                    <span itemprop="name">Node</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>ECMAScript 6.0（以下简称 ES6）是 JavaScript 语言的下一代标准，已经在 2015 年 6 月正式发布了。它的目标，是使得 JavaScript 语言可以用来编写复杂的大型应用程序，成为企业级开发语言。</p>
<h1 id="部署进度"><a href="#部署进度" class="headerlink" title="部署进度"></a>部署进度</h1><p>各大浏览器的最新版本，对 ES6 的支持可以查看kangax.github.io/compat-table/es6/。随着时间的推移，支持度已经越来越高了，超过 90%的 ES6 语法特性都实现了。</p>
<p>Node 是 JavaScript 的服务器运行环境（runtime）。它对 ES6 的支持度更高。除了那些默认打开的功能，还有一些语法功能已经实现了，但是默认没有打开。使用下面的命令，可以查看 Node 已经实现的 ES6 特性。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; Linux &amp; Mac</span><br><span class="line">$ node --v8-options | grep harmony</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; Windows</span><br><span class="line">$ node --v8-options | findstr harmony</span><br></pre></td></tr></table></figure>
<h1 id="Babel-转码器"><a href="#Babel-转码器" class="headerlink" title="Babel 转码器"></a>Babel 转码器</h1><p>Babel 是一个广泛使用的 ES6 转码器，可以将 ES6 代码转为 ES5 代码，从而在现有环境执行。这意味着，你可以用 ES6 的方式编写程序，又不用担心现有环境是否支持。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 转码前</span><br><span class="line">input.map(item &#x3D;&gt; item + 1);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 转码后</span><br><span class="line">input.map(function (item) &#123;</span><br><span class="line">  return item + 1;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>上面的原始代码用了箭头函数，Babel 将其转为普通函数，就能在不支持箭头函数的 JavaScript 环境执行了。</p>
<p>下面的命令在项目目录中，安装 Babel。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install --save-dev @babel&#x2F;core</span><br></pre></td></tr></table></figure>
<h4 id="配置文件-babelrc"><a href="#配置文件-babelrc" class="headerlink" title="配置文件.babelrc"></a>配置文件.babelrc</h4><p>Babel 的配置文件是.babelrc，存放在项目的根目录下。使用 Babel 的第一步，就是配置这个文件。</p>
<p>该文件用来设置转码规则和插件，基本格式如下。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;presets&quot;: [],</span><br><span class="line">  &quot;plugins&quot;: []</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>presets字段设定转码规则，官方提供以下的规则集，你可以根据需要安装。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#最新转码规则</span><br><span class="line">$ npm install --save-dev @babel&#x2F;preset-env</span><br><span class="line"></span><br><span class="line">#react 转码规则</span><br><span class="line">$ npm install --save-dev @babel&#x2F;preset-react</span><br></pre></td></tr></table></figure>
<p>然后，将这些规则加入.babelrc。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"presets"</span>: [</span><br><span class="line">    <span class="string">"@babel/env"</span>,</span><br><span class="line">    <span class="string">"@babel/preset-react"</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="string">"plugins"</span>: []</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意，以下所有 Babel 工具和模块的使用，都必须先写好.babelrc。</p>
<h1 id="命令行转码"><a href="#命令行转码" class="headerlink" title="命令行转码"></a>命令行转码</h1><p>Babel 提供命令行工具@babel/cli，用于命令行转码。</p>
<p>它的安装命令如下。</p>
<p>$ npm install –save-dev @babel/cli</p>
<p>基本用法如下。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#转码结果输出到标准输出</span><br><span class="line">$ npx babel example.js</span><br><span class="line"></span><br><span class="line">#转码结果写入一个文件</span><br><span class="line">#--out-file 或 -o 参数指定输出文件</span><br><span class="line">$ npx babel example.js --out-file compiled.js</span><br><span class="line"># 或者</span><br><span class="line">$ npx babel example.js -o compiled.js</span><br><span class="line"></span><br><span class="line"># 整个目录转码</span><br><span class="line"># --out-dir 或 -d 参数指定输出目录</span><br><span class="line">$ npx babel src --out-dir lib</span><br><span class="line"># 或者</span><br><span class="line">$ npx babel src -d lib</span><br><span class="line"></span><br><span class="line"># -s 参数生成source map文件</span><br><span class="line">$ npx babel src -d lib -s</span><br></pre></td></tr></table></figure>
<h4 id="babel-node"><a href="#babel-node" class="headerlink" title="babel-node"></a>babel-node</h4><p>@babel/node模块的babel-node命令，提供一个支持 ES6 的 REPL 环境。它支持 Node 的 REPL 环境的所有功能，而且可以直接运行 ES6 代码。</p>
<p>首先，安装这个模块。</p>
<p>$ npm install –save-dev @babel/node</p>
<p>然后，执行babel-node就进入 REPL 环境。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ npx babel-node</span><br><span class="line">&gt; (x &#x3D;&gt; x * 2)(1)</span><br><span class="line">2</span><br></pre></td></tr></table></figure>
<p>babel-node命令可以直接运行 ES6 脚本。将上面的代码放入脚本文件es6.js，然后直接运行。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># es6.js 的代码</span><br><span class="line"># console.log((x &#x3D;&gt; x * 2)(1));</span><br><span class="line">$ npx babel-node es6.js</span><br><span class="line">2</span><br></pre></td></tr></table></figure>
<h4 id="babel-register-模块"><a href="#babel-register-模块" class="headerlink" title="@babel/register 模块"></a>@babel/register 模块</h4><p>@babel/register模块改写require命令，为它加上一个钩子。此后，每当使用require加载.js、.jsx、.es和.es6后缀名的文件，就会先用 Babel 进行转码。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install --save-dev @babel&#x2F;register</span><br></pre></td></tr></table></figure>
<p>使用时，必须首先加载@babel/register。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; index.js</span><br><span class="line">require(&#39;@babel&#x2F;register&#39;);</span><br><span class="line">require(&#39;.&#x2F;es6.js&#39;);</span><br></pre></td></tr></table></figure>
<p>然后，就不需要手动对index.js转码了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ node index.js</span><br><span class="line">2</span><br></pre></td></tr></table></figure>
<p>需要注意的是，@babel/register只会对require命令加载的文件转码，而不会对当前文件转码。另外，由于它是实时转码，所以只适合在开发环境使用。</p>
<h4 id="babel-API"><a href="#babel-API" class="headerlink" title="babel API"></a>babel API</h4><p>如果某些代码需要调用 Babel 的 API 进行转码，就要使用@babel/core模块。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">var babel &#x3D; require(&#39;@babel&#x2F;core&#39;);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 字符串转码</span><br><span class="line">babel.transform(&#39;code();&#39;, options);</span><br><span class="line">&#x2F;&#x2F; &#x3D;&gt; &#123; code, map, ast &#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 文件转码（异步）</span><br><span class="line">babel.transformFile(&#39;filename.js&#39;, options, function(err, result) &#123;</span><br><span class="line">  result; &#x2F;&#x2F; &#x3D;&gt; &#123; code, map, ast &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 文件转码（同步）</span><br><span class="line">babel.transformFileSync(&#39;filename.js&#39;, options);</span><br><span class="line">&#x2F;&#x2F; &#x3D;&gt; &#123; code, map, ast &#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; Babel AST转码</span><br><span class="line">babel.transformFromAst(ast, code, options);</span><br><span class="line">&#x2F;&#x2F; &#x3D;&gt; &#123; code, map, ast &#125;</span><br></pre></td></tr></table></figure>
<p>配置对象options，可以参看官方文档<a href="http://babeljs.io/docs/usage/options/。" target="_blank" rel="noopener">http://babeljs.io/docs/usage/options/。</a></p>
<h4 id="babel-polyfill"><a href="#babel-polyfill" class="headerlink" title="@babel/polyfill"></a>@babel/polyfill</h4><p>Babel 默认只转换新的 JavaScript 句法（syntax），而不转换新的 API，比如Iterator、Generator、Set、Map、Proxy、Reflect、Symbol、Promise等全局对象，以及一些定义在全局对象上的方法（比如Object.assign）都不会转码。</p>
<p>ES6 在Array对象上新增了Array.from方法。Babel 就不会转码这个方法。如果想让这个方法运行，必须使用babel-polyfill，为当前环境提供一个垫片。</p>
<p>安装命令如下。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install --save-dev @babel&#x2F;polyfill</span><br></pre></td></tr></table></figure>
<p>然后，在脚本头部，加入如下一行代码。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">import &#39;@babel&#x2F;polyfill&#39;;</span><br><span class="line">&#x2F;&#x2F; 或者</span><br><span class="line">require(&#39;@babel&#x2F;polyfill&#39;);</span><br></pre></td></tr></table></figure>
<p>Babel 默认不转码的 API 非常多，详细清单可以查看babel-plugin-transform-runtime模块的definitions.js文件。</p>
<h4 id="浏览器环境"><a href="#浏览器环境" class="headerlink" title="浏览器环境"></a>浏览器环境</h4><p>Babel 也可以用于浏览器环境，使用@babel/standalone模块提供的浏览器版本，将其插入网页。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src&#x3D;&quot;https:&#x2F;&#x2F;unpkg.com&#x2F;@babel&#x2F;standalone&#x2F;babel.min.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class="line">&lt;script type&#x3D;&quot;text&#x2F;babel&quot;&gt;</span><br><span class="line">&#x2F;&#x2F; Your ES6 code</span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>
<p>注意，网页实时将 ES6 代码转为 ES5，对性能会有影响。生产环境需要加载已经转码完成的脚本。</p>
<p>Babel 提供一个REPL 在线编译器，可以在线将 ES6 代码转为 ES5 代码。转换后的代码，可以直接作为 ES5 代码插入网页运行。</p>
<h1 id="Traceur-转码器"><a href="#Traceur-转码器" class="headerlink" title="Traceur 转码器"></a>Traceur 转码器</h1><p>Google 公司的Traceur转码器，也可以将 ES6 代码转为 ES5 代码。</p>
<h4 id="直接插入网页"><a href="#直接插入网页" class="headerlink" title="直接插入网页"></a>直接插入网页</h4><p>Traceur 允许将 ES6 代码直接插入网页。首先，必须在网页头部加载 Traceur 库文件。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src&#x3D;&quot;https:&#x2F;&#x2F;google.github.io&#x2F;traceur-compiler&#x2F;bin&#x2F;traceur.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class="line">&lt;script src&#x3D;&quot;https:&#x2F;&#x2F;google.github.io&#x2F;traceur-compiler&#x2F;bin&#x2F;BrowserSystem.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class="line">&lt;script src&#x3D;&quot;https:&#x2F;&#x2F;google.github.io&#x2F;traceur-compiler&#x2F;src&#x2F;bootstrap.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class="line">&lt;script type&#x3D;&quot;module&quot;&gt;</span><br><span class="line">  import &#39;.&#x2F;Greeter.js&#39;;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>
<p>上面代码中，一共有 4 个script标签。第一个是加载 Traceur 的库文件，第二个和第三个是将这个库文件用于浏览器环境，第四个则是加载用户脚本，这个脚本里面可以使用 ES6 代码。</p>
<p>注意，第四个script标签的type属性的值是module，而不是text/javascript。这是 Traceur 编译器识别 ES6 代码的标志，编译器会自动将所有type=module的代码编译为 ES5，然后再交给浏览器执行。</p>
<p>除了引用外部 ES6 脚本，也可以直接在网页中放置 ES6 代码。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">"module"</span>&gt;</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">Calc</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'Calc constructor'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    add(a, b) &#123;</span><br><span class="line">      <span class="keyword">return</span> a + b;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> c = <span class="keyword">new</span> Calc();</span><br><span class="line">  <span class="built_in">console</span>.log(c.add(<span class="number">4</span>,<span class="number">5</span>));</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>
<p>正常情况下，上面代码会在控制台打印出9。</p>
<p>如果想对 Traceur 的行为有精确控制，可以采用下面参数配置的写法。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="comment">// Create the System object</span></span><br><span class="line">  <span class="built_in">window</span>.System = <span class="keyword">new</span> traceur.runtime.BrowserTraceurLoader();</span><br><span class="line">  <span class="comment">// Set some experimental options</span></span><br><span class="line">  <span class="keyword">var</span> metadata = &#123;</span><br><span class="line">    traceurOptions: &#123;</span><br><span class="line">      experimental: <span class="literal">true</span>,</span><br><span class="line">      properTailCalls: <span class="literal">true</span>,</span><br><span class="line">      symbols: <span class="literal">true</span>,</span><br><span class="line">      arrayComprehension: <span class="literal">true</span>,</span><br><span class="line">      asyncFunctions: <span class="literal">true</span>,</span><br><span class="line">      asyncGenerators: exponentiation,</span><br><span class="line">      forOn: <span class="literal">true</span>,</span><br><span class="line">      generatorComprehension: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">// Load your module</span></span><br><span class="line">  System.import(<span class="string">'./myModule.js'</span>, &#123;<span class="attr">metadata</span>: metadata&#125;).catch(<span class="function"><span class="keyword">function</span>(<span class="params">ex</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.error(<span class="string">'Import failed'</span>, ex.stack || ex);</span><br><span class="line">  &#125;);</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>
<p>上面代码中，首先生成 Traceur 的全局对象window.System，然后System.import方法可以用来加载 ES6。加载的时候，需要传入一个配置对象metadata，该对象的traceurOptions属性可以配置支持 ES6 功能。如果设为experimental: true，就表示除了 ES6 以外，还支持一些实验性的新功能。</p>
<h4 id="在线转换"><a href="#在线转换" class="headerlink" title="在线转换"></a>在线转换</h4><p>Traceur 也提供一个在线编译器，可以在线将 ES6 代码转为 ES5 代码。转换后的代码，可以直接作为 ES5 代码插入网页运行。</p>
<p>上面的例子转为 ES5 代码运行，就是下面这个样子。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=<span class="string">"https://google.github.io/traceur-compiler/bin/traceur.js"</span>&gt;&lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp">&lt;script src="https:/</span><span class="regexp">/google.github.io/</span>traceur-compiler/bin/BrowserSystem.js<span class="string">"&gt;&lt;/script&gt;</span></span><br><span class="line"><span class="string">&lt;script src="</span>https:<span class="comment">//google.github.io/traceur-compiler/src/bootstrap.js"&gt;&lt;/script&gt;</span></span><br><span class="line">&lt;script&gt;</span><br><span class="line">$traceurRuntime.ModuleStore.getAnonymousModule(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="meta">  "use strict"</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> Calc = <span class="function"><span class="keyword">function</span> <span class="title">Calc</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Calc constructor'</span>);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  ($traceurRuntime.createClass)(Calc, &#123;<span class="attr">add</span>: <span class="function"><span class="keyword">function</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">  &#125;&#125;, &#123;&#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> c = <span class="keyword">new</span> Calc();</span><br><span class="line">  <span class="built_in">console</span>.log(c.add(<span class="number">4</span>, <span class="number">5</span>));</span><br><span class="line">  <span class="keyword">return</span> &#123;&#125;;</span><br><span class="line">&#125;);</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="命令行转换"><a href="#命令行转换" class="headerlink" title="命令行转换"></a>命令行转换</h4><p>作为命令行工具使用时，Traceur 是一个 Node 的模块，首先需要用 npm 安装。</p>
<p>$ npm install -g traceur</p>
<p>安装成功后，就可以在命令行下使用 Traceur 了。</p>
<p>Traceur 直接运行 ES6 脚本文件，会在标准输出显示运行结果，以前面的calc.js为例。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ traceur calc.js</span><br><span class="line">Calc constructor</span><br><span class="line">9</span><br></pre></td></tr></table></figure>
<p>如果要将 ES6 脚本转为 ES5 保存，要采用下面的写法。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ traceur --script calc.es6.js --out calc.es5.js</span><br></pre></td></tr></table></figure>
<p>上面代码的–script选项表示指定输入文件，–out选项表示指定输出文件。</p>
<p>为了防止有些特性编译不成功，最好加上–experimental选项。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ traceur --script calc.es6.js --out calc.es5.js --experimental</span><br></pre></td></tr></table></figure>
<p>命令行下转换生成的文件，就可以直接放到浏览器中运行。</p>
<h4 id="Node-环境的用法"><a href="#Node-环境的用法" class="headerlink" title="Node 环境的用法"></a>Node 环境的用法</h4><p>Traceur 的 Node 用法如下（假定已安装traceur模块）。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> traceur = <span class="built_in">require</span>(<span class="string">'traceur'</span>);</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将 ES6 脚本转为字符串</span></span><br><span class="line"><span class="keyword">var</span> contents = fs.readFileSync(<span class="string">'es6-file.js'</span>).toString();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> result = traceur.compile(contents, &#123;</span><br><span class="line">  filename: <span class="string">'es6-file.js'</span>,</span><br><span class="line">  sourceMap: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// 其他设置</span></span><br><span class="line">  modules: <span class="string">'commonjs'</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (result.error)</span><br><span class="line">  <span class="keyword">throw</span> result.error;</span><br><span class="line"></span><br><span class="line"><span class="comment">// result 对象的 js 属性就是转换后的 ES5 代码</span></span><br><span class="line">fs.writeFileSync(<span class="string">'out.js'</span>, result.js);</span><br><span class="line"><span class="comment">// sourceMap 属性对应 map 文件</span></span><br><span class="line">fs.writeFileSync(<span class="string">'out.js.map'</span>, result.sourceMap);</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
     <!-- 相关文章推荐 -->
    
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://huyunshun.com/2019/04/13/Jenkins%E4%BD%BF%E7%94%A8jenkinsfile%E8%84%9A%E6%9C%AC%E6%9E%84%E5%BB%BA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="初晨">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://img.huyunshun.com/img/20200522182348.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="简">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/04/13/Jenkins%E4%BD%BF%E7%94%A8jenkinsfile%E8%84%9A%E6%9C%AC%E6%9E%84%E5%BB%BA/" itemprop="url">Jenkins使用jenkinsfile脚本构建</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-04-13T00:00:00+08:00">
                2019-04-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Jenkins/" itemprop="url" rel="index">
                    <span itemprop="name">Jenkins</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="jenkinsfile脚本使用"><a href="#jenkinsfile脚本使用" class="headerlink" title="jenkinsfile脚本使用"></a>jenkinsfile脚本使用</h2><p>Jenkins 2.0的精髓是Pipeline as Code，是帮助Jenkins实现CI到CD转变的重要角色。</p>
<p>Pipeline就是一套运行于Jenkins上的工作流框架，将原本独立运行于单个或者多个节点的任务连接起来，实现单个任务难以完成的复杂发布流程。</p>
<p>持续交付管道（CD Pipeline）是将软件从版本控制阶段到交付给用户或客户的完整过程的自动化表现。软件的每一次更改（提交到源代码管理系统）都要经过一个复杂的过程才能被发布。</p>
<p>Pipeline提供了一组可扩展的工具，通过Pipeline Domain Specific Language（DSL）syntax可以达到Pipeline as Code（Jenkinsfile存储在项目的源代码库）的目的。</p>
<p><strong>Pipeline的几个基本概念：</strong></p>
<ul>
<li><p>Stage：阶段，一个Pipeline可以划分成若干个Stage，每个Stage代表一组操作，例如：”Build”，”Test”，”Deploy”。</p>
<pre><code>Stage是一个逻辑分组的概念，可以跨多个Node</code></pre></li>
<li><p>Node：节点，一个Node就是一个Jenkins节点，或者是Master，或者是Agent，是执行Step的具体运行环境。</p>
</li>
<li><p>Step：步骤，Step是最基本的操作单元，小到创建一个目录，大到构建一个Docker镜像，由各类Jenklins Plugin提供，例如：sh ‘make’</p>
</li>
</ul>
<p>要使用Jenkins Pipeline，需要：Jenkins 2.x或更高版本和Pipeline插件</p>
<p><strong>Pipeline定义</strong></p>
<p>Pipeline脚本是用Groovy写的，可以通过以下任一方式创建基本Pipeline：</p>
<ul>
<li>pipeline script：直接在Web UI的script输入框里面输入pipeline script语句即可，参考说明可以点击输入框下边的Pipeline Syntax，里面有很多示例操作说明，非常好用。</li>
<li>pipeline script from SCM：需要配置SCM代码存储Git地址或SVN地址，指定script文件Jenkinsfile所在路径，每次构建job会自动去指定的目录执行script文件</li>
</ul>
<p>以上两种方法定义Pipeline的语法都是一样的。</p>
<p>Pipeline配有内置的文档功能192.168.1.112：8000/pipeline-syntax/</p>
<p>流水线方式搭建，安装好Pipeline Maven Integration Plugin插件：</p>
<pre><code>pipeline-model-definition
build-pipeline-plugin
buildgraph-view
workflow-aggregator</code></pre><p>也可以直接安装blueocean</p>
<h3 id="1、在Web-UI中定义Pipeline"><a href="#1、在Web-UI中定义Pipeline" class="headerlink" title="1、在Web UI中定义Pipeline"></a>1、在Web UI中定义Pipeline</h3><p>要在Jenkins Web UI中创建基本Pipeline Job，单击Jenkins主页上的New Item。输入Pipeline的名称，选择Pipeline，然后单击确定。<br>在流水线里写入代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">node &#123;</span><br><span class="line">   stage(&#39;build&#39;)&#123;</span><br><span class="line">    echo &#39;build&#39;;</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   stage(&#39;test&#39;)&#123;</span><br><span class="line">    echo &#39;test&#39;;</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   stage(&#39;deploy&#39;)&#123;</span><br><span class="line">    echo &#39;deploy&#39;;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://img.huyunshun.com/img/20200413163302.png" alt="20200413163302"></p>
<p>保存，立即构建</p>
<p><img src="https://img.huyunshun.com/img/20200413163326.png" alt="20200413163326"></p>
<p>构建成功</p>
<p><img src="https://img.huyunshun.com/img/20200413163345.png" alt="20200413163345"></p>
<h3 id="2、在SCM中定义pipeline，也就是结合版本管理工具进行构建"><a href="#2、在SCM中定义pipeline，也就是结合版本管理工具进行构建" class="headerlink" title="2、在SCM中定义pipeline，也就是结合版本管理工具进行构建"></a>2、在SCM中定义pipeline，也就是结合版本管理工具进行构建</h3><p>复杂的Pipeline难以在Pipeline配置页面的文本区域内进行写入和维护。为了解决这一问题，jenkins Pipeline支持在文本编辑器中编写脚本文件jenkinsFile，Jenkins可以通过从SCM选项的控件中加载Pipeline脚本。指定要检索的Pipeline脚本的路径。更新指定的存储库时，只要Pipeline配置了SCM轮询触发器，就会触发一个新构建。</p>
<p>首先创建一个jenkinsfile文件上传到git，作为测试使用。创建构建，和上面一致，这里选择SCM方式。</p>
<p><img src="https://img.huyunshun.com/img/20200413163427.png" alt="20200413163427"></p>
<p><img src="https://img.huyunshun.com/img/20200413163441.png" alt="20200413163441"></p>
<p>保存后，立即构建成功</p>
<p><img src="https://img.huyunshun.com/img/20200413163458.png" alt="20200413163458"></p>
<h2 id="jenkinsfile脚本语法"><a href="#jenkinsfile脚本语法" class="headerlink" title="jenkinsfile脚本语法"></a>jenkinsfile脚本语法</h2><p>支持两种语法</p>
<p>Declarative 声明式（在Pipeline plugin 2.5中引入）和 Scripted Pipeline 脚本式</p>
<p>如何创建最基本的PIpeline：直接在Jenkins Web UI 网页界面中输入脚本</p>
<p>通过创建一个jenkinsfile可以检入项目的源代码管理库</p>
<p><img src="https://img.huyunshun.com/img/20200413163640.png" alt="20200413163640"></p>
<h3 id="声明式Pipeline"><a href="#声明式Pipeline" class="headerlink" title="声明式Pipeline"></a>声明式Pipeline</h3><p>声明式Pipeline的基本语法和表达式遵循与Groovy语法相同的规则，但有以下例外：</p>
<p>声明式pipeline必须包含在固定格式pipeline{}快内</p>
<p>每个声明语句必须独立一行，行尾无需使用分号</p>
<p>块（blocks{}）只能包含章节（Sections），指令（Directives），步骤（Steps）或赋值语句</p>
<p>属性引用语句被视为无参数方法调用。例：输入被视为 input()</p>
<ul>
<li>块（blocks{}）</li>
</ul>
<p>由大括号括起来的语句，如pipeline{},Section{},parameters{},script{}</p>
<ul>
<li>章节（Sections）</li>
</ul>
<p>通常包含一个或多个指令或步骤。如 agent 、post、stages、steps</p>
<ul>
<li>指令（Directives）</li>
</ul>
<p>environment、options、parameters、triggers（触发）、stage、tools、when</p>
<ul>
<li>步骤（Steps）</li>
</ul>
<p>Pipeline steps reference    执行脚本式pipeline：使用script{}</p>
<p>agent<br>必须存在，agent必须在pipeline块内的顶层定义，但stage内是否使用使可选的</p>
<p>参数：any/none/label/node/docker/dockerfile</p>
<p>常用选项 label/cuetomWorkspace/reuseNode</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">agent &#123; label &#39;my-label&#39; &#125;</span><br><span class="line"></span><br><span class="line">agent &#123;</span><br><span class="line">   node &#123;</span><br><span class="line">       label &#39;my-label&#39;</span><br><span class="line">       customWorkspace &#39;&#x2F;some&#x2F;other&#x2F;path&#39;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">agent &#123;</span><br><span class="line">   docker &#123;</span><br><span class="line">       image &#39;nginx:1.12.2&#39;</span><br><span class="line">       label &#39;my-label&#39;</span><br><span class="line">       args &#39;-v &#x2F;tmp:&#x2F;tmp&#39;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line">post 不是必须的，用于pipeline的最外层或者stage&#123;&#125;中</span><br><span class="line"></span><br><span class="line">pipeline &#123;</span><br><span class="line">   agent any</span><br><span class="line">   stages &#123;</span><br><span class="line">       stage(&#39;Example&#39;)&#123;</span><br><span class="line">           steps &#123;</span><br><span class="line">           echo &#39;Hello world&#39;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   post &#123;</span><br><span class="line">       always &#123;</span><br><span class="line">           echo &#39;say goodbay&#39;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>stages 必须，包括顺序执行的一个或多个stage命令，在pipeline内仅能使用一次，通常位于agent/options后面，例子如上</p>
<p>steps 必须，steps位于stage指令块内部，包括一个或多个step。仅有一个step的情况下可以忽略关键字step及其{},例子如上</p>
<p>environment 不是必须的，environment定义了一组全局的环境变量键值对，存在于pipeline{}或者stage指令内。执行特殊方法credentials()可以获取jenkins中预定义的凭证明文内容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">environment &#123;CC&#x3D;&#39;clang&#39;&#125;</span><br><span class="line">environment &#123;AN_ACCESS_KEY &#x3D; credentials(&#39;my-prefined-secret-text&#39;)&#125;</span><br><span class="line">steps &#123;sh &#39;printenv&#39;&#125;</span><br><span class="line"></span><br><span class="line">options 不是必须的 预定义pipeline专有的配置信息，仅可定义一次</span><br><span class="line"></span><br><span class="line">pipeline &#123;</span><br><span class="line">   agent any</span><br><span class="line">   options&#123;</span><br><span class="line">   timeout(time:1,unit: &#39;HOURS&#39;)</span><br><span class="line">   &#125;</span><br><span class="line">   ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>parameters 不是必须的 定义参数化构建的参数可选参数 booleanParam,choice,file,text,password,run,string</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">paramenters &#123;</span><br><span class="line">   choice(name:&#39;PerformMavenRelease&#39;,choices:&#39;False\nTrue&#39;,description:&#39;desc&#39;)</span><br><span class="line">   password(name:&#39;CredsToUse&#39;,description:&#39;Apassword to build with&#39;,defaultValue:&#39;&#39;)</span><br><span class="line">&#125;</span><br><span class="line">environment &#123;</span><br><span class="line">   BUILD_USR_CHOICE&#x3D;&quot;$&#123;params.PerformMavenRelease&#125;&quot;</span><br><span class="line">   BUILD_USR_CREDS&#x3D;&quot;$&#123;params.CredsToUse&#125;&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>triggers 不是必须的 定义pipeline被自动触发的方式选项 cron、pollSCM、upstream</p>
<pre><code>triggers {cron(&apos;H 4/* 0 0 1-5&apos;)}
triggers {pollSCM(&apos;H 4/* 0 0 1-5&apos;)}
triggers {upstream(upstreamProjects:&apos;job1,job2&apos;,threshold:hudson.model.Result.SUCCESS)}</code></pre><p><strong>常用的辅助工具</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">Snipper Generator（代码片段生成器，语法检查器）</span><br><span class="line">Replay Pipeline（重放pipeline，可以修改script，修改后的不存入config.xml）</span><br><span class="line">DSL Reference 语法参考手册</span><br><span class="line">全局变量引用</span><br><span class="line">Stage View</span><br><span class="line">BlueOcean(可视化)</span><br><span class="line">Pipeline神器：可视化编辑器</span><br><span class="line">命令行Pipeline调试工具</span><br><span class="line">变量的传递</span><br><span class="line"></span><br><span class="line">自定义变量（局部）</span><br><span class="line">def username &#x3D; &#39;Jenkins&#39;</span><br><span class="line">echo &quot;Hello Mr.$&#123;username&#125;&quot;</span><br><span class="line">#注意一定要用双引号，单引号识别为字符串</span><br><span class="line">环境变量（局部）</span><br><span class="line">withEnv([&#39;MYTOOL_HOME&#x3D;&#x2F;usr&#x2F;local&#x2F;mytool&#39;])&#123;</span><br><span class="line">   sh &#39;$MYTOOL_HOME&#x2F;bin&#x2F;start&#39;</span><br><span class="line">&#125;</span><br><span class="line">环境变量（全局）</span><br><span class="line">environment &#123;CC&#x3D;&#39;clang&#39;&#125;</span><br><span class="line">echo &quot;Compiler is $&#123;env.CC&#125;&quot;</span><br><span class="line">参数化构建（全局）</span><br><span class="line">parameters &#123;string(name:&#39;Jenkins&#39;,defaultValue:&#39;Hello&#39;,description:&#39;How should I greet the world&#39;)&#125;</span><br><span class="line">ehco &quot;$&#123;params.Greeting&#125; World!&quot;</span><br><span class="line">判断</span><br><span class="line">when仅用于stage内部</span><br><span class="line">when的内置条件为：</span><br><span class="line">- when &#123;branch &#39;master&#39;&#125;</span><br><span class="line">- when &#123;environment name:&#39;DEPLOY_TO&#39;,value:&#39;production&#39;&#125;</span><br><span class="line">#当有环境变量 name 为 DEPLOY_TO 值是 production 条件成立</span><br><span class="line">- when &#123;expression &#123;return params.DEBUG_BUILD&#125; &#125;</span><br><span class="line">#表达式返回值为真时</span><br><span class="line">- when &#123;not &#123;branch &#39;master&#39;&#125; &#125;</span><br><span class="line">- when &#123;allOf &#123;branch &#39;master&#39;; environment name:&#39;DEBUG_TO&#39;,value:&#39;production&#39;&#125; &#125;</span><br><span class="line">#allOf 所有条件都满足时</span><br><span class="line">- when &#123;anyOf &#123;branch &#39;master&#39; ; branch &#39;staging&#39;&#125; &#125;</span><br><span class="line">#anyOf有一个条件满足时即可</span><br></pre></td></tr></table></figure>
<p>判断和异常处理    流程控制if/else条件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">node &#123;</span><br><span class="line">   stage(&#39;Example&#39;)&#123;</span><br><span class="line">       if(env.BRANCH_NAME &#x3D;&#x3D; &#39;master&#39;)&#123;</span><br><span class="line">           echo &#39;I only execute on the master branch&#39;</span><br><span class="line">       &#125;else &#123;</span><br><span class="line">           echo &#39;Iexecute elsewhere&#39;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>异常处理try/catch/finally</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">node&#123;</span><br><span class="line">   stage(&#39;Example&#39;)&#123;</span><br><span class="line">       try&#123;</span><br><span class="line">           sh &#39;exit 1&#39;</span><br><span class="line">       &#125;</span><br><span class="line">       catch (exc) &#123;</span><br><span class="line">           echo &#39;something failed,I should sound the klaxons!&#39;</span><br><span class="line">           throw</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>循环</p>
<p>for循环仅存在域脚本式pipeline中，但是可以通过在声明式pipeline中调用script step来执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">   agent any</span><br><span class="line">   stages &#123;</span><br><span class="line">       stage(&#39;Example&#39;)&#123;</span><br><span class="line">           steps&#123;</span><br><span class="line">               echo &#39;Hello world!&#39;</span><br><span class="line">               script &#123;</span><br><span class="line">                   def browsers &#x3D; [&#39;chrome&#39;,&#39;firefox&#39;]</span><br><span class="line">                   for (int i &#x3D; 0;i &lt; browers.size();++i)&#123;</span><br><span class="line">                       echo &quot;Testing the $&#123;browsers[i]&#125; browser&quot;</span><br><span class="line">                   &#125;</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>并发需要放在stages中，stages可以嵌套使用 stage下的steps和parallel不能共存，只能二选一<br>使用了并发的stage不能再有agent/tools 强制所有并发任务退出，加参数 failFast true</p>
<h3 id="脚本式-Pipeline"><a href="#脚本式-Pipeline" class="headerlink" title="脚本式 Pipeline"></a>脚本式 Pipeline</h3><p>在脚本式 Pipeline 语法中，一个或多个 node 块执行贯穿整个 Pipeline 的核心工作。虽然这不是脚本式 Pipeline 语法的强制性要求，但将管道 work 限制在 node 块内部会做两件事情：</p>
<pre><code>通过将 item 添加到 Jenkins 队列来运行块中包含的 step。只要执行程序在 node 上空闲，这些步骤就会运行。
创建一个工作空间（特定于该特定 Pipeline 的目录），其中可以对从源代码管理检出的文件执行工作。
注意：根据不同的 Jenkins 配置，部分 workspaces 不会在一段不活动时间之后自动清理。查看与 JENKINS-2111 相关的标记和讨论以获取更多信息。</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Jenkinsfile (Scripted Pipeline)</span><br><span class="line">node &#123;  &#x2F;&#x2F;在任何可用的代理上执行这个 Pipeline 或其任意 stage</span><br><span class="line">   stage(&#39;Build&#39;) &#123; &#x2F;&#x2F;定义 &quot;Build&quot; stage</span><br><span class="line">       &#x2F;&#x2F; 执行和 &quot;Build&quot; stage 相关的 step</span><br><span class="line">   &#125;</span><br><span class="line">   stage(&#39;Test&#39;) &#123;</span><br><span class="line">       &#x2F;&#x2F;</span><br><span class="line">   &#125;</span><br><span class="line">   stage(&#39;Deploy&#39;) &#123;</span><br><span class="line">       &#x2F;&#x2F;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
     <!-- 相关文章推荐 -->
    
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://huyunshun.com/2019/04/12/%E5%9F%BA%E4%BA%8ESpringBoot%E3%80%81Quartz%E5%88%86%E5%B8%83%E5%BC%8F%E5%8D%95%E8%8A%82%E7%82%B9%E6%8C%81%E4%B9%85%E5%8C%96/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="初晨">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://img.huyunshun.com/img/20200522182348.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="简">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/04/12/%E5%9F%BA%E4%BA%8ESpringBoot%E3%80%81Quartz%E5%88%86%E5%B8%83%E5%BC%8F%E5%8D%95%E8%8A%82%E7%82%B9%E6%8C%81%E4%B9%85%E5%8C%96/" itemprop="url">基于SpringBoot、Quartz分布式单节点持久化</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-04-12T14:23:48+08:00">
                2019-04-12
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Quartz/" itemprop="url" rel="index">
                    <span itemprop="name">Quartz</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>demo见<a href="https://github.com/huingsn/tech-point-record" target="_blank" rel="noopener">https://github.com/huingsn/tech-point-record</a></p>

          
        
      
    </div>
     <!-- 相关文章推荐 -->
    
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://huyunshun.com/2019/04/12/%E5%9F%BA%E4%BA%8ESpringBoot%E3%80%81Quartz%E5%88%86%E5%B8%83%E5%BC%8F%E5%A4%9A%E8%8A%82%E7%82%B9%E8%B4%9F%E8%BD%BD%E6%8C%81%E4%B9%85%E5%8C%96/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="初晨">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://img.huyunshun.com/img/20200522182348.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="简">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/04/12/%E5%9F%BA%E4%BA%8ESpringBoot%E3%80%81Quartz%E5%88%86%E5%B8%83%E5%BC%8F%E5%A4%9A%E8%8A%82%E7%82%B9%E8%B4%9F%E8%BD%BD%E6%8C%81%E4%B9%85%E5%8C%96/" itemprop="url">基于SpringBoot、Quartz分布式多节点负载持久化</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-04-12T14:23:48+08:00">
                2019-04-12
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Quartz/" itemprop="url" rel="index">
                    <span itemprop="name">Quartz</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>demo见<a href="https://github.com/huingsn/tech-point-record" target="_blank" rel="noopener">https://github.com/huingsn/tech-point-record</a></p>

          
        
      
    </div>
     <!-- 相关文章推荐 -->
    
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://huyunshun.com/2019/04/12/Java%E5%AE%9E%E7%8E%B0%E4%BB%BB%E5%8A%A1%E8%B0%83%E5%BA%A6%E5%AE%9A%E6%97%B6%E6%96%B9%E5%BC%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="初晨">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://img.huyunshun.com/img/20200522182348.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="简">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/04/12/Java%E5%AE%9E%E7%8E%B0%E4%BB%BB%E5%8A%A1%E8%B0%83%E5%BA%A6%E5%AE%9A%E6%97%B6%E6%96%B9%E5%BC%8F/" itemprop="url">Java实现任务调度定时方式总结</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-04-12T14:23:48+08:00">
                2019-04-12
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java/" itemprop="url" rel="index">
                    <span itemprop="name">java</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="一、java最基本方式使用"><a href="#一、java最基本方式使用" class="headerlink" title="一、java最基本方式使用"></a>一、java最基本方式使用</h2><p>使用java.util.Timer类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TimedTask</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">useTimerImplTimedTask</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">// 第一个参数是任务，第二个参数为首次执行的延时时间，第三个参数为定时执行的间隔时间，时间单位是毫秒</span></span><br><span class="line">        <span class="keyword">new</span> Timer().scheduleAtFixedRate(<span class="keyword">new</span> TimerTask() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123; </span><br><span class="line">                System.out.println(<span class="string">"Local Time is "</span> + <span class="keyword">new</span> Date().toString());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="number">0L</span>,<span class="number">1000L</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        useTimerImplTimedTask();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用java.util.concurrent.ScheduledExecutorService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TimedTask</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">userScheduledExecutorServiceImplTiemdTask</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Runnable runnable = <span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                System.out.println(<span class="string">"Local Time is "</span> + <span class="keyword">new</span> Date().toString());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        ScheduledExecutorService service = Executors.newSingleThreadScheduledExecutor();</span><br><span class="line">        <span class="comment">// 第一个参数是任务，第二个参数为首次执行的延时时间，第三个参数为定时执行的间隔时间,第四个参数是时间单位</span></span><br><span class="line">        service.scheduleAtFixedRate(runnable, <span class="number">0L</span>, <span class="number">1L</span>, TimeUnit.SECONDS);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        userScheduledExecutorServiceImplTiemdTask();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样不好，建议创建使用线程池</p>
<p>推荐使用java.util.concurrent.ScheduledThreadPoolExecutor结合org.apache.commons.lang3.concurrent.BasicThreadFactory</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TimedTask</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">useScheduledThreadPoolExecutorImplTimedTask</span><span class="params">()</span></span>&#123;</span><br><span class="line">        ScheduledThreadPoolExecutor scheduledThreadPoolExecutor = <span class="keyword">new</span> ScheduledThreadPoolExecutor(</span><br><span class="line">                <span class="number">1</span>, <span class="keyword">new</span> BasicThreadFactory.Builder().namingPattern(<span class="string">"schedule-pool-%d"</span>).daemon(<span class="keyword">false</span>).build());</span><br><span class="line">        <span class="comment">// 第一个参数是任务，第二个参数为首次执行的延时时间，第三个参数为定时执行的间隔时间,第四个参数是时间单位</span></span><br><span class="line">        scheduledThreadPoolExecutor.scheduleAtFixedRate(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                System.out.println(<span class="string">"Local Time is "</span> + <span class="keyword">new</span> Date().toString());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="number">0L</span>, <span class="number">1L</span>, TimeUnit.SECONDS);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        useScheduledThreadPoolExecutorImplTimedTask();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用java.lang.Thread方式</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TimedTask</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">useThreadImplTimedTask</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Runnable runnable = <span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">                    System.out.println(<span class="string">"Local Time is "</span> + <span class="keyword">new</span> Date().toString());</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        <span class="comment">//时间间隔，单位是毫秒</span></span><br><span class="line">                        Thread.sleep(<span class="number">1000L</span>);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        Thread thread = <span class="keyword">new</span> Thread(runnable);</span><br><span class="line">        thread.start();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        useThreadImplTimedTask();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这种方式不优雅</p>
<h2 id="二、Quartz框架实现"><a href="#二、Quartz框架实现" class="headerlink" title="二、Quartz框架实现"></a>二、Quartz框架实现</h2><p>Quartz是一个强大任务调度框架，一个简单示例：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.quartz-scheduler<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>quartz<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>任务逻辑</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 实现任务，任务执行逻辑</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloJob</span> <span class="keyword">implements</span> <span class="title">Job</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">(JobExecutionContext jobExecutionContext)</span> <span class="keyword">throws</span> JobExecutionException </span>&#123;</span><br><span class="line">        Date date = <span class="keyword">new</span> Date();</span><br><span class="line">        SimpleDateFormat sf = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd HH:mm:ss"</span>);</span><br><span class="line">        System.out.println(<span class="string">"现在的时间是："</span>+ sf.format(date));</span><br><span class="line">        <span class="comment">//每两秒钟打印</span></span><br><span class="line">        System.out.println(<span class="string">"Hello"</span>);</span><br><span class="line">        <span class="comment">//每天晚上12点执行任务</span></span><br><span class="line">        <span class="comment">//System.out.println("开始生成任务报表");</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>任务调度</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">* 任务调用，或者说任务触发地方</span></span><br><span class="line"><span class="comment">* 一个基本Quartz的任务再来介绍一下Quartz的3个重要组成，JobDetail，Trigger，Scheduler</span></span><br><span class="line"><span class="comment">* Scheduler - 用于与调度程序交互的主程序接口。</span></span><br><span class="line"><span class="comment">* Job - 我们预先定义的希望在未来时间能被调度程序执行的任务类。</span></span><br><span class="line"><span class="comment">* JobDetail - 使用JobDetail来定义定时任务的实例。</span></span><br><span class="line"><span class="comment">* Trigger - 触发器，表明任务在什么时候会执行，执行的时间条件。</span></span><br><span class="line"><span class="comment">* JobBuilder -用于声明一个任务实例，也可以定义关于该任务的详情比如任务名、组名等，这个声明的实例将会作为一个实际执行的任务。</span></span><br><span class="line"><span class="comment">* TriggerBuilder - 触发器创建器，用于创建触发器trigger实例。</span></span><br><span class="line"><span class="comment">* 一个调度器过程</span></span><br><span class="line"><span class="comment">* 1、创建调度工厂();  　　</span></span><br><span class="line"><span class="comment">* 2、根据工厂取得调度器实例();  　　</span></span><br><span class="line"><span class="comment">* 3、Builder模式构建子组件&lt;Job,Trigger&gt; 　　 // builder模式, 如JobBuilder、TriggerBuilder、DateBuilder</span></span><br><span class="line"><span class="comment">* 4、通过调度器组装子组件  调度器.组装&lt;子组件1,子组件2...&gt;  　　</span></span><br><span class="line"><span class="comment">* 5、调度器.start();</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloScheduler</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> SchedulerException </span>&#123;</span><br><span class="line">        <span class="comment">//创建一个任务的实例，将该实例与HelloJob Class绑定</span></span><br><span class="line">        JobDetail jobDetail = JobBuilder.newJob(HelloJob.class).withIdentity("demoJob").build();</span><br><span class="line">        <span class="comment">//创建一个Trigger触发器的实例，定义该job立即执行，并且每4秒执行一次，一直执行</span></span><br><span class="line">        SimpleTrigger trigger = TriggerBuilder.newTrigger().withIdentity(<span class="string">"demoTrigger"</span>).startNow().withSchedule(SimpleScheduleBuilder.simpleSchedule().withIntervalInSeconds(<span class="number">4</span>).repeatForever()).build();</span><br><span class="line">        <span class="comment">//每天晚上12点触发任务</span></span><br><span class="line">        <span class="comment">//CronTrigger cronTrigger = TriggerBuilder.newTrigger().withIdentity("cronTrigger").withSchedule(CronScheduleBuilder.cronSchedule("0 0 12 * * ?")).build();</span></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">        * cron表达式编写规则</span></span><br><span class="line"><span class="comment">        * Quartz Cron 表达式支持7个域 ,分别是秒/分/时/日/月/周/年，其中年是非必须项</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        <span class="comment">//创建schedule实例</span></span><br><span class="line">        StdSchedulerFactory factory = <span class="keyword">new</span> StdSchedulerFactory();</span><br><span class="line">        Scheduler scheduler = factory.getScheduler();</span><br><span class="line">        <span class="comment">//执行任务</span></span><br><span class="line">        scheduler.start();</span><br><span class="line">        scheduler.scheduleJob(jobDetail,trigger);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="cron表达式编写规则"><a href="#cron表达式编写规则" class="headerlink" title="cron表达式编写规则"></a>cron表达式编写规则</h3><p>Quartz Cron 表达式支持7个域 ,分别是秒/分/时/日/月/周/年，其中年是非必须项</p>
<pre><code>名称    是否必须    允许值    特殊字符
秒    是    0-59    , - * /
分    是    0-59    , - * /
时    是    0-23    , - * /
日    是    1-31    , - * ? / L W C
月    是    1-12 或 JAN-DEC    , - * /
周    是    1-7 或 SUN-SAT    , - * ? / L C #
年    否    空 或 1970-2099    , - * /
cron表达式中不区分大小写.

星号(*)：可用在所有字段中，表示对应时间域的每一个时刻，例如， 在分钟字段时，表示“每分钟”；
问号（?）：该字符只在日期和星期字段中使用，它通常指定为“无意义的值”，相当于点位符；
减号(-)：表达一个范围，如在小时字段中使用“10-12”，则表示从10到12点，即10,11,12；
逗号(,)：表达一个列表值，如在星期字段中使用“MON,WED,FRI”，则表示星期一，星期三和星期五；
斜杠(/)：x/y表达一个等步长序列，x为起始值，y为增量步长值。如在分钟字段中使用0/15，则表示为0,15,30和45秒，而5/15在分钟字段中表示5,20,35,50，你也可以使用*/y，它等同于0/y；
L：该字符只在日期和星期字段中使用，代表“Last”的意思，但它在两个字段中意思不同。L在日期字段中，表示这个月份的最后一天，如一月的31号，非闰年二月的28号；如果L用在星期中，则表示星期六，等同于7。但是，如果L出现在星期字段里，而且在前面有一个数值X，则表示“这个月的最后X天”，例如，6L表示该月的最后星期五；
W：该字符只能出现在日期字段里，是对前导日期的修饰，表示离该日期最近的工作日。例如15W表示离该月15号最近的工作日，如果该月15号是星期六，则匹配14号星期五；如果15日是星期日，则匹配16号星期一；如果15号是星期二，那结果就是15号星期二。但必须注意关联的匹配日期不能够跨月，如你指定1W，如果1号是星期六，结果匹配的是3号星期一，而非上个月最后的那天。W字符串只能指定单一日期，而不能指定日期范围；
LW组合：在日期字段可以组合使用LW，它的意思是当月的最后一个工作日；
井号(#)：该字符只能在星期字段中使用，表示当月某个工作日。如6#3表示当月的第三个星期五(6表示星期五，#3表示当前的第三个)，而4#5表示当月的第五个星期三，假设当月没有第五个星期三，忽略不触发；
C：该字符只在日期和星期字段中使用，代表“Calendar”的意思。它的意思是计划所关联的日期，如果日期没有被关联，则相当于日历中所有日期。例如5C在日期字段中就相当于日历5日以后的第一天。1C在星期字段中相当于星期日后的第一天。
Cron表达式对特殊字符的大小写不敏感，对代表星期的缩写英文大小写也不敏感。
官方示例：
表示式    说明
0 0 12 * * ?    每天12点运行
0 15 10 * * ?    每天10:15运行
0 15 10 * * ? 2008    在2008年的每天10：15运行
0 * 14 * * ?    每天14点到15点之间每分钟运行一次，开始于14:00，结束于14:59。
0 0/5 14 * * ?    每天14点到15点每5分钟运行一次，开始于14:00，结束于14:55。
0 0/5 14,18 * * ?    每天14点到15点每5分钟运行一次，此外每天18点到19点每5钟也运行一次。                         
0 0-5 14 * * ?    每天14:00点到14:05，每分钟运行一次。
0 10,44 14 ? 3 WED    3月每周三的14:10分到14:44，每分钟运行一次。
0 15 10 ? * MON-FRI    每周一，二，三，四，五的10:15分运行。
0 15 10 15 * ?    每月15日10:15分运行。
0 15 10 L * ?    每月最后一天10:15分运行。
0 15 10 ? * 6L    每月最后一个星期五10:15分运行。
0 15 10 ? * 6L 2007-2009                             在2007,2008,2009年每个月的最后一个星期五的10:15分运行。
0 15 10 ? * 6#3    每月第三个星期五的10:15分运行。</code></pre><p>Quartz对任务调度的领域问题进行了高度的抽象，提出了调度器、任务和触发器这3个核心的概念，主要类和接口解释：</p>
<pre><code>Job：是一个接口，只有一个方法void execute(JobExecutionContext context)，开发者实现该接口定义运行任务，JobExecutionContext类提供了调度上下文的各种信息。Job运行时的信息保存在JobDataMap实例中；

JobDetail：Quartz在每次执行Job时，都重新创建一个Job实例，所以它不直接接受一个Job的实例，它接收一个Job实现类，以便运行时通过newInstance()的反射机制实例化Job。因此需要通过一个类来描述Job的实现类及其它相关的静态信息，如Job名字、描述、关联监听器等信息，JobDetail承担了这一角色。

Trigger：是一个类，描述触发Job执行的时间触发规则。主要有SimpleTrigger和CronTrigger这两个子类。当仅需触发一次或者以固定时间间隔周期执行，SimpleTrigger是最适合的选择；而CronTrigger则可以通过Cron表达式定义出各种复杂时间规则的调度方案；

Calendar：org.quartz.Calendar和java.util.Calendar不同，它是一些日历特定时间点的集合，一个Trigger可以和多个Calendar关联，以便排除或包含某些时间点。

Scheduler：代表一个Quartz的独立运行容器，Trigger和JobDetail可以注册到Scheduler中，两者在Scheduler中拥有各自的组及名称，组及名称是Scheduler查找定位容器中某一对象的依据，Trigger的组及名称必须唯一，JobDetail的组和名称也必须唯一（但可以和Trigger的组和名称相同，因为它们是不同类型的）。Scheduler定义了多个接口方法，允许外部通过组及名称访问和控制容器中Trigger和JobDetail。

Scheduler可以将Trigger绑定到某一JobDetail中，这样当Trigger触发时，对应的Job就被执行。一个Job可以对应多个Trigger，但一个Trigger只能对应一个Job。可以通过SchedulerFactory创建一个Scheduler实例。Scheduler拥有一个SchedulerContext，保存着Scheduler上下文信息，Job和Trigger都可以访问SchedulerContext内的信息。SchedulerContext内部通过一个Map，以键值对的方式维护这些上下文数据，SchedulerContext为保存和获取数据提供了多个put()和getXxx()的方法。可以通过Scheduler# getContext()获取对应的SchedulerContext实例；

ThreadPool：Scheduler使用一个线程池作为任务运行的基础设施，任务通过共享线程池中的线程提高运行效率。

Job有一个StatefulJob子接口，代表有状态的任务，该接口是一个没有方法的标签接口，其目的是让Quartz知道任务的类型，以便采用不同的执行方案。无状态任务在执行时拥有自己的JobDataMap拷贝，对JobDataMap的更改不会影响下次的执行。而有状态任务共享共享同一个JobDataMap实例，每次任务执行对JobDataMap所做的更改会保存下来，后面的执行可以看到这个更改，也即每次执行任务后都会对后面的执行发生影响。

    所以，无状态的Job可以并发执行，而有状态的StatefulJob不能并发执行，这意味着如果前次的StatefulJob还没有执行完毕，下一次的任务将阻塞等待，直到前次任务执行完毕。有状态任务比无状态任务需要考虑更多的因素，程序往往拥有更高的复杂度，因此除非必要，应该尽量使用无状态的Job。
　　如果Quartz使用了数据库持久化任务调度信息，无状态的JobDataMap仅会在Scheduler注册任务时保持一次，而有状态任务对应的JobDataMap在每次执行任务后都会进行保存。

　　Trigger自身也可以拥有一个JobDataMap，其关联的Job可以通过JobExecutionContext#getTrigger().getJobDataMap()获取Trigger中的JobDataMap。不管是有状态还是无状态的任务，在任务执行期间对Trigger的JobDataMap所做的更改都不会进行持久，也即不会对下次的执行产生影响。

　　Quartz拥有完善的事件和监听体系，大部分组件都拥有事件，如任务执行前事件、任务执行后事件、触发器触发前事件、触发后事件、调度器开始事件、关闭事件等等，可以注册相应的监听器处理事件。</code></pre><p>Quartz的3大API之Job <a href="https://www.cnblogs.com/zhanghaoliang/p/7886110.html" target="_blank" rel="noopener">https://www.cnblogs.com/zhanghaoliang/p/7886110.html</a></p>
<h2 id="三、Spring方式实现"><a href="#三、Spring方式实现" class="headerlink" title="三、Spring方式实现"></a>三、Spring方式实现</h2><h3 id="1、使用注解"><a href="#1、使用注解" class="headerlink" title="1、使用注解"></a>1、使用注解</h3><p>在spring配置中加入task的命名空间：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> xmlns:task="http://www.springframework.org/schema/task"</span><br><span class="line">xsi:schemaLocation="http://www.springframework.org/schema/task</span><br><span class="line">        http://www.springframework.org/schema/task/spring-task-4.0.xsd"</span><br></pre></td></tr></table></figure>
<p>然后使用task配置扫描注解<br> <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">&lt;!-- 定时任务 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">task:annotation-driven</span> <span class="attr">scheduler</span>=<span class="string">"qbScheduler"</span> <span class="attr">mode</span>=<span class="string">"proxy"</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">task:scheduler</span> <span class="attr">id</span>=<span class="string">"qbScheduler"</span> /&gt;</span></span><br></pre></td></tr></table></figure><br>此时就可以直接使用@Scheduled(cron = “时间格式串”)，应用该注解就可以实现定时的功能。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">@Scheduled</span>(cron = <span class="string">"0/5 * * * * ?"</span>)  <span class="comment">//每隔5秒执行一次定时任务</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">consoleInfo</span><span class="params">()</span></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"定时任务"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2、不使用注解实现定时任务"><a href="#2、不使用注解实现定时任务" class="headerlink" title="2、不使用注解实现定时任务"></a>2、不使用注解实现定时任务</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"> xmlns:task="http://www.springframework.org/schema/task"</span><br><span class="line">xsi:schemaLocation=" http://www.springframework.org/schema/task  </span><br><span class="line">        http://www.springframework.org/schema/task/spring-task-3.0.xsd”</span><br><span class="line">                        <span class="tag">&lt;<span class="name">description</span>&gt;</span></span><br><span class="line">        定时任务</span><br><span class="line">    <span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    //定时注解驱动</span><br><span class="line">    <span class="tag">&lt;<span class="name">task:annotation-driven</span> /&gt;</span></span><br><span class="line">    //进行定时任务的类，将其定义为一个bean</span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"spaceStatisticsService"</span> <span class="attr">class</span>=<span class="string">"com.pojo.system.manager.sigar.impl.SpaceStatisticsServiceImpl"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    //通过task标签，定义定时功能</span><br><span class="line">    <span class="tag">&lt;<span class="name">task:scheduled-tasks</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">task:scheduled</span> <span class="attr">ref</span>=<span class="string">"spaceStatisticsService"</span> <span class="attr">method</span>=<span class="string">"statisticSpace"</span> <span class="attr">cron</span>=<span class="string">"59 59 23 * * ?"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">task:scheduled-tasks</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>Java：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpaceStatisticsServiceImpl</span> <span class="keyword">implements</span> <span class="title">SpaceStatisticsService</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">statisticSpace</span><span class="params">()</span>    </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"实现定时功能"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="3、spring-boot上使用"><a href="#3、spring-boot上使用" class="headerlink" title="3、spring boot上使用"></a>3、spring boot上使用</h2><p>开启定时任务功能</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableScheduling</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReadingListApplication</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//启动入口</span></span><br><span class="line">        SpringApplication.run(ReadingListApplication<span class="class">.<span class="keyword">class</span>, <span class="title">args</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">任务：</span><br><span class="line"> <span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Task</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Scheduled</span>(cron = <span class="string">"0/5 * * * * ?"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pringMsg</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="number">11</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行项目就会有结果</p>
<p>上面是单线程执行，如果需要并发多线程执行，这样做：</p>
<p>增加配置</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 并发任务，使其任务在多线程执行。</span></span><br><span class="line"><span class="comment">* 通过ScheduleConfig配置文件实现SchedulingConfigurer接口，并重写setSchedulerfang方法</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ScheduledConfig</span> <span class="keyword">implements</span> <span class="title">SchedulingConfigurer</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configureTasks</span><span class="params">(ScheduledTaskRegistrar scheduledTaskRegistrar)</span> </span>&#123;</span><br><span class="line">        scheduledTaskRegistrar.setScheduler(Executors.newScheduledThreadPool(<span class="number">2</span>));<span class="comment">//分配两个线程</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">多个任务：</span><br><span class="line"> <span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Task</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Scheduled</span>(cron = <span class="string">"0/5 * * * * ?"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pringMsg</span><span class="params">()</span></span>&#123;</span><br><span class="line">        DateFormat sdf = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd HH:mm:ss"</span>);</span><br><span class="line">        System.out.println(sdf.format(<span class="keyword">new</span> Date())+<span class="string">"----每5秒执行一次"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Scheduled</span>(cron = <span class="string">"0/1 * * * * ?"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pringMsg1</span><span class="params">()</span></span>&#123;</span><br><span class="line">        DateFormat sdf = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd HH:mm:ss"</span>);</span><br><span class="line">        System.out.println(sdf.format(<span class="keyword">new</span> Date())+<span class="string">"----每1秒执行一次"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="四、Spring-Boot集成Quartz"><a href="#四、Spring-Boot集成Quartz" class="headerlink" title="四、Spring Boot集成Quartz"></a>四、Spring Boot集成Quartz</h2><p>这里直接介绍spring boot整合Quartz</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.hu<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>quartz-springboot<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.2.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- quartz --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-quartz<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>创建两个任务：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestTask1</span> <span class="keyword">extends</span> <span class="title">QuartzJobBean</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">executeInternal</span><span class="params">(JobExecutionContext context)</span><span class="keyword">throws</span> JobExecutionException</span>&#123;</span><br><span class="line">        SimpleDateFormat sdf=<span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd HH:mm:ss"</span>);</span><br><span class="line">        System.out.println(<span class="string">"TestQuartz01----"</span>+sdf.format(<span class="keyword">new</span> Date()));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestTask2</span> <span class="keyword">extends</span> <span class="title">QuartzJobBean</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">executeInternal</span><span class="params">(JobExecutionContext context)</span> <span class="keyword">throws</span> JobExecutionException </span>&#123;</span><br><span class="line">        SimpleDateFormat sdf=<span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd HH:mm:ss"</span>);</span><br><span class="line">        System.out.println(<span class="string">"TestQuartz02----"</span> + sdf.format(<span class="keyword">new</span> Date()));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>配置定时任务执行：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 配置定时任务</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">QuartzConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> JobDetail <span class="title">testQuartz1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        return JobBuilder.newJob(TestTask1.class).withIdentity("testTask1").storeDurably().build();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Trigger <span class="title">testQuartzTrigger1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//5秒执行一次</span></span><br><span class="line">        SimpleScheduleBuilder scheduleBuilder = SimpleScheduleBuilder.simpleSchedule()</span><br><span class="line">                .withIntervalInSeconds(<span class="number">5</span>)</span><br><span class="line">                .repeatForever();</span><br><span class="line">        <span class="keyword">return</span> TriggerBuilder.newTrigger().forJob(testQuartz1())</span><br><span class="line">                .withIdentity(<span class="string">"testTask1"</span>)</span><br><span class="line">                .withSchedule(scheduleBuilder)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> JobDetail <span class="title">testQuartz2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        return JobBuilder.newJob(TestTask2.class).withIdentity("testTask2").storeDurably().build();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Trigger <span class="title">testQuartzTrigger2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//cron方式，每隔1秒执行一次</span></span><br><span class="line">        <span class="keyword">return</span> TriggerBuilder.newTrigger().forJob(testQuartz2())</span><br><span class="line">                .withIdentity(<span class="string">"testTask2"</span>)</span><br><span class="line">                .withSchedule(CronScheduleBuilder.cronSchedule(<span class="string">"*/1 * * * * ?"</span>))</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>入口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(Application<span class="class">.<span class="keyword">class</span>, <span class="title">args</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行没问题</p>
<pre><code>2019-05-28 19:24:31.254  INFO 4368 --- [          main] org.quartz.core.QuartzScheduler          : Scheduler quartzScheduler_$_NON_CLUSTERED started.
TestQuartz02----2019-05-28 19:24:31
TestQuartz01----2019-05-28 19:24:31
2019-05-28 19:24:31.270  INFO 4368 --- [          main] com.hu.Application                      : Started Application in 0.656 seconds (JVM running for 1.008)
TestQuartz02----2019-05-28 19:24:32
TestQuartz02----2019-05-28 19:24:33
TestQuartz02----2019-05-28 19:24:34
TestQuartz02----2019-05-28 19:24:35
TestQuartz02----2019-05-28 19:24:36
TestQuartz01----2019-05-28 19:24:36
TestQuartz02----2019-05-28 19:24:37
TestQuartz02----2019-05-28 19:24:38</code></pre><p>具体见项目spring-boot-starter-quartz<br><a href="https://github.com/huingsn/spring-boot-sample-demo/tree/master/quartz" target="_blank" rel="noopener">https://github.com/huingsn/spring-boot-sample-demo/tree/master/quartz</a><br>参考<a href="https://www.jianshu.com/p/d52d62fb2ac6" target="_blank" rel="noopener">https://www.jianshu.com/p/d52d62fb2ac6</a></p>
<p>在新版本的SpringBoot2.0发布后，SpringBoot2.0版本集成了Quartz2.3.0官网最新版本，整合到spring-boot-starter-quartz。针对Quartz新版本进行了 AutoConfiguration自动化配置，省去了很多繁琐的配置。</p>
<p>之前调度中心简单例子中，使用spring集成Quartz，这个示例把之前改为使用spring-boot-starter-quartz的项目。<br>见：spring-boot-starter-quartz<br>在此基础上修改：<br>1、pom.xml配置文件，SpringBoot为我们提供了对应的依赖，我们将之前的quartz相关依赖删除，替换为spring-boot-starter-quartz。<br>2、删除QuartzConfiguration配置类<br>之前使用 QuartzConfiguration配置类来完成了 Quartz需要的一系列配置，如： JobFactory、 SchedulerFactoryBean等，在我们添加 spring-boot-starter-quartz依赖后就不需要主动声明工厂类，因为 spring-boot-starter-quartz已经为我们自动化配置好了。</p>
<p>自动化配置源码<br>查看spring-boot-autoconfigure-2.0.0.RELEASE.jar，找到org.springframework.boot.autoconfigure.quartz，该目录就是SpringBoot提供的Quartz自动化配置源码实现，在该目录下有如下所示几个类：<br>AutowireCapableBeanJobFactory<br>该类替代了我们之前在QuartzConfiguration配置类的AutowiringSpringBeanJobFactory内部类实现，主要作用是我们自定义的QuartzJobBean子类被Spring IOC进行托管，可以在定时任务类内使用注入任意被Spring IOC托管的类。<br>JobStoreType<br>该类是一个枚举类型，定义了对应application.yml、application.properties文件内spring.quartz.job-store-type配置，其目的是配置quartz任务的数据存储方式，分别为：MEMORY（内存方式：默认）、JDBC（数据库方式）。<br>QuartzAutoConfiguration<br>该类是自动配置的主类，内部配置了SchedulerFactoryBean以及JdbcStoreTypeConfiguration，使用QuartzProperties作为属性自动化配置条件。<br>QuartzDataSourceInitializer<br>该类主要用于数据源初始化后的一些操作，根据不同平台类型的数据库进行选择不同的数据库脚本。<br>QuartzProperties<br>该类对应了spring.quartz在application.yml、application.properties文件内开头的相关配置。<br>SchedulerFactoryBeanCustomizer<br>这是一个接口，我们实现该接口后并且将实现类使用Spring IOC托管，可以完成SchedulerFactoryBean的个性化设置，这里的设置完全可以对SchedulerFactoryBean做出全部的设置变更。</p>
<p>3、在springboot配置文件中增加Quartz的配置信息，移除之前的Quartz配置文件。<br>其实就是把之前 quartz.properties配置文件内的所有配置转换成 YAML风格，对应的添加在该配置下即可，在 QuartzAutoConfiguration类内，会自动调用 SchedulerFactoryBean的 setQuartzProperties方法，把 spring.quartz.properties内的所有配置进行设置。</p>
<p>完成，启动测试和之前一样。        </p>

          
        
      
    </div>
     <!-- 相关文章推荐 -->
    
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://huyunshun.com/2019/04/12/Nodejs%E2%80%94MVVM/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="初晨">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://img.huyunshun.com/img/20200522182348.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="简">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/04/12/Nodejs%E2%80%94MVVM/" itemprop="url">Nodejs—MVVM</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-04-12T00:00:00+08:00">
                2019-04-12
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Node/" itemprop="url" rel="index">
                    <span itemprop="name">Node</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>MVVM最早由微软提出来，它借鉴了桌面应用程序的MVC思想，在前端页面中，把Model用纯JavaScript对象表示，View负责显示，两者做到了最大限度的分离。</p>
<p>把Model和View关联起来的就是ViewModel。ViewModel负责把Model的数据同步到View显示出来，还负责把View的修改同步回Model。需要用JavaScript编写一个通用的ViewModel，这样，就可以复用整个MVVM模型了。</p>
<h1 id="单向绑定"><a href="#单向绑定" class="headerlink" title="单向绑定"></a>单向绑定</h1><p>MVVM就是在前端页面上，应用了扩展的MVC模式，我们关心Model的变化，MVVM框架自动把Model的变化映射到DOM结构上，这样，用户看到的页面内容就会随着Model的变化而更新。</p>
<p><img src="https://img.huyunshun.com/img1/222222222imgclip.png" alt=""></p>
<p>经过MVVM框架的自动转换，浏览器就可以直接显示Model的数据。目前，常用的MVVM框架有：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Angular：Google出品，名气大，但是很难用；</span><br><span class="line">Backbone.js：入门非常困难，因为自身API太多；</span><br><span class="line">Ember：一个大而全的框架，想写个Hello world都很困难。</span><br></pre></td></tr></table></figure>
<p>我们选择MVVM的目标应该是入门容易，安装简单，能直接在页面写JavaScript，需要更复杂的功能时又能扩展支持。综合考察，最佳选择是尤雨溪大神开发的MVVM框架：Vue.js 目前，Vue.js的最新版本是2.0，我们会使用2.0版本作为示例。</p>
<p>创建基于koa的Node.js项目结构如下：</p>
<p><img src="https://img.huyunshun.com/img1/222222222imgclip_1.png" alt=""></p>
<h5 id="编写MVVM"><a href="#编写MVVM" class="headerlink" title="编写MVVM"></a>编写MVVM</h5><p>Model是一个JavaScript对象，它包含两个属性：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    name: <span class="string">'hu'</span>,</span><br><span class="line">    age: <span class="number">15</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>而负责显示的是DOM节点可以用和来引用Model的属性：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=<span class="string">"vm"</span>&gt;</span><br><span class="line">    &lt;p&gt;Hello, &#123;&#123; name &#125;&#125;!&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">    &lt;p&gt;You are &#123;&#123; age &#125;&#125; years old!&lt;/</span>p&gt;</span><br><span class="line">&lt;<span class="regexp">/div&gt;</span></span><br></pre></td></tr></table></figure>
<p>最后一步是用Vue把两者关联起来。</p>
<p>在<head>内部编写的JavaScript代码，需要用jQuery把MVVM的初始化代码推迟到页面加载完毕后执行，否则，直接在<head>内执行MVVM代码时，DOM节点尚未被浏览器加载，初始化将失败。正确的写法如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 引用jQuery --&gt;</span><br><span class="line">&lt;script src=<span class="string">"/static/js/jquery.min.js"</span>&gt;&lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;!-- 引用Vue --&gt;</span></span><br><span class="line"><span class="regexp">&lt;script src="/</span><span class="keyword">static</span>/js/vue.js<span class="string">"&gt;&lt;/script&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&lt;script&gt;</span></span><br><span class="line"><span class="string">// 初始化代码:</span></span><br><span class="line"><span class="string">$(function () &#123;</span></span><br><span class="line"><span class="string">    var vm = new Vue(&#123;</span></span><br><span class="line"><span class="string">        el: '#vm',</span></span><br><span class="line"><span class="string">        data: &#123;</span></span><br><span class="line"><span class="string">            name: 'hu',</span></span><br><span class="line"><span class="string">            age: 15</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    &#125;);</span></span><br><span class="line"><span class="string">    window.vm = vm;</span></span><br><span class="line"><span class="string">&#125;);</span></span><br><span class="line"><span class="string">&lt;/script&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&lt;/head&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&lt;body&gt;</span></span><br><span class="line"><span class="string">    &lt;div id="</span>vm<span class="string">"&gt;</span></span><br><span class="line"><span class="string">        &lt;p&gt;Hello, &#123;&#123; name &#125;&#125;!&lt;/p&gt;</span></span><br><span class="line"><span class="string">        &lt;p&gt;You are &#123;&#123; age &#125;&#125; years old!&lt;/p&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&lt;/body&gt;</span></span><br><span class="line"><span class="string">&lt;html&gt;</span></span><br></pre></td></tr></table></figure>
<p>其中，el指定了要把Model绑定到哪个DOM根节点上，语法和jQuery类似。这里的’#vm’对应ID为vm的一个<div>节点：</p>
<p>在该节点以及该节点内部，就是Vue可以操作的View。Vue可以自动把Model的状态映射到View上，但是不能操作View范围之外的其他DOM节点。</p>
<p>然后，data属性指定了Model，我们初始化了Model的两个属性name和age，在View内部的<p>节点上，可以直接用引用Model的某个属性。</p>
<p>如果打开浏览器console，因为我们用代码window.vm = vm，把VM变量绑定到了window对象上，所以，可以直接修改VM的Model：</p>
<p>Vue作为MVVM框架会自动监听Model的任何变化，在Model数据变化时，更新View的显示。这种Model到View的绑定我们称为单向绑定。</p>
<h5 id="单向绑定-1"><a href="#单向绑定-1" class="headerlink" title="单向绑定"></a>单向绑定</h5><p>在Vue中，可以直接写绑定某个属性。如果属性关联的是对象，还可以用多个.引用，例如，。</p>
<p>另一种单向绑定的方法是使用Vue的指令v-text，写法如下：</p>
<p>Hello, <span v-text="name"></span>!</p>

<pre><code>这种写法是把指令写在HTML节点的属性上，它会被Vue解析，该节点的文本内容会被绑定为Model的指定属性，注意不能再写双花括号{{ }}。</code></pre><h1 id="双向绑定"><a href="#双向绑定" class="headerlink" title="双向绑定"></a>双向绑定</h1><p><img src="https://img.huyunshun.com/img1/222222222imgclip_2.png" alt=""></p>
<p>在Vue中，使用双向绑定非常容易，我们仍然先创建一个VM实例：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> vm = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">        el: <span class="string">'#vm'</span>,</span><br><span class="line">        data: &#123;</span><br><span class="line">            email: <span class="string">''</span>,</span><br><span class="line">            name: <span class="string">''</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="built_in">window</span>.vm = vm;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>然后，编写一个HTML FORM表单，并用v-model指令把某个&lt;input&gt;和Model的某个属性作双向绑定：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;form id=<span class="string">"vm"</span> action=<span class="string">"#"</span>&gt;</span><br><span class="line">    &lt;p&gt;<span class="xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">v-model</span>=<span class="string">"email"</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line">    &lt;p&gt;<span class="xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">v-model</span>=<span class="string">"name"</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line">&lt;<span class="regexp">/form&gt;</span></span><br></pre></td></tr></table></figure>
<p>我们可以在表单中输入内容，然后在浏览器console中用window.vm.$data查看Model的内容，也可以用window.vm.name查看Model的name属性，它的值和FORM表单对应的&lt;input&gt;是一致的。</p>
<p>如果在浏览器console中用JavaScript更新Model，例如，执行window.vm.name=’22222’，表单对应的&lt;input&gt;内容就会立刻更新。</p>
<p>多个checkbox可以和数组绑定：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;label&gt;<span class="xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">v-model</span>=<span class="string">"language"</span> <span class="attr">value</span>=<span class="string">"zh"</span>&gt;</span> Chinese<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line">&lt;label&gt;<span class="xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">v-model</span>=<span class="string">"language"</span> <span class="attr">value</span>=<span class="string">"en"</span>&gt;</span> English<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line">&lt;label&gt;<span class="xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">v-model</span>=<span class="string">"language"</span> <span class="attr">value</span>=<span class="string">"fr"</span>&gt;</span> French<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>对应的Model为：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">language: [<span class="string">'zh'</span>, <span class="string">'en'</span>]</span><br></pre></td></tr></table></figure>
<p>单个checkbox可以和boolean类型变量绑定：</p>
<pre><code>&lt;input type=&quot;checkbox&quot; v-model=&quot;subscribe&quot;&gt;</code></pre><p>对应的Model为：</p>
<p>subscribe: true; // 根据checkbox是否选中为true/false</p>
<p>下拉框&lt;select&gt;绑定的是字符串，但是要注意，绑定的是value而非用户看到的文本：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;select v-model=<span class="string">"city"</span>&gt;</span><br><span class="line">    &lt;option value=<span class="string">"bj"</span>&gt;Beijing&lt;<span class="regexp">/option&gt;</span></span><br><span class="line"><span class="regexp">    &lt;option value="sh"&gt;Shanghai&lt;/</span>option&gt;</span><br><span class="line">    &lt;option value=<span class="string">"gz"</span>&gt;Guangzhou&lt;<span class="regexp">/option&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>select&gt;</span><br></pre></td></tr></table></figure>
<p>对应的Model为：</p>
<p>city: ‘bj’ // 对应option的value</p>
<p>双向绑定最大的好处是我们不再需要用jQuery去查询表单的状态，而是直接获得了用JavaScript对象表示的Model。</p>
<h5 id="处理事件"><a href="#处理事件" class="headerlink" title="处理事件"></a>处理事件</h5><p>当用户提交表单时，传统的做法是响应onsubmit事件，用jQuery获取表单内容，检查输入是否有效，最后提交表单，或者用AJAX提交表单。</p>
<p>现在，获取表单内容已经不需要了，因为双向绑定直接让我们获得了表单内容，并且获得了合适的数据类型。</p>
<p>响应onsubmit事件也可以放到VM中。我们在<form>元素上使用指令：</p>
<pre><code>&lt;form id=&quot;vm&quot; v-on:submit.prevent=&quot;register&quot;&gt;</code></pre><p>其中，v-on:submit=”register”指令就会自动监听表单的submit事件，并调用register方法处理该事件。使用.prevent表示阻止事件冒泡，这样，浏览器不再处理<form>的submit事件。</p>
<p>因为我们指定了事件处理函数是register，所以需要在创建VM时添加一个register函数：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> vm = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    el: <span class="string">'#vm'</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">        register: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="comment">// 显示JSON格式的Model:</span></span><br><span class="line">            alert(<span class="built_in">JSON</span>.stringify(<span class="keyword">this</span>.$data));</span><br><span class="line">            <span class="comment">// <span class="doctag">TODO:</span> AJAX POST...</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>在register()函数内部，我们可以用AJAX把JSON格式的Model发送给服务器，就完成了用户注册的功能。</p>
<h1 id="同步DOM结构"><a href="#同步DOM结构" class="headerlink" title="同步DOM结构"></a>同步DOM结构</h1><p>除了简单的单向绑定和双向绑定，MVVM还有一个重要的用途，就是让Model和DOM的结构保持同步。</p>
<p>我们用一个TODO的列表作为示例，从用户角度看，一个TODO列表在DOM结构的表现形式就是一组<li>节点：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ol</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dl</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dt</span>&gt;</span>产品评审<span class="tag">&lt;/<span class="name">dt</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dd</span>&gt;</span>新款iPhone上市前评审<span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dl</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dl</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dt</span>&gt;</span>开发计划<span class="tag">&lt;/<span class="name">dt</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dd</span>&gt;</span>与PM确定下一版Android开发计划<span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dl</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dl</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dt</span>&gt;</span>VC会议<span class="tag">&lt;/<span class="name">dt</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dd</span>&gt;</span>敲定C轮5000万美元融资<span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dl</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ol</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>而对应的Model可以用JavaScript数组表示：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">todos: [</span><br><span class="line">    &#123;</span><br><span class="line">        name: <span class="string">'产品评审'</span>,</span><br><span class="line">        description: <span class="string">'新款iPhone上市前评审'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        name: <span class="string">'开发计划'</span>,</span><br><span class="line">        description: <span class="string">'与PM确定下一版Android开发计划'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        name: <span class="string">'VC会议'</span>,</span><br><span class="line">        description: <span class="string">'敲定C轮5000万美元融资'</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>使用MVVM时，当我们更新Model时，DOM结构会随着Model的变化而自动更新。当todos数组增加或删除元素时，相应的DOM节点会增加<li>或者删除<li>节点。</p>
<p>在Vue中，可以使用v-for指令来实现：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ol</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">"t in todos"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dl</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dt</span>&gt;</span>&#123;&#123; t.name &#125;&#125;<span class="tag">&lt;/<span class="name">dt</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dd</span>&gt;</span>&#123;&#123; t.description &#125;&#125;<span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dl</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ol</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>v-for指令把数组和一组<li>元素绑定了。在<li>元素内部，用循环变量t引用某个属性，例如，。这样，我们只关心如何更新Model，不关心如何增删DOM节点，大大简化了整个页面的逻辑。</p>
<p>我们可以在浏览器console中用window.vm.todos[0].name=’计划有变’查看View的变化，或者通过window.vm.todos.push({name:’新计划’,description:’blabla…’})来增加一个数组元素，从而自动添加一个<li>元素。</p>
<p>需要注意的是，Vue之所以能够监听Model状态的变化，是因为JavaScript语言本身提供了Proxy或者Object.observe()机制来监听对象状态的变化。但是，对于数组元素的赋值，却没有办法直接监听，因此，如果我们直接对数组元素赋值：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vm.todos[<span class="number">0</span>] = &#123;</span><br><span class="line">    name: <span class="string">'New name'</span>,</span><br><span class="line">    description: <span class="string">'New description'</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>会导致Vue无法更新View。</p>
<p>正确的方法是不要对数组元素赋值，而是更新：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">vm.todos[0].name &#x3D; &#39;New name&#39;;</span><br><span class="line">vm.todos[0].description &#x3D; &#39;New description&#39;;</span><br><span class="line">或者，通过splice()方法，删除某个元素后，再添加一个元素，达到“赋值”的效果：</span><br><span class="line"></span><br><span class="line">var index &#x3D; 0;</span><br><span class="line">var newElement &#x3D; &#123;...&#125;;</span><br><span class="line">vm.todos.splice(index, 1, newElement);</span><br><span class="line">Vue可以监听数组的splice、push、unshift等方法调用，所以，上述代码可以正确更新View。</span><br></pre></td></tr></table></figure>

<h1 id="和后端交互"><a href="#和后端交互" class="headerlink" title="和后端交互"></a>和后端交互</h1><p>现在，如果要把这个简单的TODO应用变成一个用户能使用的Web应用，我们需要解决几个问题：</p>
<ul>
<li>用户的TODO数据应该从后台读取；</li>
<li>对TODO的增删改必须同步到服务器后端；</li>
<li>用户在View上必须能够修改TODO。</li>
</ul>
<p>第1个和第2个问题都是和API相关的。只要我们实现了合适的API接口，就可以在MVVM内部更新Model的同时，通过API把数据更新反映到服务器端，这样，用户数据就保存到了服务器端，下次打开页面时就可以读取TODO列表。</p>
<p>在api.js文件中，我们用数组在服务器端模拟一个数据库，然后实现以下4个API：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;api&#x2F;todos：返回所有TODO列表；</span><br><span class="line">POST &#x2F;api&#x2F;todos：创建一个新的TODO，并返回创建后的对象；</span><br><span class="line">PUT &#x2F;api&#x2F;todos&#x2F;:id：更新一个TODO，并返回更新后的对象；</span><br><span class="line">DELETE &#x2F;api&#x2F;todos&#x2F;:id：删除一个TODO。</span><br></pre></td></tr></table></figure>
<p>和上一节的TODO数据结构相比，我们需要增加一个id属性，来唯一标识一个TODO。</p>
<p>准备好API后，在Vue中，有两个方法：一是直接用jQuery的AJAX调用REST API，不过这种方式比较麻烦。第二个方法是使用vue-resource这个针对Vue的扩展，它可以给VM对象加上一个$resource属性，通过$resource来方便地操作API。</p>
<p>使用vue-resource只需要在导入vue.js后，加一行<script>导入vue-resource.min.js文件即可。可以直接使用CDN的地址：<script src="https://cdn.jsdelivr.net/vue.resource/1.0.3/vue-resource.min.js"></script></p>
<p>我们给VM增加一个init()方法，读取TODO列表：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> vm = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    el: <span class="string">'#vm'</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">        title: <span class="string">'TODO List'</span>,</span><br><span class="line">        todos: []</span><br><span class="line">    &#125;,</span><br><span class="line">    created: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.init();</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">        init: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> that = <span class="keyword">this</span>;</span><br><span class="line">            that.$resource(<span class="string">'/api/todos'</span>).get().then(<span class="function"><span class="keyword">function</span> (<span class="params">resp</span>) </span>&#123;</span><br><span class="line">                <span class="comment">// 调用API成功时调用json()异步返回结果:</span></span><br><span class="line">                resp.json().then(<span class="function"><span class="keyword">function</span> (<span class="params">result</span>) </span>&#123;</span><br><span class="line">                    <span class="comment">// 更新VM的todos:</span></span><br><span class="line">                    that.todos = result.todos;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;, <span class="function"><span class="keyword">function</span> (<span class="params">resp</span>) </span>&#123;</span><br><span class="line">                <span class="comment">// 调用API失败:</span></span><br><span class="line">                alert(<span class="string">'error'</span>);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>注意到创建VM时，created指定了当VM初始化成功后的回调函数，这样，init()方法会被自动调用。</p>
<p>类似的，对于添加、修改、删除的操作，我们也需要往VM中添加对应的函数。以添加为例：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> vm = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    ...</span><br><span class="line">    methods: &#123;</span><br><span class="line">        ...</span><br><span class="line">        create: <span class="function"><span class="keyword">function</span> (<span class="params">todo</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> that = <span class="keyword">this</span>;</span><br><span class="line">            that.$resource(<span class="string">'/api/todos'</span>).save(todo).then(<span class="function"><span class="keyword">function</span> (<span class="params">resp</span>) </span>&#123;</span><br><span class="line">                resp.json().then(<span class="function"><span class="keyword">function</span> (<span class="params">result</span>) </span>&#123;</span><br><span class="line">                    that.todos.push(result);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;, showError);</span><br><span class="line">        &#125;,</span><br><span class="line">        update: <span class="function"><span class="keyword">function</span> (<span class="params">todo, prop, e</span>) </span>&#123;</span><br><span class="line">            ...</span><br><span class="line">        &#125;,</span><br><span class="line">        remove: <span class="function"><span class="keyword">function</span> (<span class="params">todo</span>) </span>&#123;</span><br><span class="line">            ...</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>添加操作需要一个额外的表单，我们可以创建另一个VM对象vmAdd来对表单作双向绑定，然后，在提交表单的事件中调用vm对象的create方法：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> vmAdd = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    el: <span class="string">'#vmAdd'</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">        name: <span class="string">''</span>,</span><br><span class="line">        description: <span class="string">''</span></span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">        submit: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            vm.create(<span class="keyword">this</span>.$data);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>vmAdd和FORM表单绑定：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;form id=<span class="string">"vmAdd"</span> action=<span class="string">"#0"</span> v-on:submit.prevent=<span class="string">"submit"</span>&gt;</span><br><span class="line">    &lt;p&gt;<span class="xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">v-model</span>=<span class="string">"name"</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line">    &lt;p&gt;<span class="xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">v-model</span>=<span class="string">"description"</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line">    &lt;p&gt;<span class="xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"submit"</span>&gt;</span>Add<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span>&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>form&gt;</span><br></pre></td></tr></table></figure>
<p>最后，把vm绑定到对应的DOM：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=<span class="string">"vm"</span>&gt;</span><br><span class="line">    &lt;h3&gt;&#123;&#123; title &#125;&#125;&lt;<span class="regexp">/h3&gt;</span></span><br><span class="line"><span class="regexp">    &lt;ol&gt;</span></span><br><span class="line"><span class="regexp">        &lt;li v-for="t in todos"&gt;</span></span><br><span class="line"><span class="regexp">            &lt;dl&gt;</span></span><br><span class="line"><span class="regexp">                &lt;dt contenteditable="true" v-on:blur="update(t, 'name', $event)"&gt;&#123;&#123; t.name &#125;&#125;&lt;/</span>dt&gt;</span><br><span class="line">                &lt;dd contenteditable=<span class="string">"true"</span> v-on:blur=<span class="string">"update(t, 'description', $event)"</span>&gt;&#123;&#123; t.description &#125;&#125;&lt;<span class="regexp">/dd&gt;</span></span><br><span class="line"><span class="regexp">                &lt;dd&gt;&lt;a href="#0" v-on:click="remove(t)"&gt;Delete&lt;/</span>a&gt;&lt;<span class="regexp">/dd&gt;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>dl&gt;</span><br><span class="line">        &lt;<span class="regexp">/li&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>ol&gt;</span><br><span class="line">&lt;<span class="regexp">/div&gt;</span></span><br></pre></td></tr></table></figure>
<p>这里我们用contenteditable=”true”让DOM节点变成可编辑的，用v-on:blur=”update(t, ‘name’, $event)”在编辑结束时调用update()方法并传入参数，特殊变量$event表示DOM事件本身。</p>
<p>删除TODO是通过对<a>节点绑定v-on:click事件并调用remove()方法实现的。</p>
<p>如果一切无误，我们就可以先启动服务器，然后在浏览器中访问<a href="http://localhost:3000/static/index.html，对TODO进行增删改等操作，操作结果会保存在服务器端。" target="_blank" rel="noopener">http://localhost:3000/static/index.html，对TODO进行增删改等操作，操作结果会保存在服务器端。</a></p>
<p>通过Vue和vue-resource插件，我们用简单的几十行代码就实现了一个真正可用的TODO应用。</p>

          
        
      
    </div>
     <!-- 相关文章推荐 -->
    
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/5/">上一页</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><span class="page-number current">6</span><a class="page-number" href="/page/7/">7</a><span class="space">&hellip;</span><a class="page-number" href="/page/25/">25</a><a class="extend next" rel="next" href="/page/7/">下一页</a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="https://img.huyunshun.com/img/20200522182348.png"
                alt="初晨" />
            
              <p class="site-author-name" itemprop="name">初晨</p>
              <p class="site-description motion-element" itemprop="description">永远不要说你知道本质，更别说真相了。</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/%7C%7C%20archive">
              
                  <span class="site-state-item-count">249</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">46</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">109</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          
<!--近期文章版块-->
            
                <div class="links-of-blogroll motion-element links-of-blogroll-block">
                  <div class="links-of-blogroll-title">
                    <!-- modify icon to fire by szw -->
                    <i class="fa fa-history fa-" aria-hidden="true"></i>
                    近期文章
                  </div>
                  <ul class="links-of-blogroll-list">
                    
                    
                      <li>
                        <a href="/2020/05/22/WebSocket%E3%80%81Socket%E3%80%81TCP%E3%80%81HTTP%E5%8C%BA%E5%88%AB/" title="WebSocket、Socket、TCP、HTTP区别" target="_blank">WebSocket、Socket、TCP、HTTP区别</a>
                      </li>
                    
                      <li>
                        <a href="/2020/05/19/Springboot%E9%A1%B9%E7%9B%AE%E7%9A%84%E6%8E%A5%E5%8F%A3%E9%98%B2%E5%88%B7/" title="Springboot项目的接口防刷" target="_blank">Springboot项目的接口防刷</a>
                      </li>
                    
                      <li>
                        <a href="/2020/05/03/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3Volatile%E5%85%B3%E9%94%AE%E5%AD%97%E5%8F%8A%E5%85%B6%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86/" title="深入理解Volatile关键字及其实现原理" target="_blank">深入理解Volatile关键字及其实现原理</a>
                      </li>
                    
                      <li>
                        <a href="/2020/04/20/%E4%BD%BF%E7%94%A8vscode%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E7%AC%94%E8%AE%B0%E7%8E%AF%E5%A2%83/" title="使用vscode搭建个人笔记环境" target="_blank">使用vscode搭建个人笔记环境</a>
                      </li>
                    
                      <li>
                        <a href="/2020/01/20/HBase%E4%BB%8B%E7%BB%8D%E5%AE%89%E8%A3%85%E4%B8%8E%E6%93%8D%E4%BD%9C/" title="HBase介绍安装与操作" target="_blank">HBase介绍安装与操作</a>
                      </li>
                    
                  </ul>
                </div>
            
          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2018 &mdash; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Copyright</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  


</body>
</html>
