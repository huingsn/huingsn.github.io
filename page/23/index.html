<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="永远不要说你知道本质，更别说真相了。">
<meta property="og:type" content="website">
<meta property="og:title" content="简">
<meta property="og:url" content="https://huyunshun.com/page/23/index.html">
<meta property="og:site_name" content="简">
<meta property="og:description" content="永远不要说你知道本质，更别说真相了。">
<meta property="article:author" content="初晨">
<meta property="article:tag" content="编程">
<meta property="article:tag" content="开发">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://huyunshun.com/page/23/"/>





  <title>简</title>
  








  <script type="text/javascript" src="/js/src/love.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome/css/font-awesome.min.css">

  <!-- 看板娘 -->
    
        <script async src="/live2d-widget/autoload.js"></script>
    
 <!-- 飘动的彩带） -->
  <script src="/js/src/piao.js" type="text/javascript"></script>
<meta name="generator" content="Hexo 4.2.1"></head>
<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">简</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">人生短暂，学海无边，而大道至简。</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://huyunshun.com/2017/05/09/spring-ioc/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="初晨">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://img.huyunshun.com/img/20200522182348.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="简">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/05/09/spring-ioc/" itemprop="url">spring ioc使用解释</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-09T00:00:00+08:00">
                2017-05-09
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/spring/" itemprop="url" rel="index">
                    <span itemprop="name">spring</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>控制反转（ Inversion of Control ）<br>IoC 主要的作用：实例化对象的工作，通过IoC转交给 Spring 负责管理。解除了对象管理和序员之间的耦</p>
<h2 id="创建对象的三种方式"><a href="#创建对象的三种方式" class="headerlink" title="创建对象的三种方式"></a>创建对象的三种方式</h2><h3 id="通过构造方法创建"><a href="#通过构造方法创建" class="headerlink" title="通过构造方法创建"></a>通过构造方法创建</h3><ul>
<li>无参构造创建（默认）</li>
<li>有参构造创建（需要明确配置），需要在类中提供有参构造方法。<br>在 applicationContext.xml 中设置调用哪个构造方法创建对象；如果设定的条件匹配多个构造方法执行最后的构造方法。<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">index : 参数的索引,从 0 开始，</span><br><span class="line">name: 参数名</span><br><span class="line">type:类型(区分开关键字和封装类 int 和 Integer)</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- id表示获取到对象的标识，class标识创建哪个对象 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"student"</span> <span class="attr">class</span>=<span class="string">"com.hu.pojo.Student"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">"0"</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">type</span>=<span class="string">"int"</span> <span class="attr">value</span>=<span class="string">"12"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">"1"</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">type</span>=<span class="string">"java.lang.String"</span> <span class="attr">value</span>=<span class="string">"hu xiao ming"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="实例工厂"><a href="#实例工厂" class="headerlink" title="实例工厂"></a>实例工厂</h3>需要先创建工厂，再产生对象。 实现步骤：<h4 id="先创建实例工厂"><a href="#先创建实例工厂" class="headerlink" title="先创建实例工厂"></a>先创建实例工厂</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StudentFactory</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> Student <span class="title">newInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> Student(<span class="number">1</span>, <span class="string">"hu xiao xin"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="在-applicationContext-xml-中配置工厂对象和需要创建的对象"><a href="#在-applicationContext-xml-中配置工厂对象和需要创建的对象" class="headerlink" title="在 applicationContext.xml 中配置工厂对象和需要创建的对象"></a>在 applicationContext.xml 中配置工厂对象和需要创建的对象</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"factory"</span> <span class="attr">class</span>=<span class="string">"com.hu.factory.StudentFactory"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--交给工厂来创建--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"stu"</span> <span class="attr">factory-bean</span>=<span class="string">"factory"</span> <span class="attr">factory-method</span>=<span class="string">"newInstance"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
测试：<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ApplicationContext ac = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"applicationContext.xml"</span>); </span><br><span class="line">        Student student = ac.getBean(<span class="string">"stu"</span>,Student<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        System.out.println(student);</span><br><span class="line">        System.out.println(ac.getBeanDefinitionNames());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="静态工厂"><a href="#静态工厂" class="headerlink" title="静态工厂"></a>静态工厂</h4>不需要创建工厂对象，步骤：<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StudentFactory</span> </span>&#123;</span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Student <span class="title">newInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">              <span class="keyword">return</span> <span class="keyword">new</span> Student(<span class="number">1</span>, <span class="string">"hu xiao xin"</span>);</span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
配置：<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"stu"</span> <span class="attr">class</span>=<span class="string">"com.hu.factory.StudentFactory"</span> <span class="attr">factory-method</span>=<span class="string">"newInstance"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
输入结果和上面一致，没有任何问题。<h2 id="通过注入方式给Bean赋值"><a href="#通过注入方式给Bean赋值" class="headerlink" title="通过注入方式给Bean赋值"></a>通过注入方式给Bean赋值</h2><h3 id="通过构造方法"><a href="#通过构造方法" class="headerlink" title="通过构造方法"></a>通过构造方法</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"student"</span> <span class="attr">class</span>=<span class="string">"com.hu.pojo.Student"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">"0"</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">type</span>=<span class="string">"int"</span> <span class="attr">value</span>=<span class="string">"12"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">"1"</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">type</span>=<span class="string">"java.lang.String"</span> <span class="attr">value</span>=<span class="string">"hu xiao ming"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="set方法："><a href="#set方法：" class="headerlink" title="set方法："></a>set方法：</h3><h4 id="基本数据类型或String，直接赋值。比如以下两种都是等效的。"><a href="#基本数据类型或String，直接赋值。比如以下两种都是等效的。" class="headerlink" title="基本数据类型或String，直接赋值。比如以下两种都是等效的。"></a>基本数据类型或String，直接赋值。比如以下两种都是等效的。</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">       <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"student"</span> <span class="attr">class</span>=<span class="string">"com.hu.pojo.Student"</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">value</span>=<span class="string">"12"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">value</span>=<span class="string">"hu xiao ming"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">或：</span><br><span class="line">       <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"student2"</span> <span class="attr">class</span>=<span class="string">"com.hu.pojo.Student"</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"id"</span>&gt;</span><span class="tag">&lt;<span class="name">value</span>&gt;</span>12<span class="tag">&lt;/<span class="name">value</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"name"</span>&gt;</span><span class="tag">&lt;<span class="name">value</span>&gt;</span>hu xiao ming<span class="tag">&lt;/<span class="name">value</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="如果是Set或者List"><a href="#如果是Set或者List" class="headerlink" title="如果是Set或者List"></a>如果是Set<?>或者List<?></h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 此时没有set的构造方法，是通过属性set方法设值 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"student3"</span> <span class="attr">class</span>=<span class="string">"com.hu.pojo.Student"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"id"</span>&gt;</span><span class="tag">&lt;<span class="name">value</span>&gt;</span>12<span class="tag">&lt;/<span class="name">value</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"name"</span>&gt;</span><span class="tag">&lt;<span class="name">value</span>&gt;</span>hu xiao ming<span class="tag">&lt;/<span class="name">value</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"set"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">set</span>&gt;</span><span class="comment">&lt;!-- 若是List，则用&lt;list&gt; --&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">value</span>&gt;</span>111<span class="tag">&lt;/<span class="name">value</span>&gt;</span><span class="tag">&lt;<span class="name">value</span>&gt;</span>232<span class="tag">&lt;/<span class="name">value</span>&gt;</span><span class="tag">&lt;<span class="name">value</span>&gt;</span>534<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 如果集合只有一个值，可以直接如下这样写 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- &lt;property name="set" value="312321"&gt;&lt;/property&gt; --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
如果是数组：和集合类似吧<list>改为<array></li>
</ul>
<h4 id="Map"><a href="#Map" class="headerlink" title="Map"></a>Map</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"student3"</span> <span class="attr">class</span>=<span class="string">"com.hu.pojo.Student"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"map"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">map</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"a"</span> <span class="attr">value</span>=<span class="string">"b"</span>&gt;</span><span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="如果是Properties类型"><a href="#如果是Properties类型" class="headerlink" title="如果是Properties类型"></a>如果是Properties类型</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"student3"</span> <span class="attr">class</span>=<span class="string">"com.hu.pojo.Student"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"demo"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">props</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"key"</span>&gt;</span>value<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"key1"</span>&gt;</span>value1<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">props</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="Scope属性"><a href="#Scope属性" class="headerlink" title="Scope属性"></a>Scope属性</h2><p>scope 可取值</p>
<ul>
<li>singleton  默认值，单例</li>
<li>prototype  多例，每次获取重新实例化</li>
<li>request 每次请求重新实例化，web中</li>
<li>session 每个会话对象内，对象是单例的.</li>
<li>application 在 application 对象内是单例</li>
<li>global session spring 推出的一个对象，依赖于spring-webmvc-portlet.jar，类似于 session</li>
</ul>
<h2 id="自动注入"><a href="#自动注入" class="headerlink" title="自动注入"></a>自动注入</h2><p>1、在 Spring  配置文件中对象名和 ref=”id”id 名相同使用自动注入，可以不配置&lt;property/&gt;</p>
<p>2、两种配置办法</p>
<pre><code>局部配置：在&lt;bean&gt;中通过 autowire=&quot;&quot; 配置，只对这个\&lt;bean&gt;生效        

全局配置：在&lt;beans&gt;中通过 default-autowire=&quot;&quot;配置，表当当前文件中所有&lt;bean&gt;都是全局配置内容</code></pre><p>3、autowire取值类型</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">default：默认值,根据全局 default-autowire&#x3D;&quot;&quot;值，默认全局和局部都没有配置情况下,相当于 no</span><br><span class="line">no：不自动注入</span><br><span class="line">byName：通过名称自动注入，在 Spring 容器中找类的 Id</span><br><span class="line">byType：根据类型注入（spring 容器中不可以出现两个相同类型的&lt;bean&gt;）</span><br><span class="line">constructor：根据构造方法注入（提供对应参数的构造方法）底层使用 byName，构造方法参数名和其他&lt;bean&gt;的 id相同</span><br></pre></td></tr></table></figure>

<h2 id="加载配置文件"><a href="#加载配置文件" class="headerlink" title="加载配置文件"></a>加载配置文件</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 加载properties文件  如果加载多个文件，后面用逗号分隔开 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">"classpath:db.properties"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">       <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSource"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.DriverManagerDataSource"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClassName"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.driver&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.url&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.username&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.password&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"factory"</span> <span class="attr">class</span>=<span class="string">"org.mybatis.spring.SqlSessionFactoryBean"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- org.mybatis.spring.SqlSessionFactoryBean封装了mybatis的操作，为某个包取别名   --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"typeAliasesPackage"</span> <span class="attr">value</span>=<span class="string">"com.hu.pojo"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 扫描器  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.mybatis.spring.mapper.MapperScannerConfigurer"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 要扫描 mapper接口 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"basePackage"</span> <span class="attr">value</span>=<span class="string">"com.hu.mapper"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- &lt;property name="sqlSessionFactory" ref="factory"&gt;&lt;/property&gt;  --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 此时sqlSessionFactory不适用   自动注入只会影响ref=""的情况，不会影响value</span></span><br><span class="line"><span class="comment">                factory的id不能为sqlSessionFactory，会自动注入到MapperScannerConfigurer</span></span><br><span class="line"><span class="comment">                这里sqlSessionFactory属性不适用，应当用sqlSessionFactoryBeanName</span></span><br><span class="line"><span class="comment">                是因为：配置了class="org.mybatis.spring.mapper.MapperScannerConfigurer"</span></span><br><span class="line"><span class="comment">                        而这句代码会在数据源加载前就执行了，之后就把表达式$&#123;jdbc.driverClass&#125;当成字符串执行  --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sqlSessionFactoryBeanName"</span> <span class="attr">value</span>=<span class="string">"factory"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>如果，properties创建值：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">student.name&#x3D;xiaoming</span><br><span class="line">student.age&#x3D;22</span><br></pre></td></tr></table></figure>
<p>加载文件：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 加载properties文件  如果加载多个文件，后面用逗号分隔开 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">"classpath:db.properties,classpath:student.properties"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>类里边使用properties的值（相当于给属性设置了一个初始值）：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line">       <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">       <span class="meta">@Value</span>(<span class="string">"$&#123;student.name&#125;"</span>)</span><br><span class="line">       <span class="keyword">private</span> String name;</span><br><span class="line">       <span class="meta">@Value</span>(<span class="string">"$&#123;student.age&#125;"</span>)</span><br><span class="line">       <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">       <span class="comment">//......        </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
     <!-- 相关文章推荐 -->
    
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://huyunshun.com/2017/04/23/%E7%A3%81%E7%9B%98%E5%92%8C%E5%86%85%E5%AD%98%E8%AF%BB%E5%86%99%E7%AE%80%E5%8D%95%E5%8E%9F%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="初晨">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://img.huyunshun.com/img/20200522182348.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="简">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/04/23/%E7%A3%81%E7%9B%98%E5%92%8C%E5%86%85%E5%AD%98%E8%AF%BB%E5%86%99%E7%AE%80%E5%8D%95%E5%8E%9F%E7%90%86/" itemprop="url">磁盘和内存读写简单原理</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-23T00:00:00+08:00">
                2017-04-23
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E4%BD%93%E7%B3%BB/" itemprop="url" rel="index">
                    <span itemprop="name">计算机体系</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>当程序要读取的数据时传入内存地址（行地址+列地址），如果数据不在主存中时，会触发一个缺页异常，此时系统会向磁盘发出读盘信号，通过柱面号，磁头号，扇区号定位磁盘位置，找到数据的起始位置并向后连续读取一页或几页载入内存中。</p>
<p>我们在程序中的数据处理主要是操作磁盘和内存,硬盘是磁盘里面最常用的一种.以前有所谓的软盘,也是磁盘的一种,原理和硬盘是一样的.都是利用磁性物质的特性来保存信息.磁盘的原理就是利用电磁转换,学物理时我们知道电可以使物质带上磁性,而金属在磁场运动时切割磁感线时会产生电流.磁盘上有很多微粒的磁粉.当写通过磁头写数据时,磁头中的电流会导致磁粉极化,改变方向.读数据时,导体磁头经过磁粒的区域时会产生电流. 反正大概意思就是这样.</p>
<h2 id="硬盘的存储数据原理"><a href="#硬盘的存储数据原理" class="headerlink" title="硬盘的存储数据原理"></a>硬盘的存储数据原理</h2><p>我们知道信息存储在硬盘里，把它拆开也看不见里面有任何东西，只有些盘片。假设，你用显微镜把盘片放大，会看见盘片表面凹凸不平，凸起的地方被磁化，凹的地方是没有被磁化；凸起的地方代表数字1（磁化为1），凹的地方代表数字0。因此硬盘可以以二进制来存储表示文字、图片等信息。             </p>
<h2 id="内存存储数据原理"><a href="#内存存储数据原理" class="headerlink" title="内存存储数据原理"></a>内存存储数据原理</h2><p>而内存的原理就完全不同,内存是晶体管制作的(CPU也是晶体管做的),而晶体管的特性就是我们平时常说的用开关的开和关来表示1,0.<br>通过一些门电路的组合可用来表示数字和实现复杂的逻辑功能.而内存主要是用来临时保存数据.CPU就是处理一些逻辑关系.</p>
<p>晶体管由于必须得通电,然后用电流的有无状态来表示信息,充放电后电荷的多少（电势高低）分别对应二进制数据0和1,所以只有通电的时候可以保存数据,电一断内存里的晶体管状态就处未知状态就啥用处也没了.而磁盘断电后磁性物质还会一直保持原样.</p>
<p>我们知道访问磁盘时就通过磁头去指到固定的地方然后读取数据.不过内存就不一样,不需要啥磁头去读取数据,它是有数据总线连接,我们是通过总线去读取内存的数据.</p>
<h2 id="磁盘的读写原理：（柱面号，磁头号，扇区号）"><a href="#磁盘的读写原理：（柱面号，磁头号，扇区号）" class="headerlink" title="磁盘的读写原理：（柱面号，磁头号，扇区号）"></a>磁盘的读写原理：（柱面号，磁头号，扇区号）</h2><p>确定磁盘地址（柱面号，磁头号，扇区号），内存地址（源/目）：</p>
<pre><code>当需要从磁盘读取数据时，系统会将数据逻辑地址传给磁盘，磁盘的控制电路按照寻址逻辑将逻辑地址翻译成物理地址，即确定要读的数据在哪个磁道，哪个扇区。</code></pre><p>为了读取这个扇区的数据，需要将磁头放到这个扇区上方，为了实现这一点：</p>
<pre><code>1）首先必须找到柱面，即磁头需要移动对准相应磁道，这个过程叫做寻道，所耗费时间叫做寻道时间，
2）然后目标扇区旋转到磁头下，即磁盘旋转将目标扇区旋转到磁头下。这个过程耗费的时间叫做旋转时间。</code></pre><p>即一次访盘请求（读/写）完成过程由三个动作组成：</p>
<pre><code>1）寻道（时间）：磁头移动定位到指定磁道
2）旋转延迟（时间）：等待指定扇区从磁头下旋转经过
3）数据传输（时间）：数据在磁盘与内存之间的实际传输</code></pre><h2 id="内存的读写原理：（行地址-列地址）"><a href="#内存的读写原理：（行地址-列地址）" class="headerlink" title="内存的读写原理：（行地址+列地址）"></a>内存的读写原理：（行地址+列地址）</h2><h3 id="内存地址"><a href="#内存地址" class="headerlink" title="内存地址"></a>内存地址</h3><p>内存中的cell按矩阵形排列，每一行和每一列都会有一个对应的行地址线路（正规叫法叫做word line）和列地址线路（正规叫法是bit line），每个具体的cell就挂接在这样的行地址线路和列地址线路上，对应一个唯一的行号和列号，把行号和列号组合在一起，就是内存的地址。</p>
<p>上图是Thaiphoon Burner的一个SPD dump，每个地址是一个字节。不过我们可以把这些数据假设成只有一个bit，当成是一个简单的内存地址表，左边竖着的是行地址，上方横着的是列地址。例如我们要找第七行、倒数第二列（地址为7E）的数据，它就只有一个对应的值：FD。当然了，在内存的cell中，它只能是0或者1。</p>
<h3 id="寻址"><a href="#寻址" class="headerlink" title="寻址"></a>寻址</h3><p>数据要写入内存的一个cell，或者从内存中的一个cell读取数据，首先要完成对这个cell的寻址。寻址的过程，首先是将需要操作的cell的对应行地址信号和列地址信号输入行/列地址缓冲器，然后先通过行解码器（Row Decoder）选择特定的行地址线路，以激活特定的行地址。每一条行地址线路会与多条列地址线路和cell相连接，为了侦测列地址线路上微弱的激活信号，还需要一个额外的感应放大器（Sense Amplifier）放大这个信号。当行激活之后，列地址缓冲器中的列地址信号通过列解码器（Column Decoder）确定列地址，并被对应的感应放大器通过连接IO线路，这样cell就被激活，并可供读写操作，寻址完成。从行地址激活，到找到列地址这段时间，就是tRCD。</p>
<p>从内存读取到磁盘预读</p>
<p>由于存储介质的特性，磁盘本身存取就比主存慢很多，再加上机械运动耗费，磁盘的存取速度往往是主存的几百分分之一，因此为了提高效率，要尽量减少磁盘I/O。为了达到这个目的，磁盘往往不是严格按需读取，而是每次都会预读，即使只需要一个字节，磁盘也会从这个位置开始，顺序向后读取一定长度的数据放入内存。这样做的理论依据是计算机科学中著名的局部性原理：</p>
<pre><code>当一个数据被用到时，其附近的数据也通常会马上被使用。
程序运行期间所需要的数据通常比较集中。
由于磁盘顺序读取的效率很高（不需要寻道时间，只需很少的旋转时间），因此对于具有局部性的程序来说，预读可以提高I/O效率。</code></pre><p>预读的长度一般为页（page）的整倍数。页是计算机管理存储器的逻辑块，硬件及操作系统往往将主存和磁盘存储区分割为连续的大小相等的块，每个存储块称为一页（在许多操作系统中，页得大小通常为4k），主存和磁盘以页为单位交换数据。当程序要读取的数据不在主存中时，会触发一个缺页异常，此时系统会向磁盘发出读盘信号，磁盘会找到数据的起始位置并向后连续读取一页或几页载入内存中，然后异常返回，程序继续运行。</p>

          
        
      
    </div>
     <!-- 相关文章推荐 -->
    
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://huyunshun.com/2017/04/21/nexus%E7%A7%81%E6%9C%8D%E6%90%AD%E5%BB%BA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="初晨">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://img.huyunshun.com/img/20200522182348.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="简">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/04/21/nexus%E7%A7%81%E6%9C%8D%E6%90%AD%E5%BB%BA/" itemprop="url">nexus私服搭建</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-21T15:33:17+08:00">
                2017-04-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/maven/" itemprop="url" rel="index">
                    <span itemprop="name">maven</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>私服是架设在局域网的一种特殊的远程仓库，目的是代理远程仓库及部署第三方构件。有了私服之后，当 Maven 需要下载构件时，直接请求私服，私服上存在则下载到本地仓库；否则，私服请求外部的远程仓库，将构件下载到私服，再提供给本地仓库下载。</p>
<p><img src="https://img.huyunshun.com/img/20200421153417.png" alt="20200421153417"></p>
<p>我们可以使用专门的 Maven 仓库管理软件来搭建私服，比如：Apache Archiva，Artifactory，Sonatype Nexus。这里我们使用 Sonatype Nexus。</p>
<h2 id="1、下载"><a href="#1、下载" class="headerlink" title="1、下载"></a>1、下载</h2><pre><code>nexus下载地址：http://www.sonatype.org/
开源版 Nexus OSS
解压后会在同级目录中，出现两个文件夹：nexus-oss-webapp-1.8.0和sonatype-work
前者包含了nexus的运行环境和应用程序，后者包含了工作目录，你自己的配置和仓库。</code></pre><h2 id="2、安装到Linux"><a href="#2、安装到Linux" class="headerlink" title="2、安装到Linux"></a>2、安装到Linux</h2><pre><code>前提是安装了jdk
创建目录：mkdir /usr/local/nexus
拷贝到Linux服务器，解压到指定目录：tar -zxvf nexus-latest-bundle.tar.gz -C /usr/local/nexus</code></pre><h3 id="修改配置"><a href="#修改配置" class="headerlink" title="修改配置"></a>修改配置</h3><pre><code>nexus-2.14.11-01/conf/nexus.properties
端口默认已经是8081不做更改，${bundleBasedir}是指带版本号那个目录

nexus启动后需要访问Linux文件系统，需要足够的权限，在nexus启动脚本中，可以指定私服应用的访问用户，${bundleBasedir}/bin/nexus脚本文件中修改如下：
在#RUN_AS_USER=这里增加一行：RUN_AS_USER=root   代表nexus使用root用户权限。

开放端口：vim /etc/sysconfig/iptables    增加8081端口，再重启：service iptables restart

启动并测试：
[root@localhost bin]# ./nexus start
****************************************
WARNING - NOT RECOMMENDED TO RUN AS ROOT
****************************************
Starting Nexus OSS...
Removed stale pid file: /usr/local/nexus/nexus-2.14.11-01/bin/../bin/jsw/linux-x86-64/nexus.pid
Started Nexus OSS.
[root@localhost bin]# ./nexus status
****************************************
WARNING - NOT RECOMMENDED TO RUN AS ROOT
****************************************
Nexus OSS is running (2380).</code></pre><p>浏览器测试：</p>
<p><img src="https://img.huyunshun.com/img/20200421153632.png" alt="20200421153632"></p>
<h2 id="3、配置、登录"><a href="#3、配置、登录" class="headerlink" title="3、配置、登录"></a>3、配置、登录</h2><p>默认用户名密码为：admin/admin123     点击左侧 Repositories 链接，查看 Nexus 内置的仓库：</p>
<p><img src="https://img.huyunshun.com/img/20200421153705.png" alt="20200421153705"></p>
<p>Nexus 的仓库分类：</p>
<pre><code>hosted 宿主仓库：主要用于部署无法从公共仓库获取的构件（如 oracle 的 JDBC 驱动）以及自己或第三方的项目构件；
3rd Party： 顾名思义, 第三方库, 你可能会问不是有中央仓库来管理第三方库嘛,没错, 这里的是指可以让你添加自己的第三方库, 比如有些构件在中央仓库是不存在的. 比如你在中央仓库找不到Oracle 的JDBC驱动, 这个时候我们就需要自己添加到3rdparty仓库。
Releases：这里存放我们自己项目中发布的构建, 通常是Release版本的, 比如我们自己做了一个FTP Server的项目, 生成的构件为ftpserver.war, 我们就可以把这个构建发布到Nexus的Releases本地仓库. 关于符合发布后面会有介绍.
Snapshots：这个仓库非常的有用, 它的目的是让我们可以发布那些非release版本, 非稳定版本, 比如我们在trunk下开发一个项目,在正式release之前你可能需要临时发布一个版本给你的同伴使用, 因为你的同伴正在依赖你的模块开发, 那么这个时候我们就可以发布Snapshot版本到这个仓库, 你的同伴就可以通过简单的命令来获取和使用这个临时版本.
proxy 代理仓库：代理公共的远程仓库；
virtual 虚拟仓库：用于适配 Maven 1；
group 仓库组：Nexus 通过仓库组的概念统一管理多个仓库，这样我们在项目中直接请求仓库组即可请求到仓库组管理的多个仓库。</code></pre><p><img src="https://img.huyunshun.com/img/20200421153732.png" alt="20200421153732"></p>
<p>一般主要使用hosted和proxy</p>
<p>代理仓库配置信息：</p>
<p><img src="https://img.huyunshun.com/img/20200421153755.png" alt="20200421153755"></p>
<p>当下载完之后，仓库文件结构就会出来</p>
<p><img src="https://img.huyunshun.com/img/20200421153819.png" alt="20200421153819"></p>
<h2 id="4、利用搭建的私服，进行上传和下载jar包"><a href="#4、利用搭建的私服，进行上传和下载jar包" class="headerlink" title="4、利用搭建的私服，进行上传和下载jar包"></a>4、利用搭建的私服，进行上传和下载jar包</h2><h3 id="1）、下载："><a href="#1）、下载：" class="headerlink" title="1）、下载："></a>1）、下载：</h3><h4 id="a、配置认证："><a href="#a、配置认证：" class="headerlink" title="a、配置认证："></a>a、配置认证：</h4><p>setting中配置如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">    <span class="tag">&lt;<span class="name">server</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus-releases<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">username</span>&gt;</span>deployment<span class="tag">&lt;/<span class="name">username</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">password</span>&gt;</span>deployment123<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">server</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">server</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus-snapshots<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">username</span>&gt;</span>deployment<span class="tag">&lt;/<span class="name">username</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">password</span>&gt;</span>deployment123<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">server</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="b、配置仓库信息："><a href="#b、配置仓库信息：" class="headerlink" title="b、配置仓库信息："></a>b、配置仓库信息：</h4><p>如果就一个项目配置在pom.xml如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 下载 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">distributionManagement</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus-releases<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">name</span>&gt;</span>Nexus Release Repository<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://192.168.18.134:8081/nexus/content/repositories/releases/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">snapshotRepository</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus-snapshots<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">name</span>&gt;</span>Nexus Snapshots Repository<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://192.168.18.134:8081/nexus/content/repositories/snapshots/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">snapshotRepository</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">distributionManagement</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>多个项目时候 可以统一配置父项目或者maven的setting文件中：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">    <span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span>&gt;</span>hys<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 使用私服配置 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">repositories</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">id</span>&gt;</span>local_nexus<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://192.168.18.134:8081/nexus/content/groups/public/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">releases</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">releases</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">repositories</span>&gt;</span>        </span><br><span class="line">    <span class="tag">&lt;<span class="name">pluginRepositories</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pluginRepository</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">id</span>&gt;</span>local_nexus<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://192.168.18.134:8081/nexus/content/groups/public/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">releases</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">releases</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">pluginRepository</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">pluginRepositories</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 必须激活才能生效 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">activeProfiles</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">activeProfile</span>&gt;</span>hys<span class="tag">&lt;/<span class="name">activeProfile</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">activeProfiles</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="c、配置仓库镜像"><a href="#c、配置仓库镜像" class="headerlink" title="c、配置仓库镜像"></a>c、配置仓库镜像</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--  如果本地仓库找不到依赖的构件，这时需要东西时先到Nexus上找，如果发现Nexus服务关闭后，会自动到中央仓库找</span></span><br><span class="line"><span class="comment">　　 如果我们想覆盖中央仓库的默认地址，强制依赖的东西都到Nexus中去找，即使Nexus关闭也不会到中央工厂去下载： --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>local_nexus<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>local maven<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://192.168.18.134:8081/nexus/content/groups/public/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>Central<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br></pre></td></tr></table></figure>
<pre><code>repository：在repositories元素下，可以使用repository子元素声明一个或者多个远程仓库。
id：仓库声明的唯一id，尤其需要注意的是，Maven自带的中央仓库使用的id为central，如果其他仓库声明也使用该id，就会覆盖中央仓库的配置。
name：仓库的名称，让我们直观方便的知道仓库是哪个，暂时没发现其他太大的含义。
url：指向了仓库的地址，一般来说，该地址都基于http协议，Maven用户都可以在浏览器中打开仓库地址浏览构件。
releases和snapshots：用来控制Maven对于发布版构件和快照版构件的下载权限。需要注意的是enabled子元素，该例中releases的enabled值为true，表示开启JBoss仓库的发布版本下载支持，而snapshots的enabled值为false，表示关闭JBoss仓库的快照版本的下载支持。根据该配置，Maven只会从JBoss仓库下载发布版的构件，而不会下载快照版的构件。
layout：元素值default表示仓库的布局是Maven2及Maven3的默认布局，而不是Maven1的布局。基本不会用到Maven1的布局。
其他：对于releases和snapshots来说，除了enabled，它们还包含另外两个子元素updatePolicy和checksumPolicy。
元素updatePolicy用来配置Maven从远处仓库检查更新的频率，默认值是daily，表示Maven每天检查一次。其他可用的值包括：never-从不检查更新；always-每次构建都检查更新；interval：X-每隔X分钟检查一次更新（X为任意整数）。
元素checksumPolicy用来配置Maven检查校验和文件的策略。当构建被部署到Maven仓库中时，会同时部署对应的检验和文件。在下载构件的时候，Maven会验证校验和文件，如果校验和验证失败，当checksumPolicy的值为默认的warn时，Maven会在执行构建时输出警告信息，其他可用的值包括：fail-Maven遇到校验和错误就让构建失败；ignore-使Maven完全忽略校验和错误。</code></pre><h3 id="2）、上载包配置"><a href="#2）、上载包配置" class="headerlink" title="2）、上载包配置"></a>2）、上载包配置</h3><p>配置pom.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">distributionManagement</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus-releases<span class="tag">&lt;/<span class="name">id</span>&gt;</span><span class="comment">&lt;!--必须和setting中配置的用户名密码的id一致--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">name</span>&gt;</span>Nexus Release Repository<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://192.168.18.134:8081/nexus/content/repositories/releases/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">snapshotRepository</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus-snapshots<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">name</span>&gt;</span>Nexus Snapshots Repository<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://192.168.18.134:8081/nexus/content/repositories/snapshots/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">snapshotRepository</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">distributionManagement</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 上传插件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-source-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                                        <span class="tag">&lt;<span class="name">id</span>&gt;</span>attach-source<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">                                        <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                                                <span class="tag">&lt;<span class="name">goal</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                                        <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>右键项目–&gt;Maven build，输入deploy就会发布到私服。</p>
<p><img src="https://img.huyunshun.com/img/20200421155339.png" alt="20200421155339"><br>查看私服</p>
<p><img src="https://img.huyunshun.com/img/20200421155403.png" alt="20200421155403"></p>

          
        
      
    </div>
     <!-- 相关文章推荐 -->
    
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://huyunshun.com/2017/04/21/keepalived+Nginx%E9%85%8D%E7%BD%AE%E5%AE%9E%E7%8E%B0%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="初晨">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://img.huyunshun.com/img/20200522182348.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="简">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/04/21/keepalived+Nginx%E9%85%8D%E7%BD%AE%E5%AE%9E%E7%8E%B0%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/" itemprop="url">keepalived+Nginx配置实现负载均衡</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-21T00:00:00+08:00">
                2017-04-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/" itemprop="url" rel="index">
                    <span itemprop="name">负载均衡</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="一、keepalived服务"><a href="#一、keepalived服务" class="headerlink" title="一、keepalived服务"></a>一、keepalived服务</h2><p>Keepalived 一方面具有配置管理LVS的功能，同时还具有对LVS下面节点进行健康检查的功能，另一方面也可实现系统网络服务的高可用功能，用来防止单点故障。</p>
<h3 id="keepalived-工作原理"><a href="#keepalived-工作原理" class="headerlink" title="keepalived 工作原理"></a>keepalived 工作原理</h3><p>keepalived 是以 VRRP 协议为实现基础，VRRP全称Virtual Router Redundancy Protocol，即虚拟路由冗余协议。</p>
<pre><code>虚拟路由冗余协议，可以认为是实现路由器高可用的协议，即将N台提供相同功能的路由器组成一个路由器组，这个组里面有一个master和多个backup，master上面有一个对外提供服务的vip（该路由器所在局域网内其他机器的默认路由为该vip），master会发组播vrrp包，用于高速backup自己还活着，当backup收不到vrrp包时就认为master宕掉了，这时就需要根据VRRP的优先级来选举一个backup当master。这样的话就可以保证路由器的高可用了。保证业务的连续性，接管速度最快可以小于1秒。</code></pre><p>keepalived主要有三个模块，分别是core、check和vrrp。</p>
<pre><code>core模块为keepalived的核心，负责主进程的启动、维护以及全局配置文件的加载和解析。
check负责健康检查，包括常见的各种检查方式。
vrrp模块是来实现VRRP协议的。</code></pre><h3 id="keepalived-与-zookeeper-高可用性区别"><a href="#keepalived-与-zookeeper-高可用性区别" class="headerlink" title="keepalived 与 zookeeper 高可用性区别"></a>keepalived 与 zookeeper 高可用性区别</h3><p>Keepalived：</p>
<pre><code>优点：简单，基本不需要业务层面做任何事情，就可以实现高可用，主备容灾。而且容灾的宕机时间也比较短。
缺点：也是简单，因为VRRP、主备切换都没有什么复杂的逻辑，所以无法应对某些特殊场景，比如主备通信链路出问题，会导致脑裂。同时keepalived也不容易做负载均衡。</code></pre><p> Zookeeper：   </p>
<pre><code>优点：可以支持高可用，负载均衡。本身是个分布式的服务。  
缺点：跟业务结合的比较紧密。需要在业务代码中写好ZK使用的逻辑，比如注册名字。拉取名字对应的服务地址等。  </code></pre><h2 id="二、搭建配置keepalived-nginx负载均衡"><a href="#二、搭建配置keepalived-nginx负载均衡" class="headerlink" title="二、搭建配置keepalived+nginx负载均衡"></a>二、搭建配置keepalived+nginx负载均衡</h2><p>这里使用192.168.18.138作为master，192.168.18.139作为backup</p>
<p>两台Tomcat也是这两个，实际中应该是四台服务器。</p>
<p>之前在两台中一样安装好Tomcat和Nginx，现在只需要安装</p>
<pre><code>yum -y install keepalived
keepalived相关文件：
/etc/keepalived
/etc/keepalived/keepalived.conf     #keepalived服务主配置文件
/etc/rc.d/init.d/keepalived         #服务启动脚本（centos 7 之前的用init.d 脚本启动，之后的systemd启动）
/etc/sysconfig/keepalived
/usr/bin/genhash
/usr/libexec/keepalived
/usr/sbin/keepalived</code></pre><p>keepalived配置说明</p>
<pre><code>[root@etcd1 kubernetes]# cat /etc/keepalived/keepalived.conf
! Configuration File for keepalived
global_defs { # 全局配置
  notification_email { # 定义报警邮件地址，收件人，可以定义多个
    acassen@firewall.loc
    failover@firewall.loc
    sysadmin@firewall.loc
  }
  notification_email_from Alexandre.Cassen@firewall.loc # 定义发送邮件的地址
  smtp_server 192.168.200.1 # 邮箱服务器
  smtp_connect_timeout 30   # 定义超时时间
  router_id LVS_DEVEL　　    # 定义路由器标识信息，相同的局域网唯一，标识本节点的字条串,通常为hostname
}
# 虚拟 IP 配置 vrrp 每一个vrrp_instance就是定义一个虚拟路由器
vrrp_instance VI_1 {        # 定义实例
  state MASTER            # 状态参数 master/backup 仅表示说明，主节点为 MASTER， 对应的备份节点为 BACKUP  
  interface eth0          # 绑定虚拟 IP 的网络接口，与本机 IP 地址所在的网络接口相同，  
  virtual_router_id 51    # 虚拟路由的 ID 号， 两个节点设置必须一样， 可选 IP 最后一段使用, 相同的 VRID 为一个组，他将决定多播的 MAC 地址
  mcast_src_ip 192.168.10.50     ## 本机 IP 地址  
  priority 100            # 优先级决定是主还是备 --&gt; 越大越优先，节点优先级， 值范围 0-254， MASTER 要比 BACKUP 高    
  nopreempt 　　        # 优先级高的设置 nopreempt 解决异常恢复后再次抢占的问题
  advert_int 1            # 主备心跳通讯时间间隔，组播信息发送间隔，两个节点设置必须一样， 默认 1s  
  authentication {        # 认证授权，设置验证信息，两个节点必须一致
      auth_type PASS
      auth_pass 1111    #密码
  }
  ## 将 track_script 块加入 instance 配置块
  track_script {
          chk_nginx  ## 执行 Nginx 监控的服务
    }
  virtual_ipaddress { # vip，设备之间使用的虚拟ip地址，可以定义多个
      192.168.200.16
      192.168.200.17
      192.168.200.18
  }
}</code></pre><h3 id="1、配置-etc-keepalived-keepalived-conf"><a href="#1、配置-etc-keepalived-keepalived-conf" class="headerlink" title="1、配置/etc/keepalived/keepalived.conf"></a>1、配置/etc/keepalived/keepalived.conf</h3><h4 id="主master："><a href="#主master：" class="headerlink" title="主master："></a>主master：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">  ! Configuration File for keepalived</span><br><span class="line">  global_defs &#123;</span><br><span class="line">    router_id LVS_01</span><br><span class="line">  &#125;</span><br><span class="line">  ## keepalived 会定时执行脚本并对脚本执行的结果进行分析，动态调整 vrrp_instance 的优先级。</span><br><span class="line">#  如果脚本执行结果为 0，并且 weight 配置的值大于 0，则优先级相应的增加。</span><br><span class="line">#  如果脚本执行结果非 0，并且 weight配置的值小于 0，则优先级相应的减少。</span><br><span class="line">#  其他情况，维持原本配置的优先级，即配置文件中 priority 对应的值。</span><br><span class="line">vrrp_script chk_nginx &#123;</span><br><span class="line">  script &quot;&#x2F;etc&#x2F;keepalived&#x2F;nginx_check.sh&quot; ## 检测 nginx 状态的脚本路径</span><br><span class="line">  interval 2 ## 检测时间间隔</span><br><span class="line">  weight -20 ## 如果条件成立，权重-20</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">  state MASTER</span><br><span class="line">  interface eth3</span><br><span class="line">  virtual_router_id 51</span><br><span class="line">  priority 100</span><br><span class="line">  advert_int 1</span><br><span class="line">  #nopreempt</span><br><span class="line">  authentication &#123;</span><br><span class="line">      auth_type PASS</span><br><span class="line">      auth_pass 1111</span><br><span class="line">  &#125;</span><br><span class="line">  #将track_script加入instance配置快</span><br><span class="line">  track_script &#123;</span><br><span class="line">      chk_nignx   ##执行Nginx监控服务</span><br><span class="line">  &#125;</span><br><span class="line">  virtual_ipaddress &#123;</span><br><span class="line">      192.168.18.88</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h4><pre><code>/etc/init.d/keepalived start 或 service keepalived start
Unexpected argument(s): start
[root@localhost init.d]# ip addr show
1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 16436 qdisc noqueue state UNKNOWN
  link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
  inet 127.0.0.1/8 scope host lo
  inet6 ::1/128 scope host
      valid_lft forever preferred_lft forever
2: eth3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP qlen 1000
  link/ether 00:0c:29:58:0f:80 brd ff:ff:ff:ff:ff:ff
  inet 192.168.18.138/24 brd 192.168.18.255 scope global eth3
  inet 192.168.18.88/32 scope global eth3
  inet6 fe80::20c:29ff:fe58:f80/64 scope link
      valid_lft forever preferred_lft forever</code></pre><p>可以看出增加了虚拟VIP</p>
<p>keepalived正常运行后，会启动3个进程，其中一个是父进程，负责监控其子进程。一个是vrrp子进程，另外一个是checkers子进程。</p>
<pre><code>[root@localhost init.d]# ps -ef | grep keepalived
root      38347      1  0 05:41 ?        00:00:00 keepalived start
root      38348  38347  0 05:41 ?        00:00:00 keepalived start
root      38349  38347  0 05:41 ?        00:00:00 keepalived start
root      38501  16757  0 05:53 pts/0    00:00:00 grep keepalived</code></pre><h4 id="备份服务配置"><a href="#备份服务配置" class="headerlink" title="备份服务配置"></a>备份服务配置</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">! Configuration File for keepalived</span><br><span class="line">glbal_defs &#123;</span><br><span class="line">  router_id LVS_02</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">## keepalived 会定时执行脚本并对脚本执行的结果进行分析，动态调整 vrrp_instance 的优先级。</span><br><span class="line">#  如果脚本执行结果为 0，并且 weight 配置的值大于 0，则优先级相应的增加。</span><br><span class="line">#  如果脚本执行结果非 0，并且 weight配置的值小于 0，则优先级相应的减少。</span><br><span class="line">#  其他情况，维持原本配置的优先级，即配置文件中 priority 对应的值。</span><br><span class="line">vrrp_script chk_nginx &#123;</span><br><span class="line">   script &quot;&#x2F;etc&#x2F;keepalived&#x2F;nginx_check.sh&quot; ## 检测 nginx 状态的脚本路径</span><br><span class="line">   interval 3 ## 检测时间间隔</span><br><span class="line">   weight -20 ## 如果条件成立，权重-20</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">   state BACKUP</span><br><span class="line">   interface eth3</span><br><span class="line">   virtual_router_id 51</span><br><span class="line">   priority 80</span><br><span class="line">   advert_int 1</span><br><span class="line">   authentication &#123;</span><br><span class="line">       auth_type PASS</span><br><span class="line">       auth_pass 1111</span><br><span class="line">   &#125;</span><br><span class="line">   #将track_script加入instance配置快</span><br><span class="line">   track_script &#123;</span><br><span class="line">       chk_nignx   ##执行Nginx监控服务</span><br><span class="line">   &#125;</span><br><span class="line">   virtual_ipaddress &#123;</span><br><span class="line">       192.168.18.88</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>同样的启动</p>
<h3 id="2、编写-nginx-检测脚本"><a href="#2、编写-nginx-检测脚本" class="headerlink" title="2、编写 nginx 检测脚本"></a>2、编写 nginx 检测脚本</h3><p>在所有的节点上面编写 Nginx 状态检测脚本 /etc/keepalived/nginx_check.sh (已在 keepalived.conf 中配置)脚本要求：如果 nginx 停止运行，尝试启动，如果无法启动则杀死本机的 keepalived 进程， keepalied将虚拟 ip 绑定到 BACKUP 机器上。</p>
<pre><code>#!/bin/bash
set -x
A=`ps -C nginx --no-header |wc -l`
if [ $A -eq 0 ];then
  echo `date`&apos;:  nginx is not healthy, try to killall keepalived&apos; &gt;&gt; /etc/keepalived/keepalived.log
  killall keepalived
fi</code></pre><p>把文件拷贝到192.168.18.139:/etc/keepalived/</p>
<pre><code>[root@localhost keepalived]# scp nginx_check.sh 192.168.18.139:/etc/keepalived/
Warning: Permanently added &apos;192.168.18.139&apos; (RSA) to the list of known hosts.
root@192.168.18.139&apos;s password:
nginx_check.sh                                                                      100%  206     0.2KB/s   00:00    </code></pre><p>由于之前只配置了138的Nginx，现在把139的Nginx也和138一样配置过去。<br>在重启两台的keepalived和Nginx</p>
<h3 id="3、测试"><a href="#3、测试" class="headerlink" title="3、测试"></a>3、测试</h3><p>两台机子启动keepalived<br>同时看两台的ip，可以看到虚拟IP被master调动。</p>
<p><img src="https://img.huyunshun.com/img/20200421131236.png" alt="20200421131236"></p>
<p>当master停止后：backup担任起调动工作。</p>
<p><img src="https://img.huyunshun.com/img/20200421131300.png" alt="20200421131300"></p>
<p>当master再次启动后：master再度抢占虚拟IP</p>
<p><img src="https://img.huyunshun.com/img/20200421131315.png" alt="20200421131315"></p>
<p>如果要使master再次起来时，不会抢占，在master /etc/keepalived/keepalived.conf   配置：</p>
<p><img src="https://img.huyunshun.com/img/20200421131327.png" alt="20200421131327"></p>
<p>浏览器对应测试结果：</p>
<p><img src="https://img.huyunshun.com/img/20200421131352.png" alt="20200421131352"></p>
<p>注：为了保证以上测试没有问题，需关闭防火墙。</p>
<h2 id="keepalieved-conf详细配置说明"><a href="#keepalieved-conf详细配置说明" class="headerlink" title="keepalieved.conf详细配置说明"></a>keepalieved.conf详细配置说明</h2><p>参考：<a href="https://www.jianshu.com/p/b050d8861fc1" target="_blank" rel="noopener">https://www.jianshu.com/p/b050d8861fc1</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line">! Configuration File for keepalived</span><br><span class="line"></span><br><span class="line">global_defs &#123;</span><br><span class="line">  notification_email &#123;   #发送报警邮件收件地址</span><br><span class="line">    acassen@firewall.loc</span><br><span class="line">    failover@firewall.loc</span><br><span class="line">    sysadmin@firewall.loc</span><br><span class="line">  &#125;</span><br><span class="line">  notification_email_from Alexandre.Cassen@firewall.loc   #指明报警邮件的发送地址</span><br><span class="line">  smtp_server 192.168.200.1    #邮件服务器地址</span><br><span class="line">  smtp_connect_timeout 30      #smtp的超时时间</span><br><span class="line">  router_id LVS_DEVEL          #物理服务器的主机名</span><br><span class="line">  vrrp_mcast_group4            #定义一个组播地址</span><br><span class="line">  static_ipaddress</span><br><span class="line">       &#123;</span><br><span class="line">       192.168.1.1&#x2F;24 dev eth0 scope global</span><br><span class="line">       &#125;</span><br><span class="line">       static_routes</span><br><span class="line">       &#123;</span><br><span class="line">       192.168.2.0&#x2F;24 via 192.168.1.100 dev eth0</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">   vrrp_sync_group VG_1 &#123;              #定义一个故障组，组内有一个虚拟路由出现故障另一个也会一起跟着转移，适用于LVS的NAT模型。</span><br><span class="line">       group &#123;</span><br><span class="line">           VI1     # name of vrrp_instance (below)        </span><br><span class="line">           VI2     # One for each moveable IP</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">vrrp_instance VI_1 &#123;        #定义一个虚拟路由</span><br><span class="line">   state MASTER|BACKUP     #当前节点在此虚拟路由器上的初始状态；只能有一个是MASTER，余下的都应该为BACKUP；</span><br><span class="line">   interface eth0          #绑定为当前虚拟路由器使用的物理接口；</span><br><span class="line">   virtual_router_id 51    #当前虚拟路由器的惟一标识，范围是0-255；</span><br><span class="line">   priority 100            #当前主机在此虚拟路径器中的优先级；范围1-254；</span><br><span class="line">   advert_int 1            #通告发送间隔，包含主机优先级、心跳等。</span><br><span class="line">   authentication &#123;        #认证配置  </span><br><span class="line">       auth_type PASS      #认证类型，PASS表示简单字符串认证</span><br><span class="line">       auth_pass 1111      #密码,PASS密码最长为8位</span><br><span class="line"></span><br><span class="line">  virtual_ipaddress &#123;</span><br><span class="line">   192.168.200.16          #虚拟路由IP地址，以辅助地址方式设置</span><br><span class="line">   192.168.200.18&#x2F;24 dev eth2 label eth2:1 #以别名的方式设置</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">track_interface &#123;</span><br><span class="line">       eth0</span><br><span class="line">       eth1</span><br><span class="line"></span><br><span class="line">&#125;                           #配置要监控的网络接口，一旦接口出现故障，则转为FAULT状态；</span><br><span class="line">nopreempt                   #定义工作模式为非抢占模式；</span><br><span class="line">preempt_delay 300           #抢占式模式下，节点上线后触发新选举操作的延迟时长；</span><br><span class="line">  virtual_routes &#123;         #配置路由信息，可选项</span><br><span class="line">              #  src &lt;IPADDR&gt; [to] &lt;IPADDR&gt;&#x2F;&lt;MASK&gt; via|gw &lt;IPADDR&gt; [or &lt;IPADDR&gt;] dev &lt;STRING&gt; scope</span><br><span class="line">      &lt;SCOPE&gt; tab</span><br><span class="line">              src 192.168.100.1 to 192.168.109.0&#x2F;24 via 192.168.200.254 dev eth1</span><br><span class="line">              192.168.112.0&#x2F;24 via 192.168.100.254       192.168.113.0&#x2F;24  via  192.168.200.254  or 192.168.100.254 dev eth1      blackhole 192.168.114.0&#x2F;24</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   notify_master &lt;STRING&gt;|&lt;QUOTED-STRING&gt;       #当前节点成为主节点时触发的脚本。</span><br><span class="line">   notify_backup &lt;STRING&gt;|&lt;QUOTED-STRING&gt;       #当前节点转为备节点时触发的脚本。</span><br><span class="line">   notify_fault &lt;STRING&gt;|&lt;QUOTED-STRING&gt;        #当前节点转为&quot;失败&quot;状态时触发的脚本。</span><br><span class="line">   notify &lt;STRING&gt;|&lt;QUOTED-STRING&gt;              #通用格式的通知触发机制，一个脚本可完成以上三种状态的转换时的通知。</span><br><span class="line">   smtp_alert                                   #如果加入这个选项，将调用前面设置的邮件设置，并自动根据状态发送信息</span><br><span class="line">&#125;</span><br><span class="line">virtual_server 192.168.200.100 443 &#123;    #LVS配置段 ，设置LVS的VIP地址和端口</span><br><span class="line">   delay_loop                          #服务轮询的时间间隔；检测RS服务器的状态。</span><br><span class="line">   lb_algo rr                          #调度算法，可选rr|wrr|lc|wlc|lblc|sh|dh。</span><br><span class="line">   lb_kind NAT                         #集群类型。</span><br><span class="line">   nat_mask 255.255.255.0              #子网掩码，可选项。</span><br><span class="line">   persistence_timeout 50              #是否启用持久连接，连接保存时长</span><br><span class="line">   protocol TCP                        #协议，只支持TCP</span><br><span class="line">   sorry_server &lt;IPADDR&gt; &lt;PORT&gt;        #备用服务器地址，可选项。</span><br><span class="line"></span><br><span class="line">   real_server 192.168.201.100 443 &#123;   #配置RS服务器的地址和端口</span><br><span class="line">       weight 1                        #权重</span><br><span class="line">    SSL_GET &#123;                          #检测RS服务器的状态，发送请求报文</span><br><span class="line">           url &#123;</span><br><span class="line">             path &#x2F;                    #请求的URL</span><br><span class="line">             digest ff20ad2481f97b1754ef3e12ecd3a9cc  #对请求的页面进行hash运算，然后和这个hash码进行比对，如果hash码一样就表示状态正常</span><br><span class="line">             status_code &lt;INT&gt;         #判断上述检测机制为健康状态的响应码,和digest二选一即可。</span><br><span class="line"></span><br><span class="line">           &#125;                           #这个hash码可以使用genhash命令请求这个页面生成</span><br><span class="line">           connect_timeout 3           #连接超时时间</span><br><span class="line">           nb_get_retry 3              #超时重试次数</span><br><span class="line">           delay_before_retry 3        #每次超时过后多久再进行连接</span><br><span class="line">           connect_ip &lt;IP ADDRESS&gt;     #向当前RS的哪个IP地址发起健康状态检测请求</span><br><span class="line">           connect_port &lt;PORT&gt;         #向当前RS的哪个PORT发起健康状态检测请求</span><br><span class="line">           bindto &lt;IP ADDRESS&gt;         #发出健康状态检测请求时使用的源地址；</span><br><span class="line">           bind_port &lt;PORT&gt;            #发出健康状态检测请求时使用的源端口；</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
     <!-- 相关文章推荐 -->
    
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://huyunshun.com/2017/04/21/nginx%E5%AE%9E%E7%8E%B0%E4%BB%A3%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="初晨">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://img.huyunshun.com/img/20200522182348.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="简">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/04/21/nginx%E5%AE%9E%E7%8E%B0%E4%BB%A3%E7%90%86/" itemprop="url">nginx使用和实现代理</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-21T00:00:00+08:00">
                2017-04-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/nginx/" itemprop="url" rel="index">
                    <span itemprop="name">nginx</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="一、Nginx环境搭建"><a href="#一、Nginx环境搭建" class="headerlink" title="一、Nginx环境搭建"></a>一、Nginx环境搭建</h2><h3 id="1、下载-nginx-1-8-1-tar-gz"><a href="#1、下载-nginx-1-8-1-tar-gz" class="headerlink" title="1、下载  nginx-1.8.1.tar.gz"></a>1、下载  nginx-1.8.1.tar.gz</h3><p>通过wget命令下载Nginx包，或者在Windows下载后拷贝到Linux中。<br>wget <a href="http://nginx.org/download/nginx-1.8.1.tar.gz" target="_blank" rel="noopener">http://nginx.org/download/nginx-1.8.1.tar.gz</a></p>
<h3 id="2、解压到-usr-local"><a href="#2、解压到-usr-local" class="headerlink" title="2、解压到/usr/local/"></a>2、解压到/usr/local/</h3><p>tar -zxvf nginx-1.8.1.tar.gz -C /usr/local/</p>
<h3 id="3、下载Nginx编译需要的4个依赖库"><a href="#3、下载Nginx编译需要的4个依赖库" class="headerlink" title="3、下载Nginx编译需要的4个依赖库"></a>3、下载Nginx编译需要的4个依赖库</h3><p>yum install pcre/yum install pcre-devel/yum install zlib/yum install zlib-devel</p>
<h3 id="4、配置configure检查是否报错"><a href="#4、配置configure检查是否报错" class="headerlink" title="4、配置configure检查是否报错"></a>4、配置configure检查是否报错</h3><p>cd nginx-1.8.1 &amp;&amp; ./configure –prefix=/usr/local/nginx</p>
<h3 id="5、编译安装make-amp-amp-make-install"><a href="#5、编译安装make-amp-amp-make-install" class="headerlink" title="5、编译安装make &amp;&amp; make install"></a>5、编译安装make &amp;&amp; make install</h3><pre><code>编译安装完成后，在/usr/local/nginx/下有四个目录；
conf  html  logs  sbin
conf  配置文件
html  网页文件
logs  日志记录
sbin   主要的二进制程序</code></pre><h3 id="6、启动"><a href="#6、启动" class="headerlink" title="6、启动"></a>6、启动</h3><pre><code>两种方式启动/停止/重启：
[root@localhost sbin]# /usr/local/nginx/sbin/nginx
[root@localhost sbin]# /usr/local/nginx/sbin/nginx -s stop
[root@localhost sbin]# /usr/local/nginx/sbin/nginx -s reload
或 ：
[root@localhost sbin]# ./nginx
[root@localhost sbin]# ./nginx -s stop
[root@localhost sbin]# ./nginx -s reload

查看进程是否启动：
[root@localhost sbin]# ps -ef | grep nginx
root       5277      1  0 11:32 ?        00:00:00 nginx: master process /usr/local/nginx/sbin/nginx
nobody     5280   5277  0 11:33 ?        00:00:00 nginx: worker process      
root       5290   2660  0 11:43 pts/0    00:00:00 grep nginx

启动看端口：
[root@localhost sbin]# lsof -i:80
COMMAND  PID   USER   FD   TYPE DEVICE SIZE/OFF NODE NAME
nginx   5264   root    6u  IPv4  27214      0t0  TCP *:http (LISTEN)
nginx   5265 nobody    6u  IPv4  27214      0t0  TCP *:http (LISTEN)

发现浏览器访问不了，设置防火墙开放80端口
[root@localhost sbin]# vim /etc/sysconfig/iptables
[root@localhost sbin]# service iptables restart
iptables: Setting chains to policy ACCEPT: filter          [  OK  ]
iptables: Flushing firewall rules:                         [  OK  ]
iptables: Unloading modules:                               [  OK  ]
iptables: Applying firewall rules:                         [  OK  ]</code></pre><p>再次访问，ok</p>
<h2 id="二、虚拟主机配置"><a href="#二、虚拟主机配置" class="headerlink" title="二、虚拟主机配置"></a>二、虚拟主机配置</h2><p>比如在nginx.conf中新增一个server：<br>   server {<br>       listen 81;<br>       server_name hu.com;</p>
<pre><code>location / {
    root hu.com;
    index index.html;
}
access_log logs/hu.com.access.log main;
#添加日志文件
}</code></pre><p>保存后重启Nginx</p>
<p>本机设置下hosts：<br>192.168.18.138 hu.com</p>
<p>测试，OK</p>
<h2 id="三、日志处理"><a href="#三、日志处理" class="headerlink" title="三、日志处理"></a>三、日志处理</h2><p>nginx下的logs是日志目录。</p>
<pre><code>access.log  error.log  hu.com.access.log  nginx.pid
nginx.pid是Nginx运行进程日志。</code></pre><p>开启日志格式：</p>
<pre><code>log_format  main  &apos;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &apos;
                 &apos;$status $body_bytes_sent &quot;$http_referer&quot; &apos;
                 &apos;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&apos;;</code></pre><p>为每个虚拟服务设置日志：</p>
<pre><code>server {
    listen       80;
    server_name  localhost;
    location / {
        root   html;
        index  index.html index.htm;
    }
    access_log  logs/access.log  main;
}
    server {
        listen 81;
        server_name hu.com;
        location / {
            root hu.com;
            index index.html;
        }</code></pre><p>access_log  logs/hu.com.access.log  main;#81的日志</p>
<h2 id="四、日志切分备份"><a href="#四、日志切分备份" class="headerlink" title="四、日志切分备份"></a>四、日志切分备份</h2><p>日常中，要对日志分析处理，通常由运维去进行对日志的切割分析，比如实现一个定时任务去处理Nginx日志。</p>
<p>日志切分用shell脚本（log.sh放到sbin中）：</p>
<pre><code>#!/bin/sh
#定义变量，当前Nginx目录
BASE_DIR=/usr/local/nginx
#文件名
BASE_FILE_NAME=access.log
#日志目录
CURRENT_PATH=$BASE_DIR/logs
#备份目录
BAK_PATH=$BASE_DIR/datalogs

#需要备份的文件名和路径
CURRENT_FILE=$CURRENT_PATH/$BASE_FILE_NAME

BAK_TIME=`/bin/date -d yesterday +%Y%m%d%H%M`
BAK_FILE=$BAK_PATH/$BAK_TIME-$BASE_FILE_NAME
echo $BAK_FILE #备份文件名和路径

#停了Nginx
$BASE_DIR/sbin/nginx -s stop
#移动文件
mv $CURRENT_FILE $BAK_FILE
#启动Nginx
$BASE_DIR/sbin/nginx</code></pre><p>赋权：给文件权限</p>
<pre><code>root@localhost sbin]# chmod 777 log.sh
[root@localhost sbin]# ll
total 3184
-rwxrwxrwx. 1 root root     521 Feb 17 13:52 log.sh
-rwxr-xr-x. 1 root root 3254901 Feb 17 10:39 nginx</code></pre><p>定时任务对脚本进行定时调度：</p>
<pre><code>crontab -e
使用crontab你可以在指定的时间执行一个shell脚本或者一系列Linux命令。
使用crontab把下面的代码加进去
*/1 * * * * sh /usr/local/nginx/sbin/log.sh
这是一分钟执行一次脚本。</code></pre><p>可以看到备份文件已经生成</p>
<pre><code>[root@localhost nginx]# ll datalogs/
total 8
-rw-r--r--. 1 root root  592 Feb 17 13:30 201902161401-access.log
-rw-r--r--. 1 root root 1504 Feb 17 14:01 201902161402-access.log</code></pre><h2 id="五、反向代理"><a href="#五、反向代理" class="headerlink" title="五、反向代理"></a>五、反向代理</h2><p><img src="https://img.huyunshun.com/img/20200421123057.png" alt="20200421123057"></p>
<p>比如配置Nginx在访问有.jsp文件时转到Tomcat，其他在本机访问。配置如下；</p>
<pre><code>server {
listen       80;
server_name  localhost;
location / {
    root   html;
    index  index.html index.htm;
}
#配置反向代理tomcat服务器：拦截.jsp结尾的请求转向到tomcat
location ~ \.jsp$ {
    proxy_pass http://192.168.18.138:8080;
}
access_log  logs/access.log  main;</code></pre><p>创建一个jsp文件，写入内容：</p>
<pre><code>&lt;body&gt;
Test1 Page!!!&lt;br/&gt;
remote ip :  &lt;%=request.getHeader(&quot;X-real-ip&quot;) %&gt; &lt;br/&gt;
nginx server ip : &lt;%=request.getRemoteAddr()%&gt;
&lt;/body&gt;</code></pre><p>测试：</p>
<p>访问：<a href="http://192.168.18.138/" target="_blank" rel="noopener">http://192.168.18.138/</a></p>
<p>访问：<a href="http://192.168.18.138/test.jsp" target="_blank" rel="noopener">http://192.168.18.138/test.jsp</a></p>
<p>发现ip并不是客户端ip地址，这是因为，请求Nginx后，由于jsp文件Nginx会去Tomcat服务请求在发回客户端。所以当Tomcat接收请求时接收到的是Nginx的ip，并不是客户端请求IP。</p>
<p>解决方式在配置Nginx中相关处做如下处理：</p>
<pre><code>location ~ \.jsp$ {
    #设置客户端真实ip地址
    #proxy_set_header X-real-ip $remote_addr;
    proxy_pass http://192.168.18.138:8080;
}</code></pre><p>再次测试：<br>访问：<a href="http://192.168.18.138/test.jsp" target="_blank" rel="noopener">http://192.168.18.138/test.jsp</a></p>
<p>得到客户端IP，OK！！</p>
<h2 id="六、负载均衡"><a href="#六、负载均衡" class="headerlink" title="六、负载均衡"></a>六、负载均衡</h2><p>负载均衡主要通过配置upstream来实现</p>
<pre><code>#设定负载均衡的服务器列表
#upstream myproject {
        #weigth参数表示权值，权值越高被分配到的几率越大
        #max_fails 当有#max_fails个请求失败，就表示后端的服务器不可用，默认为1，将其设置为0可以关闭检查（允许请求失败的次数）
        #fail_timeout 在以后的#fail_timeout时间内nginx不会再把请求发往已检查出标记为不可用的服务器
#}</code></pre><p>状态有:</p>
<pre><code>（1）down：表示单前的server暂时不参与负载
（2）weight：权重，默认为1， weight越大，负载的权重就越大。
（3）max_fails：允许请求失败的次数默认为1。当超过最大次数时，返回proxy_next_upstream 模块定义的错误。
（4）fail_timeout：max_fails次失败后，暂停的时间。
（5）backup：备用服务器, 其它所有的非backup机器down或者忙的时候，请求backup机器，所以这台机器压力会最轻。</code></pre><p>upstream四中配置方式：</p>
<h4 id="1、轮询-weight-最普通方式"><a href="#1、轮询-weight-最普通方式" class="headerlink" title="1、轮询(weight) 最普通方式"></a>1、轮询(weight) 最普通方式</h4><p>指定轮询几率，weight和访问比率成正比，用于后端服务器性能不均的情况。默认当weight不指定时，各服务器weight相同，每个请求按时间顺序逐一分配到不同的后端服务器，如果后端服务器down掉，能自动剔除。<br>upstream bakend {<br>   server 192.168.1.10 weight=1 max_fails=2 fail_timeout=30s;<br>   server 192.168.1.11 weight=1 max_fails=2 fail_timeout=30s<br>}</p>
<h4 id="2、ip-hash"><a href="#2、ip-hash" class="headerlink" title="2、ip_hash"></a>2、ip_hash</h4><p>每个请求按访问ip的hash结果分配，这样每个访客固定访问一个后端服务器，可以解决session不能跨服务器的问题。如果后端服务器down掉，要手工down掉。</p>
<pre><code>upstream resinserver{
ip_hash;
server 192.168.1.10:8080;
server 192.168.1.11:8080;
}</code></pre><h4 id="3、fair（第三方插件）"><a href="#3、fair（第三方插件）" class="headerlink" title="3、fair（第三方插件）"></a>3、fair（第三方插件）</h4><p>按后端服务器的响应时间来分配请求，响应时间短的优先分配。</p>
<pre><code>upstream resinserver{
server 192.168.1.10:8080;
server 192.168.1.11:8080;
fair;
}</code></pre><h4 id="4、url-hash（第三方插件）"><a href="#4、url-hash（第三方插件）" class="headerlink" title="4、url_hash（第三方插件）"></a>4、url_hash（第三方插件）</h4><p>按访问url的hash结果来分配请求，使每个url定向到同一个后端服务器，后端服务器为缓存服务器时比较有效。 在upstream中加入hash语句，hash_method是使用的hash算法。</p>
<pre><code>upstream resinserver{
server 192.168.1.10:8080;
server 192.168.1.11:8080;
hash $request_uri;
hash_method crc32;
}</code></pre><p>注意，当upstream中只有一个 server 时，max_fails 和 fail_timeout 参数可能不会起作用。</p>
<p>weight\backup 不能和 ip_hash 关键字一起使用。 最后在需要使用负载均衡的server中增加proxy_pass <a href="http://tel_img_stream/，对应upstream的名字。" target="_blank" rel="noopener">http://tel_img_stream/，对应upstream的名字。</a></p>
<p>例子，负载均衡配置如下：</p>
<pre><code>upstream myapp {
        server 192.168.18.138:8080 weight=1 max_fails=2 fail_timeout=30s;  
        server 192.168.18.139:8080 weight=1 max_fails=2 fail_timeout=30s;
}

server {
#.........................
    location ~ \.jsp$ {
        #设置客户端真实ip地址
        proxy_set_header X-real-ip $remote_addr;
        proxy_pass http://myapp;
    }</code></pre><p>把上面使用的test.jsp拷贝到139的Tomcat，各自单独测试如下：</p>
<p><img src="https://img.huyunshun.com/img/20200421123613.png" alt="20200421123613"></p>
<p>使用负载均衡测试如下：</p>
<p><img src="https://img.huyunshun.com/img/20200421123625.png" alt="20200421123625"></p>
<p><img src="https://img.huyunshun.com/img/20200421123716.png" alt="20200421123716"></p>
<p>四次测试，两个Tomcat交替代理，因为weight=1设置的权重都一样，公平出现。</p>
<h2 id="七、nginx-conf配置详解"><a href="#七、nginx-conf配置详解" class="headerlink" title="七、nginx.conf配置详解"></a>七、nginx.conf配置详解</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br></pre></td><td class="code"><pre><span class="line">#user  nobody;</span><br><span class="line">#开启进程数数</span><br><span class="line">worker_processes  1;</span><br><span class="line">#错误日志保存位置</span><br><span class="line">#error_log  logs&#x2F;error.log;</span><br><span class="line">#error_log  logs&#x2F;error.log  notice;</span><br><span class="line">#error_log  logs&#x2F;error.log  info;</span><br><span class="line">#进程号保存文件</span><br><span class="line">#pid        logs&#x2F;nginx.pid;</span><br><span class="line">#每个进程最大连接数（最大连接&#x3D;连接数x进程数）每个worker允许同时产生多少个链接，默认1024</span><br><span class="line">events &#123;</span><br><span class="line">   worker_connections  1024;</span><br><span class="line">&#125;</span><br><span class="line">http &#123;</span><br><span class="line">       #文件扩展名与文件类型映射表</span><br><span class="line">   include       mime.types;</span><br><span class="line">       #默认文件类型</span><br><span class="line">   default_type  application&#x2F;octet-stream;</span><br><span class="line">       #日志文件输出格式 这个位置相于全局设置</span><br><span class="line">   log_format  main  &#39;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#39;</span><br><span class="line">                     &#39;$status $body_bytes_sent &quot;$http_referer&quot; &#39;</span><br><span class="line">                     &#39;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#39;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">       #请求日志保存位置</span><br><span class="line">   #access_log  logs&#x2F;access.log  main;</span><br><span class="line">       </span><br><span class="line">       #打开发送文件</span><br><span class="line">   sendfile        on;</span><br><span class="line">   #tcp_nopush     on;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   #keepalive_timeout  0;</span><br><span class="line">       #连接超时时间</span><br><span class="line">   keepalive_timeout  65;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">       #打开gzip压缩</span><br><span class="line">   #gzip  on;</span><br><span class="line">       </span><br><span class="line">       #设定请求缓冲</span><br><span class="line">       #client_header_buffer_size</span><br><span class="line">       #large_client_header_buffers</span><br><span class="line">       </span><br><span class="line">       #设定负载均衡的服务器列表</span><br><span class="line">       #upstream myproject &#123;</span><br><span class="line">               #weigth参数表示权值，权值越高被分配到的几率越大</span><br><span class="line">               #max_fails 当有#max_fails个请求失败，就表示后端的服务器不可用，默认为1，将其设置为0可以关闭检查</span><br><span class="line">               #fail_timeout 在以后的#fail_timeout时间内nginx不会再把请求发往已检查出标记为不可用的服务器</span><br><span class="line">       #&#125;</span><br><span class="line">       </span><br><span class="line">   #webapp</span><br><span class="line">   #upstream myapp &#123;  </span><br><span class="line">         # server 192.168.1.171:8080 weight&#x3D;1 max_fails&#x3D;2 fail_timeout&#x3D;30s;  </span><br><span class="line">       # server 192.168.1.172:8080 weight&#x3D;1 max_fails&#x3D;2 fail_timeout&#x3D;30s;  </span><br><span class="line">   #&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">       #配置虚拟主机，基于域名、ip和端口</span><br><span class="line">   server &#123;</span><br><span class="line">               #监听端口</span><br><span class="line">       listen       80;</span><br><span class="line">               #监听域名</span><br><span class="line">       server_name  localhost;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">       #charset koi8-r;</span><br><span class="line">               </span><br><span class="line">               #nginx访问日志放在logs&#x2F;host.access.log下，并且使用main格式（还可以自定义格式）</span><br><span class="line">       #access_log  logs&#x2F;host.access.log  main;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">               #返回的相应文件地址</span><br><span class="line">       location &#x2F; &#123;</span><br><span class="line">           #设置客户端真实ip地址</span><br><span class="line">           #proxy_set_header X-real-ip $remote_addr;                </span><br><span class="line">                       #负载均衡反向代理</span><br><span class="line">                       #proxy_pass http:&#x2F;&#x2F;myapp;</span><br><span class="line">                       </span><br><span class="line">                       #返回根路径地址（相对路径:相对于&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;）</span><br><span class="line">           root   html;</span><br><span class="line">                       #默认访问文件</span><br><span class="line">           index  index.html index.htm;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">               #配置反向代理tomcat服务器：拦截.jsp结尾的请求转向到tomcat</span><br><span class="line">       #location ~ \.jsp$ &#123;</span><br><span class="line">       #    proxy_pass http:&#x2F;&#x2F;192.168.1.171:8080;</span><br><span class="line">       #&#125;                </span><br><span class="line">               </span><br><span class="line">       #error_page  404              &#x2F;404.html;</span><br><span class="line">       # redirect server error pages to the static page &#x2F;50x.html</span><br><span class="line">       #</span><br><span class="line">               </span><br><span class="line">               #错误页面及其返回地址</span><br><span class="line">       error_page   500 502 503 504  &#x2F;50x.html;</span><br><span class="line">       location &#x3D; &#x2F;50x.html &#123;</span><br><span class="line">           root   html;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">       # proxy the PHP scripts to Apache listening on 127.0.0.1:80</span><br><span class="line">       #</span><br><span class="line">       #location ~ \.php$ &#123;</span><br><span class="line">       #    proxy_pass   http:&#x2F;&#x2F;127.0.0.1;</span><br><span class="line">       #&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">       # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000</span><br><span class="line">       #</span><br><span class="line">       #location ~ \.php$ &#123;</span><br><span class="line">       #    root           html;</span><br><span class="line">       #    fastcgi_pass   127.0.0.1:9000;</span><br><span class="line">       #    fastcgi_index  index.php;</span><br><span class="line">       #    fastcgi_param  SCRIPT_FILENAME  &#x2F;scripts$fastcgi_script_name;</span><br><span class="line">       #    include        fastcgi_params;</span><br><span class="line">       #&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">       # deny access to .htaccess files, if Apache&#39;s document root</span><br><span class="line">       # concurs with nginx&#39;s one</span><br><span class="line">       #</span><br><span class="line">       #location ~ &#x2F;\.ht &#123;</span><br><span class="line">       #    deny  all;</span><br><span class="line">       #&#125;</span><br><span class="line">   &#125;</span><br><span class="line">       </span><br><span class="line">       #虚拟主机配置：</span><br><span class="line">       server &#123;</span><br><span class="line">               listen 1234;</span><br><span class="line">               server_name bhz.com;</span><br><span class="line">               location &#x2F; &#123;</span><br><span class="line">               #正则表达式匹配uri方式：在&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;bhz.com下 建立一个test123.html 然后使用正则匹配</span><br><span class="line">               #location ~ test &#123;</span><br><span class="line">                       ## 重写语法：if return （条件 &#x3D; ~ ~*）</span><br><span class="line">                       #if ($remote_addr &#x3D; 192.168.1.200) &#123;</span><br><span class="line">                       #       return 401;</span><br><span class="line">                       #&#125;                </span><br><span class="line">                       </span><br><span class="line">                       #if ($http_user_agent ~* firefox) &#123;</span><br><span class="line">                       #           rewrite ^.*$ &#x2F;firefox.html;</span><br><span class="line">                       #           break;</span><br><span class="line">                       #&#125;                        </span><br><span class="line">                                               </span><br><span class="line">                       root bhz.com;</span><br><span class="line">                       index index.html;</span><br><span class="line">               &#125;</span><br><span class="line">               </span><br><span class="line">               #location &#x2F;goods &#123;</span><br><span class="line">               #                rewrite &quot;goods-(\d&#123;1,5&#125;)\.html&quot; &#x2F;goods-ctrl.html;</span><br><span class="line">               #                root bhz.com;</span><br><span class="line">               #                index index.html;</span><br><span class="line">               #&#125;</span><br><span class="line">               </span><br><span class="line">               #配置访问日志</span><br><span class="line">               access_log logs&#x2F;bhz.com.access.log main;</span><br><span class="line">       &#125;</span><br><span class="line">       </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   # another virtual host using mix of IP-, name-, and port-based configuration</span><br><span class="line">   #</span><br><span class="line">   #server &#123;</span><br><span class="line">   #    listen       8000;</span><br><span class="line">   #    listen       somename:8080;</span><br><span class="line">   #    server_name  somename  alias  another.alias;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   #    location &#x2F; &#123;</span><br><span class="line">   #        root   html;</span><br><span class="line">   #        index  index.html index.htm;</span><br><span class="line">   #    &#125;</span><br><span class="line">   #&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   # HTTPS server</span><br><span class="line">   #</span><br><span class="line">   #server &#123;</span><br><span class="line">   #    listen       443 ssl;</span><br><span class="line">   #    server_name  localhost;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   #    ssl_certificate      cert.pem;</span><br><span class="line">   #    ssl_certificate_key  cert.key;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   #    ssl_session_cache    shared:SSL:1m;</span><br><span class="line">   #    ssl_session_timeout  5m;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   #    ssl_ciphers  HIGH:!aNULL:!MD5;</span><br><span class="line">   #    ssl_prefer_server_ciphers  on;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   #    location &#x2F; &#123;</span><br><span class="line">   #        root   html;</span><br><span class="line">   #        index  index.html index.htm;</span><br><span class="line">   #    &#125;</span><br><span class="line">   #&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="八、使用keepalived-Nginx配置实现负载均衡。"><a href="#八、使用keepalived-Nginx配置实现负载均衡。" class="headerlink" title="八、使用keepalived+Nginx配置实现负载均衡。"></a>八、使用keepalived+Nginx配置实现负载均衡。</h2><p>详见：keepalived+Nginx配置实现负载均衡</p>

          
        
      
    </div>
     <!-- 相关文章推荐 -->
    
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://huyunshun.com/2017/04/13/ActiveMQ%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="初晨">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://img.huyunshun.com/img/20200522182348.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="简">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/04/13/ActiveMQ%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE/" itemprop="url">ActiveMQ安装配置及其简单使用</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-13T11:22:49+08:00">
                2017-04-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java/" itemprop="url" rel="index">
                    <span itemprop="name">java</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="ActiveMQ在windows上安装配置"><a href="#ActiveMQ在windows上安装配置" class="headerlink" title="ActiveMQ在windows上安装配置"></a>ActiveMQ在windows上安装配置</h2><p>1、安装 下载地址：<a href="http://activemq.apache.org/download.html" target="_blank" rel="noopener">http://activemq.apache.org/download.html</a></p>
<p>2、配置（conf目录下）</p>
<pre><code>修改账号密码
credentials.properties
credentials-enc.properties
可以配置用户名密码
activemq.username=system
activemq.password=manager
guest.password=password</code></pre><p>开启jmx监控</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">activemq.xml中进行如下修改</span><br><span class="line">       &lt;managementContext&gt;</span><br><span class="line">           &lt;managementContext createConnector&#x3D;&quot;true&quot;&#x2F;&gt;</span><br><span class="line">       &lt;&#x2F;managementContext&gt;</span><br></pre></td></tr></table></figure>
<p>注：这里的配置不是必须，根据需要自行配置</p>
<p>3、启动运行</p>
<p>cmd，bin目录下：activemq.bat start</p>
<p>4、浏览</p>
<p>浏览器中：<a href="http://localhost:8161/admin/index.jsp" target="_blank" rel="noopener">http://localhost:8161/admin/index.jsp</a></p>
<p>用户名，密码在：jetty-realm.properties中设置</p>
<p><img src="https://img.huyunshun.com/img/20200413113806.png" alt="20200413113806"></p>
<h2 id="ActiveMQ在Linux上安装配置"><a href="#ActiveMQ在Linux上安装配置" class="headerlink" title="ActiveMQ在Linux上安装配置"></a>ActiveMQ在Linux上安装配置</h2><p>1、下载软件，拷贝到Linux目录/usr/local</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost local]# ll</span><br><span class="line">总用量 65912</span><br><span class="line">-rw-r--r--. 1 root root 58588039 4月  14 20:50 apache-activemq-5.15.9-bin.tar.gz</span><br></pre></td></tr></table></figure>
<p>2、解压安装</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost local]# tar -zxf apache-activemq-5.15.9-bin.tar.gz</span><br><span class="line">[root@localhost local]# ll</span><br><span class="line">drwxr-xr-x. 10 root root      193 3月  15 20:04 apache-activemq-5.15.9</span><br></pre></td></tr></table></figure>
<p>3、安全配置</p>
<pre><code>开启jmx监控：
activemq.xml中进行如下修改
    &lt;managementContext&gt;
        &lt;managementContext createConnector=&quot;true&quot;/&gt;
    &lt;/managementContext&gt;
注：这里的配置不是必须，根据需要自行配置</code></pre><p>配置用户：[root@localhost apache-activemq-5.15.9]# ./bin/activemq</p>
<h2 id="基于Tomcat-JNDI-ActiveMQ实现JMS的点对点消息传送"><a href="#基于Tomcat-JNDI-ActiveMQ实现JMS的点对点消息传送" class="headerlink" title="基于Tomcat + JNDI + ActiveMQ实现JMS的点对点消息传送"></a>基于Tomcat + JNDI + ActiveMQ实现JMS的点对点消息传送</h2><p>写了一个简单的JMS例子，之所以使用JNDI 是出于通用性考虑，该例子使用JMS规范提供的通用接口，没有使用具体JMS提供者的接口，这样可以保证我们编写的程序适用于任何一种JMS实现(ActiveMQ、HornetQ…)。</p>
<p>JNDI(Java Naming and Directory Interface)是一个标准规范，类似于JDBC，JMS等规范，为开发人员提供了查找和访问各种命名和目录服务的通用、统一的接口。J2EE 规范要求所有 J2EE 容器都要提供 JNDI 规范的实现，因此Tomcat就实现了JNDI 规范。</p>
<h3 id="使用Tomcat配置JNDI"><a href="#使用Tomcat配置JNDI" class="headerlink" title="使用Tomcat配置JNDI"></a>使用Tomcat配置JNDI</h3><p>Tomcat安装路径下的conf文件夹，打开context.xml，作如下配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置JNDI start--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">Resource</span> <span class="attr">name</span>=<span class="string">"queue/connectionFactory"</span>    </span></span><br><span class="line"><span class="tag">               <span class="attr">auth</span>=<span class="string">"Container"</span>    </span></span><br><span class="line"><span class="tag">               <span class="attr">type</span>=<span class="string">"org.apache.activemq.ActiveMQConnectionFactory"</span>  </span></span><br><span class="line"><span class="tag">               <span class="attr">description</span>=<span class="string">"JMS Connection Factory"</span>  </span></span><br><span class="line"><span class="tag">               <span class="attr">factory</span>=<span class="string">"org.apache.activemq.jndi.JNDIReferenceFactory"</span>  </span></span><br><span class="line"><span class="tag">               <span class="attr">brokerURL</span>=<span class="string">"tcp://localhost:61616"</span>  </span></span><br><span class="line"><span class="tag">               <span class="attr">brokerName</span>=<span class="string">"LocalActiveMQBroker"</span> /&gt;</span>  </span><br><span class="line">                 </span><br><span class="line">       <span class="tag">&lt;<span class="name">Resource</span> <span class="attr">name</span>=<span class="string">"queue/queue0"</span>    </span></span><br><span class="line"><span class="tag">               <span class="attr">auth</span>=<span class="string">"Container"</span>    </span></span><br><span class="line"><span class="tag">               <span class="attr">type</span>=<span class="string">"org.apache.activemq.command.ActiveMQQueue"</span>  </span></span><br><span class="line"><span class="tag">               <span class="attr">description</span>=<span class="string">"My Test Queue"</span>  </span></span><br><span class="line"><span class="tag">               <span class="attr">factory</span>=<span class="string">"org.apache.activemq.jndi.JNDIReferenceFactory"</span>  </span></span><br><span class="line"><span class="tag">               <span class="attr">physicalName</span>=<span class="string">"TomcatQueue"</span> /&gt;</span></span><br><span class="line">       <span class="comment">&lt;!-- 配置JNDI end--&gt;</span></span><br></pre></td></tr></table></figure>
<p>但是，一般不建议直接更改Tomcat的全局配置，在web项目下的WebContent/META-INF 里创建context.xml在里面配置。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Context</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">Resource</span> <span class="attr">name</span>=<span class="string">"queue/connectionFactory"</span>    </span></span><br><span class="line"><span class="tag">               <span class="attr">auth</span>=<span class="string">"Container"</span>    </span></span><br><span class="line"><span class="tag">               <span class="attr">type</span>=<span class="string">"org.apache.activemq.ActiveMQConnectionFactory"</span>  </span></span><br><span class="line"><span class="tag">               <span class="attr">description</span>=<span class="string">"JMS Connection Factory"</span>  </span></span><br><span class="line"><span class="tag">               <span class="attr">factory</span>=<span class="string">"org.apache.activemq.jndi.JNDIReferenceFactory"</span>  </span></span><br><span class="line"><span class="tag">               <span class="attr">brokerURL</span>=<span class="string">"tcp://localhost:61616"</span>  </span></span><br><span class="line"><span class="tag">               <span class="attr">brokerName</span>=<span class="string">"LocalActiveMQBroker"</span> /&gt;</span>  </span><br><span class="line">                 </span><br><span class="line">       <span class="tag">&lt;<span class="name">Resource</span> <span class="attr">name</span>=<span class="string">"queue/queue0"</span>    </span></span><br><span class="line"><span class="tag">               <span class="attr">auth</span>=<span class="string">"Container"</span>    </span></span><br><span class="line"><span class="tag">               <span class="attr">type</span>=<span class="string">"org.apache.activemq.command.ActiveMQQueue"</span>  </span></span><br><span class="line"><span class="tag">               <span class="attr">description</span>=<span class="string">"My Test Queue"</span>  </span></span><br><span class="line"><span class="tag">               <span class="attr">factory</span>=<span class="string">"org.apache.activemq.jndi.JNDIReferenceFactory"</span>  </span></span><br><span class="line"><span class="tag">               <span class="attr">physicalName</span>=<span class="string">"TomcatQueue"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Context</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>创建web项目，建两个servlet</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet</span>(<span class="string">"/send"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Send</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">       <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">       <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">                       <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">               PrintWriter out = response.getWriter();</span><br><span class="line">               <span class="keyword">try</span> &#123;</span><br><span class="line">                       InitialContext context = <span class="keyword">new</span> InitialContext();</span><br><span class="line">                       Queue queue = (Queue) context.lookup(<span class="string">"java:comp/env/queue/queue0"</span>);</span><br><span class="line">                       QueueConnectionFactory conFactory = (QueueConnectionFactory) context.lookup(<span class="string">"java:comp/env/queue/connectionFactory"</span>);</span><br><span class="line">                       QueueConnection queConn = conFactory.createQueueConnection();</span><br><span class="line">                       QueueSession queSession = queConn.createQueueSession(<span class="keyword">false</span>, Session.DUPS_OK_ACKNOWLEDGE);</span><br><span class="line">                       QueueSender queSender = queSession.createSender(queue);</span><br><span class="line">                       queSender.setDeliveryMode(DeliveryMode.NON_PERSISTENT);</span><br><span class="line">                       <span class="comment">//发送消息</span></span><br><span class="line">                       TextMessage message = queSession.createTextMessage(<span class="string">"how are you  123"</span>);</span><br><span class="line">                       queSender.send(message);</span><br><span class="line">                       out.write(<span class="string">"send message: "</span> + message.getText());</span><br><span class="line">                       queConn.close();</span><br><span class="line">               &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                       e.printStackTrace();</span><br><span class="line">               &#125;</span><br><span class="line">       &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet</span>(<span class="string">"/receive"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Receive</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">       <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">       <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">                       <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">               PrintWriter out = response.getWriter();</span><br><span class="line">               response.setContentType(<span class="string">"text/html;charset=utf-8"</span>);</span><br><span class="line">               <span class="keyword">try</span> &#123;</span><br><span class="line">                       InitialContext context = <span class="keyword">new</span> InitialContext();</span><br><span class="line">                       Queue queue = (Queue) context.lookup(<span class="string">"java:comp/env/queue/queue0"</span>);</span><br><span class="line">                       QueueConnectionFactory conFactory = (QueueConnectionFactory) context.lookup(<span class="string">"java:comp/env/queue/connectionFactory"</span>);</span><br><span class="line"></span><br><span class="line">                       QueueConnection queConn = conFactory.createQueueConnection();</span><br><span class="line">                       QueueSession queSession = queConn.createQueueSession(<span class="keyword">false</span>, Session.AUTO_ACKNOWLEDGE);</span><br><span class="line">                       QueueReceiver queReceiver = queSession.createReceiver(queue);</span><br><span class="line">                       queConn.start();</span><br><span class="line">                       <span class="comment">//接收消息</span></span><br><span class="line">                       TextMessage message = (TextMessage) queReceiver.receive();</span><br><span class="line">                       out.write(<span class="string">"receive message: "</span> + message.getText());</span><br><span class="line">                       queConn.close();</span><br><span class="line">               &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                       e.printStackTrace();</span><br><span class="line">               &#125;</span><br><span class="line">       &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行web程序，访问发送端。</p>
<p><img src="https://img.huyunshun.com/img/20200413114353.png" alt="20200413114353"></p>
<h2 id="发布-订阅消息传送例子"><a href="#发布-订阅消息传送例子" class="headerlink" title="发布/订阅消息传送例子"></a>发布/订阅消息传送例子</h2><p>和上面相似，配置context.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">    <span class="tag">&lt;<span class="name">Resource</span> <span class="attr">name</span>=<span class="string">"topic/connectionFactory"</span> <span class="attr">auth</span>=<span class="string">"Container"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">type</span>=<span class="string">"org.apache.activemq.ActiveMQConnectionFactory"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">description</span>=<span class="string">"JMS Connection Factory"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">factory</span>=<span class="string">"org.apache.activemq.jndi.JNDIReferenceFactory"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">brokerURL</span>=<span class="string">"failover:(tcp://localhost:61616)?initialReconnectDelay=100<span class="symbol">&amp;amp;</span>maxReconnectAttempts=5"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">brokerName</span>=<span class="string">"LocalActiveMQBroker"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">useEmbeddedBroker</span>=<span class="string">"false"</span> /&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;<span class="name">Resource</span> <span class="attr">name</span>=<span class="string">"topic/topic0"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">auth</span>=<span class="string">"Container"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">type</span>=<span class="string">"org.apache.activemq.command.ActiveMQTopic"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">description</span>=<span class="string">"My Test Topic"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">factory</span>=<span class="string">"org.apache.activemq.jndi.JNDIReferenceFactory"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">physicalName</span>=<span class="string">"TestTopic"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet</span>(<span class="string">"/publish"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Publisher</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">       <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest request,</span></span></span><br><span class="line"><span class="function"><span class="params">           HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">       PrintWriter out = response.getWriter();</span><br><span class="line"></span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">           InitialContext ctx = <span class="keyword">new</span> InitialContext();</span><br><span class="line">           Topic topic = (Topic) ctx.lookup(<span class="string">"java:comp/env/topic/topic0"</span>);</span><br><span class="line">           TopicConnectionFactory connFactory = (TopicConnectionFactory) ctx.lookup(<span class="string">"java:comp/env/topic/connectionFactory"</span>);</span><br><span class="line"></span><br><span class="line">           TopicConnection topicConn = connFactory.createTopicConnection();</span><br><span class="line">           TopicSession topicSession = topicConn.createTopicSession(<span class="keyword">false</span>, Session.AUTO_ACKNOWLEDGE);</span><br><span class="line">           TopicPublisher topicPublisher = topicSession.createPublisher(topic);</span><br><span class="line">           topicPublisher.setDeliveryMode(DeliveryMode.NON_PERSISTENT);</span><br><span class="line">           TextMessage message = topicSession.createTextMessage();</span><br><span class="line">           message.setText(<span class="string">"how are you XXX"</span>);</span><br><span class="line">           topicPublisher.publish(message);</span><br><span class="line">           out.write(<span class="string">"published: "</span> + message.getText());</span><br><span class="line">           topicConn.close();</span><br><span class="line">       &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">           e.printStackTrace();</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet</span>(<span class="string">"/subscribe"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Subscriber</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">   </span><br><span class="line">   <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">       PrintWriter out = response.getWriter();</span><br><span class="line">       </span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">           InitialContext ctx = <span class="keyword">new</span> InitialContext();</span><br><span class="line">           Topic topic = (Topic) ctx.lookup(<span class="string">"java:comp/env/topic/topic0"</span>);</span><br><span class="line">           TopicConnectionFactory connFactory = (TopicConnectionFactory) ctx.lookup(<span class="string">"java:comp/env/topic/connectionFactory"</span>);</span><br><span class="line">           TopicConnection topicConn = connFactory.createTopicConnection();</span><br><span class="line">           TopicSession topicSession = topicConn.createTopicSession(<span class="keyword">false</span>, Session.AUTO_ACKNOWLEDGE);</span><br><span class="line">           TopicSubscriber topicSubscriber = topicSession.createSubscriber(topic);</span><br><span class="line">           topicConn.start();</span><br><span class="line">           TextMessage message = (TextMessage) topicSubscriber.receive();</span><br><span class="line">           out.write(<span class="string">"received: "</span> + message.getText());</span><br><span class="line">           topicConn.close();</span><br><span class="line">       &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">           e.printStackTrace();</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>多运行几个接收，一开始没有显示内容，只是订阅，在activemq中可以看到有两个消费者</p>
<p><img src="https://img.huyunshun.com/img/20200413114528.png" alt="20200413114528"></p>

          
        
      
    </div>
     <!-- 相关文章推荐 -->
    
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://huyunshun.com/2017/04/13/JMS%E6%B6%88%E6%81%AF%E6%9C%8D%E5%8A%A1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="初晨">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://img.huyunshun.com/img/20200522182348.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="简">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/04/13/JMS%E6%B6%88%E6%81%AF%E6%9C%8D%E5%8A%A1/" itemprop="url">JMS消息服务</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-13T10:22:49+08:00">
                2017-04-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java/" itemprop="url" rel="index">
                    <span itemprop="name">java</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="什么是Java消息服务"><a href="#什么是Java消息服务" class="headerlink" title="什么是Java消息服务"></a>什么是Java消息服务</h2><p>Java消息服务指的是两个应用程序之间进行异步通信的API，它为标准消息协议和消息服务提供了一组通用接口，包括创建、发送、读取消息等，用于支持JAVA应用程序开发。在J2EE中，当两个应用程序使用JMS进行通信时，它们之间并不是直接相连的，而是通过一个共同的消息收发服务连接起来，可以达到解耦的效果。</p>
<h2 id="JMS的重要性"><a href="#JMS的重要性" class="headerlink" title="JMS的重要性"></a>JMS的重要性</h2><p>在JAVA中，如果两个应用程序之间对各自都不了解，甚至这两个程序可能部署在不同的大洲上，那么它们之间如何发送消息呢？举个例子，一个应用程序A部署在印度，另一个应用程序部署在美国，然后每当A触发某件事后，B想从A获取一些更新信息。当然，也有可能不止一个B对A的更新信息感兴趣，可能会有N个类似B的应用程序想从A中获取更新的信息。</p>
<p>在这种情况下，JAVA提供了最佳的解决方案-JMS，完美解决了上面讨论的问题。</p>
<p>JMS同样适用于基于事件的应用程序，如聊天服务，它需要一种发布事件机制向所有与服务器连接的客户端发送消息。JMS与RMI不同，发送消息的时候，接收者不需要在线。服务器发送了消息，然后就不管了；等到客户端上线的时候，能保证接收到服务器发送的消息。这是一个很强大的解决方案，能处理当今世界很多普遍问题。</p>
<h2 id="JMS消息传送模型"><a href="#JMS消息传送模型" class="headerlink" title="JMS消息传送模型"></a>JMS消息传送模型</h2><p>在JMS API出现之前，大部分产品使用”点对点”和”发布/订阅”中的任一方式来进行消息通讯。JMS定义了这两种消息发送模型的规范，它们相互独立。任何JMS的提供者可以实现其中的一种或两种模型，这是它们自己的选择。JMS规范提供了通用接口保证我们基于JMS API编写的程序适用于任何一种模型。</p>
<p><strong>点对点消息传送模型</strong></p>
<p><img src="https://img.huyunshun.com/img/20200413112504.png" alt="20200413112504"></p>
<p>在点对点消息传送模型中，应用程序由消息队列，发送者，接收者组成。每一个消息发送给一个特殊的消息队列，该队列保存了所有发送给它的消息(除了被接收者消费掉的和过期的消息)。点对点消息模型有一些特性，如下：</p>
<pre><code>每个消息只有一个接收者；
消息发送者和接收者并没有时间依赖性；
当消息发送者发送消息的时候，无论接收者程序在不在运行，都能获取到消息；
当接收者收到消息的时候，会发送确认收到通知（acknowledgement）。</code></pre><p><strong>发布/订阅消息传递模型</strong></p>
<p><img src="https://img.huyunshun.com/img/20200413112636.png" alt="20200413112636"></p>
<p>在发布/订阅消息模型中，发布者发布一个消息，该消息通过topic传递给所有的客户端。在这种模型中，发布者和订阅者彼此不知道对方，是匿名的且可以动态发布和订阅topic。topic主要用于保存和传递消息，且会一直保存消息直到消息被传递给客户端。<br>发布/订阅消息模型特性如下：</p>
<pre><code>一个消息可以传递给多个订阅者
发布者和订阅者有时间依赖性，只有当客户端创建订阅后才能接受消息，且订阅者需一直保持活动状态以接收消息。
为了缓和这样严格的时间相关性，JMS允许订阅者创建一个可持久化的订阅。这样，即使订阅者没有被激活（运行），它也能接收到发布者的消息。</code></pre><h2 id="接收消息"><a href="#接收消息" class="headerlink" title="接收消息"></a>接收消息</h2><p>同步：使用同步方式接收消息的话，消息订阅者调用receive()方法。在receive()中，消息未到达或在到达指定时间之前，方法会阻塞，直到消息可用。</p>
<p>异步：使用异步方式接收消息的话，消息订阅者需注册一个消息监听者，类似于事件监听器，只要消息到达，JMS服务提供者会通过调用监听器的onMessage()递送消息。</p>
<h2 id="JMS相关接口"><a href="#JMS相关接口" class="headerlink" title="JMS相关接口"></a>JMS相关接口</h2><ul>
<li>管理对象（Administered objects）-连接工厂（Connection Factories）和目的地（Destination）</li>
<li>连接对象（Connections）</li>
<li>会话（Sessions）</li>
<li>消息生产者（Message Producers）</li>
<li>消息消费者（Message Consumers）</li>
<li>消息监听者（Message Listeners）</li>
</ul>
<h3 id="JMS管理对象"><a href="#JMS管理对象" class="headerlink" title="JMS管理对象"></a>JMS管理对象</h3><p>管理对象（Administered objects）是预先配置的JMS对象，由系统管理员为使用JMS的客户端创建，主要有两个被管理的对象：连接工厂（ConnectionFactory）和目的地（Destination）</p>
<p>这两个管理对象由JMS系统管理员通过使用Application Server管理控制台创建，存储在应用程序服务器的JNDI名字空间或JNDI注册表。</p>
<h3 id="连接工厂（ConnectionFactory）"><a href="#连接工厂（ConnectionFactory）" class="headerlink" title="连接工厂（ConnectionFactory）"></a>连接工厂（ConnectionFactory）</h3><p>客户端使用一个连接工厂对象连接到JMS服务提供者，它创建了JMS服务提供者和客户端之间的连接。JMS客户端（如发送者或接受者）会在JNDI名字空间中搜索并获取该连接。使用该连接，客户端能够与目的地通讯，往队列或话题发送/接收消息。让我们用一个例子来理解如何发送消息：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">QueueConnectionFactory queueConnFactory &#x3D; (QueueConnectionFactory) initialCtx.lookup (&quot;primaryQCF&quot;);</span><br><span class="line">Queue purchaseQueue &#x3D; (Queue) initialCtx.lookup (&quot;Purchase_Queue&quot;);</span><br><span class="line">Queue returnQueue &#x3D; (Queue) initialCtx.lookup (&quot;Return_Queue&quot;);</span><br></pre></td></tr></table></figure>
<h3 id="目的地（Destination）"><a href="#目的地（Destination）" class="headerlink" title="目的地（Destination）"></a>目的地（Destination）</h3><pre><code>目的地指明消息被发送的目的地以及客户端接收消息的来源。JMS使用两种目的地，队列和话题。如下代码指定了一个队列和话题。</code></pre><p>创建一个队列Session</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">QueueSession ses = con.createQueueSession (<span class="keyword">false</span>, Session.AUTO_ACKNOWLEDGE);  <span class="comment">//get the Queue object  </span></span><br><span class="line">Queue t = (Queue) ctx.lookup (<span class="string">"myQueue"</span>);  <span class="comment">//create QueueReceiver  </span></span><br><span class="line">QueueReceiver receiver = ses.createReceiver(t);</span><br></pre></td></tr></table></figure>
<p>创建一个话题Session</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">TopicSession ses = con.createTopicSession (<span class="keyword">false</span>, Session.AUTO_ACKNOWLEDGE); <span class="comment">// get the Topic object  </span></span><br><span class="line">Topic t = (Topic) ctx.lookup (<span class="string">"myTopic"</span>);  <span class="comment">//create TopicSubscriber  </span></span><br><span class="line">TopicSubscriber receiver = ses.createSubscriber(t);</span><br></pre></td></tr></table></figure>
<h3 id="JMS连接"><a href="#JMS连接" class="headerlink" title="JMS连接"></a>JMS连接</h3><p>连接对象封装了与JMS提供者之间的虚拟连接，如果我们有一个ConnectionFactory对象，可以使用它来创建一个连接。</p>
<pre><code>Connection connection = connectionFactory.createConnection();</code></pre><p>创建完连接后，需要在程序使用结束后关闭它：connection.close();</p>
<h3 id="JMS-会话（Session）"><a href="#JMS-会话（Session）" class="headerlink" title="JMS 会话（Session）"></a>JMS 会话（Session）</h3><pre><code>Session是一个单线程上下文，用于生产和消费消息，可以创建出消息生产者和消息消费者。
Session对象实现了Session接口，在创建完连接后，我们可以使用它创建Session。
Session session = connection.createSession(false, Session.AUTO_ACKNOWLEDGE);</code></pre><h3 id="JMS消息生产者"><a href="#JMS消息生产者" class="headerlink" title="JMS消息生产者"></a>JMS消息生产者</h3><p>消息生产者由Session创建，用于往目的地发送消息。生产者实现MessageProducer接口，我们可以为目的地、队列或话题创建生产者；</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">MessageProducer producer = session.createProducer(dest);</span><br><span class="line">MessageProducer producer = session.createProducer(queue);</span><br><span class="line">MessageProducer producer = session.createProducer(topic);</span><br></pre></td></tr></table></figure>
<p>创建完消息生产者后，可以使用send方法发送消息：producer.send(message);</p>
<h3 id="JMS消息消费者"><a href="#JMS消息消费者" class="headerlink" title="JMS消息消费者"></a>JMS消息消费者</h3><p>消息消费者由Session创建，用于接受目的地发送的消息。消费者实现MessageConsumer接口，，我们可以为目的地、队列或话题创建消费者；</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">MessageConsumer consumer = session.createConsumer(dest);</span><br><span class="line">MessageConsumer consumer = session.createConsumer(queue);</span><br><span class="line">MessageConsumer consumer = session.createConsumer(topic);</span><br></pre></td></tr></table></figure>
<h3 id="JMS消息监听器"><a href="#JMS消息监听器" class="headerlink" title="JMS消息监听器"></a>JMS消息监听器</h3><p>JMS消息监听器是消息的默认事件处理者，他实现了MessageListener接口，该接口包含一个onMessage方法，在该方法中需要定义消息达到后的具体动作。通过调用setMessageListener方法我们给指定消费者定义了消息监听器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Listener myListener = <span class="keyword">new</span> Listener();</span><br><span class="line">consumer.setMessageListener(myListener);</span><br></pre></td></tr></table></figure>
<h2 id="JMS消息结构"><a href="#JMS消息结构" class="headerlink" title="JMS消息结构"></a>JMS消息结构</h2><p>JMS消息由三部分组成：</p>
<pre><code>消息头
JMS消息头预定义了若干字段用于客户端与JMS提供者之间识别和发送消息，预编译头如下：

 - JMSDestination
 - JMSDeliveryMode
 - JMSMessageID
 - JMSTimestamp
 - JMSCorrelationID
 - JMSReplyTo
 - JMSRedelivered
 - JMSType
 - JMSExpiration
 - JMSPriority</code></pre><h3 id="消息属性"><a href="#消息属性" class="headerlink" title="消息属性"></a>消息属性</h3><p>我们可以给消息设置自定义属性，这些属性主要是提供给应用程序的。对于实现消息过滤功能，消息属性非常有用，JMS API定义了一些标准属性，JMS服务提供者可以选择性的提供部分标准属性。</p>
<h3 id="消息体"><a href="#消息体" class="headerlink" title="消息体"></a>消息体</h3><p>在消息体中，JMS API定义了五种类型的消息格式，让我们可以以不同的形式发送和接受消息，并提供了对已有消息格式的兼容。不同的消息类型如下：</p>
<pre><code>Text message : javax.jms.TextMessage，表示一个文本对象。
Object message : javax.jms.ObjectMessage，表示一个JAVA对象。
Bytes message : javax.jms.BytesMessage，表示字节数据。
Stream message :javax.jms.StreamMessage，表示java原始值数据流。
Map message : javax.jms.MapMessage，表示键值对。</code></pre><p>参考：<a href="https://www.cnblogs.com/chenpi/p/5559349.html" target="_blank" rel="noopener">https://www.cnblogs.com/chenpi/p/5559349.html</a></p>

          
        
      
    </div>
     <!-- 相关文章推荐 -->
    
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://huyunshun.com/2017/04/09/spring%E5%88%9D%E6%AD%A5%E6%95%B4%E5%90%88mybatis%E4%BE%8B%E5%AD%90/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="初晨">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://img.huyunshun.com/img/20200522182348.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="简">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/04/09/spring%E5%88%9D%E6%AD%A5%E6%95%B4%E5%90%88mybatis%E4%BE%8B%E5%AD%90/" itemprop="url">spring初步整合mybatis例子</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-09T00:00:00+08:00">
                2017-04-09
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/spring/" itemprop="url" rel="index">
                    <span itemprop="name">spring</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>配置文件：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/beans/spring-beans.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">       <span class="comment">&lt;!-- 配置数据源:获取数据库连接,数据源封装类在spring-jdbc.jar 中 --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSouce"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.DriverManagerDataSource"</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClassName"</span> <span class="attr">value</span>=<span class="string">"com.mysql.jdbc.Driver"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"jdbc:mysql://localhost:3306/ssm"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"root"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"123456"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">       </span><br><span class="line">       </span><br><span class="line">       <span class="comment">&lt;!-- 创建Mybatis工厂 通过Spring 创建  SqlSessionFactory 对象 需要导入包mybatis-spring-1.2.3.jar 里边包含创建session的类SqlSessionFactoryBean--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"factory"</span> <span class="attr">class</span>=<span class="string">"org.mybatis.spring.SqlSessionFactoryBean"</span>&gt;</span></span><br><span class="line">               <span class="comment">&lt;!-- 数据库连接信息来源于 dataSource --&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSouce"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">       </span><br><span class="line">       <span class="comment">&lt;!-- 扫描器 相当于 mybatis.xml 中 mappers 下 package 标 签，扫描 com.hu.mapper 包后会给对应接口创建对象   不需要被引用，id可以不写--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.mybatis.spring.mapper.MapperScannerConfigurer"</span>&gt;</span></span><br><span class="line">               <span class="comment">&lt;!-- 要扫描哪个包 --&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"basePackage"</span> <span class="attr">value</span>=<span class="string">"com.hu.mapper"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">               <span class="comment">&lt;!-- 和 factory 产生关系 --&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sqlSessionFactory"</span> <span class="attr">ref</span>=<span class="string">"factory"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>测试：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test01</span> </span>&#123;</span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">               ApplicationContext ac = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"applicationContext.xml"</span>);</span><br><span class="line">               String[] strings = ac.getBeanDefinitionNames();</span><br><span class="line">               <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; strings.length; i++) &#123;</span><br><span class="line">                       System.out.println(strings[i]);</span><br><span class="line">               &#125;</span><br><span class="line">       &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">信息: Loaded JDBC driver: com.mysql.jdbc.Driver</span><br><span class="line">dataSouce</span><br><span class="line">factory</span><br><span class="line">org.mybatis.spring.mapper.MapperScannerConfigurer#0</span><br><span class="line">studentMapper</span><br><span class="line">org.springframework.context.annotation.internalConfigurationAnnotationProcessor</span><br><span class="line">org.springframework.context.annotation.internalAutowiredAnnotationProcessor</span><br><span class="line">org.springframework.context.annotation.internalRequiredAnnotationProcessor</span><br><span class="line">org.springframework.context.annotation.internalCommonAnnotationProcessor</span><br><span class="line">org.springframework.context.annotation.ConfigurationClassPostProcessor.importAwareProcessor</span><br><span class="line">org.springframework.context.annotation.ConfigurationClassPostProcessor.enhancedConfigurationProcessor</span><br></pre></td></tr></table></figure>

<p>查询数据库测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">StudentMapper</span> </span>&#123;</span><br><span class="line">       <span class="meta">@Select</span>(<span class="string">"select * from student"</span>)</span><br><span class="line">       <span class="function">List&lt;Student&gt; <span class="title">findStudentAll</span><span class="params">()</span></span>;</span><br><span class="line">       <span class="meta">@Select</span>(<span class="string">"select * from student where id=#&#123;0&#125;"</span>)</span><br><span class="line">       <span class="function">Student <span class="title">findStudentById</span><span class="params">(<span class="keyword">int</span> id)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line">测试：</span><br><span class="line">               StudentMapper sm = ac.getBean(<span class="string">"studentMapper"</span>,StudentMapper<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">               <span class="comment">//StudentMapper sm = ac.getBean(StudentMapper.class);</span></span><br><span class="line">               System.out.println(sm.findStudentById(<span class="number">1</span>));</span><br><span class="line">输出：</span><br><span class="line">Student [id=<span class="number">1</span>, name=学生<span class="number">1</span>, age=<span class="number">5</span>, tid=<span class="number">1</span>, teacher=<span class="keyword">null</span>]</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
     <!-- 相关文章推荐 -->
    
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://huyunshun.com/2017/04/07/spring%E6%A1%86%E6%9E%B6%E4%BB%8B%E7%BB%8D%E5%92%8C%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="初晨">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://img.huyunshun.com/img/20200522182348.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="简">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/04/07/spring%E6%A1%86%E6%9E%B6%E4%BB%8B%E7%BB%8D%E5%92%8C%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/" itemprop="url">spring框架介绍和环境搭建</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-07T00:00:00+08:00">
                2017-04-07
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/spring/" itemprop="url" rel="index">
                    <span itemprop="name">spring</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>Spring是一个开源框架，Spring是于2003 年兴起的一个轻量级的Java 开发框架，由d Rod  Johnson在其著作 Expert One-On-One J2EE Development and Design 中阐述的部分理念和原型衍生而来。它是为了解决企业应用开发的复杂性而创建的。框架的主要优势之一就是其分层架构，分层架构允许使用者选择使用哪一个组件，同时为 J2EE 应用程序开发提供集成的框架。Spring 使用基本的 JavaBean来完成以前只可能由 EJB 完成的事情。然而，Spring 的用途不仅限于服务器端的开发。从简单性、可测试性和松耦合的角度而言，任何 Java 应用都可以从 Spring 中受益。Spring 的核心是控制反转（IoC）和面向切面（AOP）。简单来说，Spring  是一个分层的 JavaSE/EEfull-stack( 一站式)  轻量级开源框架。</p>
<p><strong>Spring核心模块</strong><br><img src="https://img.huyunshun.com/img/20200407094232.png" alt="20200407094232"></p>
<h3 id="Core-Container（核心容器）"><a href="#Core-Container（核心容器）" class="headerlink" title="Core Container（核心容器）"></a>Core Container（核心容器）</h3><ul>
<li>Beans：负责Bean工厂中Bean的装配，所谓Bean工厂即是创建对象的工厂，Bean的装配也就是对象的创建工作；</li>
<li>Core：这个模块即是负责IOC（控制反转）最基本的实现；</li>
<li>Context：Spring的IOC容器，因大量调用Spring Core中的函数，整合了Spring的大部分功能。Bean创建好对象后，由Context负责建立Bean与Bean之间的关系并维护。所以也可以把Context看成是Bean关系的集合；</li>
<li>SpEl：即Spring Expression Language（Spring表达式语言）；</li>
</ul>
<h3 id="Data-Access-Integration（数据访问-集成）"><a href="#Data-Access-Integration（数据访问-集成）" class="headerlink" title="Data Access/Integration（数据访问/集成）"></a>Data Access/Integration（数据访问/集成）</h3><ul>
<li>JDBC：对JDBC的简单封装；</li>
<li>ORM：支持数据集成框架的封装（如Mybatis，Hibernate）；</li>
<li>OXM：即Object XML Mapper，它的作用是在Java对象和XML文档之间来回转换；</li>
<li>JMS：生产者和消费者的消息功能的实现；</li>
<li>Transations：事务管理，声明式事务；</li>
</ul>
<h3 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h3><ul>
<li>WebSocket：提供Socket通信，web端的的推送功能；</li>
<li>Servlet：Spring MVC框架的实现；</li>
<li>Web：包含web应用开发用到Spring框架时所需的核心类，包括自动载入WebApplicationContext特性的类，Struts集成类、文件上传的支持类、Filter类和大量辅助工具类；</li>
<li>Portlet：实现web模块功能的聚合（如网站首页（Port）下面可能会有不同的子窗口（Portlet））；</li>
</ul>
<h3 id="AOP"><a href="#AOP" class="headerlink" title="AOP"></a>AOP</h3><p>面向切面；</p>
<h3 id="Aspects"><a href="#Aspects" class="headerlink" title="Aspects"></a>Aspects</h3><p>同样是面向切面的一个重要的组成部分，提供对AspectJ框架的整合；</p>
<h3 id="Instrumentation（设备）"><a href="#Instrumentation（设备）" class="headerlink" title="Instrumentation（设备）"></a>Instrumentation（设备）</h3><p>相当于一个检测器，提供对JVM以及对Tomcat的检测；</p>
<h3 id="Messaging（消息）"><a href="#Messaging（消息）" class="headerlink" title="Messaging（消息）"></a>Messaging（消息）</h3><p>Spring提供的对消息处理的功能；</p>
<h3 id="Test（测试）"><a href="#Test（测试）" class="headerlink" title="Test（测试）"></a>Test（测试）</h3><p>我们在做单元测试时，Spring会帮我们初始化一些测试过程当中需要用到的资源对象；</p>
<h2 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h2><p>建一个项目，导入包，新建配置文件，注：也可以不用配置文件，使用java config方式。</p>
<p>引入约束：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/beans/spring-beans.xsd"</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>spring 配置文件是基于 schema，schema 文件扩展名.xsd，相当于是 DTD 的升级版，比 DTD 具备更好的扩展性。每次引入一个 xsd 文件是一个 namespace(xmlns)<br>配置文件中只需要引入基本 schema通过&lt;bean/&gt; 创建对象。默认配置文件被加载时创建对象。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/beans/spring-beans.xsd"</span>&gt;</span></span><br><span class="line">       </span><br><span class="line">       <span class="comment">&lt;!-- id表示获取到对象的标识，class标识创建哪个对象 --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"student"</span> <span class="attr">class</span>=<span class="string">"com.hu.pojo.Student"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">       </span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>测试：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test01</span> </span>&#123;</span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">               ApplicationContext ac = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"applicationContext.xml"</span>);</span><br><span class="line">               <span class="comment">// getBean("&lt;bean&gt;标签 id 值",返回值类型);如果没有第二个参数,默认是 Object</span></span><br><span class="line">               <span class="comment">// getBeanDefinitionNames(),获取Spring 容器中目前所有管理的所有对象</span></span><br><span class="line">               Student student = ac.getBean(<span class="string">"student"</span>,Student<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">               System.out.println(student);</span><br><span class="line">               System.out.println(ac.getBeanDefinitionNames());</span><br><span class="line">       &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Spring常用注解"><a href="#Spring常用注解" class="headerlink" title="Spring常用注解"></a>Spring常用注解</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">1、 @Component 创建类对象,相当于配置&lt;bean&#x2F;&gt;。</span><br><span class="line">2、@Service 与@Component 功能相同，写在 ServiceImpl 类上。</span><br><span class="line">3、@Repository 与@Component 功能相同，写在数据访问层类上。</span><br><span class="line">4、@Controller 与@Component 功能相同，写在控制器类上。</span><br><span class="line">5、@Resource(用于对象属性自动注入，不需要写对象的 get&#x2F;set)</span><br><span class="line">这个注解是 java 中的注解，默认按照 byName 注入，如果没有名称对象，按照 byType 注入。</span><br><span class="line">6、@Autowired(和@Resource完全一致)，是spring 的注解，默认按照 byType 注入。</span><br><span class="line">7、 @Value() 获取 properties 文件中内容。</span><br><span class="line">8、@Pointcut() 定义切点。</span><br><span class="line">9、@Aspect() 定义切面类</span><br><span class="line">10、@Before() 前置通知</span><br><span class="line">11、@After 后置通知</span><br><span class="line">12、@AfterReturning 后置通知,必须切点正确执行</span><br><span class="line">13、@AfterThrowing 异常通知</span><br><span class="line">14、@Arround 环绕通知</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
     <!-- 相关文章推荐 -->
    
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://huyunshun.com/2017/04/01/maven%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="初晨">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://img.huyunshun.com/img/20200522182348.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="简">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/04/01/maven%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8/" itemprop="url">maven安装使用</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-01T15:33:17+08:00">
                2017-04-01
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/maven/" itemprop="url" rel="index">
                    <span itemprop="name">maven</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="一、maven-简介"><a href="#一、maven-简介" class="headerlink" title="一、maven  简介"></a>一、maven  简介</h2><p>Maven项目对象模型(POM)( Project Object Mode），可以通过一小段描述信息来管理项目的构建，报告和文档的项目管理工具软件。<br>基于 Ant 的构建工具，Ant 有的功能 Maven 都有，额外添加了其他功能。</p>
<p>运行过程：</p>
<p><img src="https://img.huyunshun.com/img/20200421155621.png" alt="20200421155621"></p>
<p>通常中央仓库在国外，下载速度慢，一般都是配置国内镜像。</p>
<p>坐标：</p>
<p>每一 jar 文件都有一个唯一坐标.通过坐标可以精确确定是哪个 jar<br>    坐标组成：<br>    Group ID : 公司名.公司网址倒写<br>    Artifact ID : 项目名<br>    Version : 版本</p>
<p>POM项目对象模型，就是把项目看做一个对象处理，通过 maven 构建工具可以让对象(项目)和对象(项目)之间产生关系。</p>
<h2 id="二、安装"><a href="#二、安装" class="headerlink" title="二、安装"></a>二、安装</h2><pre><code>1、下载包
2、解压到目录
3、配置环境变量</code></pre><h2 id="三、配置"><a href="#三、配置" class="headerlink" title="三、配置"></a>三、配置</h2><p>1、修改 JDK 版本</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span>&gt;</span>jdk-1.7<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">activation</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">activeByDefault</span>&gt;</span>true<span class="tag">&lt;/<span class="name">activeByDefault</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">jdk</span>&gt;</span>1.7<span class="tag">&lt;/<span class="name">jdk</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">activation</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>1.7<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>1.7<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.compilerVersion</span>&gt;</span>1.7<span class="tag">&lt;/<span class="name">maven.compiler.compilerVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p> 2、 修改镜像地址(不使用 nexus 时配置)</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span>&gt;</span>alimaven<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>aliyun maven<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.aliyun.com/nexus/content/groups/public/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>central<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="四、Maven本地资源库更改-更新"><a href="#四、Maven本地资源库更改-更新" class="headerlink" title="四、Maven本地资源库更改/更新"></a>四、Maven本地资源库更改/更新</h2><h3 id="1、更改本地资源库"><a href="#1、更改本地资源库" class="headerlink" title="1、更改本地资源库"></a>1、更改本地资源库</h3><p>Maven的本地资源库是用来存储所有项目的依赖关系(插件jar和其他文件，这些文件被Maven下载)到本地文件夹。很简单，当你建立一个Maven项目，所有相关文件将被存储在你的Maven本地仓库。 默认情况下，Maven的本地资源库默认为 .m2</p>
<p>目录文件夹：</p>
<pre><code>Unix/Mac OS X - ~/.m2
Windows - C:\Documents and Settings\{your-username}\.m2</code></pre><p>修改默认位置：打开{M2_HOME}\conf\setting.xml修改maven配置，找到：</p>
<pre><code>&lt;!-- localRepository
| The path to the local repository maven will use to store artifacts.
|
| Default: ${user.home}/.m2/repository
&lt;localRepository&gt;/path/to/local/repo&lt;/localRepository&gt;
--&gt;</code></pre><p>修改为新的位置：如下</p>
<pre><code>&lt;!-- localRepository
| The path to the local repository maven will use to store artifacts.
|
| Default: ${user.home}/.m2/repository  
--&gt;
&lt;localRepository&gt;G:\Maven\repository&lt;/localRepository&gt;</code></pre><h3 id="2、更新本地资源库"><a href="#2、更新本地资源库" class="headerlink" title="2、更新本地资源库"></a>2、更新本地资源库</h3><p>通过命令更新新设置的资源库：mvn help:system</p>
<p>mvn archetype:generate</p>
<h2 id="Maven项目管理"><a href="#Maven项目管理" class="headerlink" title="Maven项目管理"></a>Maven项目管理</h2><pre><code>步骤：
1、创建 maven project 时选择 packaging 为 war
2、在 webapp 文件夹下新建 META-INF 和 WEB-INF/web.xml
3、引入 java ee 相关的三个 jar包</code></pre><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">       <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                       <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                       <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jsp-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                       <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                       <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                       <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                       <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                       <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                       <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                       <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet.jsp.jstl<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                       <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jstl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                       <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">scope</span>&gt;</span> jar有效范围 provided 表示编译期生效,不会打包发布到 tomcat 中</span><br></pre></td></tr></table></figure>
<p>因为tomcat中已经有sevlet包，如果不加编译期生效这个，就会在tomcat启动时出现了Failed to start component [StandardEngine[Catalina].StandardHost[localhost]]</p>
<p>4、配置tomcat插件，运行时和本地安装的Tomcat没一点关系。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.tomcat.maven<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tomcat7-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                                <span class="comment">&lt;!-- 控制 tomcat 端口号 --&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">port</span>&gt;</span>801<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">                                <span class="comment">&lt;!-- 项目发布到 tomcat 后的名称 --&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">path</span>&gt;</span>/mavenwebappdemo<span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>右键项目–&gt; run as –&gt; maven build–&gt;Goals 中输入 clean tomcat7:run  发布，之后可以在浏览器测试。</p>
<p>5、资源拷贝插件</p>
<pre><code>1、maven 默认只把 src/main/resources 里面的资源文件进行编译到classes 中。
2、如果希望 src/main/java 下的资源文件也被编译到 classes 中，在 pom.xml中的&lt;build&gt;配置。</code></pre><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置编译文件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--  src/main/java 里面的资源文件进行编译到classes 中 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/java<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.xml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 上面修改了默认配置，打破了规则，也要配置把resources中的资源文件让其被编译到class --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/resources<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.xml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.properties<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="二、热部署"><a href="#二、热部署" class="headerlink" title="二、热部署"></a>二、热部署</h3><p>所谓热部署，就是在应用正在运行的时候升级软件，却不需要重新启动应用。</p>
<p>Tomcat的热部署实现：</p>
<p>1、修改Tomcat配置文件/conf/tomcat-users.xml，在里边添加如下内容</p>
<pre><code>&lt;role rolename=&quot;manager-gui&quot;/&gt;
&lt;role rolename=&quot;manager-script&quot;/&gt;
&lt;user username=&quot;tomcat&quot; password=&quot;tomcat&quot; roles=&quot;manager-gui,manager-script&quot;/&gt;</code></pre><p>2、 在 maven 项目的 pom.xml 中 tomcat 插件的<configuration>里配置。</p>
<pre><code>&lt;username&gt;tomcat&lt;/username&gt;
&lt;password&gt;tomcat&lt;/password&gt;
    &lt;url&gt;http://远程路径/manager/text&lt;/url&gt;</code></pre><p>3、发布</p>
<pre><code>右键项目--&gt;run as --&gt; maven build(选择第二个) --&gt;输入
tomcat7:deploy 第一次发布
tomcat7:redeploy 不是第一次发布</code></pre>
          
        
      
    </div>
     <!-- 相关文章推荐 -->
    
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/22/">上一页</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/22/">22</a><span class="page-number current">23</span><a class="page-number" href="/page/24/">24</a><a class="page-number" href="/page/25/">25</a><a class="extend next" rel="next" href="/page/24/">下一页</a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="https://img.huyunshun.com/img/20200522182348.png"
                alt="初晨" />
            
              <p class="site-author-name" itemprop="name">初晨</p>
              <p class="site-description motion-element" itemprop="description">永远不要说你知道本质，更别说真相了。</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/%7C%7C%20archive">
              
                  <span class="site-state-item-count">249</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">46</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">109</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          
<!--近期文章版块-->
            
                <div class="links-of-blogroll motion-element links-of-blogroll-block">
                  <div class="links-of-blogroll-title">
                    <!-- modify icon to fire by szw -->
                    <i class="fa fa-history fa-" aria-hidden="true"></i>
                    近期文章
                  </div>
                  <ul class="links-of-blogroll-list">
                    
                    
                      <li>
                        <a href="/2020/05/22/WebSocket%E3%80%81Socket%E3%80%81TCP%E3%80%81HTTP%E5%8C%BA%E5%88%AB/" title="WebSocket、Socket、TCP、HTTP区别" target="_blank">WebSocket、Socket、TCP、HTTP区别</a>
                      </li>
                    
                      <li>
                        <a href="/2020/05/19/Springboot%E9%A1%B9%E7%9B%AE%E7%9A%84%E6%8E%A5%E5%8F%A3%E9%98%B2%E5%88%B7/" title="Springboot项目的接口防刷" target="_blank">Springboot项目的接口防刷</a>
                      </li>
                    
                      <li>
                        <a href="/2020/05/03/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3Volatile%E5%85%B3%E9%94%AE%E5%AD%97%E5%8F%8A%E5%85%B6%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86/" title="深入理解Volatile关键字及其实现原理" target="_blank">深入理解Volatile关键字及其实现原理</a>
                      </li>
                    
                      <li>
                        <a href="/2020/04/20/%E4%BD%BF%E7%94%A8vscode%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E7%AC%94%E8%AE%B0%E7%8E%AF%E5%A2%83/" title="使用vscode搭建个人笔记环境" target="_blank">使用vscode搭建个人笔记环境</a>
                      </li>
                    
                      <li>
                        <a href="/2020/01/20/HBase%E4%BB%8B%E7%BB%8D%E5%AE%89%E8%A3%85%E4%B8%8E%E6%93%8D%E4%BD%9C/" title="HBase介绍安装与操作" target="_blank">HBase介绍安装与操作</a>
                      </li>
                    
                  </ul>
                </div>
            
          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2018 &mdash; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Copyright</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  


</body>
</html>
