<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="永远不要说你知道本质，更别说真相了。">
<meta property="og:type" content="website">
<meta property="og:title" content="简">
<meta property="og:url" content="https://huyunshun.com/page/24/index.html">
<meta property="og:site_name" content="简">
<meta property="og:description" content="永远不要说你知道本质，更别说真相了。">
<meta property="article:author" content="初晨">
<meta property="article:tag" content="编程">
<meta property="article:tag" content="开发">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://huyunshun.com/page/24/"/>





  <title>简</title>
  








  <script type="text/javascript" src="/js/src/love.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome/css/font-awesome.min.css">

  <!-- 看板娘 -->
    
        <script async src="/live2d-widget/autoload.js"></script>
    
 <!-- 飘动的彩带） -->
  <script src="/js/src/piao.js" type="text/javascript"></script>
<meta name="generator" content="Hexo 4.2.1"></head>
<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">简</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">人生短暂，学海无边，而大道至简。</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://huyunshun.com/2017/04/01/Apache%20Bench%E4%B8%8EJVisualVM%E8%81%94%E8%B0%83/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="初晨">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://img.huyunshun.com/img/20200522182348.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="简">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/04/01/Apache%20Bench%E4%B8%8EJVisualVM%E8%81%94%E8%B0%83/" itemprop="url">Apache Bench与JVisualVM联调</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-01T00:00:00+08:00">
                2017-04-01
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Tomcat/" itemprop="url" rel="index">
                    <span itemprop="name">Tomcat</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li>Apache Bench 负责模拟用户请求</li>
<li>JVisualVM负责观察Tomcat的Java虚拟机内存、线程、CPU的变化</li>
</ul>
<p>启动Tomcat，再使用JVisualVM远程连接Tomcat，JVisualVM远程连接Tomcat。</p>
<p><strong>JVisualVM</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">JDK发布的功能最强大的运行监视和故障处理工具，他可以做到：</span><br><span class="line">显示虚拟机进程以及进程的配置、环境信息</span><br><span class="line">监视应用程序的CPU、GC、堆、方法区以及线程的信息</span><br><span class="line">dump以及分析堆转储快照</span><br><span class="line">方法级的程序运行性能分析，找出被调用最多、运行时间最长的方法</span><br><span class="line">离线程序快照：收集程序的运行时配置、线程dump、内存dump等信息建立一个快照、可以将快照发送开发者处进行BUG反馈</span><br></pre></td></tr></table></figure>
<p><strong>JVisualVM监控Tomcat</strong></p>
<p>1、本地Tomcat：打开JVisualVm 既可以开始监控</p>
<p>2、远程Tomcat</p>
<p>2.1、配置服务器端Tomcat的JMX，在Tomcat的bin目录下的catalina.sh添加以下内容<br><img src="https://img.huyunshun.com/img/20200331130248.png" alt="20200331130248"></p>
<p>2.2、客户端启动JVisualVM工具</p>
<p>右键”远程”–&gt;“添加远程主机”–&gt;在”主机名”处输入Tomcat所在服务器IP地址–&gt;点击”确认”</p>
<p>右键刚刚创建的远程主机，选择”添加JMX连接，输入连接：192.168.214.150:11111；勾选”不要求SSL连接”，点击确认，点击创建成功的JMX连接。JVisualVM连接远程Tomcat成功</p>
<p>可以看到顶栏处有4个菜单，分别为：概述、监视、线程、抽样器</p>
<table>
<thead>
<tr>
<th>Tables</th>
<th>Are</th>
</tr>
</thead>
<tbody><tr>
<td>概述</td>
<td>包括JVM参数和系统相关属性等基本信息</td>
</tr>
<tr>
<td>监视</td>
<td>展示了CPU、堆、类装载、线程的活动情况</td>
</tr>
<tr>
<td>线程</td>
<td>展示所有的线程及各自的状态：运行、休眠、等待、驻留、监视</td>
</tr>
<tr>
<td>抽样器</td>
<td>细致的内存和CPU的实时监控</td>
</tr>
</tbody></table>
<p>之后Apache Bench 负责模拟用户请求，再观察JVisualVm变化。</p>

          
        
      
    </div>
     <!-- 相关文章推荐 -->
    
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://huyunshun.com/2017/04/01/Tomcat7%E6%96%B0%E7%9A%84%E8%BF%9E%E6%8E%A5%E6%B1%A0%20TOMCAT%20JDBC%20POOL/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="初晨">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://img.huyunshun.com/img/20200522182348.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="简">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/04/01/Tomcat7%E6%96%B0%E7%9A%84%E8%BF%9E%E6%8E%A5%E6%B1%A0%20TOMCAT%20JDBC%20POOL/" itemprop="url">Tomcat7新的连接池 TOMCAT JDBC POOL</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-01T00:00:00+08:00">
                2017-04-01
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Tomcat/" itemprop="url" rel="index">
                    <span itemprop="name">Tomcat</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Tomcat 在 7.0 以前的版本都是使用 commons-dbcp 做为连接池的实现，但是 dbcp具有问题，原因有：</p>
<ul>
<li>dbcp 是单线程的，为了保证线程安全会锁整个连接池。</li>
<li>dbcp 性能不佳，特别是高度并发系统。</li>
<li>dbcp 太复杂，超过 60 个类。</li>
<li>dbcp 使用静态接口，必须使用给定的jre，在 JDK 1.6 编译有问题。</li>
</ul>
<p>因此很多人会选择一些第三方的连接池组件：c3p0 , bonecp, druid等。为此，Tomcat 从 7.0 开始引入一个新的模块：Tomcat jdbc pool</p>
<ul>
<li>tomcat jdbc pool 近乎兼容 dbcp ，性能更高，异步方式获取连接。</li>
<li>tomcat jdbc pool 是 tomcat 的一个模块，基于 tomcat JULI，使用 Tomcat 的日志框架。<br>使用 javax.sql.PooledConnection 接口获取连接。支持高并发应用环境超简单，核心文件只有8个，更好的空闲连接处理机制；支持 JMX；支持 XA Connection。</li>
</ul>
<p>详情请看<a href="https://tomcat.apache.org/tomcat-7.0-doc/jdbc-pool.html" target="_blank" rel="noopener">https://tomcat.apache.org/tomcat-7.0-doc/jdbc-pool.html</a></p>
<p>tomcat jdbc pool 可在 Tomcat 中直接使用，也可以在独立的应用中使用。</p>
<h4 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h4><blockquote>
<p>Tomcat 中项目直接使用</p>
</blockquote>
<p>创建context.xml，放置于META-INF下。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Context</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">Resource</span></span></span><br><span class="line"><span class="tag">               <span class="attr">name</span>=<span class="string">"test"</span></span></span><br><span class="line"><span class="tag">               <span class="attr">driverClassName</span>=<span class="string">"com.mysql.jdbc.Driver"</span></span></span><br><span class="line"><span class="tag">               <span class="attr">url</span>=<span class="string">"jdbc:mysql://localhost:3306/ssm"</span></span></span><br><span class="line"><span class="tag">               <span class="attr">username</span>=<span class="string">"root"</span></span></span><br><span class="line"><span class="tag">               <span class="attr">password</span>=<span class="string">"123456"</span></span></span><br><span class="line"><span class="tag">               <span class="attr">maxActive</span>=<span class="string">"50"</span></span></span><br><span class="line"><span class="tag">               <span class="attr">maxIdle</span>=<span class="string">"20"</span>                 </span></span><br><span class="line"><span class="tag">               <span class="attr">auth</span>=<span class="string">"Container"</span></span></span><br><span class="line"><span class="tag">               <span class="attr">maxWait</span>=<span class="string">"10000"</span></span></span><br><span class="line"><span class="tag">               <span class="attr">type</span>=<span class="string">"javax.sql.DataSource"</span></span></span><br><span class="line"><span class="tag">       /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Context</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>Java代码：               </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">        Context cxt = <span class="keyword">new</span> InitialContext();<span class="comment">//使用了JNDI本地目录访问</span></span><br><span class="line">        DataSource ds = (DataSource) cxt.lookup(<span class="string">"java:comp/env/test"</span>);<span class="comment">//complete/environment/test</span></span><br><span class="line">        Connection conn = ds.getConnection();<span class="comment">//从连接池取连接</span></span><br><span class="line">        PreparedStatement ps = conn.prepareStatement(<span class="string">"select * from user"</span>);</span><br><span class="line">        ResultSet rs = ps.executeQuery();</span><br><span class="line">        <span class="keyword">while</span>(rs.next())&#123;</span><br><span class="line">                System.out.println(rs.getLong(<span class="number">1</span>) + <span class="string">"   "</span>+rs.getString(<span class="number">2</span>)+<span class="string">"   "</span>+rs.getInt(<span class="number">3</span>) );</span><br><span class="line">        &#125;</span><br><span class="line">        rs.close();</span><br><span class="line">&#125; <span class="keyword">catch</span> (NamingException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>这种连接池当得到连接时，把连接对象状态改为：Active
关闭连接对象时，把连接对象归还给数据库连接池，把状态改变成：Idle</code></p>
<blockquote>
<p>独立应用使用</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.ResultSet;</span><br><span class="line"><span class="keyword">import</span> java.sql.Statement;</span><br><span class="line"><span class="keyword">import</span> org.apache.tomcat.jdbc.pool.DataSource;</span><br><span class="line"><span class="keyword">import</span> org.apache.tomcat.jdbc.pool.PoolProperties;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimplePOJOExample</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        PoolProperties p = <span class="keyword">new</span> PoolProperties();</span><br><span class="line">        p.setUrl(<span class="string">"jdbc:mysql://localhost:3306/mysql"</span>);</span><br><span class="line">        p.setDriverClassName(<span class="string">"com.mysql.jdbc.Driver"</span>);</span><br><span class="line">        p.setUsername(<span class="string">"root"</span>);</span><br><span class="line">        p.setPassword(<span class="string">"password"</span>);</span><br><span class="line">        p.setJmxEnabled(<span class="keyword">true</span>);</span><br><span class="line">        p.setTestWhileIdle(<span class="keyword">false</span>);</span><br><span class="line">        p.setTestOnBorrow(<span class="keyword">true</span>);</span><br><span class="line">        p.setValidationQuery(<span class="string">"SELECT 1"</span>);</span><br><span class="line">        p.setTestOnReturn(<span class="keyword">false</span>);</span><br><span class="line">        p.setValidationInterval(<span class="number">30000</span>);</span><br><span class="line">        p.setTimeBetweenEvictionRunsMillis(<span class="number">30000</span>);</span><br><span class="line">        p.setMaxActive(<span class="number">100</span>);</span><br><span class="line">        p.setInitialSize(<span class="number">10</span>);</span><br><span class="line">        p.setMaxWait(<span class="number">10000</span>);</span><br><span class="line">        p.setRemoveAbandonedTimeout(<span class="number">60</span>);</span><br><span class="line">        p.setMinEvictableIdleTimeMillis(<span class="number">30000</span>);</span><br><span class="line">        p.setMinIdle(<span class="number">10</span>);</span><br><span class="line">        p.setLogAbandoned(<span class="keyword">true</span>);</span><br><span class="line">        p.setRemoveAbandoned(<span class="keyword">true</span>);</span><br><span class="line">        p.setJdbcInterceptors(</span><br><span class="line">          <span class="string">"org.apache.tomcat.jdbc.pool.interceptor.ConnectionState;"</span>+</span><br><span class="line">          <span class="string">"org.apache.tomcat.jdbc.pool.interceptor.StatementFinalizer"</span>);</span><br><span class="line">        DataSource datasource = <span class="keyword">new</span> DataSource();</span><br><span class="line">        datasource.setPoolProperties(p);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        Connection con = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          con = datasource.getConnection();</span><br><span class="line">          Statement st = con.createStatement();</span><br><span class="line">          ResultSet rs = st.executeQuery(<span class="string">"select * from user"</span>);</span><br><span class="line">          <span class="keyword">int</span> cnt = <span class="number">1</span>;</span><br><span class="line">          <span class="keyword">while</span> (rs.next()) &#123;</span><br><span class="line">              System.out.println((cnt++)+<span class="string">". Host:"</span> +rs.getString(<span class="string">"Host"</span>)+</span><br><span class="line">                <span class="string">" User:"</span>+rs.getString(<span class="string">"User"</span>)+<span class="string">" Password:"</span>+rs.getString(<span class="string">"Password"</span>));</span><br><span class="line">          &#125;</span><br><span class="line">          rs.close();</span><br><span class="line">          st.close();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (con!=<span class="keyword">null</span>) <span class="keyword">try</span> &#123;con.close();&#125;<span class="keyword">catch</span> (Exception ignore) &#123;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
     <!-- 相关文章推荐 -->
    
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://huyunshun.com/2017/04/01/Linux%E7%9A%84%E9%A1%B9%E7%9B%AECan't%20connect%20to%20X11%20window%20server%E7%9A%84%E9%97%AE%E9%A2%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="初晨">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://img.huyunshun.com/img/20200522182348.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="简">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/04/01/Linux%E7%9A%84%E9%A1%B9%E7%9B%AECan't%20connect%20to%20X11%20window%20server%E7%9A%84%E9%97%AE%E9%A2%98/" itemprop="url">Linux的项目Can't connect to X11 window server的问题</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-01T00:00:00+08:00">
                2017-04-01
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Tomcat/" itemprop="url" rel="index">
                    <span itemprop="name">Tomcat</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在Linux，tomcat中，web程序使用了AWT绘图，在浏览的时候出现以下异常；</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">java.lang.InternalError: Can&#39;t connect to X11 window server using &#39;localhost:10.0&#39; as the value of the DISPLAY variable.</span><br><span class="line">at sun.awt.X11GraphicsEnvironment.initDisplay(Native Method)</span><br><span class="line">at sun.awt.X11GraphicsEnvironment.access$000(X11GraphicsEnvironment.java:53)</span><br><span class="line">&#96;</span><br></pre></td></tr></table></figure>
<p>CentOS系统，如果以init 5启动，显示是GUI方式运行，不会有这个异常，如果是纯命令模式init 3启动，就异常。</p>
<p>是因为awt绘图api会调用操作系统本地窗口资源绘图，windows对此支持很好，在linux下如果没有进到X window，AWT就不能绘图。</p>
<p>网上的解决方案如下：<br>1、在JVM中加入-Djava.awt.headless=true    对于tomcat ,可以修改catalina.sh,加入 CATALINA_OPTS=”$CATALINA_OPTS -Djava.awt.headless=true”<br> 已验证，无效</p>
<p>2、修改tomcat的startup.sh<br> 加入export CATALINA_OPTS=”-Djava.awt.headless=true”。<br>问题解决，init 3启动级别下，java awt没问题。</p>

          
        
      
    </div>
     <!-- 相关文章推荐 -->
    
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://huyunshun.com/2017/04/01/tomcat%E5%92%8C%E8%BF%90%E7%94%A8%E9%9B%86%E6%88%90--%E5%86%85%E5%B5%8CTomcat%E7%9A%84%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="初晨">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://img.huyunshun.com/img/20200522182348.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="简">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/04/01/tomcat%E5%92%8C%E8%BF%90%E7%94%A8%E9%9B%86%E6%88%90--%E5%86%85%E5%B5%8CTomcat%E7%9A%84%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/" itemprop="url">tomcat和运用集成--内嵌Tomcat的应用开发</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-01T00:00:00+08:00">
                2017-04-01
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Tomcat/" itemprop="url" rel="index">
                    <span itemprop="name">Tomcat</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>将tomcat作为应用的一部分集成到应用中，使得应用可以直接开启http服务，对外提供接口。此时应用程序不必再遵守j2ee中的文件目录格式要求。<br>此种方式改变了以往先部署tomcat容器，再按照j2ee标准目录格式部署应用的做法，开发人员无需搭建Tomcat的环境就可以使用内嵌式Tomcat进行开发，减少搭建J2EE容器环境的时间和开发时容器频繁启动所花时间，提高开发的效率。</p>
<h2 id="Tomcat组成结构"><a href="#Tomcat组成结构" class="headerlink" title="Tomcat组成结构"></a>Tomcat组成结构</h2><p><img src="https://img.huyunshun.com/img/20200331125301.png" alt=""></p>
<p>代码创建Tomcat如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TomcatStarter</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> LifecycleException </span>&#123;</span><br><span class="line">        Tomcat tomcat = <span class="keyword">new</span> Tomcat();</span><br><span class="line">        <span class="comment">//因为Tomcat启动时，需要指定它的工作目录</span></span><br><span class="line">        tomcat.setBaseDir(<span class="string">"/temp"</span>);</span><br><span class="line">        <span class="comment">//可获得一个Server实例，并可以设置此server的port值，在此端口上监听server关闭请求。</span></span><br><span class="line">        Server server = tomcat.getServer();</span><br><span class="line">        <span class="comment">// server.setPort(8080);</span></span><br><span class="line">        <span class="comment">//可获得service实例，其真实类型为StandardService，service实际为上述创建的server中的service；</span></span><br><span class="line">        Service service = tomcat.getService();</span><br><span class="line">        service.setName(<span class="string">"Tomcat-embbeded"</span>);</span><br><span class="line">        <span class="comment">//可获得一个connector实例，默认protocol为“HTTP/1.1”。</span></span><br><span class="line">        <span class="comment">//此connector实际上为上述创建的service中的connector。</span></span><br><span class="line">        <span class="comment">//用于设置监听的端口，即http请求时访问的端口。</span></span><br><span class="line">        Connector connector = tomcat.getConnector();</span><br><span class="line">        <span class="comment">// connector.setPort(8888);</span></span><br><span class="line">        <span class="comment">//创建context时，会将默认的engine、host一同创建，因此在TomcatStarter中可以忽略其创建。</span></span><br><span class="line">        <span class="comment">//addContext中的两个参数分别是contextPath和docBase。</span></span><br><span class="line">        <span class="comment">//contextPath：即网络请求是的路径；</span></span><br><span class="line">        <span class="comment">//docBase：即在tomcatBaseDir/webapps目录下的目录，可以不包含任何文件，但必须存在</span></span><br><span class="line">        Context context = tomcat.addContext(<span class="string">""</span>, <span class="string">"/"</span>);</span><br><span class="line">        <span class="comment">//用于向指定的context添加servlet。</span></span><br><span class="line">        <span class="comment">//tomcat.addServlet("", "test", new MyServlet());</span></span><br><span class="line">        <span class="comment">//用于完成servlet在context中的映射配置。</span></span><br><span class="line">        <span class="comment">//这里同web.xml中的配置相似。</span></span><br><span class="line">        context.addServletMappingDecoded(<span class="string">"/*"</span>, <span class="string">"test"</span>);</span><br><span class="line">        server.start();</span><br><span class="line">        server.await();</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 注意：</span></span><br><span class="line"><span class="comment">         *         service、connector、engine、host的显式创建可以忽略。</span></span><br><span class="line"><span class="comment">         *         engine、host会在context创建时创建；</span></span><br><span class="line"><span class="comment">         *         server会在engine创建时创建；</span></span><br><span class="line"><span class="comment">         *         service会在server创建时创建；</span></span><br><span class="line"><span class="comment">         *         如果没有显式创建connector，需要使用tomcat实例去设置port值，使用tomcat实例启动服务时，会创建connector；</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * 简化后的TomcatStarter可以为:</span></span><br><span class="line"><span class="comment">         *         Tomcat tomcat = new Tomcat();</span></span><br><span class="line"><span class="comment">         *         tomcat.setPort(8080);</span></span><br><span class="line"><span class="comment">         *         Context context = tomcat.addContext("", "/");</span></span><br><span class="line"><span class="comment">         *         tomcat.addServlet("", "test", new MyServlet());</span></span><br><span class="line"><span class="comment">         *         context.addServletMappingDecoded("/*", "test");</span></span><br><span class="line"><span class="comment">         *         tomcat.start();</span></span><br><span class="line"><span class="comment">         *         tomcat.getServer().await();</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h2><p>文件结构：</p>
<p><img src="https://img.huyunshun.com/img/20200331125541.png" alt=""></p>
<p>依赖：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.hu<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tomcat-dev<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.tomcat.embed<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tomcat-embed-websocket<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.5.20<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.tomcat.embed<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tomcat-embed-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.5.20<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.tomcat.embed<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tomcat-embed-jasper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.5.20<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.tomcat<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tomcat-util<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.5.9<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.tomcat.embed<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tomcat-embed-logging-juli<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.5.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>创建一个servlet：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        doGet(req, resp);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        req.setCharacterEncoding(<span class="string">"utf-8"</span>);</span><br><span class="line">        resp.setContentType(<span class="string">"text/html; charset=UTF-8"</span>);</span><br><span class="line">        PrintWriter out = resp.getWriter();</span><br><span class="line">        out.write(<span class="string">"parameter："</span>+ req.getParameter(<span class="string">"par"</span>));</span><br><span class="line">        out.flush();</span><br><span class="line">        out.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>创建Tomcat实例并且配置：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TomcatStarterDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Tomcat tomcat = <span class="keyword">new</span> Tomcat();</span><br><span class="line">        <span class="comment">//设置端口和编码格式</span></span><br><span class="line">        Connector connector = <span class="keyword">new</span> Connector();</span><br><span class="line">        connector.setURIEncoding(<span class="string">"UTF-8"</span>);</span><br><span class="line">        connector.setPort(<span class="number">80</span>);</span><br><span class="line">        tomcat.getService().addConnector(connector);</span><br><span class="line">        <span class="comment">//配置servlet</span></span><br><span class="line">        Context context = tomcat.addContext(<span class="string">"demo"</span>,<span class="keyword">null</span>);</span><br><span class="line">        tomcat.addServlet(context,<span class="string">"demoServlet"</span>,<span class="keyword">new</span> DemoServlet());</span><br><span class="line">        <span class="comment">//servlet映射路径</span></span><br><span class="line">        context.addServletMappingDecoded(<span class="string">"/demoServlet"</span>,<span class="string">"demoServlet"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//设置webapps目录</span></span><br><span class="line">        String dir = System.getProperty(<span class="string">"user.dir"</span>)+ File.separator;</span><br><span class="line">        System.out.println(dir);</span><br><span class="line">        tomcat.getHost().setAppBase(dir);</span><br><span class="line">        tomcat.addWebapp(<span class="string">""</span>,<span class="string">"webapps"</span>);</span><br><span class="line"></span><br><span class="line">        tomcat.start();</span><br><span class="line">        <span class="comment">//维持tomcat服务</span></span><br><span class="line">        tomcat.getServer().await();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行：<a href="http://localhost/demo/demoServlet?par=hello" target="_blank" rel="noopener">http://localhost/demo/demoServlet?par=hello</a></p>
<p>测试成功，在webapp下创建html，一样可以访问。</p>

          
        
      
    </div>
     <!-- 相关文章推荐 -->
    
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://huyunshun.com/2017/04/01/Tomcat%E7%83%AD%E9%83%A8%E7%BD%B2%E7%9A%84%E4%B8%89%E7%A7%8D%E6%96%B9%E5%BC%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="初晨">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://img.huyunshun.com/img/20200522182348.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="简">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/04/01/Tomcat%E7%83%AD%E9%83%A8%E7%BD%B2%E7%9A%84%E4%B8%89%E7%A7%8D%E6%96%B9%E5%BC%8F/" itemprop="url">Tomcat热部署的三种方式</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-01T00:00:00+08:00">
                2017-04-01
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Tomcat/" itemprop="url" rel="index">
                    <span itemprop="name">Tomcat</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><strong>热部署是指在你修改项目BUG的时候对JSP或JAVA类进行了修改在不重启WEB服务器前提下能让修改生效。但是对配置文件的修改除外!</strong></p>
<p>1、直接把项目web文件夹放在webapps里。</p>
<p>2、在tomcat\conf\server.xml中的<host></host>内部添加<context/>标签:<br><Context debug="0" docBase="D:\demo1\web" path="/demo1" privileged="true" reloadable="true"/></p>
<p>docBase:项目路径，可以使用绝对路径或相对路径，相对路径是相对于webapps<br>path:访问项目的路径，如：<a href="http://127.0.0.1:8080/demo1" target="_blank" rel="noopener">http://127.0.0.1:8080/demo1</a><br>reloadable:是否自动加载新增或改变的class文件.<br>debug属性与这个Engine关联的Logger记录的调试信息的详细程度。数字越大，输出越详细。如果没有指定，缺省为0。 也就是程序异常时写入日志文件里的详细程度。</p>
<p>3、第三种方式和第二种差不多，但是不是在Server.xml文件中添加Context标签，而是在<br>%tomcat_home%\conf\Catalina\localhost中添加一个XML文件，</p>
<p>如:demo1.xml，内容如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;Context docBase&#x3D;&quot;D:\demo1\web&quot; reloadable&#x3D;&quot;true&quot; &#x2F;&gt;</span><br></pre></td></tr></table></figure>
<p><code>只是缺少了path属性，如果你硬写个path=&quot;demo2&quot;的话，是没有用的，tomcat不明确的告诉你：&quot;我不认得&quot;，
这种方式服务器会使用xml文件的名字作为path属性的名字，SO访问地址为：http://localhost:8080/demo1</code></p>
<blockquote>
<p>还有一种方式：使用第三方工具  <a href="http://www.zeroturnaround.com/jrebel/" target="_blank" rel="noopener">http://www.zeroturnaround.com/jrebel/</a></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">1、解压缩包</span><br><span class="line">2、执行Java -jar jrebel-setup.jar</span><br><span class="line">3、会弹出一个安装界面（自己看，很好懂）</span><br><span class="line">4、在MyEclipse中配置，找到服务器(如tomcat)的配置页面，在tomcat的jdk配置页面的Optional Java VM arguments输入框中加如下参数:-noverify -javaagent:D:\dev\JRebel\jrebel.jar -Drebel.dirs&#x3D;D:\dev\apache-tomcat-6.0.20\webapps\nmr</span><br><span class="line">        第一个路径是jar包的绝对路径，第二个地址是说想让哪个目录下的类更改后不重启服务。</span><br><span class="line">        如果Optional java VM arguments输入框中有其他参数,用空格隔开。</span><br><span class="line">5、发布项目，就能在控制台看到效果。</span><br><span class="line"></span><br><span class="line">类就可以改变之后不用重启tomcat。目前流行的服务器都支持。详细看官方网站。</span><br><span class="line">下载的压缩包文件名为jrebel-setup.zip (7.8 MB)</span><br><span class="line"></span><br><span class="line">可参考：http:&#x2F;&#x2F;japankn.javaeye.com&#x2F;blog&#x2F;577931</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
     <!-- 相关文章推荐 -->
    
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://huyunshun.com/2017/01/20/MySQL%E7%B4%A2%E5%BC%95%E7%AE%A1%E7%90%86%E5%92%8C%E4%BC%98%E5%8C%96/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="初晨">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://img.huyunshun.com/img/20200522182348.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="简">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/01/20/MySQL%E7%B4%A2%E5%BC%95%E7%AE%A1%E7%90%86%E5%92%8C%E4%BC%98%E5%8C%96/" itemprop="url">MySQL索引管理和优化</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-01-20T00:00:00+08:00">
                2017-01-20
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/mysql/" itemprop="url" rel="index">
                    <span itemprop="name">mysql</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="MySQL-中的索引简介"><a href="#MySQL-中的索引简介" class="headerlink" title="MySQL 中的索引简介"></a>MySQL 中的索引简介</h2><h3 id="索引的优点"><a href="#索引的优点" class="headerlink" title="索引的优点"></a>索引的优点</h3><p>创建索引可以大大提高系统的查询性能。</p>
<pre><code>第一、通过创建唯一性索引，可以保证数据库表中每一行数据的唯一性。
第二、可以大大加快 数据的检索速度，这也是创建索引的最主要的原因。
第三、可以加速表和表之间的连接，特别是在实现数据的参考完整性方面特别有意义。
第四、在使用分组和排序子句进行数据检索时，同样可以显著减少查询中分组和排序的时间。</code></pre><h3 id="索引的缺点"><a href="#索引的缺点" class="headerlink" title="索引的缺点"></a>索引的缺点</h3><p>增加索引有如此多的优点，为什么不对表中的每一个列创建一个索引呢？ 增加索引也有许多不利的一个方面：</p>
<pre><code>第一、创建索引和维护索引要耗费时间，这种时间随着数据量的增加而增加。
第二、索引需要占物理空间，除了数据表占数据空间之外，每一个索引还要占一定的物理空间。如果要建立聚簇索引，那么需要的空间就会更大。
第三、当对表中的数据进行增加、删除和修改的时候，索引也要动态的维护，这样就降低了数据的维护速度。</code></pre><h3 id="什么样的字段适合创建索引"><a href="#什么样的字段适合创建索引" class="headerlink" title="什么样的字段适合创建索引"></a>什么样的字段适合创建索引</h3><p>索引是建立在数据库表中的某些列的上面。因此，在创建索引的时候，应该仔细考虑在哪些列上可以创建索引，在哪些列上不能创建索引。 </p>
<pre><code>第一、在经常需要搜索的列上，可以加快搜索的速度；
第二、在作为主键的列上，强制该列的唯一性和组织表中数据的排列结构；
第三、在经常用在连接的列上，这些列主要是一些外键，可以加快连接的速度；
第四、在经常需要根据范围进行搜索的列上创建索引，因为索引已经排序，其指定的范围是连续的；
第五、在经常需要排序的列上创建索引，因为索引已经排序，这样查询可以利用索引的排序，加快排序查询时间；
第六、在经常使用在 WHERE 子句中的列上面创建索引，加快条件的判断速度。建立索引，一般按照 select 的 where 条件来建立，比如： select 的条件是 where f1 andf2，那么如果我们在字段 f1 或字段 f2 上建立索引是没有用的，只有在字段 f1 和 f2 上同时建立索引才有用</code></pre><h3 id="什么样的字段不适合创建索引"><a href="#什么样的字段不适合创建索引" class="headerlink" title="什么样的字段不适合创建索引"></a>什么样的字段不适合创建索引</h3><pre><code>第一，对于那些在查询中很少使用或者参考的列不应该创建索引。这是因为，既然这些列很少使用到，因此有索引或者无索引，并不能提高查询速度。相反，由于增加了索引，反而降低了系统的维护速度和增大了空间需求。
第二，对于那些只有很少数据值的列也不应该增加索引。这是因为，由于这些列的取值很少，例如人事表的性别列，在查询的结果中，结果集的数据行占了表中数据行的很大比例，即需要在表中搜索的数据行的比例很大。增加索引，并不能明显加快检索速度。
第三，对于那些定义为 text, image 和 bit 数据类型的列不应该增加索引。这是因为，这些列的数据量要么相当大，要么取值很少。
第四，当修改性能远远大于检索性能时，不应该创建索引。这是因为，修改性能和检索性能是互相矛盾的。当增加索引时，会提高检索性能，但是会降低修改性能。当减少索引时，会提高修改性能，降低检索性能。因此，当修改性能远远大于检索性能时，不应该创建索引。</code></pre><h2 id="MySQL-中的索引种类"><a href="#MySQL-中的索引种类" class="headerlink" title="MySQL 中的索引种类"></a>MySQL 中的索引种类</h2><p>B-Tree 索引；Full-text 索引</p>
<h2 id="MySQL-中的索引管理"><a href="#MySQL-中的索引管理" class="headerlink" title="MySQL 中的索引管理"></a>MySQL 中的索引管理</h2><p>在 MySQL 中，对索引的查看和删除操作是所有索引类型通用的。</p>
<h3 id="普通索引"><a href="#普通索引" class="headerlink" title="普通索引"></a>普通索引</h3><pre><code>这是最基本的索引，它没有任何限制 MyIASM 中默认的 BTREE 类型的索引，也是我们大多数情况下用到的索引。
创建索引
CREATE INDEX index_name ON table_name (column(length))
ALTER TABLE table_name ADD INDEX index_name (column(length))
CREATE TABLE table_name (id int not null auto_increment,title varchar(30) ,PRIMARY
KEY(id) , INDEX index_name (title(5)))
查看索引
SHOW INDEX FROM [table_name]
SHOW KEYS FROM [table_name] # 只在 MySQL 中可以使用 keys 关键字。
删除索引
DROP INDEX index_name ON talbe_name
ALTER TABLE table_name DROP INDEX index_name
ALTER TABLE table_name DROP PRIMARY KEY</code></pre><h3 id="唯一索引"><a href="#唯一索引" class="headerlink" title="唯一索引"></a>唯一索引</h3><p>与普通索引类似，不同的就是：索引列的值必须唯一，但允许有空值（注意和主键不同）。如果是组合索引，则列值的组合必须唯一，创建方法和普通索引类似</p>
<pre><code>创建索引
CREATE UNIQUE INDEX index_name ON table_name (column(length))
ALTER TABLE table_name ADD UNIQUE index_name (column(length))
CREATE TABLE table_name (id int not null auto_increment,title varchar(30) ,PRIMARY
KEY(id) , UNIQUE index_name (title(length)))</code></pre><h3 id="全文索引（FULLTEXT）"><a href="#全文索引（FULLTEXT）" class="headerlink" title="全文索引（FULLTEXT）"></a>全文索引（FULLTEXT）</h3><p>MySQL 从 3.23.23 版开始支持全文索引和全文检索，FULLTEXT 索引仅可用于 MyISAM表；他们可以从 CHAR、VARCHAR 或 TEXT 列中作为 CREATE TABLE 语句的一部分被创建，或是随后使用 ALTER TABLE 或 CREATE INDEX 被添加。对于较大的数据集，将你的资料输入一个没有 FULLTEXT 索引的表中，然后创建索引，其速度比把资料输入现有 FULLTEXT 索引的速度更为快。不过切记对于大容量的数据表，生成全文索引是一个非常消耗时间非常消耗硬盘空间的做法。</p>
<pre><code>创建索引
CREATE FULLTEXT INDEX index_name ON table_name(column(length))
ALTER TABLE table_name ADD FULLTEXT index_name( column)
CREATE TABLE table_name (id int not null auto_increment,title varchar(30) ,PRIMARY
KEY(id) , FULLTEXT index_name (title))</code></pre><h3 id="组合索引（最左前缀）"><a href="#组合索引（最左前缀）" class="headerlink" title="组合索引（最左前缀）"></a>组合索引（最左前缀）</h3><p>CREATE TABLE article(id int not null, title varchar(255), time date);</p>
<p>平时用的 SQL 查询语句一般都有比较多的限制条件，所以为了进一步榨取 MySQL 的效率，就要考虑建立组合索引。例如上表中针对 title 和 time 建立一个组合索引：ALTER TABLEarticle ADD INDEX index_title_time (title(50),time(10))。建立这样的组合索引，其实是相当于分别建立了下面两组组合索引：</p>
<p>-title,time -title</p>
<h2 id="MySQL-中的索引优化"><a href="#MySQL-中的索引优化" class="headerlink" title="MySQL 中的索引优化"></a>MySQL 中的索引优化</h2><p>上面都在说使用索引的好处，但过多的使用索引将会造成滥用。因此索引也会有它的缺点。虽然索引大大提高了查询速度，同时却会降低更新表的速度，如对表进行 INSERT、UPDATE和 DELETE 次数大于查询次数时，放弃索引。因为更新表时，MySQL 不仅要保存数据，还要保存一下索引文件。建立索引会占用磁盘空间的索引文件。一般情况这个问题不太严重，但如果你在一个大表上创建了多种组合索引，索引文件的会膨胀很快。索引只是提高效率的一个因素，如果你的 MySQL 有大数据量的表，就需要花时间研究建立最优秀的索引，或优化查询语句。</p>
<h3 id="索引不会包含有-NULL-值的列"><a href="#索引不会包含有-NULL-值的列" class="headerlink" title="索引不会包含有 NULL 值的列"></a>索引不会包含有 NULL 值的列</h3><p>只要列中包含有 NULL 值都将不会被包含在索引中，组合索引中只要有一列含有 NULL值，那么这一列对于此组合索引就是无效的。所以我们在数据库设计时不要让字段的默认值为 NULL。create table table_name(c1 varchar(32) default ‘0’)</p>
<h3 id="使用短索引"><a href="#使用短索引" class="headerlink" title="使用短索引"></a>使用短索引</h3><p>对串列进行索引，如果可能应该指定一个前缀长度。例如，如果有一个 CHAR(255)的列，如果在前 10 个或 20 个字符内，多数值是惟一的，那么就不要对整个列进行索引。短索引不仅可以提高查询速度而且可以节省磁盘空间和 I/O 操作。<br>CREATE INDEX index_name ON table_name (column(length))</p>
<h3 id="索引列排序"><a href="#索引列排序" class="headerlink" title="索引列排序"></a>索引列排序</h3><p>MySQL 查询只使用一个索引，因此如果 where 子句中已经使用了索引的话，那么 orderby 中的列是不会使用索引的。因此数据库默认排序可以符合要求的情况下不要使用排序操作；尽量不要包含多个列的排序，如果需要最好给这些列创建复合索引。</p>
<h3 id="like-语句操作"><a href="#like-语句操作" class="headerlink" title="like 语句操作"></a>like 语句操作</h3><p>一般情况下不鼓励使用 like 操作，如果非使用不可，如何使用也是一个问题。like “%aaa%” 不会使用索引，而 like “aaa%”可以使用索引。</p>
<h3 id="不要在列上进行运算"><a href="#不要在列上进行运算" class="headerlink" title="不要在列上进行运算"></a>不要在列上进行运算</h3><p>例如：select * from users where YEAR(adddate)&lt;2007，将在每个行上进行运算，这将导致 索 引 失 效 而 进 行 全 表 扫 描 ， 因 此 我 们 可 以 改 成 ： select * from users where adddate&lt;’2007-01-01′ 8 索引总结</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>MySQL 只对以下操作符才使用索引：&lt;，&lt;=，,=，&gt;，&gt;=，between，in，以及某些时候的 like(不以通配符%或_开头的情形)。而理论上每张表里面最多可创建 16 个索引，不过除非是数据量真的很多，否则过多的使用索引也不是那么好玩的。</p>
<p>建议：一个表的索引数最好不要超过 6 个，若太多则应考虑一些不常使用到的列上建的索引是否有必要。</p>
<h2 id="常见优化策略"><a href="#常见优化策略" class="headerlink" title="常见优化策略"></a>常见优化策略</h2><h3 id="避免全表扫描"><a href="#避免全表扫描" class="headerlink" title="避免全表扫描"></a>避免全表扫描</h3><p>对查询进行优化，应尽量避免全表扫描，首先应考虑在 where 及 order by 涉及的列上建立索引。</p>
<h3 id="避免判断-null-值"><a href="#避免判断-null-值" class="headerlink" title="避免判断 null 值"></a>避免判断 null 值</h3><pre><code>应尽量避免在 where 子句中对字段进行 null 值判断，否则将导致引擎放弃使用索引而进行全表扫描，如：select id from t where num is null
可以在 num 上设置默认值 0，确保表中 num 列没有 null 值，然后这样查询：select id from t where num=0</code></pre><h3 id="避免不等值判断"><a href="#避免不等值判断" class="headerlink" title="避免不等值判断"></a>避免不等值判断</h3><p>应尽量避免在 where 子句中使用!=或&lt;&gt;操作符，否则引擎将放弃使用索引而进行全表扫描。</p>
<h3 id="避免使用-or-逻辑"><a href="#避免使用-or-逻辑" class="headerlink" title="避免使用 or 逻辑"></a>避免使用 or 逻辑</h3><pre><code>应尽量避免在 where 子句中使用 or 来连接条件，否则将导致引擎放弃使用索引而进行全表扫描，如：
select id from t where num=10 or num=20

可以这样查询：
select id from t where num=10
union all
select id from t where num=20</code></pre><h3 id="慎用-in-和-not-in-逻辑"><a href="#慎用-in-和-not-in-逻辑" class="headerlink" title="慎用 in 和 not in 逻辑"></a>慎用 in 和 not in 逻辑</h3><pre><code>in 和 not in 也要慎用，否则会导致全表扫描，如：select id from t1 where num in(select id from t2 where id &gt; 10)
此时外层查询会全表扫描，不使用索引。可以修改为：select id from t1,(select id from t1 where id &gt; 10)t2 where t1.id = t2.id
此时索引被使用，可以明显提升查询效率。</code></pre><h3 id="注意模糊查询"><a href="#注意模糊查询" class="headerlink" title="注意模糊查询"></a>注意模糊查询</h3><p>下面的查询也将导致全表扫描：<br>select id from t where name like ‘%abc%’ 模糊查询如果是必要条件时，可以使用 select id from t where name like ‘abc%’来实现模糊查询，此时索引将被使用。如果头匹配是必要逻辑，建议使用全文搜索引擎（Elastic search、Lucene、Solr 等）。</p>
<h3 id="避免查询条件中字段计算"><a href="#避免查询条件中字段计算" class="headerlink" title="避免查询条件中字段计算"></a>避免查询条件中字段计算</h3><pre><code>应尽量避免在 where 子句中对字段进行表达式操作，这将导致引擎放弃使用索引而进行全表扫描。如：select id from t where num/2=100
应改为: select id from t where num=100*2</code></pre><h3 id="避免查询条件中对字段进行函数操作"><a href="#避免查询条件中对字段进行函数操作" class="headerlink" title="避免查询条件中对字段进行函数操作"></a>避免查询条件中对字段进行函数操作</h3><pre><code>应尽量避免在 where 子句中对字段进行函数操作，这将导致引擎放弃使用索引而进行全表扫描。如：select id from t where substring(name,1,3)=&apos;abc&apos;--name 以 abc 开头的 id
应改为：select id from t where name like &apos;abc%&apos; 9.9WHERE 子句&quot;=&quot;左边注意点
不要在 where 子句中的&quot;=&quot;左边进行函数、算术运算或其他表达式运算，否则系统将可能无法正确使用索引。</code></pre><h3 id="组合索引使用"><a href="#组合索引使用" class="headerlink" title="组合索引使用"></a>组合索引使用</h3><p>在使用索引字段作为条件时，如果该索引是复合索引，那么必须使用到该索引中的第一个字段作为条件时才能保证系统使用该索引，否则该索引将不会被使用，并且应尽可能的让字段顺序与索引顺序相一致。</p>
<h3 id="不要定义无异议的查询"><a href="#不要定义无异议的查询" class="headerlink" title="不要定义无异议的查询"></a>不要定义无异议的查询</h3><pre><code>不要写一些没有意义的查询，如需要生成一个空表结构：
select col1,col2 into #t from t where 1=0
这类代码不会返回任何结果集，但是会消耗系统资源的，应改成这样：
create table #t(...)</code></pre><h3 id="exists"><a href="#exists" class="headerlink" title="exists"></a>exists</h3><pre><code>很多时候用 exists 代替 in 是一个好的选择：
select num from a where num in(select num from b)
用下面的语句替换：
select num from a where exists(select 1 from b where num=a.num)</code></pre><h3 id="索引也可能失效"><a href="#索引也可能失效" class="headerlink" title="索引也可能失效"></a>索引也可能失效</h3><p>并不是所有索引对查询都有效，SQL 是根据表中数据来进行查询优化的，当索引列有大量数据重复时，SQL 查询可能不会去利用索引，如一表中有字段 sex，male、female 几乎各一半，那么即使在 sex 上建了索引也对查询效率起不了作用。</p>
<h3 id="表格字段类型选择"><a href="#表格字段类型选择" class="headerlink" title="表格字段类型选择"></a>表格字段类型选择</h3><p>尽量使用数字型字段，若只含数值信息的字段尽量不要设计为字符型，这会降低查询和连接的性能，并会增加存储开销。这是因为引擎在处理查询和连接时会逐个比较字符串中每一个字符，而对于数字型而言只需要比较一次就够了。</p>
<p>尽可能的使用 varchar 代替 char ，因为首先可变长度字段存储空间小，可以节省存储空间，其次对于查询来说，在一个相对较小的字段内搜索效率显然要高些。</p>
<h3 id="查询语法中的字段"><a href="#查询语法中的字段" class="headerlink" title="查询语法中的字段"></a>查询语法中的字段</h3><p>任何地方都不要使用 select * from t ，用具体的字段列表代替”*”，不要返回用不到的任何字段。</p>
<h3 id="索引无关优化"><a href="#索引无关优化" class="headerlink" title="索引无关优化"></a>索引无关优化</h3><pre><code>不使用*、尽量不使用 union，union all 等关键字、尽量不使用 or 关键字、尽量使用等值判断。
表连接建议不超过 5 个。如果超过 5 个，则考虑表格的设计。（互联网应用中）表连接方式使用外联优于内联。
外连接有基础数据存在。
如：A left join B,基础数据是 A。
A inner join B，没有基础数据的，先使用笛卡尔积完成全连接，在根据连接条件得到内连接结果集。
大数据量级的表格做分页查询时，如果页码数量过大，则使用子查询配合完成分页逻辑。
Select * from table limit 1000000, 10
Select * from table where id in (select pk from table limit 100000, 10)</code></pre>
          
        
      
    </div>
     <!-- 相关文章推荐 -->
    
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://huyunshun.com/2016/12/20/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E5%BC%95%E6%93%8E%E4%BB%8B%E7%BB%8D/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="初晨">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://img.huyunshun.com/img/20200522182348.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="简">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/12/20/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E5%BC%95%E6%93%8E%E4%BB%8B%E7%BB%8D/" itemprop="url">MySQL数据库引擎介绍</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-12-20T00:00:00+08:00">
                2016-12-20
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/mysql/" itemprop="url" rel="index">
                    <span itemprop="name">mysql</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="MySQL架构"><a href="#MySQL架构" class="headerlink" title="MySQL架构"></a>MySQL架构</h2><p><img src="https://img.huyunshun.com/img/20200420155948.png" alt="20200420155948"></p>
<h2 id="MySQL-数据库引擎简介"><a href="#MySQL-数据库引擎简介" class="headerlink" title="MySQL 数据库引擎简介"></a>MySQL 数据库引擎简介</h2><h3 id="ISAM-Indexed-Sequential-Access-Method"><a href="#ISAM-Indexed-Sequential-Access-Method" class="headerlink" title="ISAM(Indexed Sequential Access Method)"></a>ISAM(Indexed Sequential Access Method)</h3><p>ISAM 是一个定义明确且历经时间考验的数据表格管理方法，它在设计之时就考虑到数据库被查询的次数要远大于更新的次数。因此，ISAM 执行读取操作的速度很快，而且不占用大量的内存和存储资源。ISAM 的两个主要不足之处在于，它不支持事务处理，也不能够容错。如果你的硬盘崩溃了，那么数据文件就无法恢复了。如果你正在把 ISAM 用在关键任务应用程序里，那就必须经常备份你所有的实时数据，通过其复制特性，MYSQL 能够支持这样的备份应用程序。</p>
<p>注意：使用 ISAM 注意点：必须经常备份所有实时数据。</p>
<h3 id="MyISAM"><a href="#MyISAM" class="headerlink" title="MyISAM"></a>MyISAM</h3><p>MyISAM 是 MySQL 的 ISAM 扩展格式（MySQL5.5 之前版本的缺省数据库引擎）数据库引擎。除了提供 ISAM 里所没有的索引和字段管理的大量功能，MyISAM 还使用一种表格锁定的机制，来优化多个并发的读写操作，其代价是你需要经常运行 OPTIMIZE TABLE 命令，来恢复被更新机制所浪费的空间。MyISAM 还有一些有用的扩展，例如用来修复数据库文件的 MyISAMCHK 工具和用来恢复浪费空间的 MyISAMPACK 工具。</p>
<p>MYISAM 强调了快速读取操作，这可能就是为什么 MySQL 受到了 WEB 开发如此青睐的主要原因：在 WEB 开发中你所进行的大量数据操作都是读取操作。所以，大多数虚拟主机提供商和 INTERNET 平台提供商只允许使用 MYISAM 格式。MyISAM 格式的一个重要缺陷就是不能在表损坏后恢复数据。MyISAM 引擎使用注意：必须经常使用 Optimize Table 命令清理空间；必须经常备份所有实时数据。工具有用来修复数据库文件的 myISAMCHK 工具和用来恢复浪费空间的MyISAMPACK 工具。不支持事务。数据越多，写操作效率越低。因为要维护数据和索引信息。（索引列越多，相对效率月底。）如果使用该数据库引擎，会生成三个文件：</p>
<pre><code>.frm:表结构信息
.MYD:数据文件
.MYI:表的索引信息</code></pre><h3 id="InnoDB"><a href="#InnoDB" class="headerlink" title="InnoDB"></a>InnoDB</h3><p>InnoDB 数据库引擎都是造就 MySQL 灵活性的技术的直接产品，这项技术就是 MYSQL++API。在使用 MYSQL 的时候，你所面对的每一个挑战几乎都源于 ISAM 和 MyISAM 数据库引擎不支持事务处理（transaction process）也不支持外键。尽管要比 ISAM 和 MyISAM 引擎慢很多，但是 InnoDB 包括了对事务处理和外来键的支持，这两点都是前两个引擎所没有的。是现在的 MySQL（5.5 以上版本）常用版本默认引擎MySQL 官方对 InnoDB 是这样解释的：InnoDB 给 MySQL 提供了具有提交、回滚和崩溃恢复能力的事务安全（ACID 兼容）存储引擎。InnoDB 锁定在行级并且也在 SELECT 语句提供一个 Oracle 风格一致的非锁定读，这些特色增加了多用户部署的性能。没有在 InnoDB 中扩大锁定的需要，因为在 InnoDB 中行级锁定适合非常小的空间。InnoDB 也支持 FOREIGN KEY强制。在 SQL 查询中，你可以自由地将 InnoDB 类型的表与其它 MySQL 的表的类型混合起来，甚至在同一个查询中也可以混合。</p>
<p>InnoDB 是为处理巨大数据量时的最大性能设计，它的 CPU 效率可能是任何其它基于磁盘的关系数据库引擎所不能匹敌的。InnoDB 存储引擎被完全与 MySQL 服务器整合，InnoDB 存储引擎为在主内存中缓存数据和索引而维持它自己的缓冲池。InnoDB 存储它的表＆索引在一个表空间中，表空间可以包含数个文件（或原始磁盘分区）。这与 MyISAM 表不同，比如在 MyISAM 表中每个表被存在分离的文件中。InnoDB 表可以是任何尺寸，即使在文件尺寸被限制为 2GB 的操作系统上。在 MySQL5.7 版本中，InnoDB 存储引擎管理的数据文件为两个：分别是 frm,idb 文件。</p>
<p>InnoDB 特点：</p>
<pre><code>1）、支持事务
2）、数据多版本读取（InnoDB+MyISAM+ISAM）
3）、锁定机制的改进
4）、实现外键</code></pre><h4 id="innodb-与-myisam-区别"><a href="#innodb-与-myisam-区别" class="headerlink" title="innodb 与 myisam 区别"></a>innodb 与 myisam 区别</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1. InnoDB 支持事务，MyISAM 不支持，对于 InnoDB 每一条 SQL 语言都默认封装成事务，自动提交，这样会影响速度，所以最好把多条 SQL 语言放在 begin transaction 和 commit 之间，组成一个事务；</span><br><span class="line">2. InnoDB 支持外键，而 MyISAM 不支持。对一个包含外键的 InnoDB 表转为 MYISAM 会失败；</span><br><span class="line">3. InnoDB 是聚集索引，数据文件是和索引绑在一起的，必须要有主键，通过主键索引效率很高。但是辅助索引需要两次查询，先查询到主键，然后再通过主键查询到数据。因此，主键不应该过大，因为主键太大，其他索引也都会很大。而 MyISAM 是非聚集索引，数据文件是分离的，索引保存的是数据文件的指针。主键索引和辅助索引是独立的。</span><br><span class="line">4. InnoDB 不保存表的具体行数，执行 select count(*) from table 时需要全表扫描。而MyISAM 用一个变量保存了整个表的行数，执行上述语句时只需要读出该变量即可，速度很快；</span><br><span class="line">5. Innodb 不支持全文索引，而 MyISAM 支持全文索引，查询效率上 MyISAM 要高；</span><br></pre></td></tr></table></figure>
<h4 id="如何选择"><a href="#如何选择" class="headerlink" title="如何选择"></a>如何选择</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1. 是否要支持事务，如果要请选择 innodb，如果不需要可以考虑 MyISAM</span><br><span class="line">2. 如果表中绝大多数都只是读查询，可以考虑 MyISAM，如果既有读写也挺频繁，请使用 InnoDB。</span><br><span class="line">3. 系统崩溃后，MyISAM 恢复起来更困难，能否接受；</span><br><span class="line">4. MySQL5.5 版本开始 Innodb 已经成为 Mysql 的默认引擎(之前是 MyISAM)，说明其优势是有目共睹的，如果你不知道用什么，那就用 InnoDB，至少不会差。</span><br></pre></td></tr></table></figure>
<h3 id="Memory-存储引擎"><a href="#Memory-存储引擎" class="headerlink" title="Memory 存储引擎"></a>Memory 存储引擎</h3><p>Memory 存储引擎，通过名字就很容易让人知道，他是一个将数据存储在内存中的存储引擎。Memory 存储引擎不会将任何数据存放到磁盘上，仅仅存放了一个表结构相关信息的.frm 文件在磁盘上面。所以一旦 MySQLCrash 或者主机 Crash 之后，Memory 的表就只剩下一个结构了。Memory 表支持索引，并且同时支持 Hash 和 B－Tree 两种格式的索引。由于是存放在内存中，所以 Memory 都是按照定长的空间来存储数据的，而且不支持 BLOB 和 TEXT类型的字段。Memory 存储引擎实现页级锁定。</p>

          
        
      
    </div>
     <!-- 相关文章推荐 -->
    
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://huyunshun.com/2016/06/21/linux%E4%B8%8A%E5%AE%89%E8%A3%85yum/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="初晨">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://img.huyunshun.com/img/20200522182348.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="简">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/06/21/linux%E4%B8%8A%E5%AE%89%E8%A3%85yum/" itemprop="url">linux上安装yum和使用</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-06-21T00:00:00+08:00">
                2016-06-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index">
                    <span itemprop="name">linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>通过wget命令下载安装</p>
<pre><code>[root@localhost ~]# wget http://yum.baseurl.org/download/3.4/yum-3.4.3.tar.gz
--2019-02-17 07:22:41--  http://yum.baseurl.org/download/3.4/yum-3.4.3.tar.gz
Resolving yum.baseurl.org... 140.211.9.35
Connecting to yum.baseurl.org|140.211.9.35|:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 1140370 (1.1M) [application/x-gzip]
Saving to: &quot;yum-3.4.3.tar.gz&quot;

100%[======================================&gt;] 1,140,370   23.3K/s   in 28s    

2019-02-17 07:23:09 (40.0 KB/s) - &quot;yum-3.4.3.tar.gz&quot; saved [1140370/1140370]</code></pre><p>查看并且移动到tmp中解压</p>
<pre><code>[root@localhost ~]# ls
anaconda-ks.cfg  Downloads           Music     Templates
Desktop          install.log         Pictures  Videos
Documents        install.log.syslog  Public    yum-3.4.3.tar.gz
[root@localhost ~]# mv yum-3.4.3.tar.gz /usr/local/tmp
[root@localhost ~]# ls /usr/local/tmp
apache-tomcat-7.0.68.tar.gz  mysql-5.6.31-linux-glibc2.5-x86_64.tar.gz
Demo.class                   yum-3.4.3.tar.gz
Demo.java
[root@localhost ~]# cd /usr/local/tmp
[root@localhost tmp]# tar -zxvf yum-3.4.3.tar.gz</code></pre><p>进入解压的文件，运行安装yum</p>
<pre><code>[root@localhost yum-3.4.3]# ./yummain.py install yum
Loaded plugins: fastestmirror, refresh-packagekit, security
Loading mirror speeds from cached hostfile
* base: mirrors.huaweicloud.com
* extras: mirrors.shu.edu.cn
* updates: mirrors.shu.edu.cn
Setting up Install Process
Resolving Dependencies
--&gt; Running transaction check
---&gt; Package yum.noarch 0:3.2.29-40.el6.centos will be updated
---&gt; Package yum.noarch 0:3.2.29-81.el6.centos.0.1 will be an update
--&gt; Processing Dependency: python-urlgrabber &gt;= 3.9.1-10 for package: yum-3.2.29-81.el6.centos.0.1.noarch
--&gt; Running transaction check
---&gt; Package python-urlgrabber.noarch 0:3.9.1-9.el6 will be updated
---&gt; Package python-urlgrabber.noarch 0:3.9.1-11.el6 will be an update
--&gt; Finished Dependency Resolution

Dependencies Resolved

================================================================================
Package              Arch      Version                        Repository  Size
================================================================================
Updating:
yum                  noarch    3.2.29-81.el6.centos.0.1       updates    1.0 M
Updating for dependencies:
python-urlgrabber    noarch    3.9.1-11.el6                   base        86 k

Transaction Summary
================================================================================
Upgrade       2 Packages

Total download size: 1.1 M
Is this ok [y/N]: y
Downloading Packages:
(1/2): python-urlgrabber-3.9.1-11.el6.noarch.rpm         |  86 kB     00:00    
warning: rpmts_HdrFromFdno: Header V3 RSA/SHA1 Signature, key ID c105b9de: NOKEY
Public key for python-urlgrabber-3.9.1-11.el6.noarch.rpm is not installed
(2/2): yum-3.2.29-81.el6.centos.0.1.noarch.rpm           | 1.0 MB     00:03    
Public key for yum-3.2.29-81.el6.centos.0.1.noarch.rpm is not installed
--------------------------------------------------------------------------------
Total                                           274 kB/s | 1.1 MB     00:04    
Retrieving key from file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-6
Importing GPG key 0xC105B9DE:
Userid : CentOS-6 Key (CentOS 6 Official Signing Key) &lt;centos-6-key@centos.org&gt;
Package: centos-release-6-5.el6.centos.11.1.x86_64 (@anaconda-CentOS-201311272149.x86_64/6.5)
From   : /etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-6
Is this ok [y/N]: y
Running Transaction Check
Running Transaction Test
Transaction Test Succeeded
Running Transaction
Updating   : python-urlgrabber-3.9.1-11.el6.noarch                        1/4
Updating   : yum-3.2.29-81.el6.centos.0.1.noarch                          2/4
Cleanup    : yum-3.2.29-40.el6.centos.noarch                              3/4
Cleanup    : python-urlgrabber-3.9.1-9.el6.noarch                         4/4

Updated:
yum.noarch 0:3.2.29-81.el6.centos.0.1                                        

Dependency Updated:
python-urlgrabber.noarch 0:3.9.1-11.el6                                      

Complete!
[root@localhost yum-3.4.3]# yum
Loaded plugins: fastestmirror, refresh-packagekit, security
You need to give some command
Usage: yum [options] COMMAND

List of Commands:

check          Check for problems in the rpmdb
check-update   Check for available package updates</code></pre><p>至此，安装完成！！！！！！！！！！！！！</p>
<p>1.备份原始源</p>
<p>cp /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.bak</p>
<p>2.创建新源</p>
<p>wget -O /etc/yum.repos.d/CentOS-Base.repo <a href="http://mirrors.aliyun.com/repo/Centos-6.repo" target="_blank" rel="noopener">http://mirrors.aliyun.com/repo/Centos-6.repo</a></p>
<ol start="3">
<li>重新缓存</li>
</ol>
<p>yum clean all</p>
<p>yum makecache</p>
<h2 id="使用yum来安装或卸载CentOS图形界面包"><a href="#使用yum来安装或卸载CentOS图形界面包" class="headerlink" title="使用yum来安装或卸载CentOS图形界面包"></a>使用yum来安装或卸载CentOS图形界面包</h2><pre><code>命令行模式安装图形界面
yum grouplist 检查已安装的组
yum groupinstall &quot;X Window System&quot;
yum groupinstall &quot;GNOME Desktop Environment&quot;
startx
或者init 5
就OK。
重新安装了带图形界面模式的centos系统，来实验yum方式卸载图形界面
图形界面想要卸载：
yum groupremove &quot;GNOME Desktop Environment&quot;
yum groupremove &quot;X Window System&quot;
以图形界面安装的linux 卸载图形界面之后会提示错误
init: Id &quot;x&quot; respawning too fast: disabled for 5 minutes
解决的办法是
vi /etc/inittab
找到这段文字 把这段文字中id后面的数字改为3 id:3:initdefault 让系统以文本界面启动
找到这段文字x:5:respawn:/etc/X11/prefdm -nodaemon注释掉！
注（此方法未证实能否保证服务器保持稳定！未在服务器上线实验过）</code></pre><h2 id="如何查看yum-安装的软件路径"><a href="#如何查看yum-安装的软件路径" class="headerlink" title="如何查看yum 安装的软件路径"></a>如何查看yum 安装的软件路径</h2><pre><code>比如查看yum install keepalived安装后的路径
第一步：
[root@localhost local]# rpm -qa|grep keepalived
keepalived-1.2.13-5.el6_6.x86_64
第二步得结果：
[root@localhost local]# rpm -ql keepalived-1.2.13-5.el6_6.x86_64
/etc/keepalived
/etc/keepalived/keepalived.conf
/etc/rc.d/init.d/keepalived
/etc/sysconfig/keepalived
/usr/bin/genhash
/usr/libexec/keepalived
/usr/sbin/keepalived
/usr/share/doc/keepalived-1.2.13
/usr/share/doc/keepalived-1.2.13/AUTHOR
/usr/share/doc/keepalived-1.2.13/CONTRIBUTORS
/usr/share/doc/keepalived-1.2.13/COPYING
/usr/share/doc/keepalived-1.2.13/ChangeLog
/usr/share/doc/keepalived-1.2.13/NOTE_vrrp_vmac.txt
/usr/share/doc/keepalived-1.2.13/README
/usr/share/doc/keepalived-1.2.13/TODO
/usr/share/doc/keepalived-1.2.13/VERSION
/usr/share/doc/keepalived-1.2.13/keepalived.conf.SYNOPSIS
/usr/share/doc/keepalived-1.2.13/samples
/usr/share/doc/keepalived-1.2.13/samples/keepalived.conf.HTTP_GET.port
/usr/share/doc/keepalived-1.2.13/samples/keepalived.conf.IPv6
/usr/share/doc/keepalived-1.2.13/samples/keepalived.conf.SMTP_CHECK
/usr/share/doc/keepalived-1.2.13/samples/keepalived.conf.SSL_GET
/usr/share/doc/keepalived-1.2.13/samples/keepalived.conf.fwmark
/usr/share/doc/keepalived-1.2.13/samples/keepalived.conf.inhibit
/usr/share/doc/keepalived-1.2.13/samples/keepalived.conf.misc_check
/usr/share/doc/keepalived-1.2.13/samples/keepalived.conf.misc_check_arg</code></pre><h2 id="yum命令"><a href="#yum命令" class="headerlink" title="yum命令"></a>yum命令</h2><pre><code>1.使用YUM查找软件包
命令：yum search
2.列出所有可安装的软件包
命令：yum list
3.列出所有可更新的软件包
命令：yum list updates
4.列出所有已安装的软件包
命令：yum list installed
5.列出所有已安装但不在 Yum Repository 内的软件包
命令：yum list extras

6.列出所指定的软件包
命令：yum list XX
7.使用YUM获取软件包信息
命令：yum info XX
8.列出所有软件包的信息
命令：yum info
9.列出所有可更新的软件包信息
命令：yum info updates
10.列出所有已安装的软件包信息
命令：yum info installed
11.列出所有已安装但不在 Yum Repository 内的软件包信息
命令：yum info extras
12.列出软件包提供哪些文件
命令：yum provides</code></pre>
          
        
      
    </div>
     <!-- 相关文章推荐 -->
    
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://huyunshun.com/2016/05/11/java%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="初晨">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://img.huyunshun.com/img/20200522182348.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="简">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/05/11/java%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/" itemprop="url">java网络编程</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-05-11T17:51:44+08:00">
                2016-05-11
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java/" itemprop="url" rel="index">
                    <span itemprop="name">java</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="1、Socket编程"><a href="#1、Socket编程" class="headerlink" title="1、Socket编程"></a>1、Socket编程</h2><p>Socket(套接字)：封装着如端口号，ip地址，计算机名等信息的类。通过Socket我们可以和远程计算机通信。</p>
<p>网络通信模型</p>
<p>C/S Client/Server</p>
<p>  客户端通航运行在用户的计算机上，客户端是一个特有的程序，实现特有的功能，连接服务器进行通信，谁发起连接谁是用户。<br>  服务器端通常是等待客户端连接，提供功能服务并与之通信。</p>
<p>B/S</p>
<p>  固定了客户端和通信协议和C/S结构。</p>
<p>通信协议：计算机通信的实质就是相互收发字节。那么按照一定的格式收发字节就是通信协议。</p>
<p>一个最简单的网络通信：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 创建客户端Socket</span></span><br><span class="line"><span class="comment">* Socket客户端类</span></span><br><span class="line"><span class="comment">* 构造的时候就会根据给定的服务端ip地址和服务端的端口号尝试连接</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">"开始连接"</span>);</span><br><span class="line">    Socket socket = <span class="keyword">new</span> Socket(<span class="string">"172.16.3.33"</span>, <span class="number">8088</span>);</span><br><span class="line">    System.out.println(<span class="string">"与服务端连接成功！"</span>);</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 通过socket可以获取一组与服务器通信的输入输出流</span></span><br><span class="line"><span class="comment">    * 我们对其包装就可以方便进行读写信息了。</span></span><br><span class="line"><span class="comment">    * 通过socket拿到的是两个低级流（字节流）</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    InputStream in = socket.getInputStream();</span><br><span class="line">    OutputStream out = socket.getOutputStream();</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 向服务器发送字符，将字符输出流转换成缓冲字符输出流</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    PrintWriter pw = <span class="keyword">new</span> PrintWriter(out);</span><br><span class="line">    pw.println(<span class="string">"你好服务器！"</span>);</span><br><span class="line">    pw.flush();</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 收取服务器发送的字符串，包装为缓冲字符输入流</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    BufferedReader reader = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(in));</span><br><span class="line">    <span class="comment">//读取服务器发回的信息</span></span><br><span class="line">                                                                                                                                                                                                                                                                                                       </span><br><span class="line">    String info = reader.readLine();</span><br><span class="line">    System.out.println(<span class="string">"服务端："</span>+info);</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">    <span class="comment">//e.printStackTrace();</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 服务端</span></span><br><span class="line"><span class="comment">* 服务器端打开socket等待客户端的连接</span></span><br><span class="line"><span class="comment">* 服务器端的Socket名称是ServerSocket</span></span><br><span class="line"><span class="comment">* 创建ServerSocket需要指定服务端口号</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">"dddd"</span>);</span><br><span class="line">        ServerSocket server = <span class="keyword">new</span> ServerSocket(<span class="number">8050</span>);</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">        * 监听端口</span></span><br><span class="line"><span class="comment">        * 等待客户端连接</span></span><br><span class="line"><span class="comment">        * 等待客户端连接的方法accept()</span></span><br><span class="line"><span class="comment">        * 该方法是一个阻塞方法，知道有客户端连接上该方法才会返回，返回的就是当前客户端的套接字。</span></span><br><span class="line"><span class="comment">        * 从中我们可以知道客户端的ip等信息。</span></span><br><span class="line"><span class="comment">        *</span></span><br><span class="line"><span class="comment">        * accept()方法可以重复调用</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        System.out.println(<span class="string">"启动完毕，等待连接"</span>);</span><br><span class="line">        Socket client = server.accept();</span><br><span class="line">        System.out.println(<span class="string">"有一个客户端和我连接了"</span>);</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">        * 通过socket获取输入流读取客户端的信息</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        InputStream in = client.getInputStream();</span><br><span class="line">        OutputStream out = client.getOutputStream();</span><br><span class="line">                                                                                                                                                                                                                                                                                                           </span><br><span class="line">        BufferedReader reader = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(in));</span><br><span class="line">        System.out.println(<span class="string">"客户端："</span>+reader.readLine());</span><br><span class="line">                                                                                                                                                                                                                                                                                                           </span><br><span class="line">        <span class="comment">//向客户端发信息</span></span><br><span class="line">        PrintWriter pw = <span class="keyword">new</span> PrintWriter(out);</span><br><span class="line">        pw.println(<span class="string">"你好客户端"</span>);</span><br><span class="line">        pw.flush();   </span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        <span class="comment">//e.printStackTrace();</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="2、多线程Socket"><a href="#2、多线程Socket" class="headerlink" title="2、多线程Socket"></a>2、多线程Socket</h2><p>Server端多线程：</p>
<p>服务器端无限循环接受客户端的访问，每连接都能茶圣一对新的Socket的实例。</p>
<p>为每个客户端连接创建一个独立线程，处理客户请求。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        ServerSocket server = <span class="keyword">new</span> ServerSocket(<span class="number">8088</span>);</span><br><span class="line">        System.out.println(<span class="string">"启动完毕，等待连接"</span>);</span><br><span class="line">                                                                                                                                                                                                                                                                                                           </span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">        Socket client = server.accept();</span><br><span class="line">        <span class="keyword">if</span>(client==<span class="keyword">null</span>)<span class="keyword">continue</span>;</span><br><span class="line">        System.out.println(<span class="string">"与客户端连接成功"</span>+client.getInetAddress().getHostAddress());</span><br><span class="line">        Handler handler = <span class="keyword">new</span> Handler(client);<span class="comment">//交给线程去处理</span></span><br><span class="line">        Thread t = <span class="keyword">new</span> Thread(handler);</span><br><span class="line">        t.start();</span><br><span class="line">        &#125;   </span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 与客户端通信线程</span></span><br><span class="line"><span class="comment">* 负责与某个特定的socket的客户端进行通信</span></span><br><span class="line"><span class="comment">* 每个线程实例负责一个客户端的通信</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Handler</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 当前线程要通信的客户端socket</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">private</span> Socket client;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Handler</span><span class="params">(Socket client)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.client = client;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">/** 通过socket获取客户端信息 */</span></span><br><span class="line">            InputStream in = <span class="keyword">this</span>.client.getInputStream();</span><br><span class="line">            BufferedReader reader = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(in));</span><br><span class="line">            <span class="comment">/** 死循环读取客户端信息 */</span></span><br><span class="line">                                                                                                                                                                                                                                                                                                               </span><br><span class="line">            <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (reader.readLine() == <span class="keyword">null</span>)</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">                System.out.println(<span class="string">"客户端"</span>+ <span class="keyword">this</span>.client.getInetAddress().getHostAddress() + <span class="string">"："</span> + reader.readLine());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="3、线程池"><a href="#3、线程池" class="headerlink" title="3、线程池"></a>3、线程池</h2><p>上面这种频繁的创建线程和销毁线程是非常消耗资源和性能的。</p>
<p>可以创建一些空的线程，将它们保存起来，当有任务需要并发执行时，我们取出一个空的线程来运行这个任务，当任务运行完毕后，在将线程收回，等待下次分配任务。</p>
<p>这样自始自终我们都只使用了开始创建的那些线程，并可以重复利用来节省性能开销。</p>
<p>JDK提供了线程池的管理器ExecutorService</p>
<p>通过Executors类的静态方法创建几个不同实现的线程池。</p>
<p>Executors.newCachedThreadPool();创建一个缓存线程池，当有任务的时候会检查线程池中是否有空线程，若有就使用它，若没有就创建新的线程。若长久没有使用的线程会自动回收。</p>
<p>Executors.newFixedThreadPool(int threads);创建一个可重用的，具有固定线程数的线程池。</p>
<p>Executors.newScheduledExecutor();创建只有一条线程的线程池，它可以在指定延迟后执行线程任务。</p>
<p>Executors.newSingleThreadExecutor();创建一个只有单线程的线程池，相当于Exceutors.newFixedThreadPool方法时传入参数1。里边维护着一个任务队列。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 创建一个线程池，具有50个</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">ExecutorService threadPool =Executors.newFixedThreadPool(<span class="number">50</span>);</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    ServerSocket server = <span class="keyword">new</span> ServerSocket(<span class="number">8088</span>);</span><br><span class="line">    System.out.println(<span class="string">"启动完毕，等待连接"</span>);</span><br><span class="line">    <span class="comment">/** 将转发消息线程启动 */</span></span><br><span class="line">    SendMessageHandler sHandler = <span class="keyword">new</span> SendMessageHandler();</span><br><span class="line">    Thread sendTh = <span class="keyword">new</span> Thread(sHandler);</span><br><span class="line">    sendTh.start();</span><br><span class="line">                                                                                                                                                                                                                                                                                                       </span><br><span class="line">    <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">        Socket client = server.accept();</span><br><span class="line">        System.out.println(<span class="string">"与客户端连接成功"</span>+client.getInetAddress().getHostAddress());</span><br><span class="line">        Handler handler = <span class="keyword">new</span> Handler(client);<span class="comment">//交给线程去处理</span></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">        * 将需要并发的任务（Runnable）交给线程池</span></span><br><span class="line"><span class="comment">        * 让其分配空线程去运行该任务</span></span><br><span class="line"><span class="comment">        * 若线程都在工作，那么登载，直到有空线程为止。</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        threadPool.execute(handler);</span><br><span class="line">        <span class="comment">//Thread t = new Thread(handler);</span></span><br><span class="line">        <span class="comment">//t.start();</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="4、双端队列"><a href="#4、双端队列" class="headerlink" title="4、双端队列"></a>4、双端队列</h2><p>内部由两个队列实现，他们交替进行存取工作。这样至少可以保证2个线程同时进行存取操作。但是对于两个线程同时进行存或者取，还是要求同步的。</p>
<p>但是比单队列实现线程安全还是要快的。</p>
<p>BlockingDeque双端队列</p>
<p>实现：</p>
<p>1）ArrayBlockingDeque该类实现的构造方法要求我们传入一个整数，代表当前队列的长度。所以这个是一个固定大小的双端队列，存取原则为FIFO先入先出的原则。</p>
<p>当元素调用offer存入了队列时，若队列已满，那么可以设置延时等待，当超过了延时等待会返回存入失败。</p>
<p>2）LinkedBlockingDeque变长双端队列。长度不定，随着元素数量而增加，最大可以达到Integer.MAX_VALUE,重载构造方法可以传入一个整数，使之变为一个定长的队列。</p>
<p>3）PriorityBlockingDeque 这个和LinkedBlockingDeque相似，只不过是进去了自然排序后获取。</p>
<p>4）SynchronousQueue特殊的双端队列 存取步骤有要求，必须存一次取一次，交替进行。</p>
<p>例：</p>
<p>服务端</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 创建一个静态集合保护所有客户端的数输入流</span></span><br><span class="line"><span class="comment">* 注意：因为这个集合被多个线程使用，所哟一集合要是安全的。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">static</span> Vector&lt;PrintWriter&gt; allOut = <span class="keyword">new</span> Vector&lt;PrintWriter&gt;();</span><br><span class="line"><span class="comment">/** 消息队列 */</span></span><br><span class="line"><span class="keyword">static</span> BlockingDeque&lt;String&gt; msgQueue = <span class="keyword">new</span> LinkedBlockingDeque&lt;String&gt;();</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 创建一个线程池，具有50个</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    ExecutorService threadPool =Executors.newFixedThreadPool(<span class="number">50</span>);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        ServerSocket server = <span class="keyword">new</span> ServerSocket(<span class="number">8088</span>);</span><br><span class="line">        System.out.println(<span class="string">"启动完毕，等待连接"</span>);</span><br><span class="line">        <span class="comment">/** 将转发消息线程启动 */</span></span><br><span class="line">        SendMessageHandler sHandler = <span class="keyword">new</span> SendMessageHandler();</span><br><span class="line">        Thread sendTh = <span class="keyword">new</span> Thread(sHandler);</span><br><span class="line">        sendTh.start();</span><br><span class="line">                                    </span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            Socket client = server.accept();</span><br><span class="line">            System.out.println(<span class="string">"与客户端连接成功"</span>+client.getInetAddress().getHostAddress());</span><br><span class="line">            Handler handler = <span class="keyword">new</span> Handler(client);<span class="comment">//交给线程去处理</span></span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">            * 将需要并发的任务（Runnable）交给线程池</span></span><br><span class="line"><span class="comment">            * 让其分配空线程去运行该任务</span></span><br><span class="line"><span class="comment">            * 若线程都在工作，那么登载，直到有空线程为止。</span></span><br><span class="line"><span class="comment">            */</span></span><br><span class="line">            threadPool.execute(handler);</span><br><span class="line">            <span class="comment">//Thread t = new Thread(handler);</span></span><br><span class="line">            <span class="comment">//t.start();</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 与客户端通信线程</span></span><br><span class="line"><span class="comment">* 负责与某个特定的socket的客户端进行通信</span></span><br><span class="line"><span class="comment">* 每个线程实例负责一个客户端的通信</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Handler</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 当前线程要通信的客户端socket</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">private</span> Socket client;</span><br><span class="line">                                </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Handler</span><span class="params">(Socket client)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.client = client;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>&#123;</span><br><span class="line">        PrintWriter pw = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">/** 通过socket获取客户端信息 */</span></span><br><span class="line">            InputStream in = <span class="keyword">this</span>.client.getInputStream();</span><br><span class="line">            BufferedReader reader = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(in));</span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">            * 将当前客户端的输出流保存到共享集合</span></span><br><span class="line"><span class="comment">            */</span></span><br><span class="line">            pw = <span class="keyword">new</span> PrintWriter(client.getOutputStream());</span><br><span class="line">            allOut.add(pw);</span><br><span class="line">            <span class="comment">/** 死循环读取客户端信息 */</span></span><br><span class="line">            <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">                String str = reader.readLine();</span><br><span class="line">                <span class="comment">/**</span></span><br><span class="line"><span class="comment">                * 将信息放入到消息队列</span></span><br><span class="line"><span class="comment">                */</span></span><br><span class="line">                <span class="keyword">if</span>(<span class="string">"q"</span>.equals(str))&#123;</span><br><span class="line">                client.close();</span><br><span class="line">                &#125;</span><br><span class="line">                msgQueue.offer(str);</span><br><span class="line">                <span class="comment">/**</span></span><br><span class="line"><span class="comment">                * arg1：存放的元素</span></span><br><span class="line"><span class="comment">                * arg2：延时时间</span></span><br><span class="line"><span class="comment">                * arg3：延时的时间单位</span></span><br><span class="line"><span class="comment">                *</span></span><br><span class="line"><span class="comment">                * 下面方法是向队列中存放元素，设置5秒超时，若超时了还没有放入队列这返回false</span></span><br><span class="line"><span class="comment">                */</span></span><br><span class="line">                <span class="keyword">boolean</span> tf = msgQueue.offer(str, <span class="number">5</span>, TimeUnit.SECONDS);</span><br><span class="line">            &#125;       </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">            * 抛出异常，我们应该将这个客户端的输出流从共享集合中删除</span></span><br><span class="line"><span class="comment">            * 告诉其他线程不要再发信息了。</span></span><br><span class="line"><span class="comment">            */</span></span><br><span class="line">            allOut.remove(pw);</span><br><span class="line">        &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 转发消息</span></span><br><span class="line"><span class="comment">* 循环消息队列，将每一个消息通过所有客户端的输入流发送给客户端</span></span><br><span class="line"><span class="comment">* 做到广播的效果。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">SendMessageHandler</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            <span class="comment">/** 循环将消息发送给每一个客户端 每50ms作一次*/</span></span><br><span class="line">            String str = <span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">while</span> ((str=msgQueue.poll())!=<span class="keyword">null</span>) &#123;<span class="comment">//and msgQueue.poll()!=null</span></span><br><span class="line">                <span class="comment">/** 获取所有客户端的输出流，将字符串输出 */</span></span><br><span class="line">                <span class="keyword">for</span> (PrintWriter pw : allOut) &#123;</span><br><span class="line">                    pw.println(str);</span><br><span class="line">                    pw.flush();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">50</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>客户端：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 创建客户端Socket</span></span><br><span class="line"><span class="comment">    * Socket客户端类</span></span><br><span class="line"><span class="comment">    * 构造的时候就会根据给定的服务端ip地址和服务端的端口号尝试连接</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">"开始连接"</span>);</span><br><span class="line">        Socket socket = <span class="keyword">new</span> Socket(<span class="string">"172.16.3.14"</span>, <span class="number">8088</span>);</span><br><span class="line">        System.out.println(<span class="string">"与服务端连接成功！"</span>);</span><br><span class="line">              </span><br><span class="line">        <span class="comment">//启动消息线程</span></span><br><span class="line">        Thread readerMsgTh = <span class="keyword">new</span> Thread(<span class="keyword">new</span> ReadMessageHandler(socket.getInputStream()));</span><br><span class="line">        readerMsgTh.start();</span><br><span class="line">              </span><br><span class="line">        OutputStream out = socket.getOutputStream();</span><br><span class="line">        PrintWriter pw = <span class="keyword">new</span> PrintWriter(out);</span><br><span class="line">        BufferedReader reader = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(System.in));</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            pw.println(reader.readLine());</span><br><span class="line">            pw.flush();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">    <span class="comment">//e.printStackTrace();</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 该线程用于从服务器读取信息。</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ReadMessageHandler</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line">      <span class="keyword">private</span> InputStream in;<span class="comment">//从服务端读取信息</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="title">ReadMessageHandler</span><span class="params">(InputStream in)</span> </span>&#123;</span><br><span class="line">          <span class="keyword">this</span>.in = in;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">          <span class="keyword">try</span> &#123;</span><br><span class="line">              <span class="comment">//将字节输入流转换为缓冲字符输入流</span></span><br><span class="line">              BufferedReader reader = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(in));</span><br><span class="line">              <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">                  System.out.println(reader.readLine());</span><br><span class="line">              &#125;</span><br><span class="line">          &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">              e.printStackTrace();</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p><a href="http://www.cnblogs.com/springcsc/archive/2009/12/03/1616413.html这里有一篇文章讲的比较细，把地址记录下来，供查询，感谢作者。" target="_blank" rel="noopener">http://www.cnblogs.com/springcsc/archive/2009/12/03/1616413.html这里有一篇文章讲的比较细，把地址记录下来，供查询，感谢作者。</a></p>

          
        
      
    </div>
     <!-- 相关文章推荐 -->
    
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://huyunshun.com/2016/04/21/linux%E5%AE%89%E8%A3%85JavaEE%E7%8E%AF%E5%A2%83JDK%E3%80%81Tomcat%E3%80%81Mysql/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="初晨">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://img.huyunshun.com/img/20200522182348.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="简">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/04/21/linux%E5%AE%89%E8%A3%85JavaEE%E7%8E%AF%E5%A2%83JDK%E3%80%81Tomcat%E3%80%81Mysql/" itemprop="url">linux安装JavaEE环境JDK、Tomcat、Mysql</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-04-21T00:00:00+08:00">
                2016-04-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index">
                    <span itemprop="name">linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="JDK"><a href="#JDK" class="headerlink" title="JDK"></a>JDK</h2><pre><code>1、把压缩包上传到linux服务器目录/usr/local/tmp
这里使用FileZilla上传
2、解压压缩包：tar zxvf jdk-8u191-linux-x64.tar.gz
3、把解压后的文件复制到/usr/local/jdk8
cp -r jdk1.8.0_191 /usr/local/jdk8
4、配置环境变量，linux是通过修改环境变量配置文件来配置，使用vim编辑：
vim /etc/profile
在文件中添加环境变量信息：
#export PATH USER LOGNAME MAIL HOSTNAME HISTSIZE HISTCONTROL
export JAVA_HOME=/usr/local/jdk8
export PATH=$JAVA_HOME/bin:$PATH
export CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar#jdk1.6以后不用配置classpath</code></pre><p><img src="https://img.huyunshun.com/img/20200421165530.png" alt="20200421165530"></p>
<pre><code>5、解析文件或者重启系统
source /etc/profile
6、验证java环境：
[root@localhost ~]# java -version
java version &quot;1.8.0_191&quot;
Java(TM) SE Runtime Environment (build 1.8.0_191-b12)
Java HotSpot(TM) 64-Bit Server VM (build 25.191-b12, mixed mode)</code></pre><h2 id="Tomcat安装"><a href="#Tomcat安装" class="headerlink" title="Tomcat安装"></a>Tomcat安装</h2><pre><code>1、把安装包上传到服务器/usr/local/tmp
[root@localhost local]# ls tmp
apache-tomcat-7.0.68.tar.gz  Demo.class  Demo.java  mysql-5.6.31-linux-glibc2.5-x86_64.tar.gz
2、解压
[root@localhost local]# tar -zxvf tmp/apache-tomcat-7.0.68.tar.gz
3、复制解压文件到/usr/local/tomcat7.0
命令：cp -r apache-tomcat-7.0.68 /usr/local/tomcat7.0
上一步直接把文件解压到local目录了，这一步直接省略。
[root@localhost local]# ls
apache-tomcat-7.0.68  bin  etc  games  include  jdk8  lib  lib64  libexec  sbin  share  src  tmp
4、添加环境变量vim /etc/profile
export TOMCAT_HOME=/usr/local/apache-tomcat-7.0.68
export CATALINA_HOME=/usr/local/apache-tomcat-7.0.68#tomcat启动主服务</code></pre><p><img src="https://img.huyunshun.com/img/20200421165616.png" alt="20200421165616"></p>
<pre><code>运行配置：source /etc/profile
5、开放端口让通过防火墙（centos默认开放端口只有22）
[root@localhost local]# vim /etc/sysconfig/iptables
类似22端口，增加开放8080端口的配置：
-A INPUT -m state --state NEW -m tcp -p tcp --dport 8080 -j ACCEPT
比如要开放连续的多个端口：8080:9900  #开放8080到9900之间的所有端口。
重启服务，使其端口配置生效。
[root@localhost local]# service iptables restart
iptables: Setting chains to policy ACCEPT: filter          [  OK  ]
iptables: Flushing firewall rules:                         [  OK  ]
iptables: Unloading modules:                               [  OK  ]
iptables: Applying firewall rules:  
分别有：restart  start   stop

6、启动Tomcat
进入到Tomcat的bin目录
直接启动：./startup.sh
[root@localhost bin]# ./startup.sh
Using CATALINA_BASE:   /usr/local/apache-tomcat-7.0.68
Using CATALINA_HOME:   /usr/local/apache-tomcat-7.0.68
Using CATALINA_TMPDIR: /usr/local/apache-tomcat-7.0.68/temp
Using JRE_HOME:        /usr/local/jdk8
Using CLASSPATH:       /usr/local/apache-tomcat-7.0.68/bin/bootstrap.jar:/usr/local/apache-tomcat-7.0.68/bin/tomcat-juli.jar
Tomcat started.
[root@localhost bin]# ./shutdown.sh

启动并打印启动信息：
[root@localhost bin]# ./startup.sh &amp; tailf /usr/local/apache-tomcat-7.0.68/logs/catalina.out
..............###显示启动过程的日志信息
INFO: Server startup in 1567 ms</code></pre><h2 id="MYSQL"><a href="#MYSQL" class="headerlink" title="MYSQL"></a>MYSQL</h2><p>CentOS上安装MySql官方推荐使用rpm在线安装的方式进行安装。但是使用在线安装的方式无法修改安装的路径，而且速度慢。</p>
<h3 id="1、复制MySQL道服务器-usr-local-tmp"><a href="#1、复制MySQL道服务器-usr-local-tmp" class="headerlink" title="1、复制MySQL道服务器/usr/local/tmp"></a>1、复制MySQL道服务器/usr/local/tmp</h3><h3 id="2、解压缩到-usr-local"><a href="#2、解压缩到-usr-local" class="headerlink" title="2、解压缩到/usr/local"></a>2、解压缩到/usr/local</h3><pre><code>[root@localhost local]# tar -zxvf tmp/mysql-5.6.31-linux-glibc2.5-x86_64.tar.gz
修改文件名太长
[root@localhost local]# mv mysql-5.6.31-linux-glibc2.5-x86_64 mysql-5.6.31
[root@localhost local]# ls
apache-tomcat-7.0.68  etc    include  lib    libexec       sbin   src
bin                   games  jdk8     lib64  mysql-5.6.31  share  tmp</code></pre><h3 id="3、创建用户和用户组"><a href="#3、创建用户和用户组" class="headerlink" title="3、创建用户和用户组"></a>3、创建用户和用户组</h3><pre><code>首先：单独为MySQL创建用户和用户组的目的是为了保证mysql服务的独立性，隔离风险；即便mysql服务被黑掉，得到了mysql用户权限，也不会影响整个系统的安全，因为读写不了其他文件。             
其次：所指定的用户是想要运行mysqld进程用户名。这个是可变的，不一定非要是mysql。设置这个用户以后，所有通过mysqld进程创建的文件都会属于这个用户。
添加名为mysql用户组
[root@localhost local]# groupadd mysql
创建用户mysql，并指定所属组为mysql
[root@localhost local]# useradd -r -g mysql mysql</code></pre><h3 id="4、赋权，让用户组合用户具有操作权限"><a href="#4、赋权，让用户组合用户具有操作权限" class="headerlink" title="4、赋权，让用户组合用户具有操作权限"></a>4、赋权，让用户组合用户具有操作权限</h3><pre><code>一定要保证在需要赋予某个目录权限的这个目录中操作；.号表示本级目录。
变更mysql用户组具有操作本级目录的权限：
[root@localhost mysql-5.6.31]# chgrp -R mysql .
变更mysql用户具有操作本级目录的权限：
[root@localhost mysql-5.6.31]# chown -R mysql .
上面两条命令可以同时换成一条来完成操作：
chown -R mysql:mysql ./
mysql:mysql，第一个mysql是用户名，第二个mysql是组名
chown -R mysql:mysql /usr/local/mysql-5.6.31  #这种也可以</code></pre><h3 id="5、初始化（安装数据库注册服务）"><a href="#5、初始化（安装数据库注册服务）" class="headerlink" title="5、初始化（安装数据库注册服务）"></a>5、初始化（安装数据库注册服务）</h3><pre><code>判断/etc/my.cnf（mysql全局配置文件）是否存在，如果存在，则删除。
[root@localhost mysql-5.6.31]# ls /etc/my.cnf
/etc/my.cnf
[root@localhost mysql-5.6.31]# rm /etc/my.cnf
rm: remove regular file `/etc/my.cnf&apos;? y
[root@localhost mysql-5.6.31]# ls /etc/my.cnf
ls: cannot access /etc/my.cnf: No such file or directory
执行初始化脚本文件
[root@localhost mysql-5.6.31]# ls scripts
mysql_install_db
[root@localhost mysql-5.6.31]# ./scripts/mysql_install_db --user=mysql #使用mysql用户执行该脚本</code></pre><h3 id="6、修改配置文件"><a href="#6、修改配置文件" class="headerlink" title="6、修改配置文件"></a>6、修改配置文件</h3><pre><code>配置my.cnf和启动文件，如没有特殊操作，直接复制mysql服务启动配置文件到/etc/下并重命名为my.cnf
[root@localhost mysql-5.6.31]#  cp support-files/my-default.cnf /etc/my.cnf
其实步骤5中的判断/etc/my.cnf可以不用，如果文件存在会提示是否覆盖？
[root@localhost mysql-5.6.31]#  cp support-files/my-default.cnf /etc/my.cnf
cp: overwrite `/etc/my.cnf&apos;? y
配置启动服务文件
将mysql加入到可控制启动的服务的文件夹内，并命名mysql，就可以用service mysql start控制启动mysql
[root@localhost mysql-5.6.31]# cp support-files/mysql.server /etc/rc.d/init.d/mysql
    /etc/init.d 是/etc/rc.d/init.d的链接，在/etc/init.d添加一个文件会同步在/etc/rc.d/init.d下添加一个相同文件
测试出问题：
[root@localhost mysql-5.6.31]# service mysql-5.6.31 start
/etc/init.d/mysql-5.6.31: line 256: my_print_defaults: command not found
/etc/init.d/mysql-5.6.31: line 276: cd: /usr/local/mysql: No such file or directory
Starting MySQL ERROR! Couldn&apos;t find MySQL server (/usr/local/mysql/bin/mysqld_safe)

原因是我的MySQL文件夹带了版本信息，目录名不是默认mysql，解决办法在MySQL全局配置/etc/mycnf中设置MySQL的主目录。
[root@localhost init.d]# vim /etc/my.cnf  
basedir=/usr/local/mysql-5.6.31
datadir=/usr/local/mysql-5.6.31/data
或者
vim /etc/init.d/mysql
#   basedir=&lt;path-to-mysql-installation-directory&gt;
basedir=/usr/local/mysql-5.6.31
datadir=/usr/local/mysql-5.6.31/data
保存，再测试---通过
[root@localhost mysql-5.6.31]# service mysql start
Starting MySQL.. SUCCESS!

开机自启动mysql服务
让mysql服务加入到开机启动指令管理的服务列表中，前提是服务文件拷贝到init.d下
chkconfig --add mysql
显示服务列表：chkconfig --list
如果mysql服务的345都是no的话则执行：
chkconfig mysql on
否则执行如下命令：
chkconfig --level 345 mysql on
on : 针对的服务有等级限制，具体查询chkconfig详细
验证：reboot重启后，运行netstat -na | grep 3306有监听说明成功</code></pre><h3 id="7、命令行操作MySQL"><a href="#7、命令行操作MySQL" class="headerlink" title="7、命令行操作MySQL"></a>7、命令行操作MySQL</h3><pre><code>以上配置没有问题，启动服务后可以通过命令进入MySQL命令行模式：
[root@localhost mysql-5.6.31]# mysql -u root -p
-bash: mysql: command not found
提示没有命令，需要添加软连接，把mysql中/bin/mysql添加到/usr/bin/中，类似windows中添加一个可执行文件的path或者快捷方式。
[root@localhost mysql-5.6.31]# ln -s /usr/local/mysql-5.6.31/bin/mysql /usr/bin/mysql
这样就可以使用mysql命令行了
[root@localhost mysql-5.6.31]# mysql -u root -p
Enter password:
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 1
...
Type &apos;help;&apos; or &apos;\h&apos; for help. Type &apos;\c&apos; to clear the current input statement.
mysql&gt; show databases ;
+--------------------+
| Database           |
+--------------------+
| information_schema |
| mysql              |
| performance_schema |
| test               |
+--------------------+
4 rows in set (0.11 sec)</code></pre><h3 id="8、设置root密码"><a href="#8、设置root密码" class="headerlink" title="8、设置root密码"></a>8、设置root密码</h3><pre><code>如果忘记密码无法登陆，则先通过启动安全模式的方式进入到mysql后修改密码。
进入/etc/my.cnf 在[mysql]下添加skip-grant-tables 启动安全模式   vi /etc/my.cnf
重启服务：service mysql restart
登录mysql，输入密码时直接回车mysql -u root -p
修改mysql数据库中的user表的password，5.7版本以下才有这个列，5.7及其上密码列为authentication_string：mysql&gt; use mysql
Database changed
mysql&gt; update user set password=password(&apos;123456&apos;) where user=&apos;root&apos;;
刷新权限：
mysql&gt; flush privileges;
Query OK, 0 rows affected (0.02 sec)
退出，重新连接，测试ok
[root@localhost mysql-5.6.31]# mysql -u root -p123456
Warning: Using a password on the command line interface can be insecure.
Welcome to the MySQL monitor.  Commands end with ; or \g.</code></pre><h3 id="9、设置远程连接（外部访问数据库）"><a href="#9、设置远程连接（外部访问数据库）" class="headerlink" title="9、设置远程连接（外部访问数据库）"></a>9、设置远程连接（外部访问数据库）</h3><pre><code>执行赋予权限命令
mysql&gt;GRANT ALL PRIVILEGES ON *.* TO &apos;root&apos;@&apos;%&apos; IDENTIFIED BY &apos;123456&apos; WITH GRANT OPTION;
刷新权限：
mysql&gt; flush privileges;
注：
grant 权限 on 数据库对象 to 用户
如果想让授权的用户，也可以将这些权限 grant 给其他用户，需要选项 &quot;grant option&quot;
%可能是localhost或192.168.0.%或192.168.%.%等等，所以直接使用%
    grant使用可以参考https://www.cnblogs.com/crxis/p/7044582.html

开启防火墙mysql3306端口的外部访问，CentOS升级到7之后，使用firewalld代替了原来的iptables。
[root@localhost mysql-5.6.31]# vim /etc/sysconfig/iptables
[root@localhost mysql-5.6.31]# service iptables restart
iptables: Setting chains to policy ACCEPT: filter          [  OK  ]
iptables: Flushing firewall rules:                         [  OK  ]
iptables: Unloading modules:                               [  OK  ]
iptables: Applying firewall rules:                         [  OK  ]</code></pre><p>外部测试：</p>
<p><img src="https://img.huyunshun.com/img/20200421165727.png" alt="20200421165727"></p>
<h3 id="10、一系列测试如下"><a href="#10、一系列测试如下" class="headerlink" title="10、一系列测试如下"></a>10、一系列测试如下</h3><pre><code>mysql&gt; show satabases;
ERROR 1064 (42000): You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &apos;satabases&apos; at line 1                 
mysql&gt; show databases;
+--------------------+
| Database           |
+--------------------+
| information_schema |
| mysql              |
| performance_schema |
| test               |
+--------------------+
4 rows in set (0.02 sec)

mysql&gt; create database demo default character set utf8;
Query OK, 1 row affected (0.01 sec)

mysql&gt; use demo
Database changed
mysql&gt; create table user(id int(10) primary key auto_increment, name varchar(20));
Query OK, 0 rows affected (0.08 sec)

mysql&gt; show tables;
+----------------+
| Tables_in_demo |
+----------------+
| user           |
+----------------+
1 row in set (0.00 sec)

mysql&gt; insert into user values(default,&apos;张三丰&apos;),(default,&apos;江小白&apos;);
Query OK, 2 rows affected (0.02 sec)
Records: 2  Duplicates: 0  Warnings: 0

mysql&gt; select * from user;
+----+-----------+
| id | name      |
+----+-----------+
|  1 | 张三丰    |
|  2 | 江小白    |
+----+-----------+
2 rows in set (0.00 sec)</code></pre><h3 id="11、在服务器上如何批量操作sql语句"><a href="#11、在服务器上如何批量操作sql语句" class="headerlink" title="11、在服务器上如何批量操作sql语句"></a>11、在服务器上如何批量操作sql语句</h3><pre><code>拷贝sql脚本文件到服务器
在MySQL命令行中执行脚本文件：source /usr/local/tmp/xx.sql


在mysql有时执行了错误的update或者delete时导致大量数据错误恢复的办法。执行时没有开启事务，也没有对数据进行。这时就需要使用到sqlbinlog工具。

sqlbinlog需要开启，具体的打开方法就不说了。

使用sqlbinlog会产生bin文件，恢复就需要用到这些文件。文件中记录着数据库的所有操作。（此方法的操作是将数据库之前所执行的语句重新执行一次，以达到恢复效果）</code></pre><p>具体步骤：</p>
<pre><code>1，先找到bin文件，一般都是在mysql的data文件夹中，结尾以.00000X等形式结束。
2，寻找需要还原的时间点 使用语句   mysqlbinlog  文件名    例（MySQLbinlog xxbin.000001）来查看内容，然后找到对应的具体时间
3，导出sql语句，使用语句   文件名&gt;sql文件路径   例(mysqlbinlog xxxbin,00001&gt;&gt;a.sql mysql -u root -p
如果需要指定时间导出--start--date -stop=&apos;&apos; &apos; 来导出指定时间执行的语句例(sqlbinlog --start-stop=&apos;2015-11-22 10:00:00&apos;  xxbin.000001&gt;a.sql mysql -u root -p )这句意思是导出在2015-11-22 10点之前的语句，反之start是导出时间之后的。 和stop可以同时使用。
如果存在多个bin文件，则按照需要导出。
4，使用mysql将导出的语句执行一次。</code></pre>
          
        
      
    </div>
     <!-- 相关文章推荐 -->
    
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/23/">上一页</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/23/">23</a><span class="page-number current">24</span><a class="page-number" href="/page/25/">25</a><a class="extend next" rel="next" href="/page/25/">下一页</a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="https://img.huyunshun.com/img/20200522182348.png"
                alt="初晨" />
            
              <p class="site-author-name" itemprop="name">初晨</p>
              <p class="site-description motion-element" itemprop="description">永远不要说你知道本质，更别说真相了。</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/%7C%7C%20archive">
              
                  <span class="site-state-item-count">249</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">46</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">109</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          
<!--近期文章版块-->
            
                <div class="links-of-blogroll motion-element links-of-blogroll-block">
                  <div class="links-of-blogroll-title">
                    <!-- modify icon to fire by szw -->
                    <i class="fa fa-history fa-" aria-hidden="true"></i>
                    近期文章
                  </div>
                  <ul class="links-of-blogroll-list">
                    
                    
                      <li>
                        <a href="/2020/05/22/WebSocket%E3%80%81Socket%E3%80%81TCP%E3%80%81HTTP%E5%8C%BA%E5%88%AB/" title="WebSocket、Socket、TCP、HTTP区别" target="_blank">WebSocket、Socket、TCP、HTTP区别</a>
                      </li>
                    
                      <li>
                        <a href="/2020/05/19/Springboot%E9%A1%B9%E7%9B%AE%E7%9A%84%E6%8E%A5%E5%8F%A3%E9%98%B2%E5%88%B7/" title="Springboot项目的接口防刷" target="_blank">Springboot项目的接口防刷</a>
                      </li>
                    
                      <li>
                        <a href="/2020/05/03/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3Volatile%E5%85%B3%E9%94%AE%E5%AD%97%E5%8F%8A%E5%85%B6%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86/" title="深入理解Volatile关键字及其实现原理" target="_blank">深入理解Volatile关键字及其实现原理</a>
                      </li>
                    
                      <li>
                        <a href="/2020/04/20/%E4%BD%BF%E7%94%A8vscode%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E7%AC%94%E8%AE%B0%E7%8E%AF%E5%A2%83/" title="使用vscode搭建个人笔记环境" target="_blank">使用vscode搭建个人笔记环境</a>
                      </li>
                    
                      <li>
                        <a href="/2020/01/20/HBase%E4%BB%8B%E7%BB%8D%E5%AE%89%E8%A3%85%E4%B8%8E%E6%93%8D%E4%BD%9C/" title="HBase介绍安装与操作" target="_blank">HBase介绍安装与操作</a>
                      </li>
                    
                  </ul>
                </div>
            
          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2018 &mdash; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Copyright</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  


</body>
</html>
